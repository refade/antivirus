(function(d){var c=d.SkbKontur=d.SkbKontur||{},a=d.KasperskyLab=d.KasperskyLab||{},b=a.LIGHT_PLUGIN_API_KEY="klTabId_kis";d[b]=true;c.Help=c.Help||{}})(window);
(function(gM,da,gA){da.Scripts={};function k(w){return(w<10)?("0"+w):String(w)}Date.prototype.toShortString=function(hf,e0){var w=[k(this.getDate()),k(this.getMonth()+1),this.getFullYear()].join(".");
if(hf){w+=" "+k(this.getHours())+":"+k(this.getMinutes());if(e0){w+=":"+k(this.getSeconds())}}return w};function cN(){return new Date().getTime()}if(!Date.now){Date.now=cN
}var eh=null,gx=true,bd=false,dN="2.14.26.54",g7={Error:-1,Timeout:-2,BadXhr:-3,NoMsXml:-4,BadUrl:-5},A={},ev={},dr=bd,dA=bd,dz=bd,eM="REG_BINARY",eN="REG_DWORD",eO="REG_EXPAND_SZ",eP="REG_MULTI_SZ",eQ="REG_QWORD",eR="REG_SZ",de=2147483648,df=2147483649,dg=2147483650,dh=2147483651,bf=1,bg=2,bh=4,e7="HKCR\\",e8="HKCU\\",e9="HKLM\\",fa="HKU\\",fo={"0x80000000":e7,"0x80000001":e8,"0x80000002":e9,"0x80000003":fa,"2147483648":e7,"2147483649":e8,"2147483650":e9,"2147483651":fa,"-2147483648":e7,"-2147483647":e8,"-2147483646":e9,"-2147483645":fa},fu="SOFTWARE\\",eV=fu+"Classes\\",fv=fu+"Clients\\StartMenuInternet\\",fc=fu+"Microsoft\\",aF="CurrentVersion",fy=fc+"Windows\\",eY=fy+aF+"\\",eZ=fc+"Windows NT\\"+aF+"\\",eX="SYSTEM\\CurrentControlSet\\",eW=eX+"Control\\",fp=eX+"Services\\",fs="shell\\open\\",ft=fs+"command\\",fN="https://help.kontur.ru",aU="/content/components/",di=new RegExp("^https?://","i"),d2={},d4=bd,d1={},dZ={fatal:ce("fatal",gM.alert),error:ce("error"),info:ce("info"),debug:ce("debug"),send:ce("send"),attach:r,detach:aS},z="Не задан пароль для учетной записи администратора",Z={401:z,632:"Некорректные аргументы для начала установки",740:"Не удалось получить права администратора",1168:"Нет API для запуска инсталлятора",1223:"Не хватило прав для начала установки",1327:z,1500:"В данный момент устанавливается другая программа",1602:"Пользователь отменил установку"},gF={clientTime:gM.clientTime,clientDate:gM.clientDate,serverTime:gM.serverTime,serverDate:gM.serverDate,defaultParams:{},certsByThumb:{},downloadSpeed:0,downloadSize:0,downloadUpdateInterval:0,distrPath:aU,innkpps:[],installing:bd,log:"",logTime:cN(),maxUploadFileCount:gA,maxUploadFileSize:gA,originUrl:fN,dispatches:{},processes:{},rootPath:fN+aU,skipTests:{},files:{}};
function gk(e0,w){var hf=new RegExp(e0,w);return function(hg){return hf.test(hg)}}if(!gF.clientTime){gF.clientDate=new Date();gF.clientTime=gF.clientDate.getTime();
gF.clientTimeError=1;dZ.error("Ошибка получения времени клиента")}if(!gF.serverTime){gF.serverDate=new Date();gF.serverTime=gF.serverDate.getTime();gF.serverTimeError=1;
dZ.error("Ошибка получения времени сервера")}function dy(){return(gM.oHTA&&gM.oHTA.commandLine)||bN("XUACompatible")}function ci(){return gM.navigator||gM.clientInformation
}function cU(){var w=ci();return w?w.userAgent:eh}function eq(e0,w){var hf=w||cU();if(hf&&hf.length){var hg=hf.split(new RegExp(e0,"i"));if(hg.length>1){return parseFloat(hg[1].split(new RegExp("[^\\d\\s\\.]"))[0])
}}return 0}function cY(){return eq("Windows NT")}function cT(w){return eq("Trident\\/",w)}function cf(e0,w){if(!e0){var hi=cT(w);if(hi>0){return hi+4}}var hh=eq("MSIE\\s*",w),hf=!hh&&!eq("Firefox\\/",w)&&eq("rv:",w),hg=!hh&&eq("Edge\\/",w);
return hh||hg||hf}function aT(hj,hk){if(!hj){return""}function hf(ho){var hn=hj.match(ho);return(hn&&(hn.length>1)&&hn[1])||""}var hm=hf(new RegExp("version\\/(\\d+(\\.\\d+)?)","i")),hg=new RegExp("(?:msie\\s|rv:|edge\\/)(\\d+(\\.\\d+)?)","i"),hi=cf(bd,hj),hl=hk?(!!gM.opera&&gM.opera.version&&gM.opera.version()):"",e0="Неизвестный браузер",w=eh,hh=bd;
if(hl||gk("opera","i")(hj)){hl=hl||hf(new RegExp("YaBrowser\\/(\\d+(\\.\\d+)*)","i"));e0="Opera";w="browser_opera.png"}else{if(hk&&!!gM.chrome&&gk("edge\\/","i")(hj)){hl=hi||+hf(hg);
if(12==hl){hl="11.0 (Windows 10)"}e0="Microsoft Edge";w="browser_ie.png"}else{if(gk("YaBrowser\\/","i")(hj)){hl=hf(new RegExp("YaBrowser\\/(\\d+(\\.\\d+)*)","i"));
e0="Яндекс.Браузер";w="browser_yandex.png"}else{if(gk("OPR\\/","i")(hj)){hl=hf(new RegExp("OPR\\/(\\d+(\\.\\d+)*)","i"));e0="Opera";w="browser_opera_new.png"
}else{if(gk("Amigo\\/","i")(hj)){hl=hf(new RegExp("Amigo\\/(\\d+(\\.\\d+)*)","i"));e0="Амиго";w="browser_amigo.png"}else{if(gk("MRCHROME","i")(hj)){hl=hf(new RegExp("Chrome\\/(\\d+(\\.\\d+)*)","i"));
e0="Интернет@Mail.Ru";w="browser_internet.png"}else{if(gk("Vivaldi\\/","i")(hj)){hl=hf(new RegExp("Vivaldi\\/(\\d+(\\.\\d+)*)","i"));e0="Vivaldi";w="browser_vivaldi.png"
}else{if(gk("Nichrome\\/self\\/","i")(hj)){hl=hf(new RegExp("Nichrome\\/self\\/(\\d+(\\.\\d+)*)","i"));e0="Рамблер.Браузер";w="browser_rambler.png"}else{if(gk("SputnikBrowser","i")(hj)){hl=hf(new RegExp("SputnikBrowser/(\\d+(\\.\\d+)*)","i"));
e0="Спутник";w="browser_sputnik.png"}else{if(hi||gk("edge\\/","i")(hj)){hl=hi||+hf(hg);if(12==hl){hl="11.0 (Windows 10)"}e0="Internet Explorer";w="browser_ie.png"
}else{if(gk("Maxthon|MyIE2","i")(hj)){hl=hf(new RegExp("Maxthon\\/(\\d+(\\.\\d+)?)","i"))||hi||+hf(hg);e0="Maxthon";w="browser_maxthon.png"}else{if(gk("chrome|chromium|crios|crmo","i")(hj)){hl=hf(new RegExp("(?:chrome|crios|crmo)\\/(\\d+(\\.\\d+)*)","i"));
e0="Google Chrome";w="browser_chrome.png"}else{if(gk("SeaMonkey\\/","i")(hj)){hl=hf(new RegExp("SeaMonkey\\/(\\d+(\\.\\d+)*)","i"));e0="SeaMonkey";w="browser_seamonkey.png"
}else{if(gk("firefox|iceweasel","i")(hj)){hl=hf(new RegExp("(?:firefox|iceweasel)[\\s\\/](\\d+(\\.\\d+)*)","i"));e0="Mozilla Firefox";w="browser_firefox.png"
}else{if(gk("safari","i")(hj)){hl=hf(new RegExp("safari\\/(\\d+(\\.\\d+)*)","i"));e0="Safari";w="browser_safari.png"}else{if(gk("webkit","i")(hj)){hl=hm
}else{if(gk("gecko\\/","i")(hj)){hl=hm}}}}}}}}}}}}}}}}}if(gk("[;\\s](Win64|x64)[;\\)]","i")(hj)){hh=gx}return{name:e0,version:hl,icon:w,isX64:hh}}(function(){var hz=ci(),hE=cU(),hk=hz?hz.buildID:eh,hH=bd,hI=gx,hA=bd,ho=bd,hl=bd,hs=bd,hn=bd,hC=bd,hF="",hj="";
if(gk("windows","i")(hE)){A.windows=gx}if(gk("[;\\s](Win64|x64)[;\\)]","i")(hE)){hH=gx}else{if(!(gk("[;\\s]WOW64[;\\)]","i")(hE))){hI=bd}}var hi=aT(hE,gx);
hj=hi.name||"";hF=hi.version||"";var hy=Number(String(hF).split(".")[0]||0);switch(hj){case"Opera":hA=gx;dA=hy<37;dz=hy>28;break;case"Microsoft Edge":hn=gx;
break;case"Яндекс.Браузер":A.yabrowser=gx;var hB=String(hF).split("."),hx=hB[0]>16||(16==hB[0]&&hB.length>1&&hB[1]>=6);dz=hx;dA=!hx;break;case"Amigo":case"Амиго":A.amigo=gx;
dz=gx;break;case"Браузер@Mail.Ru":case"Интернет@Mail.Ru":A.internet=gx;dA=gx;break;case"Vivaldi":case"Спутник":dz=gx;break;case"Рамблер.Браузер":dA=gx;
break;case"Maxthon":A.maxthon=gx;dA=hy<5;dz=hy>4;break;case"Google Chrome":hl=gx;dA=hy<42;dz=hy>28;break;case"Mozilla Firefox":ho=gx;dA=hy<55;dz=hy>=50;
break;case"Safari":hC=gx;break;default:if(!!gM.sidebar&&gk("SeaMonkey\\/","i")(hE)){dA=gx}else{if(gk("msie\\s|rv\\:|(edge|trident)\\/","i")(hE)||("ActiveXObject" in gM)){hs=gx;
dr=gx}else{if(gk("webkit","i")(hE)){dA=gx}else{if(gk("gecko\\/","i")(hE)){dA=gx}else{A.unknown=gx;dZ.error("Браузер не распознан")}}}}break}A.errors={ok:0,noKd:-1,badAx:-2,notTrusted:-3,badBrowser:-4,kdNotTrusted:-5,trustedSites:-6,notWindows:-7,denySystem:-8,oldWindows:-9};
A.userAgent=hE;A.arch=hH?64:32;A.win64=hH;A.wow64=hI;A.winNTVer=eq("Windows\\sNT\\s*");A.ax=dr;A.np=dA;A.nc=dz;A.ie=hs;A.edge=hn;A.safari=hC;A.opera=hA;
A.firefox=ho;A.chrome=hl;A.version=hF;var hr={"20170303022339":gx,"20170316213902":gx,"20170323110425":gx,"20170417065206":gx,"20170504112025":gx,"20170517122419":gx,"20170607123825":gx,"20170627155318":gx,"20170802111520":gx,"20170921064520":gx,"20171005074949":gx,"20171107091003":gx,"20171128121223":gx,"20171206101620":gx,"20171226003912":gx,"20180118122319":gx};
var hf=(hs&&((hy<8)||hH)),hg=(hA&&(hy<10||hy>=38)),hG=(ho&&(hy>=52)&&(!hk||!hr[hk])),hp=gF.productVersions&&gF.productVersions.FirefoxBadMin||55,e0=ho&&(hy<17||(hG&&(hy>=hp))),w=hn||hC||(!dr&&!dA),hh=hH&&(hl||ho);
A.bad=gM.isBotFound||w||hh||hf||hg||e0;A.warn=A.bad||hG;if(hs){hj="Internet Explorer"}A.name=hj;hj=hj||"Unknown";if(hF){hj+=" "+hF}if(hH){hj+=" (64-bit)"
}A.fullName=hj;try{var hq=A.get={},hD=gM.location.search.slice(1);bu(hD.split("&"),function(hL){if(hL.indexOf("=")>=0){var hK=hL.split("=");hq[hK[0]]=hK[1]
}else{hq[hL]=true}})}catch(hm){}var ht="IE8-WindowsServer2003-x64-ENU.exe",hv="IE8-WindowsServer2003-x64-RUS.exe",hu="7/5/4/754D6601-662D-4E39-9788-6F90D8E5C097/",hw="1/2/E/12E9B74E-9099-4922-B313-220C45ACDDA2/",hJ={rus:{file:hv,link:hw},eng:{file:ht,link:hu}};
A.updateInfo={"8":{XP:{x64:hJ,x86:{rus:{file:"IE8-WindowsXP-x86-RUS.exe",link:"D/6/9/D693B7D9-C8E3-4D15-B3D2-59843A8DE90B"},eng:{file:"IE8-WindowsXP-x86-ENU.exe",link:"C/C/0/CC0BD555-33DD-411E-936B-73AC6F95AE11"}}},Server2003:{x64:hJ,x86:{rus:{file:"IE8-WindowsServer2003-x86-RUS.exe",link:"7/C/C/7CC257AA-C4BB-4BF9-8968-45C7229BA0A4"},eng:{file:"IE8-WindowsServer2003-x86-ENU.exe",link:"7/5/0/7507EBD5-0193-4B7F-9F14-9014C7EB5C67"}}},Vista:{x64:{rus:{file:"IE8-WindowsVista-x64-RUS.exe",link:"B/B/3/BB35C235-BAA3-43C6-885E-237290E23533"},eng:{file:"IE8-WindowsVista-x64-ENU.exe"}},x86:{rus:{file:"IE8-WindowsVista-x86-RUS.exe",link:"D/0/5/D0506F22-0081-47AD-9EBE-9C4EBC0640B7"},eng:{file:"IE8-WindowsVista-x86-ENU.exe"}}}},"9":{Vista:{x64:{rus:{file:"IE9-WindowsVista-x64-rus.exe",link:"C/1/5/C15EA7C3-415D-4B10-85CF-77BA9DED3AA3"},eng:{file:"IE9-WindowsVista-x64-enu.exe"}},x86:{rus:{file:"IE9-WindowsVista-x86-rus.exe",link:"2/9/D/29DC74DF-AD43-4543-BE9B-99001C6601D8"},eng:{file:"IE9-WindowsVista-x86-enu.exe"}}},"7":{x64:{rus:{file:"IE9-Windows7-x64-rus.exe"},eng:{file:"IE9-Windows7-x64-enu.exe"}},x86:{rus:{file:"IE9-Windows7-x86-rus.exe"},eng:{file:"IE9-Windows7-x86-enu.exe"}}}},"10":{"7":{x64:{rus:{file:"IE10-Windows6.1-x64-ru-ru.exe"},eng:{file:"IE10-Windows6.1-x64-en-us.exe"}},x86:{rus:{file:"IE10-Windows6.1-x86-ru-ru.exe"},eng:{file:"IE10-Windows6.1-x86-en-us.exe"}}}},"11":{"7":{file:"IE11-Windows6.1.exe"}}};
A.checkBad=function(){if(dr&&hH){var hO=document.getElementById("browser-fixie64");hO.style.display="";hO.style.visibility="visible"}if(ho&&!hH&&(hy>=52)&&(hy<55)){var hN=document.getElementById("browser-fixff53");
if(hN){hN.style.display="";hN.style.visibility="visible"}}document.getElementById("browser-name").innerHTML=A.fullName;var hW=cY();if(hs&&(hy<8)){var hS=String(hz.language||hz.systemLanguage||hz.userLanguage||"").toLowerCase(),hT=("ru"===hS||"ru-ru"===hS)?"rus":"eng",hK=(hH||hI)?"x64":"x86",hV=(6==hW)?"Vista":((5.2==hW)?"Server2003":"XP"),hR=A.updateInfo["8"][hV][hK][hT],hP=hR.file,hQ=fN+aU+hP,hL=document.getElementById("ie-update-link"),hU=hL.innerHTML||"Internet Explorer";
if(hU.indexOf(hP)<0){hL.innerHTML='<a rel="nofollow noopener" target="_blank" href="'+hQ+'">'+hU+"</a>"}}if((hW>0)&&(hW<6.1)){var hM=document.getElementById("ff-setup-link");
hM.style.display="block";hM.style.visibility="visible"}};A.stdCheck=function(hK){if(!A.windows){throw"badOS"}if(A.bad){A.checkBad();throw"badBrowser"+(hn?"Edge":"Error")
}return ey.fork(dr,hK,function(){return cR("kd").then(function(hL){if(hL===eh){throw"kdNeeded"}if(hL===bd){throw"needAllowPlugins"}return !!hL})}).truth(gx,bd,function(hL){return hL
}).then(function(hL){if(gx===hL){return gx}if(A.warn){A.checkBad();throw"badBrowser"+(hn?"Edge":"Error")}throw (bd===hL)?"trustNeeded":hL})};A._installExtension=function(){};
A.installExtension=function(){return A._installExtension.apply(A,arguments)}})();function cS(w){for(var e0=0,hf=w.length;e0<hf;++e0){w[e0]=String(w[e0]).split("").join("\\w?")+"\\w?"
}return w.join("|")}var fT=(function(){function w(hf){var e0=hf.replace(/\\["\\\/bfnrtu]/g,"@");e0=e0.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");
e0=e0.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(e0)){return(new Function("return ("+hf+");"))()}else{dZ.error("Попытка передать опасный JSON: "+hf,gA,gA,"badJSON");
return""}}if(gM.JSON&&(typeof gM.JSON.parse=="function")){return function(hf){try{return gM.JSON.parse(hf)}catch(e0){return w(hf)}}}return w})();var gL=cS(["AppSave","ApptoU","BestSaveForYou","BetterPriceChec","Browse2Save","BrowseAndShop","BuyAndBrowse","BuyFast","CheapAll","Cheap4all","CheapCoup","ClickForSale","CoolCheap","CouponCheapCha","CouponPeak","CoupScaner","DailyPrize","Deal2DealIt","Deal4me","Deal4real","DealExpress","DealsFinderPro","DealSter","DigiCoupon","DigiSaver","DiscountLocator","DollarSaver","Download keeper","DownloadItKeep","DownSave","EarnSale","EasyToShop","ExtraCoupon","ExstraSavings","ExtraShopper","FastSaler","FineDealSoft","FlashCoupon","FlexibleShopper","FreeDelivery","Free2you","FunDeal","GoSave","GreatSave4U","greatsavIng","Isaver","JonCoupon","KeepersoEXto","KingCoupon","Less2pay","LowPrices","LowRate","LuckyCoupon","MinimumPrice","NeToCoupon","NiceFree","NiceNFree","NitroDeal","OfferApp","OfferDeal","OfferSale","OfferSoft","PrizeCoupon","ProShopper","QueenCoupon","QuickShop","RandomPrice","RealDeal","RegularDeal","RoboSaver","RocketDeal","RocketSale","RoyalShopperApp","SafeWeb","SaleItCoupon","SaleMagNet","SaleOffer","SalePrizes","SaveAddon","saveiriBox","SaveLot","SaveNewAApp","SaverExtension","SaverNet","saVEron","SavErPro","savinshop","SharkManCoupon","ShopNDrop","ShopperMaster","ShopperMoster","SoftCoup","SuperManCoupon","SurfKeepIt","SystemSafeguard","TakeOrLeave","TakeSave","TakeShop","TerminusExtender","TicTeaCoupon","TopBuyer","topdeal","tPerfectCoupon","WowCoupon","YoutubeAdBlock"]),gN=["360 Total Security","AMICON|Avest CSP|eToken (for|для) Signal\\-?COM","JC\\-?(GOST|Pro)?Client","LISSI\\-?CSP|ПК [\\\"\\']?ЛИССИ\\-?CSP","Signal\\-?Com (CryptoProvider|CSP)|Tumar CSP|ViPNet CSP","Валидата CSP|(Континент|Continent) TLS (Клиент|Client)|КриптоНУЦ|СКЗИ (Агава|Верба\\-ОW)"].join("|");
var ai=da.Core={veryBadPrograms:gL,addZero:k,warnPrograms:new RegExp(("^ ("+gN+")").replace(new RegExp("\\s+","g"),"\\s*"),"i"),badPrograms:new RegExp(("^ ("+[gL,gN,"50 FREE MP3s|a2zLyrics|Adanak|Adguard|adusy $|AdvanceElite|AI Suite II|AlterGeo|Amazon Assistant 10\\.|Amazon 1Button App|AMD Quick Stream|AnyProtect $|AnySend $|App Bud $|AppEnable $|AppptOU|AppSafe $|AppSuper $|Ask Toolbar|aswast|AtuZi|AVG Security Toolbar|AVG Web TuneUp","Baidu Antivirus|baidu version|BatBrowse $|Bellaphant|BetterBrowse $|Better Surf|Bing Bar|BitGuard|BitSaveerr|Blacount|BlockAndSurf|Body Text Feathering|Bonanza Deals|BonusBerry|Brass Search|BringStar $|Brothersoft Toolbar|BrowseBurst|BrowseFox $|BrowseMark|Browser AdBlocker|BrowserDefender|Browser Extensions $|BrowseSmart|BrowseStudio|BS\\-Defender|BuzzSearch","Caramava $|CA Research $|ChampionDeals|(CinemaP|Cinema Plus (Pro)?|Cinema Video|CiPlus) \\-? (\\d+\\.?\\d*[a-z])?V\\d+\\.\\d+|Cinemax $|CinepPlayer \\d+ Update|ClearThink $|Click Caption|Colour Separation Point Of Sale|Conduit Engine|Content Defender|ContentProtector|ConvertAd $|coupcoup|Coupon Downloader|CouponFactor|coupon monkey|CPU Miner|Crossbrowse $|CutterEdit|Cyti Web","Deal Keeper|DealPly|DefaultTab $|Discount_Frenzy|DiscountLocator|DiVapton $|DNS Unlocker version|Download Manager Packages|Download Master","eDealsPop|EnhanceTronic|EnterDigital $|enterprise 1\\.1|Eseller|Extended Update $|EZDownloader","Fast And Safe|Faster Light|FastPlayer $|FilesFrog Update|FindRight|Foxit Toolbar|Framed Display|Friendly Error|FullScreen for GoogleMaps|Funmoods","Gameo $|GamesDesktop [\\d\\.]+ $|Ge\\-Force $|Genie Cleaner|Genie Wifi|GeoSurf $|GetTheDiscount|goopad $|GrabRez|GrabMyRez|Greener Web|GreyGray $|Guard.Mail\\.Ru","Hands\\-free LAN|Hands\\-free Subscript|HDefsoft|Higher Aurum|Hold Page $|HomePageDefender|Homepager $|HQ Cinema Pro|HQ Cinema Video|HQ\\-Video\\-Pro|Html5 geolocation provider|HttpFilter $|HulaToo|HypeNet $","ICQ Toolbar|IePluginService|iExpert $|IGS $|igsc $|InboxAce $|IncludeFoobar $|IncludeFunc $|InfiniNet $|Infonaut [\\d\\.]+|Intel Security True Key|InterBank RS|Internet Download Manager|Internet Explorer Toolbar [\\d\\.]* by SweetPacks|Internet Program $|Internet Speed Checker|IObit Uninstaller|IOLA Crypto|istartpageing|istartsurf","Jads $|Jotzey $|Jump Flip $","Lampy Lighty|LemurLeap|LinkFunc|LinkSwift $|Link Wiz [\\d\\.]+|LirSSL \\d|LiveWPPUpdate|luckysearches uninstall|LuckyShopper|Lucky Video Converter","MadLen\\.uCoz\\.coM|Mail\\.Ru Спутник|MaintenanceService [\\d\\.]+|MaxDownload|Media Buzz|MediaCaster by Ask|Media Player 1\\.1|Media Player Z|MediaPlayerApplication\\d+|Media Saver|Media View|Media Watch|MedPvid\\d+\\.\\d+|Mega Browse|metaCrawler|MicroHomeSafe|Mini Bld Base Service|Mobogenie|MossNet $|moters $|Movies Search App|Movies Toolbar for|MyAshampoo Toolbar|mycomputer $|MySafeProxy|mystartsearch","NetCrawl|Net Safety Addon|Noticeboard Renew","OffersWizard Network System Driver|omiga\\-plus uninstall|omniboxes uninstall|Oovoo Toolbar|Optimizer Pro|oursurfing uninstall","PacFunction $|Pandora Service|PathMaxx|PBot $|PC Speed Up|PennyBee|PFHttpContentFilter|Phrase Finder|PlusHD_(\\d+\\.?\\d*[a-z])?V\\d+\\.\\d+|Poaaa|PodoWeb $|Pop\\-Up Stopper Free Edition|PortalMore $|PrettyPrint $|PriceFountain|PrivDog","QIP Internet Guardian|Quick Ref [\\d\\.]+|Quiknowledge","Radio W Toolbar|Red AdBlocker|Reimage Repair|RelieverPro|Remote Desktop Access \\(VuuPC\\)|ResultsBay $|Rich Media View|RightSurf|Rock Turner $","Safer\\-Surf|sale\\-o $|SalesMagnet|Satellite Comma|SaveAs[\\s\\d\\.]*$|SaveByclick|SavePass|Save to Me $|sCloudStatusCheck|Screentool \\-|ScreenUp $|Search App by Ask|Search Protect $|Search Protection $|Search Snacks|Secret Net|Sense $|SerialTrunc $|Settings Manager $|.*Se7en Dark-Blue|SG Miner|Shopper\\-?Pro|shoppilation|Shopping App by Ask|ShoppingDealFactory|shopshop|ShowPass Smartbar|SimilarSites $|Sm23mS|Smart Application Controller $|SmarterPower|SmartWeb $|SmilesExtensions version|Smileys We Love Toolbar for IE|Social2Search|Social Search App by Ask|Software Version Updater|Solution Real|SpaceSoundPro|SpadeCast|Speed Analysis \\d+|SpeedCheck $|SpeeditUp|Speed Test \\(\\d+\\)|SquirrelWeb|StaffCop|StartNow Toolbar|StatInit $|Steel Cut $|storegid $|SunnyDay $|SunriseBrowse $|Super Fast Download Manger Packages|Superfish Inc|Super Optimizer|SupTab $|Surfing Protection|Surftastic|SVH $|sweet[\\-\\s]*page|SwiftSearch|SwizzleBiz|SyManager $|SystemAssister $|SystemSave $|SystemUphold $","TablacusApp|Techgile|Term Tutor $|TerminusMaker|The Sea App|Ticno multibar|Ticno Tabs|Time tasks $|ToggleMark|TomorrowGames|Torrent Search|TowerTilt|Traffic Inspector User Agent|Treasure Track|Trust Media Viewer|TSearch|Ttessab|TubeStop","Update for Html5 geolocation provider|Update for PriceFountain|Update for Video Converter|Update Manager for SweetPacks|UpgraderCreator|Uptolike\\.Toolbar version","V\\-bates|Video and Audio Plugin UBar|Video Camera Log Onto|Video Converter Packages|Video\\s+Player $|VK Downloader|VkontakteDJ|VKSaver|VTope|VuuPC","WeatherChickn|WebBars|WebConnect|Webexp Enhanced|Webfuii|webget|Web Protector Plus|WebSafetyExtension|WebSecurity Extension version|WebSecurityProg|WebSpades|WebSparkle|webssearches|webwebget|Whilokii|WinCheck $|WinDealist|WindeskWinsearch|WindowsMangerProtect|WindowsProtectManger|WinSpeed|WinZipper|WiseEnhance|Word Count Close|WPM[\\s\\d\\.]+$","x\\-rates|X PROJECT NEW LOOK 3|X PROJECT Personalization Panel","YAC\\(Yet Another Cleaner\\!\\)|Yawtix|Yellow AdBlocker|yoursearching uninstall|YTDownloader|Yulasee","ZaxarGameBrowser|ZaxarLoader|Zaxar Games Browser 4|Zona $|ZPro $","Аудио и видео скачивание","Кнопка.*Яндекс","Менеджер браузеров $","Панель Bing","Служба автоматического обновления программ $|Спутник\\@Mail\\.Ru|СЭП ПБЗИ СКЗИ [\\\"\\']?ЛирССЛ","Элементы Яндекса \\d+\\.\\d+ для Internet Explorer","Яндекс\\.Строка"].join("|")+")").replace(new RegExp("\\s+","g"),"\\s*"),"i"),kdActualVersion:dN,badPluginsRegex:/(BonanzaDealsLive\s*Update)|(Trolltech)/i,kdBuild:0,XHR:g7,browser:A,plugins:ev,HKCR:de,HKCU:df,HKLM:dg,HKU:dh,regHKCR:e7,regHKCU:e8,regHKLM:e9,regHKU:fa,regRoots:fo,REG_BINARY:eM,REG_DWORD:eN,REG_EXPAND_SZ:eO,REG_QWORD:eQ,REG_SZ:eR,certViewPrivate:1,certViewCA:2,certViewOther:3,certViewRoot:4,certViewDisallowed:5,rootUrl:fN,registerUrl:fN+"/diagnostics/register",logUrl:fN+"/diagnostics/log",certOID:"OID.1.2.840.113549.1.9.2",newCertOID:eh,regCertOID:"1.2.840.113549.1.9.2!5",regOidPath:"Microsoft\\Cryptography\\OID\\EncodingType 0\\CryptDllFindOIDInfo\\",regSoftware:fu,regMicrosoft:fc,regClasses:eV,regCurVer:eY,regCurVerNT:eZ,cspSerialHint:"Серийный номер лицензии можно найти на бланке с заголовком\\n«Лицензия на право использования на одном рабочем месте MS Windows программного продукта КриптоПро CSP»",vars:gF,js:{},getTimeline:cO,getTimeZone:cQ,log:dZ,trackEvent:gt,winVersions:{"5":"Windows 2000","5.0":"Windows 2000","5.1":"Windows XP","5.2":"Windows 2003","5.2x64":"Windows 2003 x64 или Windows XP x64","6":"Windows Vista или Windows 2008","6.0":"Windows Vista или Windows 2008","6x64":"Windows Vista x64 или Windows 2008 x64","6.0x64":"Windows Vista x64 или Windows 2008 x64","6.1":"Windows 7","6.1x64":"Windows 7 x64 или Windows 2008 R2","6.2":"Windows 8","6.2x64":"Windows 8 x64 или Windows 2012","6.3":"Windows 8.1","6.3x64":"Windows 8.1 x64 или Windows 2012 R2","6.4":"Windows 10","6.4x64":"Windows 10 x64 или Windows 2016","10":"Windows 10","10.0":"Windows 10","10x64":"Windows 10 x64 или Windows 2016","10.0x64":"Windows 10 x64 или Windows 2016"},codeToMessages:Z,bind:x,call:G,getProductInstallInfo:cw,timeTicksToDays:gp,getLicenseInfo:cc,getFile:bS,getFolder:bW,File:be,Folder:bs,fileExist:bi,folderExist:bt,getFileByCLSID:bT,getFreeSpace:bX,hasProcessFeature:c7,intToHex:dn,hexToDec:dc,getNavigator:ci,showErrorInfo:ga,createAXObject:al,importCertificate:dj,getKTObject:cb,getArray:bA,debugKD:aL,parseError:ep,createCallback:an,getTools:cR,getKonturDiag:b9,createNPAXObject:aA,wmiHotFixEngineering:gT,getNetworkAdapters:ck,getNetworkAdapterConfigs:cj,getNetworkAdaptersEx:cl,getRouteTable:cE,isWinServer:dL,checkWinVersion:W,waitWinInfo:V,getDisplays:bQ,findDevices:bo,getService:b,hasServiceDeleteFlag:c8,startService:gh,createAndStartService:ak,getProcesses:cp,buildPath:B,getLocator:cd,garbageCollect:bx,doubleSlashes:aW,getCertificateDate:bF,getCertificateIdentity:bH,getCertificateInfo:bI,getCertificateName:bJ,getCertificateOrg:bK,getOIDsFromCertificate:cn,hasCertificateLicense:c6,isCertificateKEP:dt,isMSHTA:dy,getTridentVer:cT,getMSIEVer:cf,regReadWinNTVer:fn,getGostComment:bZ,reverseGuid:fM,getXhrName:c2,isUCProfiles:dH,isRARProfiles:dE,getKT2Version:ca,checkFolderPermission:L,checkWritePermission:X,getCookies:bL,exploreFile:bb,showSaveDialog:ge,showOpenDialog:gc,showMultipleOpenDialog:gb,selectFolder:fU,getCache:bE,getMyDocuments:ch,getUserDesktop:cV,getStartup:cM,getShortcut:cJ,searchOldShortcuts:fS,deleteAllOldShortcuts:aQ,checkShortcut:T,checkAllShortcuts:J,createDesktopLink:aq,writeAll:g2,writeBinary:g3,readAll:eF,readUnicode:eG,getCustomParam:bN,getCurrentUrl:bM,addOrigin:i,getXml:c3,hexToBin:db,byteArrayToBase64:C,encodeBase64:aZ,decodeBase64:aM,sendRequest:fW,sendXssRequest:fX,download:aX,run:fO,openRegKey:en,getOpenRegKey:co,execute:a7,removeBadChars:fJ,escapeString:a6,getInfoFromFtpLog:b1,getInfoFromCspLog:b0,install:dl,uninstall:gB,uninstallAllByMask:gC,runUniversalFix:fQ,runTestEquipment:fP,getUserSID:cW,hasUac:c9,isSystem:dG,isUser:dJ,needAdmin:ee,needLocalSession:ef,kdWMISelect:dT,execWMIMethod:a8,checkIfThrowWMIError:M,callWMIMethod:H,wmiGetResult:gR,wmiGetResultLite:gS,regEnumKeys:e4,regEnumValues:e5,regDeleteKey:e2,regDeleteValue:e3,regReadString:fm,regReadMultiString:fj,regReadNumber:fk,regReadBinary:fg,regReadComplex:fi,regReadQWord:fl,regReadByType:fh,regMassRead:fb,regWriteString:fI,regWriteExpandString:fE,regWriteNumber:fG,regWriteQWord:fH,regWriteBinary:fC,regWriteMultiString:fF,$regWriteMultiString:f,regGetAccess:e6,regSetAccess:fq,regSetOwner:fr,checkOidInRegistry:R,writeOidToRegistry:g4,getSecurityPackages:cF,isFileNotFoundError:dx,isAccessDeniedError:dp,compareVersion:ac,compareDate:aa,dateToDisplayDate:aK,versionToDisplayVersion:gJ,getInstallDate:b2,isCUProgram:dv,isProgramOf:dD,getProductInfoReg:cu,getProductVersion:cz,getProductAllVersions:cr,getProductInstallPath:cx,getProductInstallDate:cv,getProductGUID:cs,getProductName:cy,findProductPath:bp,maxVersion:d8,redirectInstallSourceToLocalPackage:eI,pingWorker:et,testPort:gm,testServer:gn,expandEnvStrings:ba,compareEnvValues:ab,setEnvironment:f6,findApplication:bn,compressLogs:ae,getSizeString:cK,getIntervalString:b6,getDaysString:bO,getDMYString:bR,getFixComment:bU,refreshDesktop:eK,addToRunOnce:j,rebootComputer:eH,checkInstalledUpdate:N,setDefaultBrowser:f5,cyrillicFirstCompare:aI,secureEvalJSON:fT,toJSON:gr,getKdActualBuild:b7,detectBrowserName:aT};
var gv="[\\s\\r\\n\\xA0\u200B-\u200D\uFEFF]+",gw=new RegExp("^"+gv+"|"+gv+"$","g"),dV=new RegExp("\\r?\\n","g");function gu(w){return w&&w.length?w.replace(gw,""):""
}function dI(w){return"undefined"==typeof(w)}function dq(w){return(w instanceof Array)||(w&&("string"!=typeof w)&&!dI(w.length))}function bu(w,hg){var hf=0;
if(w){var hh,hi,hj,e0=typeof(w);if("string"===e0){for(hh=0,hi=w.length;hh<hi;++hh){hj=hg(w.charAt(hh),hh,hi);if(bd===hj){break}else{if(gx===hj){++hf}}}}else{if(dq(w)){for(hh=0,hi=w.length;
hh<hi;++hh){hj=hg(w[hh],hh,hi);if(bd===hj){break}else{if(gx===hj){++hf}}}}else{if("object"===e0){for(hh in w){if(w.hasOwnProperty(hh)){hj=hg(hh,w[hh]);
if(bd===hj){break}else{if(gx===hj){++hf}}}}}else{dZ.fatal("foreach of not array or string or object",eh,eh,"Type")}}}}return hf}function d6(w,hf){var hk=[];
if("string"==typeof(w)){for(var hi=0,hj=w.length;hi<hj;++hi){hk.push(hf(w.charAt(hi),hi,hj))}return hk.join("")}else{if(dq(w)){for(var hg=0,hh=w.length;
hg<hh;++hg){hk.push(hf(w[hg],hg,hh))}return hk}else{var e0="map() of not array or string";dZ.error(e0+", callback: "+hf.toString());return eh}}}function br(e0,hi,hf){if(typeof(e0)=="string"||!e0||!("length" in e0)||!(0 in e0)){dZ.error("fold of non-array")
}var w=hi;for(var hg=0,hh=e0.length;hg<hh;++hg){w=hf(w,e0[hg],hg,hh)}return w}function eJ(e0,hf){if(typeof(e0)=="string"){dZ.error("reduce of non-array")
}if(!e0||!e0.length||!(0 in e0)){dZ.error("reduce of non-array or empty array")}var w=e0[0];for(var hg=1,hh=e0.length;hg<hh;++hg){w=hf(w,e0[hg],hg)}return w
}function a9(hf,hg){if(!hf){return false}if(dq(hf)){for(var w=0,e0=hf.length;w<e0;++w){if(hg(hf[w],w)){return gx}}return bd}if(typeof(hf)=="object"){for(var hh in hf){if(hf.hasOwnProperty(hh)&&hg(hh,hf[hh])){return gx
}}return bd}dZ.fatal("exists not of array or object");return gA}function n(w){return w&&w.length}function af(w,e0,hf){if(hf){var hg=String(e0||"").toLowerCase();
return a9(w,function(hh){return String(hh||"").toLowerCase()===hg})}return a9(w,function(hh){return hh===e0})}function bk(w,e0){var hf=[];bu(w,function(hg,hh){if(e0(hg,hh)){hf.push(hg)
}});return hf}function bm(w,hg){if(w&&w.length){for(var e0=0,hf=w.length;e0<hf;++e0){if(hg(w[e0],e0,w)){return w[e0]}}}return gA}function d7(w,e0){return eJ(w,function(hf,hg){return e0(hf,hg)?hg:hf
})}function a0(w,hf){var e0=0;if(w){for(;!w.atEnd();w.moveNext()){var hg=hf(w.item());if(bd===hg){break}else{if(gx===hg){++e0}}}}return e0}function gj(w,e0,hf){hf=hf||0;
var hg=w[e0];w[e0]=w[hf];w[hf]=hg}function a4(hg,w,hf){var e0={name:"Error",description:hg,message:hg,number:w,errorCode:w,code:w};if(hf){e0.innerError=hf
}return e0}var a3=function(hg,e0,hf){try{if(5!=new Error(5,"Error").number){throw new Error()}a3=function(hj,hh,hi){try{var hk=new Error(hh,hj);try{hk.innerError=hi
}catch(hm){}return hk}catch(hl){return a4(hj,hh,hi)}}}catch(w){a3=a4}return a3(hg,e0,hf)};function a1(hf,w,e0){if(dI(w)){w=1}return a3(hf,w,e0)}function Y(hf){if(null===hf){return null
}var hg=typeof(hf);if("string"===hg){return String(hf)}if("number"===hg){return Number(hf)}if("object"!==hg){return hf}var e0=hf.constructor();for(var w in hf){if(hf.hasOwnProperty(w)){e0[w]=hf[w]
}}return e0}function dB(w){return !(w&&w.length)}function dC(w){return dB(w)||gk("^(err|none|not|sse2|win81?|win10(new)?|win2016)$","i")(w)}function dw(w){return(w instanceof Date)||("date"==typeof(w))
}function dK(w){return w&&("string"==typeof(w))&&w.length&&gk("^[TZ\\d\\s\\+\\.\\:\\-]+$","i")(w)}function gi(hi,hf){if(dw(hi)){return new Date(hf?Date.UTC(hi):hi)
}var hg=gu(String(hi)).split(new RegExp("[T\\s]","gi")),w=hg[0].split(new RegExp("[\\-\\.]","g")),hh=(hg.length>1)?hg[1].split(new RegExp("[Z\\+]","gi"))[0].split(new RegExp("[:\\.]","g")):eh,e0=Number(w[0])>1890;
return(function(hp,hm,hj,hk,hl,ho,hn){return hf?new Date(Date.UTC(hp,hm,hj,hk,hl,ho,hn)):new Date(hp,hm,hj,hk,hl,ho,hn)})(Number(e0?w[0]:w[2]),Number(w[1])-1,Number(e0?w[2]:w[0]),hh?Number(hh[0]):0,hh?Number(hh[1]):0,(hh&&hh.length>2)?Number(hh[2]):0,(hh&&hh.length>3)?Number(hh[3]):0)
}function q(hf){var w=new Date(hf[2],hf[1]-1,hf[0],hf[3],hf[4],hf[5]);w.setMinutes(w.getMinutes()+w.getTimezoneOffset());var e0=[w.getFullYear(),k(w.getMonth()+1),k(w.getDate())].join("-")+"T";
e0+=[k(w.getHours()),k(w.getMinutes()),k(w.getSeconds())].join(":")+"Z";return e0}function ej(hf){var e0=[];for(var w in hf){if(hf.hasOwnProperty(w)){e0.push(w)
}}return e0}function d0(w,e0){if(w){dZ.error("В функцию "+e0+" передали неверный аргумент",eh,eh,"badArg")}}function x(e0,w){var hf=arguments.length>2?Array.prototype.slice.call(arguments,2):eh;
return function(){return w.apply(e0,hf||arguments)}}function G(w){var e0=arguments.length>1?Array.prototype.slice.call(arguments,1):eh;return function(){return w.apply(eh,e0||arguments)
}}function o(w){this.id=w;this.valueOf=function(){return w}}function a(w){var e0=arguments.length>1?Array.prototype.slice.call(arguments,1):eh;if(e0){return function(){for(var hh=0,hg=arguments.length;
hh<hg;++hh){var hf=e0[hh];if(hf instanceof o){e0[hh]=arguments[+hf]}}return w.apply(eh,e0)}}else{return function(){return w.apply(eh,arguments)}}}a.arg=function(w){return new o(w)
};a.first=a.arg(0);a.second=a.arg(1);a.third=a.arg(2);a.fourth=a.arg(3);a.fifth=a.arg(4);var eg=cN();function eE(){var hf=[],hg=bd;function e0(){while(hf.length&&(eg>cN())){hf.shift()._invoke()
}hg=bd;eg=cN()+100;if(hf.length){w()}}function w(){if(!hg){hg=gx;if(eg>cN()){e0()}else{gM.setTimeout(e0,0)}}}return function(hh){hf.push(hh);w()}}var eD=eE(),ez=function(){var w=0;
return function(){w++;return w}}();function ey(hg,hf,w,e0){this.id=ez();if(!dI(hg)){w|=ey.flags.resolve;this.resolve0=hg}if(!dI(hf)){w|=w&ey.flags.unusual||ey.flags.reject;
this.reject0=hf}if(!dI(e0)){w|=ey.flags.lie;w|=ey.flags.logic;this.lie0=e0}this.flags|=w;this.count=0}ey.flags={fullfiled:1,rejected:2,canceled:4,noPending:7,resolve:8,reject:16,lie:32,$continue:64,$break:128,$return:256,unusual:448,logic:512,spread:1024,ignoreResolve:2048,ignoreAnyway:4096,promiseTypes:8184,exceptValue:8191,resolveValue:8192,rejectValue:16384,lieValue:32768,continueValue:65536,breakValue:131072,returnValue:262144,unusualValue:458752,argsValue:524288,value:516096,valueTypes:1040384,logging:1048576};
function eC(w,e0){this.type=w;this.value=e0}function eA(hf){function hg(hi){if(dI(hi)){return"undef"}if(hi instanceof Function){return"func"}var hh=typeof(hi);
if(hh=="number"||hh=="boolean"||!hi){return String(hi)}if(hh=="string"){return hi.length>10?hi.substr(0,7)+"...":hi}if(hh=="object"){return"object"}return"unknown"
}var w=hf.flags,e0;if(w&ey.flags.unusual){if(w&ey.flags.$continue){e0="continue("+hg(hf.reject0)+")"}else{if(w&ey.flags.$break){e0="break("+hg(hf.reject0)+")"
}else{e0="return("+hg(hf.reject0)+")"}}}else{if(w&ey.flags.ignoreAnyway){e0="lastly("+hg(hf.resolve0)+")"}else{if(w&ey.flags.ignoreResolve){e0="tap("+hg(hf.resolve0)+")"
}else{if(w&ey.flags.logic){e0="truth("+hg(hf.resolve0)+", "+hg(hf.lie0)+", "+hg(hf.reject0)+")"}else{if(w&ey.flags.spread){e0="spread("+hg(hf.resolve0)+")"
}else{e0="then("+hg(hf.resolve0)+", "+hg(hf.reject0)+")"}}}}}return e0}ey.prototype={resolve:function(e0,w){if(!this.isPending()){return}if(e0 instanceof ey){e0._react(this);
return}else{if(e0 instanceof eC){w|=e0.type;e0=e0.value;w|=(w&(ey.flags.rejectValue|ey.flags.unusualValue))?ey.flags.rejected:ey.flags.fullfiled}else{w|=ey.flags.fullfiled
}}w|=(w&ey.flags.fullfiled)&&ey.flags.resolveValue;this._settle(w,e0)},reject:function(w,e0){if(!this.isPending()){return}if((w instanceof eC)&&(w.type&ey.flags.argsValue)){e0|=ey.flags.argsValue;
w=w.value}this._settle(e0|ey.flags.rejected|(e0&ey.flags.unusualValue||ey.flags.rejectValue),w)},then:function(hh,hg,w,e0){var hf=new ey(hh,hg,w,e0);this._react(hf);
return hf},caught:function(w){return this.then(gA,w,ey.flags.reject)},caughtContinue:function(w){return this.then(gA,w,ey.flags.$continue)},caughtBreak:function(w){return this.then(gA,w,ey.flags.$break)
},caughtReturn:function(w){return this.then(gA,w,ey.flags.$return)},anyway:function(w){return this.then(w,w,ey.flags.resolve|ey.flags.reject)},lastly:function(w){return this.then(w,w,ey.flags.resolve|ey.flags.reject|ey.flags.ignoreAnyway)
},tap:function(w){return this.then(w,gA,ey.flags.ignoreResolve)},spread:function(e0,w){return this.then(e0,w,ey.flags.spread)},truth:function(hf,w,e0){return this.then(hf,e0,ey.flags.logic,w)
},lie:function(w,hf,e0){return this.then(hf,e0,ey.flags.logic,w)},fork:function(e0,hg,hf){var w=this;return w.then((e0!==gA)&&e0).then(function(hh){return w.then(hh?hg:hf)
})},timeout:function(w){return this.tap(function(){return ey.timeout(w)})},promisify:function(e0,w){return this.then(function(){return ey.promisify(e0,w)
})},each:function(w){return this.then(function(e0){return ey.each(e0,w)})},map:function(e0,w){if(w||("function"!=typeof(e0))){d0(w||e0,"promise.map")}return this.then(function(hf){return ey.map(hf,e0)
})},filter:function(w){return this.then(function(e0){return ey.filter(e0,w)})},exists:function(w){return this.then(function(e0){return ey.exists(e0,w)})
},waterfall:function(){var w=Array.prototype.slice.call(arguments);return this.then(function(e0){return ey.waterfall.apply(eh,[e0].concat(w))})},collector:function(){var w=Array.prototype.slice.call(arguments);
return this.then(function(e0){return ey.collector.apply(eh,[e0].concat(w))})},isPending:function(){return !(this.flags&ey.flags.noPending)},isFulfilled:function(){return(this.flags&ey.flags.fullfiled)
},isRejected:function(){return(this.flags&ey.flags.rejected)},cancel:function(){if(!(this.flags&ey.flags.noPending)){this.flags|=ey.flags.canceled}},cancelAll:function(){if(!(this.flags&ey.flags.noPending)){this.flags|=ey.flags.canceled;
if(this.parent){this.parent.cancelAll()}}},isCanceled:function(){return(this.flags&ey.flags.canceled)},get:function(e0){try{e0(this)}catch(w){dZ.error("Error on enquirer at Promise",w)
}return this},log:function(w){this.logger=w;this.flags|=ey.flags.logging;return this},clone:function(){var hf=new ey(this.resolve0,this.reject0,0,this.lie0);
for(var w=0,e0=this.count;w<e0;++w){hf[w]=Y(this[w])}hf.count=Number(this.count);hf.flag=this.flag&~ey.flags.noPending;return hf},_setState:function(w){this.flags|=ey.flags.noPending&w
},_setValue:function(e0,w){this.result=w;this.flags=(~ey.flags.valueTypes&this.flags)|e0},_settle:function(hg,hf){if(this.flags&ey.flags.logging){this.logger()
}if(this.parent){delete this.parent}if(hg&ey.flags.rejected){if(this._forward){if(this.stack){this.stack.push("at Promise."+eA(this))}else{this.stack=["at Promise."+eA(this)]
}}else{if(this.stack){this.stack[this.stack.length-1]+="."+eA(this)}else{this.stack=["at Promise."+eA(this)]}}}if(!(this.ignoreTypes&hg)){this._setValue(hg,hf)
}this._setState(hg);for(var w=0,e0=this.count;w<e0;++w){this[w].parent=this;eD(this[w])}this.count=0;return this},_react:function(w){w.parent=this;if(this.isPending()){this[this.count]=w;
++this.count}else{eD(w)}},_invoke:function(){var hg=this.parent,hn=hg.flags&ey.flags.valueTypes,hk=hg.result,hi=this.flags;if((hg.flags&ey.flags.rejected)&&hg.stack){this.stack=hg.stack
}delete this.parent;if(this._forward){if(hn&ey.flags.resolveValue){this.resolve(hk,hn)}else{this.reject(hk,hn)}return}if(hi&ey.flags.logging){this.logger()
}var hl=hn;var hm=hi&ey.flags.spread||hl&ey.flags.argsValue;if((hi&ey.flags.logic)&&(hl&ey.flags.resolveValue)){if((hm&&dq(hk)&&!hk[0])||!hk){hl=(hl&~ey.flags.resolveValue)|ey.flags.lieValue
}}var w=((hl&ey.flags.value)>>10)&hi;if(w){var e0=hi&ey.flags.ignoreAnyway,hf=e0||hi&ey.flags.ignoreResolve,hj=w&ey.flags.lie?this.lie0:w&ey.flags.resolve?this.resolve0:this.reject0;
if(hf){this._setValue(hn,hk);this.ignoreTypes=ey.flags.resolveValue|(e0&&ey.flags.rejectValue)}if(hj instanceof Function){if(hm&&!dq(hk)){hk=[hk]}try{this._forward=gx;
ey.previous=hg;ey.current=this;this.resolve(hm?hj.apply(eh,hk):hj(hk))}catch(hh){this.reject(ep(hh))}}else{this.resolve(w&ey.flags.unusual?hk:hj)}}else{if(hn&ey.flags.resolveValue){this.resolve(hk,hn)
}else{this.reject(hk,hn)}}}};ey.when=ey.then=function(e0){var hh=new ey(),hf=arguments.length>1,w=hf&&Array.prototype.slice.call(arguments,1);try{if(!e0){throw new Error("executor is not function",66)
}hh.resolve(hf?e0.apply(eh,w):e0())}catch(hg){hh.reject(ep(hg))}return hh};ey.resolve=function(hg){if(hg instanceof ey){return hg}var hf=new ey(),e0=arguments.length!=1,w=e0?arguments:hg;
hf.resolve(w,e0&&ey.flags.argsValue);return hf};ey.reject=function(e0){var w=new ey();w.reject(e0);return w};ey.thrown=function(hf,w){var e0=dI(hf)||!arguments.length,hg=e0?arguments:(("string"==typeof(hf))?a1(hf,w):hf);
return new eC(ey.flags.rejectValue|(e0&&ey.flags.argsValue),hg)};ey.args=function(w){return new eC(ey.flags.argsValue,(arguments.length==1&&dq(w))?w:arguments)
};ey.$return=ey.result=function(e0){var w=arguments.length!==1;return new eC(ey.flags.returnValue|(w&&ey.flags.argsValue),w?arguments:e0)};ey.fork=function(w,hf,e0){var hg=w?hf:e0;
return("function"==typeof(hg))?ey.when(hg):ey.resolve(hg)};ey.timeout=function(hg,hh){var hf=new ey(),e0=arguments.length>2,w=e0?Array.prototype.slice.call(arguments,1):hh;
gM.setTimeout(function(){hf.resolve(w)},hg);return hf};var gq;function cP(){if(gq){return gq}var e0=0,w=1,hf={};return gq={print:function(){dZ.info("promisify time tracking(length="+(e0?e0+"; factor="+w:0)+")"+(e0?":":""));
if(!e0){return}bu(hf,function(hm,hr){var ho=0,hj=0,hp=0,hn=0,hl=0,hh=0,hi=0,hg=0;bu(hr.tracks,function(ht){if(ht.start){++ho;return}if(ht.timeout){++hp;
return}var hs=ht.diff;if(hl<hs){hl=hs}hh+=hs;if(ht.overtime){++hn;hi+=hs}else{++hj;hg+=hs}});hh=(hh?hh/(hj+hn):0).toFixed(2);hi=(hn?hi/hn:0).toFixed(2);
hg=(hj?hg/hj:0).toFixed(2);var hk=hr.limit?"nominal="+hr.nominal+" limit="+hr.limit:"unlimited",hq="all="+hr.tracks.length+"("+hh+"ms) succ="+hj+"("+hg+"ms) out="+hp+" over="+hn+"("+hi+"ms)";
dZ.info(hm+": "+hk+" "+hq+" max="+hl+"ms")});e0=0;hf={}},get:function(hi,hh){if(!hi){return eh}if(hf[hi]){return hf[hi]}++e0;var hg=0,hj=hf[hi]={tracks:[],peek:function(){var hk=+new Date(),hl={start:gx,diff:0};
this.tracks.push(hl);return function(hm){hl.diff=(+new Date())-hk;if(!!hj.limit){if(!hm){hj.limit=Math.max(hj.limit,hl.diff*1.5);w=Math.max(w,hj.limit/hj.nominal)
}hg=hm?hg+1:0}hl.start=bd;if(hl.timeout){hl.overtime=gx;hg=0;dZ.error("timeout in ("+hi+"), limit has been increased to "+hj.limit,eh,eh,"timeout")}hl.timeout=hm;
return hm?{message:"promisify timeout",timeout:gx}:eh}},failover:function(){return hg<3},nominal:+hh,limit:+hh,maxLimit:function(){return Math.max(hj.limit,hj.nominal*w)
}};return hj}}}ey.promisify=function(w,e0,hh){hh=hh||0;var hk=e0?cP().get(e0,hh):eh;if(hk&&!hk.failover()){return ey.reject(a1("tries are expired in promisify/wait "+e0,1))
}var hg=new ey(),hj=e0?hk.peek():eh;try{w(function(hm){if(hj){hj()}if(hg.isPending()){var hl=arguments.length>1;hg.resolve(hl?arguments:hm,hl&&ey.flags.argsValue)
}},function(hl){if(hj){hj()}if(hg.isPending()){hg.reject(hl)}});if(hh&&hg.isPending()){var hi=function(hm){var hl=hk&&hk.maxLimit()||hh;gM.setTimeout(function(){if(hg.isPending()){var hn=hk&&hk.maxLimit()||hh;
if(hl<hn){hi(hn-hl)}else{hg.reject(hj?hj(gx):new Error("promisify timeout"))}}},hm)};hi(hk&&hk.maxLimit()||hh)}}catch(hf){hf=ep(hf);if(hj){hj()}if(hg.isPending()){hg.reject(hf)
}}return hg};ey.wait=function(w,e0,hg,hf){hf=hf||100;var hh=ey.promisify(function(hk,hi){function hj(){ey.when(w).then(function(hl){if(hh.isPending()){if(hl){hk(gx)
}else{gM.setTimeout(hj,hf)}}},hi)}gM.setTimeout(hj,0)},e0,hg);return hh.caught(function(hj){var hi=hj&&(hj.message||hj.description)||hj;if("promisify timeout"!==hi){throw hj
}return bd})};ey.$break=ey.stop=function(e0){var w=arguments.length!==1;return new eC(ey.flags.breakValue|(w&&ey.flags.argsValue),w?arguments:e0)};ey.$continue=ey.next=function(e0){var w=arguments.length!==1;
return new eC(ey.flags.continueValue|(w&&ey.flags.argsValue),w?arguments:e0)};function eB(e0,hn,hp,hx,hm){if(!e0){return ey.resolve(hx<2?hp:[])}var hf=typeof(e0),hq=[],hr,w;
if(e0 instanceof Function){hr=1;w=function(){++hr;return ey.when(e0)};if(hx){return ey.reject(a1("PromiseIterator: wrong type for Function",1))}}else{if(dq(e0)){hr=e0.length;
w=function(hy){return hn(e0[hy],hy,hr)};if(hx>=2){hp=[]}}else{if("object"==hf){bu(e0,function(hy){hq.push(hy)});hr=hq.length;w=function(hy){var hz=hq[hy];
return hn(hz,e0[hz])};if(hx==2){hp={}}}else{return ey.reject(a1("PromiseIterator: wrong value type",1))}}}if(hr<=0){return ey.resolve(hp)}var hg=bd,ho,ht;
if(hx===0){ho=function(){};ht=function(hy,hz){hp=hz}}else{if(hx===1){var hi=hn;hn=function(){[].unshift.call(arguments,hp);return hi.apply(eh,arguments)
};ho=ht=function(hy,hz){hp=hz}}else{if(hx===2){if(dq(e0)){hn=hn||function(hy){return hy};ho=ht=function(hy,hz){hp[hy]=hz}}else{hn=hn||function(hy,hz){return hz
};ho=ht=function(hy,hz){hp[hq[hy]]=hz}}}else{if(hx===3){hp=[];ho=ht=function(hy,hA,hz){if(hA&&hz){hp.push(e0[hy])}}}else{if(hx===4){hp=bd;ho=ht=function(hy,hA,hz){if(hA&&hz){hp=gx;
hg=gx}}}else{return ey.reject(a1("Promise.each: wrong iterator type",1))}}}}}hm=hm===gx?16:(hm||1);var hs=0,hj=0;var hu=new ey(),hw=[];function hv(hz){++hs;
function hA(hC){++hj;var hB=ey.previous;if(hB.flags&ey.flags.resolveValue){ho(hz,hC,1)}else{if(hB.flags&ey.flags.continueValue){ht(hz,hC,arguments.length)
}else{if(hB.flags&ey.flags.breakValue){ht(hz,hC,arguments.length);hg=gx;hh()}else{hh();hu.reject(hC);return}}}if(hg||(hj==hr)){hu.resolve(hp)}else{if(hs<hr){hv(hs)
}}}try{if(e0 instanceof Function){hw[hz]=w(hz).spread(hn).then(hA,hA,ey.flags.resolve|ey.flags.reject|ey.flags.$continue|ey.flags.$break)}else{hw[hz]=ey.resolve(w(hz)).then(hA,hA,ey.flags.resolve|ey.flags.reject|ey.flags.$continue|ey.flags.$break)
}}catch(hy){hu.reject(hy)}}function hh(){if(hj<hw.length){bu(hw,function(hy){hy.cancel()})}}for(var hk=0,hl=Math.min(hm,hr);hk<hl;++hk){hv(hk)}return hu
}ey.each=function(w,hf,hg,e0){if("number"==typeof(w)){w=w?new Array(w):[]}return eB(w,hf,hg,0,e0)};ey.reduce=function(e0,hf,w){return eB(e0,hf,w,1)};ey.map=function(w,hf,e0){return eB(w,hf,eh,2,e0)
};ey.filter=function(w,hf,e0){return eB(w,hf,eh,3,e0)};ey.exists=function(w,hf,e0){return eB(w,hf,eh,4,e0)};ey.props=function(w,e0){return ey.map(w,dq(w)?function(hf){return(hf instanceof Function)?hf():hf
}:function(hf,hg){return(hg instanceof Function)?hg():hg},e0)};ey.all=function(w){return ey.props(arguments.length>1?arguments:w,gx)};ey.serial=function(w){return ey.props(arguments.length>1?arguments:w)
};ey.waterfall=function(){var w=ey.resolve();bu(arguments,function(e0){w=w.then(e0)});return w};ey.collector=function(){var w=ey.resolve();bu(arguments,function(hf){var hg,e0=bd;
w=w.then(function(){hg=Array.prototype.slice.call(arguments);e0=!(hf instanceof Function)&&dq(hf);return hf instanceof Function?hf.apply(eh,hg):hf}).then(function(){return ey.args([].concat.apply(hg,e0?[arguments]:arguments))
})});return w};var h;function ah(e0){if(!h||e0){hg()}function hf(hn,hr,ho){var hj=hn,hi=decodeURIComponent(hr),hh=ho||{},hl=hh.expires,hp=hh.secure||bd;
hj+="="+hi;if(typeof hl==="number"&&hl!==0){var hk=new Date();hk.setTime(hk.getTime()+(hl*1000));hl=hk}if(hl&&hl.toUTCString){hh.expires=hl.toUTCString()
}if(!hp&&ho){delete ho.secure}for(var hm in hh){var hq=hh[hm];hj+=";"+hm;if(typeof hq!=="boolean"){hj+="="+hq}}document.cookie=hj;return hg()}function w(hh,hi){hi=hi||{};
hi.expires=-1;hf(hh,"",hi);return hg()}function hg(){h=ai.getCookies();return h}return{getCookie:function(hh){return h&&h[hh]},getCookies:function(){return h
},setCookie:hf,deleteCookie:w}}function S(hf){var e0=900000;var w=function(){++e0;return e0};var hg=function(){var hk="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";
return hk.replace(/[xy]/g,function(hl){var hm=Math.random()*16|0,hn=("x"===hl)?hm:(hm&3|8);return hn.toString(16)})};var hi;var hj=hi="Контур.Плагин"===hf?"kontur-toolbox":"diag-helper";
hi+="-request";hj+="-response";var hh;return da.Promise.promisify(function(hk){hh=function(hl){if(hl.data&&hl.data.type===hj){hk(gx)}};window.addEventListener("message",hh);
window.postMessage({type:hi,request:{type:"plugin-info",sessionId:hg(),commandId:w()}},"*")},null,3000).anyway(function(hk){window.removeEventListener("message",hh);
return hk===gx})}da.Err=a1;da.clone=Y;da.extend=bc;da.foreach=bu;da.map=d6;da.Test=gk;da.fold=br;da.filter=bk;da.find=bm;da.reduce=eJ;da.exists=a9;da.contains=af;
da.max=d7;da.any=n;da.trim=gu;da.enumerate=a0;da.swap=gj;da.$onSendComplete=em;da.$bind=x;da.$call=G;da.$apply=a;da.Promise=ey;da.isNullOrEmpty=dB;da.isNullOrEmptyOrBad=dC;
da.isDate=dw;da.isUTCDate=dK;da.isUndef=dI;da.isArray=dq;da.objectKeys=ej;da.strToDate=gi;da.arrToDateString=q;da.Cookies=ah;da.checkPluginInstalled=S;
var aJ=gk("^[а-яёА-ЯЁ]+","i");function aI(w){return function(e0,hf){var hl=function(hm){return String(hm).toLowerCase()},hj=e0,hk=hf,hi=0;if(w){hj=e0&&e0[w];
hk=hf&&hf[w]}if(!hj){if(hk){hi=-1}}else{if(!hk){hi=1}else{hj=hl(hj);hk=hl(hk);var hg=aJ(hj),hh=aJ(hk);if(hg&&!hh){hi=-1}else{if(!hg&&hh){hi=1}else{hi=hj.localeCompare(hk)
}}}}return hi}}function cw(w){var hf=gF.productStatus;if(!w){return ey.thrown(a1("getProductInstallInfo: 'options' is not a valid object",1))}if(typeof(w.getVersion)!=="function"){return ey.thrown(a1("getProductInstallInfo: 'options.getVersion' is not a function",1))
}return ey.when(w.getVersion).then(function(hg){if(hg&&hg.length){return{status:hf.installed,version:hg}}else{return{status:hf.notInstalled}}},function(hg){if(typeof(w.onError)==="function"){w.onError(ep(hg))
}return{status:hf.error}}).then(function e0(hg){hg.isInstalled=hg.status===hf.installed;hg.isNotInstalled=hg.status===hf.notInstalled;hg.isError=hg.status===hf.error;
hg.diagVersionValue=hg.isInstalled?hg.version:hg.status;if(!hg.isError){if(w.latestVersion){hg.isLatest=hg.isInstalled&&ac(w.latestVersion,hg.version);
hg.isNotLatest=!hg.isLatest}if(w.sufficientVersion){hg.isSufficient=hg.isInstalled&&ac(w.sufficientVersion,hg.version);hg.isNotSufficient=!hg.isSufficient
}if(typeof(w.isSufficient)==="function"){hg.isSufficient=hg.isInstalled&&w.isSufficient(hg);hg.isNotSufficient=!hg.isSufficient}}return hg})}function gp(e0){var w=e0/86400000;
if(w<0){w+=0.5}return Math.floor(w)}function cc(hf){if(!hf){return ey.thrown(a1("getLicenseInfo: 'options' is not a valid object",1))}if(typeof(hf.getExpireDate)!=="function"){return ey.thrown(a1("getLicenseInfo: 'options.getExpireDate' is not a function",1))
}var e0={},hg=hf.warnExpire,w=hf.ignoreExpire;return hf.getExpireDate().then(function(hh){e0.expireMs=new Date(hh).getTime();e0.expireDays=gp(e0.expireMs-gF.serverTime);
return ey.when(function(){return typeof(hf.isInfinite)==="function"&&hf.isInfinite(e0.expireMs)}).truth(function(){e0.diagValue="inf";e0.diagStatus=0},function(){e0.diagValue=e0.expireMs;
if(e0.expireDays<=0){e0.expired=gx;e0.diagStatus=(w?-1:(hg?1:2))}else{if(e0.expireDays<=31){e0.diagStatus=(w?-1:1);e0.soonToExpire=gx}else{e0.diagStatus=0
}}})}).caught(function(hh){hh=ep(hh);e0.diagValue="err";e0.diagStatus=hg?1:2;if(typeof(hf.onError)==="function"){hf.onError(hh,e0)}else{hh.info=e0;throw hh
}}).then(e0)}var dQ=function(){var w=0;return function(){w++;return w}}();function an(w,e0){if(dr&&!e0){return w}var hf="kdGlobalCallback"+dQ();gM[hf]=w;
return hf}var dM,fR,dO=0,dP=[214,213,212,211,210,209,208,207,206,205],dR=gk("#0x[\\dA-F]{8}$","i");function b7(){return parseInt(dP[0])}function ep(w){var hf=w&&(w.message||w.description);
if(dr||!w||!hf||(hf.indexOf("NPObject")<0)){if(hf&&dR(hf)){w=hf}if(("string"==typeof(w))&&dR(w)){var hg=w.lastIndexOf("#");return a1(w.substr(0,hg),parseInt(w.substr(hg+1))-4294967295-1)
}return w}try{return dM&&dM.lastException||w}catch(e0){return w}}function dx(e0){e0=ep(e0);var w=e0&&+e0.number;return e0&&(w===2||w===-2147024894||w===2147942402)
}function dp(e0){e0=ep(e0);var w=e0&&+e0.number;return e0&&(w===5||w===-2147024891||w===2147942405||w===-2146828218||w===2148139078)}function b9(hk){if(hk||dI(dM)){dO=0;
var hj="application/x-kontur-diag-";var hh=(function(hl){return Math.floor(hl/100)+"."+(hl%100)});bu(dP,dr?function(hl){try{dM=al(["Kontur","Diag",hh(hl)]);
if(dM){dZ.debug("Используем KD "+(dM.hasAccess()?dM.version:hh(hl)));dO=hl;fR=gA;return bd}}catch(hm){dM=eh;fR=gA}return gx}:function(hl){try{dM=az("Diag.Helper|Kontur.Diag",hj+hh(hl));
if(dM){if(dM.hasAccess){dZ.debug("Используем KD "+dM.version);dO=hl;fR=gA;return bd}throw a1("plugin isn't created",1)}}catch(hm){gF.kdError=hm;dM=bd;fR=gA
}return gx})}try{if(dM){ai.kdBuild=dO;return dM.hasAccess()?dM:bd}ai.kdBuild=dO=0;return eh}catch(w){ai.kdBuild=dO=0;if(dM){var e0=w&&w.message;if(e0&&(e0.indexOf("NPObject")>=0)){try{var hi=dM.lastException;
if(hi&&(e0!=hi.message)){var hf=a1(e0,w.number,hi);hf.stack=w.stack;w=hf}}catch(hg){}}dM=eh;fR=gA;dZ.error("Ошибка обращения к KD, теперь NULL",w,eh,"NullKD");
if(w&&w.stack){dZ.debug(w.stack)}return bd}return eh}}function aL(hf,w,hg,e0){w=ep(w);if(b9()){if(w&&(dx(w)||dp(w))){if(hg){throw w}}else{if(!w||(0!==w.number)){(e0||dZ.debug)("Ошибка вызова KD."+hf,w,eh,"KD")
}}}return w}function cC(e0){if(e0||dI(fR)){var w=b9(e0);fR=w&&w.registryWorker}return fR}function al(w){if(gM.isBotFound){throw a1("You are Bot",31337)
}return(new Function(["return new ","Activ",'eXObject("'].join("")+w.join(".")+'")'))()}function az(hg,e0){if(gM.isBotFound){return eh}var w=ci().plugins,hi=hg.toLowerCase(),hh=(hg.indexOf("|")>=0)?hi.split(new RegExp("\\|","g")):[hi],hf=hh[0],hj=eh;
bu(w,function(hl){if(af(hh,hl.name.toLowerCase())){if(!e0||a9(hl,function(hm){return hm.type===e0})){hf=hl.name;hj=hl;return bd}}return eh});if(!hj){return eh
}var hk=(hf&&hf.length)?document.getElementById(hf):eh;if(hk){document.body.removeChild(hk)}hk=document.createElement("object");hk.setAttribute("id",hf);
hk.setAttribute("type",e0||hj[0].type);hk.setAttribute("style","visibility:hidden;width:0;height:0;max-width:0;max-height:0;margin:0;padding:0;border:0 none;position:absolute");
document.body.appendChild(hk);return hk}function aA(hf,w){function hg(hh){if(!hh){return[]}var hi=[];bu(hh,dr?function(hj){hi.push((hj&&("object"==typeof(hj)))?hj.obj:hj)
}:function(hj){var hl=typeof(hj),hk;if("boolean"==hl){hk="b_"+hj}else{if("number"==hl){hk="i_"+hj}else{if("string"==hl){hk="s_"+hj}else{if(("object"==hl)&&("ordinal" in hj)){hk="d_"+hj.ordinal
}else{hk="i_0"}}}}hi.push(hk)});return hi}function e0(hn){if(dr){return hn?{obj:hn,get:function(hr,hq){if(hq){return this.call(hr,hq)}var hs=hn[hr];return("object"==typeof(hs))?e0(hs):hs
},getAsync:function(hs,hr){var hq=this;return ey.when(function(){return hq.get(hs,hr)})},set:function(hq,hr){hn[hq]=hr[0]},setAsync:function(hs,hr){var hq=this;
return ey.when(function(){return hq.set(hs,hr)})},call:function(hv,hr){var hs="$"+hv;if(!(hs in this)){hr=hr||[];var hq=[];for(var ht=0,hu=hr.length;ht<hu;
++ht){hq.push("args["+ht+"]")}this[hs]=new Function("o","return function(args){ return o."+hv+"("+hq.join(",")+");}")(hn)}var hw=this[hs](hg(hr));return("object"==typeof(hw))?e0(hw):hw
},callAsync:function(hs,hr){var hq=this;return ey.when(function(){return hq.call(hs,hr)})},free:function(){}}:eh}if(!hn||("succeeded"!==hn.result)||!("ordinal" in hn)){var hl="result: "+(hn&&hn.result)+", ordinal: "+(hn&&hn.ordinal)+", coreError: "+(hn&&hn.coreError)+", clsid: "+(hn&&hn.clsid)+", iid: "+(hn&&hn.iid),hm=a1(hl,hn&&hn.winError&&parseInt(hn.winError.substr(0,8),16));
aL("comDispatchCreate("+hf+", callb)",hm||(hn&&hn.winError),bd,dZ.error);throw hm}var ho=hn.ordinal,hk=gk("dispatch::\\d+","i"),hi=function(hs,hq){if(!hs){throw a1("bad result",1)
}if(hs.result!=="succeeded"){throw a1("not succeeded",1)}if("exception" in hs){throw hs.exception}var hr=hs.hresult?parseInt(hs.hresult.slice(0,8),16):0;
if(hr<134217728){return}dZ.debug("COMDispatch catches exception by hresult("+hs.hresult+") with message("+gu(hs.errdesc)+")"+(hq?" and info("+hq+")":""),gA,gA,"HRes");
throw a1(hs.errdesc,hr)},hp=function(hr,hq){var hs=fT(hr);hi(hs,hq);var ht=hs.retval;if((typeof ht=="string")&&hk(ht)){hs.ordinal=+hs.retval.slice(10);
return e0(hs)}return ht};gF.dispatches[ho]=gx;var hj=(dO<212)?function(hs,hq,ht,hu,hr){return b9().comDispatchInvoke(ho,hs,hq,ht,hr)}:function(hs,hq,ht,hu,hr){return b9().comDispatchInvoke(ho,hs,hq,ht,hu,hr)
};function hh(hr,hq,ht,hv,hu){hu=hu?1:0;var hs=hf.join(".")+"->"+hr;return ey.promisify(function(hy,hx){try{hj(hr,hg(hq),ht,hu,an(function(hA){try{hy(hp(hA,hs))
}catch(hz){hx(ep(hz))}}))}catch(hw){hx(ep(hw))}},hs,(typeof hv=="number")?hv:20000)}return{ordinal:ho,get:function(hr,hq){return hp(b9().comDispatchInvokeSync(ho,hr,hg(hq),2),hf.join(".")+"->"+hr)
},getAsync:function(hr,hq,ht,hs){return hh(hr,hq,2,ht,hs)},set:function(hr,hq){return hp(b9().comDispatchInvokeSync(ho,hr,hg(hq),4),hf.join(".")+"->"+hr)
},setAsync:function(hr,hq,ht,hs){return hh(hr,hq,4,ht,hs)},call:function(hr,hq){return hp(b9().comDispatchInvokeSync(ho,hr,hg(hq),1),hf.join(".")+"->"+hr)
},callAsync:function(hr,hq,ht,hs){return hh(hr,hq,1,ht,hs)},free:function(hq){if(gF.dispatches[ho]){gF.dispatches[ho]=eh;delete gF.dispatches[ho]}try{b9().comDispatchRelease(ho,hq?an(hq):"")
}catch(hr){aL("(ActiveX: "+hf.join(".")+").free()",hr)}}}}if(dr){if(w){return ey.when(function(){return e0(al(hf))})}return e0(al(hf))}if(!b9()){if(w){return ey.reject(a1("no kd",6))
}throw a1("no kd",6)}if(w&&(dO>=210)){return ey.promisify(function(hh){b9().comDispatchCreateAsync(hf.join("."),an(hh))},eh,15000).then(function(hh){return e0(fT(hh))
})}else{if(w){return ey.when(function(){return e0(fT(b9().comDispatchCreate(hf.join("."))))})}return e0(fT(b9().comDispatchCreate(hf.join("."))))}}function cb(w){var e0=gM.SkbKontur.Toolbox;
return e0?(w?e0[w]:e0):eh}function dj(hf){try{var e0=aA(["CAPICOM","Certificate"]);e0.call("Import",[hf]);return{raw:e0.obj,get:e0.get,getAsync:e0.getAsync,call:e0.call,callAsync:e0.callAsync,free:e0.free,display:function(){e0.call("Display")
},getExtensions:function(){var hl=e0.call("ExtendedKeyUsage").get("EKUs"),hm={};try{for(var hi=1,hk=hl.get("Count");hi<=hk;++hi){hm[hl.get("Item",[hi]).get("OID")]=true
}}catch(hj){}return{extendedKeyUsages:hm}},getHash:function(){return{toHexString:function(){return e0.get("Thumbprint")}}},getIssuer:function(){return e0.get("IssuerName")
},getName:function(){return bJ(bI(e0.get("SubjectName"),gx))},getSerialNumber:function(){return e0.get("SerialNumber")},getSubject:function(){return e0.get("SubjectName")
},getValidFrom:function(){return e0.get("ValidFromDate")},getValidTo:function(){return e0.get("ValidToDate")}}}catch(hg){var hh=cb(),w=hh.Binary.fromBase64(hf);
return hh.Crypto.createCertificateFromContent(w)}}da.displayCert=function(hx,hz){function w(){try{var hA=gM.event;if(hA){try{hA.preventDefault()}catch(hC){}try{hA.stopPropagation()
}catch(hC){}hA.cancelBubble=true;hA.returnValue=false}}catch(hB){}}var hh=gF.certsByThumb,hp=cb(),hq,hf;if(hh&&hh[hz]&&hh[hz][hx]){hf=hh[hz][hx]}else{hf=hh?hh[hx]:eh
}if(!hf||!hf.length){try{hq=hp?hp.getPluginInfo():eh;if(!hq||hq.denied||hq.disabled){throw a1(!hq?"No KT2":(hq.denied?"KT2 denied":"KT2 disabled"))}var hs=hp.Crypto.findCertificate({hash:hx});
if(!hs){throw a1("KT2 does not found cert")}w();hs.display();return bd}catch(hu){try{var hi={1:"My",2:"CA",3:"AddressBook",4:"ROOT",5:"Disallowed"},hw=aA(["Capicom","Store"]);
hw.call("Open",[2,hi[hz]]);var hg=hw.get("Certificates");for(var hn=1,ho=hg.get("Count");hn<=ho;++hn){var ht=hg.get("Item",[hn]);if(ht.get("Thumbprint")==hx){w();
ht.call("Display");try{hw.call("Close")}catch(hl){}try{hw.free()}catch(hm){}return bd}}try{hw.call("Close")}catch(hl){}try{hw.free()}catch(hm){}}catch(hv){dZ.debug("Ошибка поиска сертификата через Тулбокс",hu);
dZ.debug("Ошибка поиска сертификата через CAPICOM",hv)}}dZ.debug("Не найден сертификат "+hx+" в локальных копиях.");dZ.fatal("Отсутствует локальная копия сертификата для отображения.");
return bd}hf=hf.replace(new RegExp("<br\\s*\\/?>","gi"),"\r\n");try{var hj=al(["Kontur_Toolbox","CryptoService"]);hj.ViewCertificate(hf)}catch(hy){hy=ep(hy);
try{w();var e0=dj(hf);e0.display();if(e0.free){e0.free()}}catch(hk){hk=ep(hk);try{hk.innerError=hy}catch(hm){}var hr="Просмотр сертификата невозможен.";
dZ.debug(hr,hk);dZ.fatal(hr)}}return bd};function bZ(e0){var w="Ваш антивирус вмешивается в работу системы, подменяя <nobr><b>ГОСТ-сертификат</b></nobr>.<br/>";
if(e0){w+="Проверьте, что в настройках антивируса Avast ";w+='<a rel="nofollow noopener" target="_blank" href="http://www.kontur-extern.ru/support/faq/34/566">';
w+="отключено сканирование HTTPS</a>."}else{w+="В настройках антивируса необходимо отключить подмену <nobr>SSL/HTTPS-сертификата</nobr>";w+=" сервера. Пожалуйста, обратитесь к вашему системному администратору."
}return w}var hc=cN()%1000000,hd={},hb={};function bB(){return gF.distrPath+"blank.htm"}function fX(hm){var hk=hc,hj=[],ho=' style="visibility: hidden; position: absolute; left: -999px; top: -999px"',hp=hm.url,hf=hm.data,hl=["<ifr",'ame onload="window.SkbKontur.Help.$onSendComplete(this)"'].join("");
hl+=' src="'+bB()+'" id="'+hk+'" name="'+hk+'"'+ho+" />";hb[hk]=hm.callback;hd[hk]=bd;++hc;hj.push('<form method="post" id="form'+hk+'" action="'+hp+'" target="'+hk+'" '+ho+">");
for(var hn in hf){var hq=hf[hn];if("function"!=typeof(hq)){if("string"==typeof(hq)){hq=hq.replace(new RegExp('"',"g"),"&quot;")}hj.push('<div><input name="'+hn+'" type="hidden" value="'+hq+'"/></div>')
}}hj.push('<div><input type="submit" name="send'+hk+'" value="Send" /></div>');hj.push("</form>");var hi=document,w=hi?hi.getElementsByTagName("body"):eh,e0=(hi&&hi.body)?hi.body:((w&&w.length)?w[0]:hi.documentElement),hg=hi.createElement("div"),hh=hi.createElement("div");
e0.appendChild(hg);hg.innerHTML=hl;e0.appendChild(hh);hh.innerHTML=hj.join("");hi.getElementById("form"+hk).submit();e0.removeChild(hh);function hr(){if(hd[hk]){return
}try{var ht=document.getElementById(hk);if(!ht){return}if("complete"===ht.readyState){em(ht);return}}catch(hs){}gM.setTimeout(hr,300)}gM.setTimeout(hr,100)
}function em(hn){hd[hn.id]=gx;var hl=eh,hk=eh;try{hl=hn.contentWindow;try{if(!hn.xssState&&hl.location&&(hl.location.pathname===bB())){return}}catch(hj){}hk=hl?hl.name:eh
}catch(hi){}var hm=gk("^\\{.*\\}$");if(hn.xssState||(hk&&hm(hk))){var hp,w=hb[hn.id];try{hp=new Function("return ("+hk+")")()}catch(hf){}if(hp){if(hp.serverTime&&hp.serverTime.length){gM.clientDate=gF.clientDate=new Date();
gM.clientTime=gF.clientTime=gF.clientDate.getTime();gM.serverTime=gF.serverTime=Date.parse(hp.serverTime);gM.serverDate=gF.serverDate=new Date(gF.serverTime)
}var e0=gF.diagnostics;if(e0&&e0.complete){if(hp.hash&&hp.hash.length){e0.hash=hp.hash}if((!isNaN(hp.id))&&hp.id>0){e0.diagId=hp.id}}}else{hp={}}if(w){w(hp);
delete hb[hn.id]}var ho=function(){if(hn&&hn.parentNode){hn.parentNode.removeChild(hn)}};try{hl.setTimeout(ho,1)}catch(hf){try{gM.setTimeout(ho,1)}catch(hg){}}}else{hn.xssState=1;
if(hk&&(Number(hk)==hk)){try{var hh="Ошибка отправки запроса на сервер";try{hh+=": "+hl.document.title}catch(hg){}try{console.error(hh)}catch(hg){console.log(hh)
}}catch(hf){}}if(hl){hl.location=bB()}}}var aH=null;function bN(e0){e0=(e0||"").toLowerCase();if(aH){return aH[e0]}try{var hg=gM.location?gM.location.search:eh;
if(hg&&hg.length){if("?"===hg.charAt(0)){hg=hg.substr(1)}var hf=hg.split(new RegExp("&","g"));aH={};bu(hf,function(hi){if(hi&&hi.length){var hh=hi.indexOf("=");
if(hh>0){aH[hi.substr(0,hh).toLowerCase()]=hi.substr(hh+1)||gx}else{aH[hi.toLowerCase()]=gx}}});return aH[e0]}}catch(w){}return bd}function gs(w){var e0=[];
for(var hf in w){var hg=w[hf];if("function"!=typeof(hg)){e0.push(encodeURIComponent(hf)+"="+encodeURIComponent(hg))}}return e0.join("&")}function bM(){var hj=gM.profileName||"",hk="",w;
try{var hh=gM.location;hj=hj||hh.pathname||"";w=hh.protocol+"//"+hh.host}catch(e0){w=fN}try{if(!aH){bN("back")}var hg=gk("^(arch|csp|(force)?back(url)?|from|hdd|ie|(install|query)cert|(need|no)(reboot|restart)|ram|regionId|sse\\d|test|win(Build|Name|SP))$","i"),hi={};
bu(aH,function(hl,hm){if(hl&&hg(hl)){hi[hl]=hm}});hk=gs(hi)}catch(hf){}if(hj&&hj.length&&("/"!==hj.charAt(0))){hj="/"+hj}if("/"===hj||"/diagnostics"===hj){hj=""
}return w+hj+(hk?("?"+hk):"")}function i(hg){var e0=bN("inframe");if(hg&&e0&&e0.length){var hf=gM.siteFrom,w=bN("from");if(w&&gk("^[\\w\\.\\/\\:\\-\\_]+$")(w)){hg+="&from="+w
}else{if(hf&&hf.length){hg+="&from="+hf}}if(hg.indexOf("inframe=")<0){hg+="&inframe=1"}}return hg}function bl(hk){if(hk&&hk.length){var hj=[],e0="А".charCodeAt(0),hh="ё".charCodeAt(0),hi="№".charCodeAt(0);
for(var hf=0,hg=hk.length;hf<hg;++hf){var w=hk.charCodeAt(hf);if((w>=32&&127!=w&&w<=255)||(w>=e0&&w<=hh)||(hi==w)){hj.push(hk.charAt(hf))}}return hj.join("")
}return hk}var er=new RegExp("^(\\\\)+"),es=new RegExp("(\\\\)+$");function B(w,e0){if(!e0||!e0.length){return(w&&w.length)?w.replace(es,""):""}if(!w||!w.length){return e0.replace(er,"")
}return w.replace(es,"")+"\\"+e0.replace(er,"")}function bS(hm){if(!hm){return{}}var hq=hm.lastIndexOf("\\"),hp=hm.substr(hq+1),hn=(hq>0)?hm.substr(0,hq+1):"",hg=hp.lastIndexOf("."),hj=(hg>0)?hp.substr(hg+1).toLowerCase():"",hk={name:hp,safeName:bl(hp),ext:hj,exist:bd,folder:hn,path:hm,attrs:eh},ho;
try{if(dr){var w=bY();if(!w){throw a1("fso is null")}if(w.$FileExists(hm)){hk.exist=gx;try{hk.version=w.$GetFileVersion(hm)}catch(hi){}ho=w.$GetFile(hm);
try{hk.size=ho.Size}catch(hi){}try{hk.dateCreated=new Date(ho.DateCreated).getTime()}catch(hi){}try{hk.dateOpened=new Date(ho.DateLastAccessed).getTime()
}catch(hi){}try{hk.dateWrited=new Date(ho.DateLastModified).getTime()}catch(hi){}try{if(!dI(ho.Attributes)){var hl=ho.Attributes;hk.attrs={readOnly:!!(hl&1),hidden:!!(hl&2),system:!!(hl&4),archive:!!(hl&32)};
hk.setReadOnly=function(hr){hl=hr?(hl|1):(hl&65534);w.$GetFile(hm).Attributes=hl;hk.attrs.readOnly=hr;return hk};hk.setHidden=function(hr){hl=hr?(hl|2):(hl&65533);
w.$GetFile(hm).Attributes=hl;hk.attrs.hidden=hr;return hk};hk.setSystem=function(hr){hl=hr?(hl|4):(hl&65531);w.$GetFile(hm).Attributes=hl;hk.attrs.system=hr;
return hk};hk.setArchive=function(hr){hl=hr?(hl|32):(hl&65503);w.$GetFile(hm).Attributes=hl;hk.attrs.archive=hr;return hk}}}catch(hi){}}hk.copy=function(hr){if(w.$FileExists(hr)){w.$DeleteFile(hr,gx)
}w.$CopyFile(hm,hr,gx);return hk};hk.move=function(hr){if(w.$FileExists(hr)){w.$DeleteFile(hr,gx)}w.$MoveFile(hm,hr);hk.exist=bd;return hk};hk.remove=function(){if(w.$FileExists(hm)){w.$DeleteFile(hm,gx);
hk.exist=bd}return hk};return hk}}catch(hh){}var e0=b9();if(e0){if(e0.isFileExist(hm)){hk.exist=gx;ho=e0.getFileObject(hm);try{hk.version=ho.version}catch(hh){}try{hk.size=ho.size
}catch(hh){}try{var hf=ho.dates;hk.dateCreated=1000*hf.creation;hk.dateOpened=1000*hf.lastAccess;hk.dateWrited=1000*hf.lastWrite}catch(hh){}}hk.copy=function(hr){e0=e0||b9();
if(e0.isFileExist(hr)){e0.deleteFile(hr)}ho.copyTo(hr);return hk};hk.move=function(hr){e0=e0||b9();if(e0.isFileExist(hr)){e0.deleteFile(hr)}ho.moveTo(hr);
hk.exist=bd;return hk};hk.remove=function(){e0=e0||b9();if(e0.isFileExist(hm)){e0.deleteFile(hm);hk.exist=bd}return hk}}return hk}function be(hf){var e0=bS(hf),w=e0.copy,hg=e0.move,hh=e0.remove;
e0.get=function(hi){if(hi&&("function"!=typeof(hi))){var hj=[];bu(hi,function(hk){if("e"===hk){hj.push(e0.exist)}else{if("v"===hk){hj.push(e0.version)}else{if("s"===hk){hj.push(e0.size)
}else{if("a"===hk){hj.push(e0.attrs)}else{hj.push(e0)}}}}});hj.push(e0);return ey.resolve(ey.args(hj))}else{d0(hi,"file.get");return ey.resolve(e0)}};e0.exists=function(hi){d0(hi,"file.exists");
return ey.resolve(e0.exist,e0)};if(w){e0.copy=function(hi){return ey.when(w,hi)}}if(hg){e0.move=function(hi){return ey.when(hg,hi)}}if(hh){e0.remove=function(hi){d0(hi,"file.remove");
return ey.when(hh)}}return e0}function bi(w){return be(w).exists()}function b8(hf,e0){var w=bA(e0);bu(w,function(hh,hg){w[hg]=B(hf,hh)});return w}function c0(w){var e0=[];
a0(new gM.Enumerator(w),function(hf){e0.push(hf.Path)});return e0}function bW(hi){if(!hi){return{}}if(hi.charAt(hi.length-1)=="\\"){hi=hi.substr(0,hi.length-1)
}var hn=hi.lastIndexOf("\\"),hk=hi.substr(hn+1),hl=(hn>0)?hi.substr(0,hn+1):"",hh={name:hk,safeName:bl(hk),ext:"folder",exist:bd,parent:hl,path:hi},e0=eh,hf=eh,hm=function(){if(hf.isExist(hi)){if((dO<213)&&A.ie&&(A.version<9)){return ey.promisify(function(hq,hp){try{hf.remove(hi);
hh.exist=bd;hq(hh)}catch(ho){hp(ho)}})}return ey.promisify(function(hp,ho){var hq=hf.removeAsync(hi,an(function(hr){if(hr){ho(a1("directory deletion error "+hr,hr))
}else{hh.exist=bd;hp(hh)}}));if(hq){ho(a1("thread creation error",1))}},"folder.removeAsync")}return ey.resolve(hh)};try{if(dr){var w=bY(),hj;if(!w){throw new Error()
}if(w.$FolderExists(hi)){hh.exist=gx;hj=w.$GetFolder(hi)}hh.files=function(){return hh.exist?c0(hj.Files):[]};hh.folders=function(){return hh.exist?c0(hj.SubFolders):[]
};hh.create=function(){if(!w.$FolderExists(hi)){if(hl&&hl.length>3){bW(hl).create()}try{w.$CreateFolder(hi);if(!w.$FolderExists(hi)){throw a1("Folder not created with FSO",2)
}}catch(ho){dZ.debug("Error when folder create with FSO",ho);throw ho}hh.exist=gx}return hh};hh.remove=function(){if(w.$FolderExists(hi)){try{w.$DeleteFolder(hi,gx)
}catch(ho){dZ.debug("Error when folder remove with FSO",ho);throw ho}hh.exist=bd}return hh};hh.removeAsync=function(){if(!w.$FolderExists(hi)){return ey.resolve(hh)
}e0=e0||b9();hf=e0&&e0.directoryWorker;if(hf){return hm()}return ey.reject(a1("fso - inappropriate api",1))};return hh}}catch(hg){}e0=b9();hf=e0&&e0.directoryWorker;
if(hf){hh.exist=hf.isExist(hi);hh.files=function(){return hh.exist?b8(hi,hf.getFilesIn(hi)):[]};hh.folders=function(){return hh.exist?b8(hi,hf.getSubdirsIn(hi)):[]
};hh.create=function(){if(!hf.isExist(hi)){try{hf.create(hi);if(!hf.isExist(hi)){throw a1("Folder not create",2)}}catch(ho){dZ.debug("Error when folder create with dw",ho);
throw ho}hh.exist=gx}return hh};hh.remove=function(){if(hf.isExist(hi)){try{hf.remove(hi)}catch(ho){dZ.debug("Error when folder remove with dw",ho);throw ho
}hh.exist=bd}return hh};hh.removeAsync=hm}return hh}function bs(hg){var hf=bW(hg),e0=hf.files,hh=hf.folders,w=hf.create,hi=hf.remove,hj=hf.removeAsync;
hf.get=function(hk){d0(hk,"folder.get");return ey.resolve(hf)};hf.exists=function(hk){d0(hk,"folder.exists");return ey.resolve(hf.exist,hf)};if(e0){hf.files=function(hk){d0(hk,"folder.files");
return ey.when(e0)}}if(hh){hf.folders=function(hk){d0(hk,"folder.folders");return ey.when(hh)}}if(w){hf.create=function(hk){d0(hk,"folder.create");return ey.when(w)
}}if(hi){hf.remove=function(hk){d0(hk,"folder.remove");return ey.when(hi)}}if(hj){hf.removeAsync=function(hk){d0(hk,"folder.removeAsync");return ey.when(hj)
}}return hf}function bt(w){return bs(w).exists()}function bT(hf){var w="CLSID\\";function e0(hg){return ai.$regReadString(hg,eV+hf+"\\"+w,"",bd).then(function(hh){if(!hh||!hh.length){throw new Error()
}return hh}).caught(function(){return ai.$regReadString(hg,eV+hf+"\\CurVer\\","",bd).then(function(hh){return fm(hg,eV+hh+"\\"+w,"",bd)}).then(function(hh){if(!hh||!hh.length){throw new Error()
}return hh})}).then(function(hh){return ai.$regReadString(hg,eV+w+hh+"\\InprocServer32\\","",bd).then(function(hi){if(!hi||!hi.length){throw new Error()
}return ba(hi)})})}return e0(df).caught(G(e0,dg)).caught(eh)}function bX(w){return ey.when(function(){return b9().directoryWorker.getFreeSpace(w)}).caught(function(hf){aL("getFreeSpace("+w+")",hf);
if(dr){try{var e0=bY().$GetDrive(w),hh=1048576;return Math.floor((e0.AvailableSpace||e0.FreeSpace||0)/hh)}catch(hg){}}return 0})}function dc(hi){if(!hi||!hi.length){return hi
}function hl(ho){var hn=[];while(ho>0){hn.push(ho%10);ho=Math.floor(ho/10)}return hn}function hf(hn){for(var ho=0,hp=hn.length;ho<hp;++ho){if(hn[ho]>9){hn[ho+1]=(hn[ho+1]||0)+Math.floor(hn[ho]/10);
hn[ho]=hn[ho]%10}}return hn}function w(hn,ho){var ht=[];for(var hp=0,hq=hn.length;hp<hq;++hp){ht.push((hn[hp]||0)+(ho[hp]||0))}for(var hr=hn.length,hs=ho.length;
hr<hs;++hr){ht[hr]=(ho[hr]||0)}return hf(ht)}function e0(hn){var ho=w(hn,hn),hp=w(ho,ho),hq=w(hp,hp);return w(hq,hq)}var hh=Math.min(7,hi.length),hm=hl(parseInt(hi.substr(0,hh),16));
for(var hj=hh,hk=hi.length;hj<hk;++hj){hm=e0(hm);var hg=parseInt(hi.substr(hj,1),16);hm=w(hm,hl(hg))}return hm.reverse().join("")}function dn(w){if(w<0){w=4294967295+w+1
}return"0x"+w.toString(16).toUpperCase()}function ga(e0,w){var hh="Неизвестная ошибка";if(!e0){return hh}var hg={};hg[-2146827859]="Проверьте настройки зоны надежных узлов";
hg[-2147023838]="Необходимая служба или ее зависимые службы отключены";hg[-2147024769]="Указанная процедура не найдена. Возможно, повреждены системные файлы";
hg[-2147024770]="Системные файлы повреждены или отсутствуют";hg[-2147024891]="Отказано в доступе (к DCOM или Windows)";hg[-2147217405]="У вас недостаточно прав. Обратитесь к своему сист. администратору (WBEM_E_ACCESS_DENIED)";
hg[-2147217406]="Возможно, групповая политика сист. администратора блокирует запуск (WBEM_E_NOT_FOUND)";hg[-2147217407]="Фатальная ошибка вызова WMI (WBEM_E_FAILED)";
hg[-2147319779]="Библиотека не зарегистрирована";function hf(hj){var hm=hj.description||hj.message,hn=hj.number||hj.errorCode||hj.code,hl=null;if(hn&&(hn>=2147483648)){hn=hn-4294967295-1
}var hk=(hn||0===hn)?((hn>=0&&hn<10)?hn:(dn(hn)+", "+hn)):"";if(hm){var hi=w?hm:(hg[hn]||hm);hi=hi.length&&hi.replace(new RegExp("^[\\s\\r\\n]+|[\\s\\r\\n]+$","g"),"")||"";
hl=hi+(hn?(" (код: "+hk+")"):"")}else{if(hn){if(hg[hn]){hl=hg[hn]+" (код: "+hk+")"}else{hl="код ошибки: "+hk}}}if(hl){return hl+(hj.innerError?(" - "+hf(hj.innerError)):"")
}return hh}return hf(ep(e0))}var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=eh;function u(w){if(!w||!w.length){return[]}if(!t){t={"=":64};
bu(s,function(ho,hp){t[ho]=hp})}var hn=[];for(var hl=0,hm=w.length;hl<hm;hl+=4){var hh=t[w.charAt(hl)],hi=t[w.charAt(hl+1)],hj=t[w.charAt(hl+2)],hk=t[w.charAt(hl+3)],e0=(hh<<2)|(hi>>4),hf=((hi&15)<<4)|(hj>>2),hg=((hj&3)<<6)|hk;
hn.push(e0);if(hj<64){hn.push(hf)}if(hk<64){hn.push(hg)}}return hn}function C(w){var e0=2,hi=0,hj=[];for(var hg=0,hh=w.length;hg<hh;++hg){var hf=w[hg];
if(hf<0||hf>255){return""}e0=hg%3;switch(e0){case 0:hj.push(s.charAt(hf>>2));break;case 1:hj.push(s.charAt(((hi&3)<<4)|(hf>>4)));break;case 2:hj.push(s.charAt(((hi&15)<<2)|(hf>>6)));
hj.push(s.charAt(hf&63));break;default:break}hi=hf}switch(e0){case 0:hj.push(s.charAt((hi&3)<<4));hj.push("==");break;case 1:hj.push(s.charAt((hi&15)<<2));
hj.push("=");break;default:break}return hj.join("")}function d5(hk){var hf={},hg=256;for(var hl=0;hl<hg;++hl){hf[String.fromCharCode(hl)]=hl}var hm="",hj=[],w=0,hh=0,hi=9,e0=hg;
bu(hk,function(hn){var ho=hm+hn;if(hf[ho]){hm=ho}else{w|=hf[hm]<<hh;hh+=hi;do{hj.push(s.charAt(w&63));w>>=6;hh-=6}while(hh>=6);hf[ho]=hg;hg++;hm=hn;--e0;
if(!e0){e0=hg;++hi}}});w|=hf[hm]<<hh;hh+=hi;while(hh>0){hj.push(s.charAt(w&63));w>>=6;hh-=6}return hj.join("")}function fV(hi,hf,w){var hh={profileId:da.profileId||0,type:((hi=="fatal")||(hi=="error"))?"error":((hi=="info")?hi:"warning"),url:bM(),message:encodeURIComponent(hf||"")},e0=gF.diagnostics,hg=[];
return ey.fork(e0,function(){var hj=e0.hash;if(hj&&hj.length){hh.hash=hj;return eh}return ey.timeout(10).then(function(){return encodeURIComponent(e0.getResult().toXml(gx))
}).caught(function(hm){var hl=e0.getResult(),hk=hl.getValues();function hn(hp){function ho(hr,hs){try{hl.setValues(hs);encodeURIComponent(hl.toXml());return eh
}catch(hq){hg.push(hr);hn(hs);return bd}}if(dq(hp)){bu(hp,function(hr,hq){return ho(hq,hr)})}else{if("object"==typeof(hp)){bu(hp,ho)}}}hn(hk);hl.setValues(hk);
throw hm}).timeout(10).then(function(hk){hh.diagnosis=d5(hk);hh.lzw=1})}).timeout(10).then(function(){try{hh.trace=encodeURIComponent(gF.log||"")}catch(hj){var hk=(gF.log||"").split(dV);
var hl=function(hn,hp){var hm="";try{hm=encodeURIComponent(hp)}catch(hq){var ho=[];for(var hr=0,hs=hp.length;hr<hs;++hr){ho.push(hp.charCodeAt(hr))}hm=["START_LONG_LINE ",ho.join(",")," END_LONG_LINE","\n"].join("")
}hn+=hm;return hn};hh.trace=da.reduce([""].concat(hk),hl)}}).timeout(10).then(function(){fX({url:ai.logUrl,callback:w,data:hh})}).caught(function(hk){var hj="Ошибка при сохранении лога событий.\nИнформация для техподдержки:\n-тип: "+hi+"\n"+(hg.length?("-путь: "+hg.join("/")+"\n"):"")+"-сообщение: "+hf;
gM.alert(hj+"\n"+ga(hk,gx));if(w){w({})}})}function cO(){var w=new Date();w.setTime(cN()-gF.logTime);var e0=w.getMinutes(),hf=w.getSeconds();return k(e0)+":"+k(hf)
}function cQ(w){var hg=dw(w)?-w.getTimezoneOffset():(w*60),e0=Math.floor(Math.abs(hg)/60),hf=Math.abs(hg)%60;return"UTC"+((hg<0)?"-":"+")+k(e0)+":"+k(hf)
}function c7(w){return ey.when(function(){return b9().isProcessorFeaturePresent(w)})}function gt(hf,hh,hi){var hg="Diagnostics",w=hf?(hg+"."+hf):"",e0=hh?(w+"."+hh):"";
if(gM._gaq){gM._gaq.push(["_trackEvent",hg,w,e0,hi])}if(gM._paq){gM._paq.push(["trackEvent",hg,w,e0,hi])}}function ce(e0,w){return function(hj,hh,hf,hn,hm){if(gF.log&&gF.log.length){gF.log+="\r\n"
}var hk="["+cO()+"] ";if("debug"!==e0&&"send"!==e0){hk+=e0.toUpperCase()+": "}hk+=(hj||"");hh=ep(hh);if(hh){if(hh.description||hh.message||hh.number){hk+=": "+ga(hh,gx)
}else{if("string"==typeof(hh)){hk+=": "+hh}else{var hi=[];for(var hl in hh){hi.push('"'+hl+'"="'+hh[hl]+'"')}hk+=": "+hi.join(", ")}}}if(hn){d1[hn]=gx;
if(hm){hk+="\r\n"+hm.join("\r\n")}}gF.log+=hk;if(("fatal"===e0)||("error"===e0)){d4=gx;try{console.log(hk)}catch(hg){}if("fatal"===e0){fV("error",hj,hf)
}}else{if("send"===e0){fV("info",hj,hf)}}if(bq(e0,hj)&&w){w(hj)}}}function r(hf,w){var e0=d2[hf];if(!e0){e0=d2[hf]=[]}e0.push(w)}function aS(hf,w){var e0=d2[hf];
bu(e0,function(hh,hg){if(hh===w){e0.splice(hg,1);return bd}return eh})}function bq(hg,e0){var w=d2[hg],hf=gx;bu(w,function(hi,hh){if(bd===w[hh](e0)){hf=bd;
return bd}return eh});return hf}var gg=new RegExp("[\\x00-\\x1F]","g"),gf=new RegExp("[\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F]","g");function fJ(e0,w){return(e0&&e0.length)?gu(e0.replace(w?gf:gg,"")):""
}function a6(e0){var w="\\.-+*|()[]?$^".split("");bu(w,function(hf){var hg="\\"+hf;e0=e0.replace(new RegExp(hg,"g"),hg)});return e0}function ae(hh,hk,hg,hm,e0){hk=hk||"";
function w(ho,hp){return ey.timeout(hp||500,ho)}var hj=gF.maxUploadFileSize,hi=-1,hn=0,hl="7za.exe",hf=[];return ey.each(hg,function(ho){if(!ho){return eh
}var hp=be(B(hk,ho));return ey.fork((ho.indexOf("*")>=0),function(){var hq=gk("^"+a6(hp.name).replace("\\*",".*")+"$","g");return bs(hp.folder).files().each(function(hr){if(hq(be(hr).name)){hf.push(ho)
}})},function(){return hp.exists().truth(function(){hf.push(ho)})})}).then(function(){return hf.length}).truth(function(){dZ.info("Скачиваем архиватор (600 КБ)...");
return cR("cache").then(function(ho){return ey.all(ho.getFreePath(eh,hm),ho.getFreePath(eh,hl))}).spread(function(hr,hs){function ho(){var ht;return be(hr).get("esf").then(function(hu,hw,hx){var hv="ЛОГИ - размер архива "+hx.name+" равен "+cK(hw,gx);
return ey.fork(hw>hj,function(){return bn(hl,hr).truth(function(hy){ht=hy;return ht.kill(0)}).anyway(function(){return hx.remove()}).anyway(function(){dZ.debug(hv+", это больше лимита 15 МБ");
return ey.$return(hr)})}).fork(hw==hi,function(){return bn(hl,hr).then(function(hy){ht=hy;if(!ht){dZ.debug(hv+", архиватор закрылся, архив готов");return ey.$return(hr)
}if(hn>=10){return ey.when(function(){return ht.kill(0)}).anyway(function(){dZ.debug(hv+", давно не меняется, архив готов");return ey.$return(hr)})}++hn;
return eh})},function(){hn=0}).then(function(){hi=hw;dZ.info(hh+" ("+cK(hi,gx)+" сжато)...");return ey.timeout(999).then(ho)})})}var hp=ai.rootUrl+gF.distrPath;
return ai.download(hp,hl,gF.distrPath).then(function(ht){if(eh===ht){dZ.debug("ЛОГИ - Ошибка скачивания архиватора "+hl);return ey.thrown()}return be(ht).copy(hs).then(function(){return bi(hs).truth(function(){gM.setTimeout(function(){bs(be(ht).folder).remove().caught()
},2999);return hs},ey.thrown())}).caught(ht)}).then(function hq(hu){dZ.info(hh+"...");var ht=e0?(" -x!"+e0):"";return fO(hu,{args:"a -t7z -mx5 -aoa -ssw -y"+ht+' "'+hr+'" "'+hf.join('" "')+'"',directory:hk}).waitRun().timeout(500).anyway(ho)
})})},function(){dZ.debug("ЛОГИ - Нет файлов для сжатия");return w(eh,1)}).caught(function(){return w(eh,1)}).caughtReturn(w)}function bx(){try{if("function"==typeof(CollectGarbage)){CollectGarbage()
}}catch(w){dZ.error("Метод CollectGarbage() выдал ошибку",w)}}function bP(){return gF.diagnostics||(gF.diagnostics=new da.Diagnostics())}da.getDiagnostics=bP;
function bV(){return gF.diagnostics.getFixer()}da.startDiagnostics=function(hq){try{gF.originUrl=gM.location.protocol+"//"+gM.location.host}catch(hf){}gF.customFixParams={addon:"needInstallDiadocPrint"};
hq=hq||{};var w=hq.options,ht=hq.viewId;if(w){bu(["distrPath","originUrl"],function(hv){if(!dI(w[hv])){gF[hv]=w[hv]}});if(w.customFixParams){bu(w.customFixParams,function(hv,hw){gF.customFixParams[hv]=hw
})}}bu(gF.customFixParams,function(hv,hw){if(bN(hv)){gF[hw]=gx}});var e0=bP(),hh=bV(),hp="onStart",hm="onKDUpdate",hn="onProgress",hl="onComplete",ho="onPrompt",hg=[hp,hm,hn,hl];
function hi(){var hv=[];bu(d1,function(hw){hv.push(hw)});hv.sort();return hv.length?" (tags: "+hv.join(", ")+")":""}e0.onProgressDefault=function(hw,hx,hv){dZ.debug((hv?"Complete":"Start")+' test "'+(hx||"Untitled")+'".');
if(hv){bx()}};e0.addEventListener(hn,e0.onProgressDefault);e0.onCompleteDefault=function(){hh.addEventListener("fixRemove",function(hv){dZ.debug("Отменен фикс "+hv.caption+" ("+hv.name+"). Т.к. сломана папка TEMP.")
});hh.checkMsiExcludes();hh.checkAppDataExcludes();hh.clearEventListeners("fixRemove");hh.restoreExcludes();cP().print();gF.diagnostics.complete=gx;if(d4){fV("error","Diagnostics complete with error(s)."+hi());
d4=bd}else{fV("info","Diagnostics complete."+hi())}d1={}};e0.addEventListener(hl,e0.onCompleteDefault);hh.addEventListener(hp,function(){dZ.debug("Starting of fixes...")
});hh.addEventListener(hn,function(hx,hz){if(!hx){return}var hy;if(dI(hz)){hy='Start fix "'+hx.name+'" ('+(hx.script?"script":(hx.filename||""))+")."}else{var hv=hx.badDependency;
var hw=hv?" (Unresolved dependency: "+hv+")":"";var hA=(hz&&!hz.code)?"success.":"failed."+hw;hy='Complete fix "'+hx.name+'" '+hA;bx()}dZ.debug(hy)});hh.addEventListener(hl,function(hx,hw){hw=hw||{};
cP().print();dZ.debug("Completing of fixes is "+(hx?"success.":"failed."));if(d4||!hx){fV("error","Fixes applied with error(s)."+hi());d4=bd}else{fV("info","Fixes complete."+hi())
}if(hx&&!hw.license){try{bE().clear()}catch(hv){}}d1={}});hh.addEventListener(ho,function(hv,hw){dZ.debug("Prompting fix "+hv.name+" with state "+hw)});
bu(hg,function(hv){if(hq[hv]){e0.addEventListener(hv,hq[hv])}});for(var hr in da.Scripts){var hs=da.Scripts[hr];var hk=hr.toLowerCase().indexOf("hidden")!==0;
if("function"==typeof(hs)){e0.addTest(hr,hs,hk)}}var hj=!!(da.View&&ht&&ht.length);if(hj){if("function"==typeof(da.View.startCallback)){e0.addEventListener(hp,da.View.startCallback)
}if("function"==typeof(da.View.progressCallback)){e0.addEventListener(hn,da.View.progressCallback)}var hu=document.getElementById(ht);hu.innerHTML=da.View.getDiagnosticsHtml()
}e0.run(hq.params||gF.defaultParams);return e0};function I(){var w=gF.certsByThumb;function hf(hj){var hh=[],hg=w[hj];if(hg){for(var hi in hg){hh.push("<string>"+hg[hi]+"</string>")
}}return hh.join("")}var e0='<?xml version="1.0"?>\r\n<ArrayOfString>';if(w){e0+=hf(ai.certViewPrivate);e0+=hf(ai.certViewOther);e0+=hf(ai.certViewDisallowed)
}e0+="</ArrayOfString>";return e0}da.attachFile=function(w){var e0={},hj=bd,hf=gF.diagnostics,hk=hf.diagId;if(hk){e0.id=hk;e0.hash=hf.hash;for(var hg in gF.files){if(gF.files[hg]){var hi=gF.files[hg][0],hh=gF.files[hg][1];
dZ.debug('[AttachFile] Отправка файла "'+hi+'" - '+cK(hh.length,gx)+" ("+hh.length+" байт)");e0["filename-"+hg]=hi;e0["filecontent-"+hg]=hh;hj=gx}}var hl=function(hm){if("success"==hm.result){gF.files={}
}if(w){w(hm.result)}};if(!hj){hl({result:"success"});return}gM.setTimeout(function(){fX({url:ai.attachUrl,data:e0,callback:hl})},50)}};da.sendResult=function(hj){var hf=gF.diagnostics,hk=hj||{},hl=hf.getResult(),hg=bV(),hh=hg.getApplicableFixes(),e0=hk.onComplete,hi=hf.hash,w=ai.addFile||function(){return ey.resolve()
};return ey.when(cd).then(function(hn){var hq=hn.$System32,ho=B(hq,"oeminfo.ini"),hp=B(hq,"oemlogo.bmp");return ey.all(be(ho).get(),be(hp).get()).spread(function(hs,hr){return ey.fork(hs.exist&&(hs.size<=204800),function(){return w(ho,bd).caught()
}).fork(hr.exist&&(hr.size<=1048576),function(){return w(hp,bd).caught()})})}).caught().timeout(10).then(function(){hk.fixes=encodeURIComponent(da.Fix.toXml(hh))
}).timeout(10).then(function(){hk.certificates=d5(I());hk.lzw=1;hk.url=bM();if(hi&&hi.length){hk.hash=hi}else{hk.result=encodeURIComponent(hl.toXml(gx))
}}).timeout(10).fork(!!ai.customCompressLogFunc,function(){return ey.when(ai.customCompressLogFunc).truth(function hn(ho){return be(ho).get("es").truth(function(hq,hr,hp){dZ.debug('Прикрепляем логи "'+hp.name+'" - '+cK(hr,gx)+" ("+hr+" байт)");
return w(ho,bd,gx).then(function(hs){if(hs&&hs.length){dZ.debug('Ошибка прикрепления файла "'+ho+'": '+hs)}})},function(){dZ.debug("Не удалось сжать логи - файл не найден")
})},function(){dZ.debug("Не удалось сжать логи - путь пустой")})}).then(function hm(){for(var hn in gF.files){if(gF.files[hn]){var hp=gF.files[hn][0],ho=gF.files[hn][1];
dZ.debug('[SendReg] Отправка файла "'+hp+'" - '+cK(ho.length,true)+" ("+ho.length+" байт)");hk["filename-"+hn]=hp;hk["filecontent-"+hn]=ho}}fX({url:ai.registerUrl,data:hk,callback:function(hr){if(e0){if(!hr||isNaN(hr.id)){e0(-1)
}else{gF.files={};e0(hr.id)}}hk.certificates=eh;hk.fixes=eh;hk.result=eh;for(var hq in gF.files){if(gF.files[hq]){hk["filecontent-"+hq]=eh}}gF.files={}
}})})};var f7,g,g5,bv,dm,d,gP,eL,eS,ei,d9="winmgmts:",gU="{impersonationLevel=impersonate}";function dH(){return(gF.atolLocale||gF.cryptoLocale||gF.eiasLocale||gF.fedLocale||gF.flashLocale||gF.ftsLocale||gF.rosreestrLocale||gF.shtrihLocale||gF.sertumLocale||gF.ucLocale||gF.vikiLocale)
}function dE(){return gF.rarLocale||gF.locale16||gF.egaisLocale}function ca(){var w=gF.productVersions,e0=w.KonturToolboxMin2;if(gF.needKT2Pilot){e0=w.KonturToolboxPilot2
}else{if(dE()||dH()){e0=w.KonturToolbox2}}return e0}function bA(w){if(w===eh){return eh}if(dr&&!w&&(typeof w=="unknown")){return new gM.VBArray(w).toArray()
}if(w&&("item" in w)){var hg=[];for(var e0=0,hf=w.length;e0<hf;++e0){hg.push(w.item(e0))}return hg}return w}function p(w){var e0=al(["Scripting","Dictionary"]);
bu(w,function(hg,hf){e0.Add(hf,hg)});return e0.Items()}function g1(hh,hg,e0){var w=[];for(var hf=0;hf<e0;++hf){w.push("arguments["+hf+"]")}return new Function("o","return function(){ return o."+hg+"("+w.join(",")+");}")(hh)
}function bY(){if(dI(bv)){try{var hg=al(["Scripting","FileSystemObject"]),hf={BuildPath:2,CopyFile:3,CopyFolder:3,CreateFolder:1,CreateTextFile:3,DeleteFile:2,DeleteFolder:2,FileExists:1,FolderExists:1,GetDrive:1,GetExtensionName:1,GetFile:1,GetFileName:1,GetFileVersion:1,GetFolder:1,GetParentFolderName:1,GetSpecialFolder:1,GetTempName:0,MoveFile:2,MoveFolder:2,OpenTextFile:4};
bv={};for(var e0 in hf){bv["$"+e0]=g1(hg,e0,hf[e0])}bv.$Drives=new Function("o",["return function() { return o.Dri","ves; }"].join(""))(hg)}catch(w){bv=eh
}}return bv}function cZ(){if(dI(gP)){var w=function(hj){var hk=hj.ExecQuery(["SELECT * FROM Win32_Opera","tingSystem"].join(""),"WQL",48);return new gM.Enumerator(hk)
};try{var hf=al(["WbemScripting","SWbemLocator"]);gP=hf.ConnectServer("","root\\cimv2","","","MS_0419");gP.Security_.ImpersonationLevel=3;w(gP)}catch(e0){var hh="//./root/cimv2",hi="\\\\.\\root\\cimv2",hg=[d9+gU+hh,d9+gU+hi,d9+gU+"!"+hh,d9+gU+"!"+hi,d9+hh,d9+hi,d9+"!"+hh,d9+"!"+hi];
bu(hg,function(hk){try{gP=GetObject(hk);w(gP);return bd}catch(hj){gP=eh;return eh}})}}return gP}function gQ(w){return new gM.Enumerator(cZ().ExecQuery(w,"WQL",48))
}function gR(hh,w,hf){var hi=[];if(cZ()){var hj;try{hj=gQ(hh)}catch(e0){dZ.error("Ошибка при запросе к WMI",e0);return eh}for(;!hj.atEnd();hj.moveNext()){var hg=hj.item();
if(!w||(bd===w(hg))){if(hf){return hg}hi.push(hg)}}}return hi.length?hi:eh}function gS(hg,w,hf){if(cZ()&&w){try{var hh=gQ(hg);for(;!hh.atEnd();hh.moveNext()){if(w(hh.item())===bd||hf){break
}}}catch(e0){}}}function gT(hf,w){var e0="HotFixID",hg="SELECT "+e0+", InstalledBy, InstalledOn FROM Win32_QuickFixEngineering";if(hf&&hf.length){hg+=" WHERE "+e0+"='"+hf.join("' OR "+e0+"='")+"'"
}return gR(hg,eh,w)}function ck(){var e0={},hf=0;function w(hg){if(hg&&(hg.Caption&&hg.Caption!=="0")&&hg.Caption.length){++hf;e0[hg.GUID]={Speed:hg.Speed,Name:hg.NetConnectionID||hg.Caption,Status:hg.NetConnectionStatus}
}}return ey.fork(dr,function(){return gR("SELECT * FROM Win32_NetworkAdapter",w)},function(){return dT("root\\cimv2","SELECT * FROM Win32_NetworkAdapter",["GUID","Speed","NetConnectionID","Caption","NetConnectionStatus"]).then(function(hg){bu(hg,w)
})}).then(function(){return ey.args(e0,hf)})}function cj(w){return ey.when(function(){if(!cZ()){return ey.thrown()}return gR("SELECT * FROM Win32_NetworkAdapterConfiguration")
}).caught(function(e0){if(cZ()){dZ.debug("Ошибка при получении информации о сетевых адаптерах через WMI",e0)}if(w){return eh}var hf=bA(b9().getNetworkAdaptersInfo());
if(!hf){throw a1("func returns null",31337,e0)}return hf}).caught(function(e0){throw aL("getNetworkAdaptersInfo()",e0)}).filter(function(e0){return e0&&e0.IPEnabled&&e0.MACAddress!="10:11:11:11:11:11"
})}function cl(){return ey.fork(dO>=209,function(){var w=fT(b9().getNetworkAdaptersInfoEx());if(!w){throw a1("func returns null",3133)}return w},ey.thrown(a1("kd too old"))).fork(gF.winVer<600,function(w){return ey.filter(w,function(e0){return !!e0.macAddress
})}).caught(function(w){throw aL("getNetworkAdaptersInfoEx()",w)})}function cE(){var e0=[];function w(hf){if(hf&&(hf.Destination||hf.NetworkAddress)&&(hf.Mask||hf.NetworkMask)){e0.push({Network:hf.Destination||hf.NetworkAddress,Subnet:hf.Mask||hf.NetworkMask,Gateway:hf.NextHop})
}}return ey.when(function(){try{var hg=bA(b9().getRouteTable());bu(hg,w)}catch(hf){aL("getRouteTable()",hf);gS("SELECT * FROM Win32_IP4RouteTable",w)}return e0
})}function cX(){var w=dr?cZ():null,hf=1024,hg=1048576,hh=["SELECT * FROM Win32_Opera","tingSystem WHERE Primary = TRUE"].join(""),e0=function(hn){if(hn&&hn.length>13){var ho=Number(hn.substr(0,4)),hl=Number(hn.substr(4,2)),hi=Number(hn.substr(6,2)),hj=Number(hn.substr(8,2)),hk=Number(hn.substr(10,2)),hm=Number(hn.substr(12,2));
return new Date(ho,hl-1,hi,hj,hk,hm).getTime()}return hn};return ey.fork(dr,function(){if(!w){throw new Error()}var hk=gR(hh,eh,gx);if(!hk){gF.badWmi=gx;
throw a1("winData is empty from wmi",1)}var hi=0,hj=0;if(hk.TotalVisibleMemorySize){hi=hk.TotalVisibleMemorySize/hf}gS("SELECT Capacity FROM Win32_PhysicalMemory",function(hl){if(hl){hj+=hl.Capacity?hl.Capacity/hg:0
}});hi=Math.max(hi,hj);if(0===hi){gS("SELECT TotalPhysicalMemory FROM Win32_LogicalMemoryConfiguration",function(hl){if(hl&&hl.TotalPhysicalMemory){hi+=hl.TotalPhysicalMemory/hf
}})}return ey.args(hk,hi)},function(){var hi=["Name","Version","ServicePackMajorVersion","EncryptionLevel","LastBootUpTime","OSLanguage","CodeSet","Locale","CountryCode","TotalVisibleMemorySize"];
if(cY()>=6){hi.push("OSArchitecture")}return dT("root\\cimv2",hh,hi,gx).then(function(hk){if(!hk){throw a1("winData is empty from kd_wmi",1)}var hj=0;if(hk.TotalVisibleMemorySize){hj=hk.TotalVisibleMemorySize/hf
}return dT("root\\cimv2","SELECT Capacity FROM Win32_PhysicalMemory",["Capacity"],gx).then(function(hl){if(hl&&hl.Capacity){hj=Math.max(hj,hl.Capacity/hg)
}return ey.fork(0===hj,function(){return dT("root\\cimv2","SELECT TotalPhysicalMemory FROM Win32_LogicalMemoryConfiguration",["TotalPhysicalMemory"]).then(function(hm){if(hm&&hm.TotalPhysicalMemory){hj=hm.TotalPhysicalMemory/hf
}})}).then(function(){return ey.args(hk,hj)})})})}).caught(function(hi){if(w||!dr){dZ.debug("Ошибка определения информации о Windows",hi)}return ey.args(eh,eh)
}).then(function(hn,hl){var hk=eh;try{var hi=b9();if(hi){hk=hi.osInformation}else{throw a1("KD is null or not HasAccess",5)}}catch(hj){aL("osInformation",hj)
}if(hn===eh&&hk===eh){return ey.thrown()}var hm=(hn!==eh)?{name:String(hn.Name||"").split("|")[0],version:hn.Version,sp:Number(hn.ServicePackMajorVersion),arch:(hn.OSArchitecture||""),encryption:Number(String(hn.EncryptionLevel||"").split(" ")[0]),lastboottime:e0(hn.LastBootUpTime),language:hn.OSLanguage,ram:Math.floor(hl+0.6)}:{name:eh,version:hk.version,sp:hk.servicePackMajorVersion,arch:hk.architecture,encryption:hk.encryptionLevel,lastboottime:hk.startupTime*1000,language:hk.language,ram:Math.floor((hk.totalVisibleMemorySize/hf)+0.6)};
if(hk!==eh){hm.codepage=hk.codepage;hm.locale=hk.locale;hm.country=hk.countryCode}else{hm.codepage=hn.CodeSet;hm.locale=hn.Locale;hm.country=hn.CountryCode
}return hm})}function dL(){var w=gF.winVer;return 503==w||601==w||701==w||801==w||811==w||1011==w}function W(hf){if(!hf){return 2}var w={"windows 2000":500,"windows xp professional x64":502,"windows xp x64":502,"windows xp":501,"windows server 2003":503,"windows 2003":503,"windows vista":600,"windows 7":700,"windows web server 2008 r2":701,"windows server 2008 r2":701,"windows 2008 r2":701,"windows web server 2008":601,"windows server 2008":601,"windows 2008":601,"windows web server 2012 r2":811,"windows server 2012 r2":811,"windows 2012 r2":811,"windows web server 2012":801,"windows server 2012":801,"windows 2012":801,"windows web server 2016":1011,"windows server 2016":1011,"windows 2016":1011,"windows 8.1":810,"windows 8":800,"windows 10":1010,"windows technical preview":1010,"windows developer preview":800,"windows consumer preview":800,"windows customer preview":800,"5.1.2600":501,"6.0.600":600,"6.1.760":700,"6.2.8":800,"6.2.9":800,"6.3.9":810,"6.4.9":1010};
hf=hf.toLowerCase().replace(new RegExp("\\®","g"),"");hf=hf.replace(new RegExp("\\s*\\(R\\)\\s*","gi")," ");for(var e0 in w){if(hf.indexOf(e0)>=0){var hg=gF.winVer=w[e0];
if((hg>=501)&&(hg<900)){return 0}if(1010==hg){return(Number(gF.winBuild||"10240")>=10240)?0:1}if(1011==hg){return(Number(gF.winBuild||"14393")>=14393)?0:1
}return 1}}dZ.error("Невозможно определить версию Windows по строке: "+hf);return 1}function U(w){if(eh===w||("0"===w)){return 1}var e0=gF.winVer;if(!e0){return 0
}switch(e0){case 500:return(w>=4)?0:2;case 501:return(w>=3)?0:2;case 502:case 503:return(w>=2)?0:2;case 600:case 601:return(w>=2)?0:2;case 700:case 701:return(w>=1)?0:2;
case 800:case 801:case 810:case 811:case 1010:case 1011:return 0;default:dZ.error("Неизвестная версия Windows при определении допустимого сервис-пака: "+e0);
return 2}}function V(){var e0=0,ho,hp="user",hr=1,hq=bd,hi=bd,hf="err",ht="",hu="",hl=bd,hg=bd,hj=bd,hm=bd,hh=bd,hk=bd,hn=[],hs,w;return ey.fork((gF.winInfoCode===0||gF.winInfoCode===-2),gF.winInfoCode,function(){return ey.when(function(){if(!dr&&!b9()){e0=-1;
return ey.thrown(a1("kd not found",1))}return cX()}).then(function(hN){var hO=eh,hM=eh,hP="",hK="",hw="",hx="",hJ=0,hE="",hA=eh,hF="",hI="",hy="";if(hN){hO=hN.version;
var hR=String(hO||"").split(new RegExp("\\.","g"));hM=(hR.length>2)&&hR[2]||eh;if(hN.name){hP=(hN.name+" ("+hO+")")}hK=hN.sp;hw=hN.arch;hx=hN.codepage;
hA=hN.encryption;hF=hN.lastboottime;hE=hN.language;hI=hN.locale;hy=hN.country;hJ=hN.ram}gF.encryption=hA;gF.lastboottime=hF;gF.language=hE;gF.locale=hI;
gF.country=hy;ho=cd();if(!hP){try{hP=fm(dg,eZ,"ProductName",bd);if(!hP){throw new Error()}try{var hB=bS(B(ho.$System32,"eula.txt"));if(hB.exist&&(hB.size<100000)){var hH=eF(hB.path,1251).split(dV);
for(var hD=hH.length-1;hD>=0;--hD){var hG=hH[hD];if(0===hG.indexOf("EULAID:")){if(hG.indexOf("_HOM_")>0){hP+=" Home"}else{if(hG.indexOf("_PRO_")>0){hP+=" Professional"
}}break}}}}catch(hz){}if(!hO){try{hO=fn();hM=fm(dg,eZ,"CurrentBuildNumber",bd)}catch(hz){hO=eh}}if(hO){hO+=(hM&&hO.indexOf("."+hM)<0)?("."+hM):"";hO=" ("+hO+")"
}hP+=(hO||"")}catch(hz){var hQ=A.winNTVer,hS=ai.winVersions;hP="Windows NT";if(hQ){hP+=" "+hQ;if(hS[hQ+hw]){hP+=" ("+hS[hQ+hw]+")"}else{if(hS[hQ]){hP+=" ("+hS[hQ]+")"
}else{dZ.error("Ошибка определения версии Windows ("+hQ+") по UserAgent: "+A.userAgent)}}}}}if(!hK){try{hK=fk(dg,eW+"Windows\\","CSDVersion",bd)>>8}catch(hL){dZ.debug("Ошибка определения версии сервис-пака из реестра",hL)
}}gF.needKT2Pilot=false;gF.needKT3Pilot=false;gF.winName=hP;gF.winBuild=hM;gF.ram=hJ;gF.winSP=hK;gF.winVerResult=W(hP);gF.winSpStatus=U(hK);(function(){if(!hw){if(A.wow64){hw="x64"
}else{if(hP&&hP.length>5&&hP.indexOf(" x64 ")>0){hw="x64"}else{if(ho){hw=ho.$Arch}else{dZ.debug("Ошибка определения разрядности Windows. UserAgent: "+A.userAgent)
}}}}hw=String(hw);if(~hw.indexOf("32")||~hw.indexOf("86")){gF.arch=32}else{if(~hw.indexOf("64")){gF.arch=64}else{gF.arch=eh;dZ.debug("Неизвестное значение разрядности Windows: "+hw)
}}})();ho=cd(gx);if(!hx){try{hx=Number(fm(dg,eW+"Nls\\CodePage\\","ACP",bd))}catch(hv){dZ.debug("Ошибка определения кодировки Windows из реестра",hv)}}gF.codepage=hx;
(function hC(h2){var hY=eY+"Policies\\System\\",hW="EnableLUA",hT="ConsentPromptBehaviorAdmin";function h0(h5,h6){try{var h4=fk(dg,hY,h5,h6);if(!h4&&(0!==h4)){throw a1("null uac",1)
}return[gx,h4]}catch(h3){return[bd,ep(h3)]}}function hZ(h5,h3,h6){var h4=h0(h5,h6);if(!h4[0]){if(h6){h4=h0(h5,bd)}if(!h4[0]){if(dx(h4[1])){return[gx,h3]
}dZ.error("Ошибка определения UAC (параметр: "+h5+", версия Windows: "+h2+")",h4[1]);return eh}}return h4}if(h2>=600){var hX=(64==gF.arch),h1=hZ(hW,1,hX),hU=hZ(hT,5,hX),hV=(hU&&(hU.length>1))?hU[1]:-1;
gF.uac=(h1&&(h1.length>1))?h1[1]:"err";if(1==gF.uac){if(0===hV){gF.uac="silent"}}else{if((h2>=700)&&(hV>0)){gF.uac="consent";dZ.debug("UAC = "+gF.uac+", "+hT+" = "+hU[1])
}}}else{gF.uac=h2?"unimpl":"not"}})(gF.winVer)}).then(function(){if(ho){ht=ho.$UserDomain;var hw=ho.$UserDNSDomain;hu=ho.$UserName;hi=(ht&&hw&&(0===hw.toLowerCase().indexOf(ht.toLowerCase())));
hf=hi?"yes":"no"}gF.indomain=hf;w=b9();hs=cW();if("S-1-5-18"===hs){gF.rights="system";gF.rightsResult=1;hq=gx;return}if(w){try{if(w.isAdmin()){hn.push("KD.isAdmin(): Админ");
if(hi){hj=gx}else{gF.rights="admin";gF.rightsResult=0;hq=gx;return}}else{hk=gx;hn.push("KD.isAdmin(): Юзер")}}catch(hv){aL("KD.isAdmin()",hv,bd,dZ.error)
}}}).then(function(){if(hq||hj||(dO<207)||!w){return ey.resolve()}var hv=".",hw=function(hy,hx){w.testMembership(hy,"S-1-5-32-544",ht,hu,an(hx))};return ey.promisify(function(hy,hx){hw(hv,function(hA,hz){if(!hz){hy(hA);
return}hv="localhost";hw(hv,function(hC,hB){if(!hB){hy(hC);return}if(!ho){hx(hB);return}hv=ho.$CompName;hw(hv,function(hE,hD){if(hD){hx(hD)}else{hy(hA)
}})})})}).then(function(hx){hn.push('KD.testMembership("'+hv+'"): '+(hx?"Админ":"Юзер"));if(hx){if(hi){hj=gx}else{gF.rights="admin";gF.rightsResult=0;hq=gx;
return}}else{hk=gx}}).caught(function(hx){aL('KD.testMembership("'+hv+'")',a1("",hx))})}).then(function(){if(hq){return eh}return ey.when(function(){if(!w){throw a1("no kd",6)
}if(gF.winVer<600){throw a1("XP/2003 not supported",1)}var hy=gk("^S-1-5-32-","i"),hv=gk("^S-1-5-21-\\d{10}-\\d{10}-\\d{10}-","i"),hw=bA(w.getUserGroups());
bu(hw,function(hA){var hB;if(hy(hA)){hB=hA.substr(9,3);if(hB==544){hl=gx;hm=bd;hn.push("Group "+hA+": Админ")}else{if(hB==545||hB==546||hB==547){if(!hl){hm=gx
}hn.push("Group "+hA+": Юзер")}}}else{if(hi&&hv(hA)){hB=hA.substr(42,3);if(hB==500||hB==512||hB==519){hg=gx}else{if(hB==501||hB==513||hB==514){hh=gx}}}}});
var hx=hl||hj,hz=hm||(hk&&!c9());if(!hg&&!hh&&!hx&&!hz){hp="unknown";hr=2;if(hn.length){dZ.error("Ошибка определения прав пользователя. Лог:\r\n"+hn.join("\r\n"))
}}else{if(!hi){hp=hx?(hz?"useradmin":"admin"):(hz?"user":"unknown");hr=hx?(hz?1:0):(hz?1:2)}else{hp={Local:hx?(hz?"useradmin":"admin"):(hz?"user":"unknown"),Domain:hg?"admin":(hh?"user":"unknown")};
hr=hx?(hz?1:0):((hz||hh)?1:2)}}if(hx&&hz){dZ.debug("Лог определения прав пользователя:\r\n"+hn.join("\r\n"))}}).caught(function(hv){if(gF.winVer>=600&&dM){aL("getUserGroups()",hv,bd,dZ.error)
}hp="unknown";hr=2;var hC=hu.toLowerCase(),hw=ht.toLowerCase()+"\\"+hC,hx=bd,hy=bd,hB="Лог определения прав пользователя:\r\n",hA=((hm||hk)&&!c9());return ey.when(function hz(){var hD=["Администраторы","Administrators","Administratoren"],hE=B(ho.$System32,"net.exe"),hF={charset:866};
return ey.each(hD,function(hG){return a7(hE,'localgroup "'+hG+'"',hF).get(function(hI){gM.setTimeout(function(){if(hI.isPending()){try{hI.parent.cancelAll()
}catch(hJ){}hI.reject(a1("timeout",-1))}},10000)}).truth(function hH(hJ){var hI=bd,hK=hJ?hJ.split(dV):[];bu(hK,function(hL){hL=gu(hL||"").toLowerCase();
if(hw===hL||hC===hL){hI=gx;return bd}return eh});return hI}).truth(ey.$break)},bd)}).truth(function(){hn.push("net.exe localgroup admins: Админ");hx=gx;
if(hA){dZ.debug(hB+hn.join("\r\n"))}},function(){hy=gx;throw a1("Not Admin",5)}).caught(function(hD){dZ.debug("net.exe localgroup admins",hD);if(hn.length){dZ.debug(hB+hn.join("\r\n"))
}}).then(function(){if(hj||hk||hx||hy){if(hi){hp={Local:(hj||hx)?(hA?"useradmin":"admin"):"user",Domain:"unknown"}}else{hp=(hj||hx)?(hA?"useradmin":"admin"):"user"
}hr=(hj||hx)?(hA?1:0):1}})}).then(function(){gF.rights=hp;gF.rightsResult=hr})}).caught(function(hv){if(-1!==e0){e0=-2}if(!A.bad&&!A.warn){dZ.error("checkWinInfo завершилась некорректно",hv,eh,"winInfo")
}}).then(function(){gF.winInfoCode=e0;return e0})})}var aj={cache:bE,fso:bY,kd:b9,installer:b3,locator:cd,reg32:cA,shell:c,wmi:cZ,ws:c1};function cR(e0){if(typeof e0=="string"){var w=aj[e0];
return ey.resolve(w&&w())}return ey.map(e0,dq(e0)?function(hf){return ey.when(aj[hf]).caught(function(hg){dZ.error("Ошибка создания "+hf,hg);return eh})
}:function(hf,hg){return ey.resolve(hg).then(aj[hf]).caught(function(hh){dZ.error("Ошибка создания "+hf,hh);return eh})})}function bQ(){var hh=gk("Secondary$","i"),e0=[],w=function(hi){var hk=hi?(hi.Name||hi.caption):eh;
if(!hi||(hk&&hh(hk))){return}var hj={Width:hi.CurrentHorizontalResolution||hi.horisontalResolution||"err",Height:hi.CurrentVerticalResolution||hi.verticalResolution||"err",BitsPerPixel:hi.CurrentBitsPerPixel||hi.bitsPerPixel||"err",RefreshRate:hi.CurrentRefreshRate||hi.refreshRate||"err"};
if("err"!==hj.Width||"err"!==hj.Height||"err"!==hj.BitsPerPixel||"err"!==hj.RefreshRate){e0.push(hj)}};try{var hg=bA(b9().getMonitorsInfo());if(!hg){throw a1("func returns null",1)
}bu(hg,w)}catch(hf){aL("getMonitorsInfo()",hf);e0=[];gS(["SELECT * FROM Win32_Video","Controller"].join(""),w)}return ey.resolve(e0)}function eK(){try{var w=c1();
if(w.$AppActivate("Program Manager")){w.$SendKeys("{F5}")}}catch(e0){}}function j(w,e0){e0=e0||0;return ey.when(cd).then(function(hf){var hg=w;if(e0<2){var hh=B(hf.$System,"mshta.exe");
hg='"'+((1==e0)?hh:hf.$IEPATH86)+'" '+w}fE(dG()?dg:df,eY+"RunOnce\\","KonturDiagnostics",hg,bd)}).caught(function(hf){dZ.debug("Не удалось создать запись автозагрузки Диагностики",hf)
})}function eH(){return ey.when(cd).then(function(w){return fO(B(w.$System32,"shutdown.exe"),{args:"/r /t 0"}).waitExit()}).then(function(e0){var w=e0.exitCode();
if(0!==w){throw a1("Ошибка запуска shutdown.exe, код "+w,w)}}).caught(function(w){aL('run("shutdown.exe", "/r /t 0")',w,bd,dZ.error);if(dr){a0(gQ("SELECT * FROM Win32_OperatingSystem WHERE Primary=true"),function(e0){e0.Win32Shutdown(2)
})}}).caught(function(w){dZ.error("Ошибка завершения работы при помощи wmi",w)})}function aC(){var w=al(["Microsoft","Update","Session"]);w.ClientApplicationID="SKBKontur.Diagnostics";
return w}function O(w){var e0=eh;bu(w,function(hg){var hf=b9().getUpdateInfo(hg);if(hf&&hf.operationType==1){e0=hf.resultCode>=1&&hf.resultCode<=3;return bd
}return eh});return e0}function P(hn){var ho=eh;try{ho=O(hn)}catch(e0){aL("getUpdateInfo("+hn.join(", ")+")",e0);try{if(!dr){throw e0}var hr=aC().CreateUpdateSearcher(),hj=hr.GetTotalHistoryCount(),w=(hj>0)?hr.QueryHistory(0,hj):eh;
if(!w||!w.Count){throw a1("Empty update list",1)}for(var hh=0,hi=w.Count;hh<hi;++hh){var hq=w.Item(hh),hp=hq.Title.toLowerCase();for(var hk=0,hl=hn.length;
hk<hl;++hk){var hm=hn[hk];if(hp.indexOf(hm.toLowerCase())>=0){ho=((hq.ResultCode>=1)&&(hq.ResultCode<=3));break}}if(eh!==ho){break}}}catch(hf){dZ.debug("Ошибка проверки установленного обновления "+hn[0]+" через Windows.Update",hf);
try{if(gT(hn,gx)){ho=gx}}catch(hg){dZ.debug("Ошибка проверки установленного обновления "+hn[0]+" через WMI",hg)}}}return ho}function Q(hg){var hf=(64==gF.arch);
function w(){var hk,hi;switch(gF.winVer){case 500:hk="Windows 2000";hi=["SP5","SP4","SP3"];break;case 501:hk="Windows XP";hi=["SP4","SP3","SP2"];break;
case 502:hk="Windows XP Version 2003";hi=["SP3","SP2","SP1"];break;case 503:hk="Windows Server 2003";hi=["SP3","SP2","SP1"];break;default:return false}function hj(hm,hn){try{var ho=fm(dg,hm,hn,hf);
return ho&&ho.length}catch(hl){return false}}var hh=fc+"Updates\\"+hk+"\\";return a9(hg,function(hl){return a9(hi,function(hn){var hm=hh+hn+"\\"+hl+"\\";
return hj(hm,"InstalledDate")||hj(hm,"Description")})})}function e0(){var hh=fc+"Windows NT\\CurrentVersion\\HotFix\\";return a9(hg,function(hj){try{return !!fk(dg,hh+hj+"\\","Installed",hf)
}catch(hi){return false}})}return w()||e0()}function N(w){w=("string"==typeof(w))?[w]:w;return ey.fork(gF.winVer>=600,G(P,w),G(Q,w))}function c8(e0){var w=fk(dg,fp+e0+"\\","DeleteFlag",bd);
return(1==w)}function cH(hm){var hk=hm?hm.name:eh,ho=hm?hm.startMode:eh,w=bd,hj=bd,e0=bd,hl=eh,hh=bd,hi=!!(hm&&hm.State);if(ho){if(ho.length){ho=ho.substr(0,4).toLowerCase()
}w=(2==ho||"auto"===ho);hj=(3==ho||"manu"===ho);e0=(4==ho||"disa"===ho)}if(hm){var hp=hm.currentState||hm.State;if((-1==hp)||(4294967295==hp)){try{hp=cI().IsServiceRunning(hk)?4:1
}catch(hg){}}if(hp){if(hp.length){hp=hp.substr(0,3).toLowerCase()}if((-1!=hp)&&(4294967295!=hp)){hl=((4==hp)||("run"===hp));if(hl){e0=bd;if(!w&&!hj){hj=gx;
w=bd}}}}}if(hk){try{hh=c8(hk)}catch(hf){}}function hn(hA,hw,hy){var hs,hx;try{hs=hm.ChangeStartMode(hA);if(0!==hs){throw a1("WMI error",hs)}}catch(hz){hz=ep(hz);
try{if(hi){hx=bA(dM.getServicesByName(hk))[0]}else{hx=hm}if(!hx){throw a1("KD not found")}hx.startMode=hw;hs=(hw==hx.startMode)?0:8;if(hs!==0){throw a1("KD",hs)
}}catch(hv){hv=ep(hv);try{if(!hy){throw a1("sheelModeStart no need",0)}var hq=cI();if(!hq.CanStartStopService(hk)){throw a1("Access denied",8)}var hr=hq.IsServiceRunning(hk);
if(hy===1){hs=hq.ServiceStart(hk,gx)}else{hs=hq.ServiceStop(hk,gx)}if(hr&&!hq.IsServiceRunning(hk)){hq.ServiceStart(hk,bd)}else{if(!hr&&hq.IsServiceRunning(hk)){hq.ServiceStop(hk,bd)
}}}catch(ht){ht=ep(ht);try{hv.innerError=hz}catch(hu){}try{ht.innerError=hv}catch(hu){}hs=8;dZ.debug("Не удалось настроить режим "+hA+" запуска службы "+hk,ht)
}}}return hs}return hm?{name:hk,caption:hm.caption,account:hm.startName,pathName:hm.PathName||hm.exePath,running:hl,pid:hl?hm.ProcessId:eh,automatic:w,manual:hj,disabled:e0,forDeletion:hh,setAccount:function(hs,ht){var hq;
try{hq=hm.Change(gA,gA,gA,gA,gA,gA,hs,ht||"")}catch(hx){hx=ep(hx);try{var hw=B(cd().$System32,"sc.exe"),hu='config "'+hk+'" obj= "'+hs+'"'+(ht?' password= "'+ht+'"':"");
hq=+fO(hw,{args:hu,admin:gx,wait:gx});if(hq){throw a1(hw+" "+hu+" - ошибка "+hq,hq)}}catch(hv){hv=ep(hv);try{hv.innerError=hx}catch(hr){}hq=8;dZ.debug("Не удалось поменять аккаунт службы "+hk+" на "+hs,hv)
}}return hq},setAuto:function(){return hn("Automatic",2,1)},setManual:function(){return hn("Manual",3,2)},setDisable:function(){return hn("Disabled",4,0)
},stop:function(){var hs=0;try{if("function"!=typeof(hm.stop)){throw a1("service.stop is not a function",1)}hm.stop()}catch(hr){hr=ep(hr);try{hs=hm.StopService()
}catch(ht){ht=ep(ht);try{var hq=cI();hs=(!hq.IsServiceRunning(hk)||hq.ServiceStop(hk,bd))?0:8}catch(hu){hu=ep(hu);hs=8;try{ht.innerError=hr}catch(hv){}try{hu.innerError=ht
}catch(hv){}dZ.debug("Не удалось остановить службу "+hk,hu)}}}if(!hs){this.running=bd}return hs},start:function(){var hs=0;try{if("function"!=typeof(hm.start)){throw a1("service.start is not a function",1)
}hm.start()}catch(hr){hr=ep(hr);try{hs=hm.StartService()}catch(ht){ht=ep(ht);try{var hq=cI();hs=(hq.IsServiceRunning(hk)||hq.ServiceStart(hk,gx))?0:8}catch(hu){hu=ep(hu);
hs=8;try{ht.innerError=hr}catch(hv){}try{hu.innerError=ht}catch(hv){}dZ.debug("Не удалось запустить службу "+hk,hu)}}}if(!hs){this.running=gx}return hs
}}:eh}function cG(hl,hh,hg){hl=hl||"";var hf=hl&&hl.length,hm;try{if(!cZ()){throw a1("wmi is null",1)}var hj="SELECT * FROM Win32_Service";if(!hg&&hf){hj+=" WHERE Name "+(hh?"LIKE":"=")+" '"+hl+"'"
}hm=gR(hj,eh,!hg);if(!hm){throw a1('WMI("'+hl+'") is null',1)}else{if(hh&&hg&&hf){var hk=gk("^"+hl.replace("%",".*")+"$","i");hm=bk(hm,function(ho){return ho?hk(ho.name||""):bd
})}}}catch(hn){if(hf&&hh){hl=hl.replace("%",".*")}var hi="getKonturDiag";if(!dM){dM=b9()}try{if(hg){hi="getServicesByCaption";hm=bA(dM.getServicesByCaption(hf?("^"+hl+"$"):""))
}else{hi="getServicesByName";hm=bA(dM.getServicesByName(hf?("^"+hl+"$"):""));hm=hm[0]}}catch(w){hm=eh;aL(hi+"("+(hl||"null")+")",w)}}if(hm){return hg?d6(hm,cH):cH(hm)
}try{fm(dg,fp+hl,"ImagePath",bd)}catch(e0){if(dx(e0)){return eh}else{throw a1("Ошибка при проверке пути к службе: "+hl,e0.number)}}dZ.debug("Путь в реестре к службе "+hl+" найден. Но WMI и KD не смогли найти службу");
throw a1("Ошибка KD при поиске службы "+hl,2)}function b(hf,e0,w){return ey.when(cG,hf,e0,w)}function bo(hf){hf=hf||{};var e0=hf.hwids,hh=hf.services,hg={found:bd,devices:{}};
function w(hj){var hi=fp+hj+"\\Enum";return ey.each(256,function(hl,hk){return ey.when(function(){return fm(dg,hi,String(hk),bd)}).then(function(hm){hm=hm.toUpperCase();
hg.devices[hm]=hj;hg.found=gx;if(e0){bu(e0,function(hn,ho){if(gk(ho,"i")(hm)){hg[hn]=hm;return bd}return eh})}}).caught(ey.$break())}).then(hg)}return ey.fork(e0,function(){if(ai.kdBuild<214){throw a1("KD < 2.14")
}return dM.sysDeviceEnumHwid()}).truth(function(hj){var hi=hj.split(new RegExp("\\|","g"));bu(e0,function(hk,hm){var hl=gk(hm,"i");if(hl(hj)){hg.found=gx;
hg[hk]=gx;bu(hi,function(hn){if(hl(hn)){hn=hn.toUpperCase();hg.devices[hn]=gx;hg[hk]=hn;return bd}return eh})}})}).caught(eh).then(dq(hh)&&hh.length&&hh||[]).each(function(hi){return w(hi)
}).anyway(hg)}function cq(hi,hf,e0){if(!hi){return eh}var hg=(e0?hi.ExecutablePath:hi.executablePath),hh=eh,w=function(){try{var hj=(e0?hi.ProcessId:hi.PID);
if(hj||(0===hj)){hh=hj}}catch(hk){}return hh};return{wmi:e0,pid:w(),getPID:w,path:hg||hf||"",cmdLine:(e0?hi.CommandLine:hi.commandLine)||"",name:hi.Name||(hg?hg.substr(hg.lastIndexOf("\\")+1):(hf||"")),env:e0?eh:hi.environment,startTime:(e0||!hi.startTime)?eh:new Date(hi.startTime*1000).getTime(),kill:function(hj){if(e0){hi.Terminate(hj||0)
}else{hi.kill(hj||0,gx)}}}}function cp(e0,w){return ey.when(function(){var hj=!!e0,hm=[],hl="getProcesses",hk=bd,hf=function(ho){if(ho){if(ho.executablePath){hm.push(cq(ho,eh,hk))
}else{if(w&&(ho.pid>0)&&(ho.pid<65536)){hm.push(cq(ho,w,hk))}}}};try{if(e0){hl="getProcessByPID";hf(b9().getProcessByPID(e0))}else{hl="getProcessesByName";
var hi=bA(b9().getProcessesByName(w||".*"));if(hi&&hi.length){bu(hi,hf)}}}catch(hg){hk=gx;try{aL(hl+"("+(e0||"null")+", "+(w||"null")+")",hg);if(!cZ()){throw new Error()
}hm=[];var hn="SELECT * FROM Win32_Process";if(e0){hn+=" WHERE ProcessId = "+e0}gS(hn,hf,hj)}catch(hh){hh=ep(hh);if(cZ()){dZ.debug("Ошибка обращения к процессу "+(e0||w)+" через WMI",hh)
}throw hh}}return hm.length?(hj?hm[0]:hm):eh})}function gh(hg,hh){hh=hh||{};var hj=hh.restart,e0=hh.manual,w=hh.account,hi=hh.password||"",hf="Не удалось запустить/изменить службу "+hg,hk="Служба "+hg;
dZ.info("Поиск службы "+hg+"...");return ey.when(cG,hg).lie(function(){dZ.info(hk+" не найдена.");return bd},function(hl){return ey.fork("wuauserv"===hg,function(){return fG(dg,eY+"WindowsUpdate\\Auto Update\\","AUOptions",2,64==gF.arch)
}).caught().fork(hj&&hl.running,function(){dZ.info(hk+" останавливается...");var hm=hl.stop();if(0!==hm){throw a1("StopService "+hg,hm)}return ey.wait(function(){return ey.when(cG,hg).lie(bd,function(hn){hl=hn;
return !hn.running})},"srvStopTimeout",60000,1000).then(function(){if(hl.running){throw a1(hk+" все еще работает",1056)}dZ.info(hk+" остановлена.")})}).then(function(){if(e0&&!hl.manual&&!hl.automatic){var ho=hl.setManual();
if(0!==ho){throw a1("setManual "+hg,ho)}}else{if(!hl.automatic){var hn=hl.setAuto();if(0!==hn){throw a1("setAuto "+hg,hn)}}}if(w){var hm=hl.setAccount(w,hi);
if(0!==hm){throw a1("setAccount "+hg+" to "+w,hm)}}if(hl.running){dZ.info(hk+" уже работает.")}else{dZ.info(hk+" запускается...");var hp=hl.start();if(0!==hp){throw a1("StartService "+hg,hp)
}dZ.info(hk+" запущена.")}return gx})}).caught(function(hl){dZ.debug(hf,hl);dZ.info("Альтернативный режим запуска службы...");var hm=[];if(e0){hm.push("manual")
}if(hj){hm.push("restart")}if(w){hm.push("account="+w.replace("\\","/"));if(hi&&hi.length){hm.push("password="+hi)}}var hn=hm.length?(' "'+hm.join(";;;")+'"'):"";
return fQ('StartService "'+hg+'"'+hn,gx).tap(function(ho){if(!ho||ho.code){dZ.info("Не удалось запустить службу "+hg)}})}).caught(function(hl){dZ.debug(hf,hl);
dZ.info(hf);return bd})}function ak(hm){hm=hm||{};var hq=hm.name,hf=hm.binpath,hh=hm.depend,hi=hm.description,hj=hm.displayName,hk=hm.errorControl,hl=hm.group,hr=hm.obj,ho=hm.requiredPrivileges,ht=hm.serviceSidType,hu=hm.type,hp=hm.serviceDll,hs=hm.serviceProcedure,w=hm.account,hn=hm.password||"";
return ey.fork(dJ()||c9(),ey.thrown(a1("User or UAC",5)),function(){function hv(hz,hA,hB,hy){if(hy||(hA&&hA.length)){hB+=" "+hz+'= "'+((hA||0===hA)?hA:"")+'"'
}return hB}var hw=hv("binPath",hf,"");hw=hv("displayName",hj,hw);hw=hv("depend",(eh===hh)?"/":hh,hw,gx);hw=hv("group",hl,hw);hw=hv("obj",hr,hw);hw=hv("type",hu,hw);
return ey.when(cG,hq).truth("config","create","create").then(function(hz){function hy(hA,hB){return ey.when(cd).then(function(hC){return fO(B(hC.$SysNative,"sc.exe"),{args:hA+' "'+hq+'"'+hB,admin:gx,wait:gx}).waitExit().then(function(hE){var hD=hE.exitCode();
if(("create"===hA)&&(1073==hD)){return hy("config",hB)}return hD})})}return hy(hz,hw)}).then(function hx(hy){var hE=(0===hy||2==hy),hB=fp+hq+"\\",hA=hB+"Parameters\\",hz=(64==gF.arch),hD={kernel:1,filesys:2,own:16,share:32},hC=hu&&hD[hu];
return ey.fork(!hE,function(){dZ.error("Ошибка создания службы: "+hq+", код: "+hy+(hw?(", аргументы: "+hw):""))},function(){return ey.fork(hh&&hh.length,function(){return f(dg,hB,"DependOnService",hh.split(new RegExp(",","g")),bd)
},function(){return e3(dg,hB,"DependOnService").caught()}).fork(ho&&ho.length,function(){return f(dg,hB,"RequiredPrivileges",ho.split(new RegExp(",","g")),bd)
}).then(function(){if(hi){fI(dg,hB,"Description",hi,bd)}if(hj){fI(dg,hB,"DisplayName",hj,bd)}if(hk||(0===hk)){fG(dg,hB,"ErrorControl",hk,bd)}if(hl){fI(dg,hB,"Group",hl,bd)
}if(hf){fE(dg,hB,"ImagePath",hf,bd)}if(hr){fI(dg,hB,"ObjectName",hr,bd)}if(ht||(0===ht)){fG(dg,hB,"ServiceSidType",ht,bd)}fG(dg,hB,"Start",2,bd);if(hC){fG(dg,hB,"Type",hC,bd)
}}).fork(gF.winVer>=600,function(){fE(dg,hA,"ServiceDll",hp);fG(dg,hA,"ServiceDllUnloadOnStop",1);fI(dg,hA,"ServiceMain",hs);var hI=eZ+"SvcHost\\",hG=(gF.winVer<700)?"LocalService":"LocalServiceAndNoImpersonation",hH;
try{hH=fj(dg,hI,hG,hz)}catch(hF){dZ.error("Ошибка чтения параметра "+hG,hF);hH=[]}return ey.fork(hH&&hH.length,function(){var hO=bd;if((1==hH.length)&&(gF.winVer>=1010)&&("SCardSvr"===hH[0])){try{var hN=fj(dg,hI,"LocalServiceNetworkRestricted",hz),hK=af(hN,"TimeBrokerSvc");
hH=(hK?[]:["TimeBroker"]).concat(["SSDPSRV","upnphost","SCardSvr","QWAVE","fdrespub","wcncsvc","SensrSvc","BthHFSrv"]);hO=gx}catch(hJ){dZ.error("Ошибка чтения параметра LocalServiceNetworkRestricted",hJ)
}}if(!hO){var hP=bd;for(var hL=0,hM=hH.length;hL<hM;++hL){if(hq==hH[hL]){hP=gx;break}}if(!hP){hH.push(hq);hO=gx}}if(hO){return f(dg,hI,hG,hH,hz)}return eh
})})}).fork(hz,function(){return e3(dg,hB,"WOW64",bd).caught()}).fork(hE&&!ef(),function(){return gh(hq,{restart:gx,account:w,password:hn})},hE)})}).caught(function e0(hy){var hw=[];
function hx(hB,hD,hC){if(hD){hw.push(hB+"="+(hC?String(hD).replace(new RegExp("\\\\","g"),"/"):hD))}}function hv(){hw=[];hx("binpath",hf,gx);hx("depend",(eh===hh)?"/":hh);
hx("description",hi,gx);hx("displayname",hj,gx);hx("errorcontrol",hk);hx("group",hl);hx("obj",hr,gx);hx("requiredprivileges",ho);hx("servicedll",hp,gx);
hx("servicemain",hs);hx("servicesidtype",ht);hx("type",hu);if(w){hx("account",w,gx);if(hn&&hn.length){hx("password",hn)}}return hw.length?(' "'+hw.join(";;;")+'"'):""
}var hz=hv(),hA=ef()?"CreateService":"CreateAndStartService";dZ.debug("Альтернативное создание службы "+hq,ep(hy));return fQ(hA+' "'+hq+'"'+hz)}).tap(function hg(hv){dZ.info(hv?("Служба "+hq+" установлена"):("Не удалось установить службу "+hq))
})}function cI(){if(dI(f7)){try{f7=al(["Shell","Application"])}catch(w){f7=eh}}return f7}function c(){return ey.resolve(g).lie(function(){return ai.createNPAXObject(["Shell","Application"],gx).tap(function(w){g=w
})})}function c1(){if(dI(g5)){try{var hg=al(["WScript","Shell"]),hf={AppActivate:1,CreateShortcut:1,Environment:1,Exec:1,ExpandEnvironmentStrings:1,Popup:4,RegDelete:1,RegRead:1,RegWrite:3,Run:3,SendKeys:1,SpecialFolders:1};
g5={};for(var e0 in hf){g5["$"+e0]=g1(hg,e0,hf[e0])}g5.$GetCurrentDir=new Function("o",["return function() { return o.Cur","rentDirectory; }"].join(""))(hg);
g5.$SetCurrentDir=new Function("o",["return function(dir) { o.Cur","rentDirectory = dir; }"].join(""))(hg);gF.wsDirectory=hg.CurrentDirectory}catch(w){g5=eh
}}return g5}function b3(){return ey.resolve(d).lie(function(){return ai.createNPAXObject(["WindowsInstaller","Installer"],gx).caught(eh).tap(function(w){dm=w
})})}function cA(hg){if(hg||dI(eL)){var hl="StdRegProv",w=function(ho){try{ho.CheckAccess(df,"Software")}catch(hn){ho.CheckAccess(dg,"Software")}};try{var hm=al(["WbemScripting","SWbemLocator"]),hk=hm.ConnectServer("","root\\default","","","MS_0419");
hk.Security_.ImpersonationLevel=3;eL=hk.Get(hl);w(eL)}catch(hf){var e0=["default",hl].join(":"),hi="//./root/"+e0,hj="\\\\.\\root\\"+e0,hh=[d9+gU+hi,d9+gU+hj,d9+gU+"!"+hi,d9+gU+"!"+hj,d9+hi,d9+hj,d9+"!"+hi,d9+"!"+hj];
bu(hh,function(ho){try{eL=GetObject(ho);w(eL);return bd}catch(hn){eL=eh;return eh}})}}return eL}function cB(e0){if(e0||dI(eS)){try{ei=al(["WbemScripting","SWbemNamedValueSet"]);
ei.Add("__ProviderArchitecture",64);var hg=al(["WbemScripting","SWbemLocator"]),hf=hg.ConnectServer("","root\\default","","","MS_0419",eh,eh,ei);hf.Security_.ImpersonationLevel=3;
eS=hf.Get("StdRegProv")}catch(w){eS=eh;ei=eh}}return eS}function ba(e0){try{return b9().environmentWorker.expandVariable(e0)}catch(w){aL("expandVariable("+e0+")",w);
return dr?c1().$ExpandEnvironmentStrings(e0):e0}}function ab(w,e0){if(w===e0){return gx}if(!w||!e0){return bd}return ba(w).toLowerCase()==ba(e0).toLowerCase()
}function f6(hj,hm,hg){hg=hg||{admin:gx};var e0="Environment\\",hi=eW+"Session Manager\\"+e0,hk={admin:bd,user:bd,process:bd};try{if(!hg.admin||dJ()||c9()){throw a1("User or UAC",5)
}fE(dg,hi,hj,hm,bd);var w=fm(dg,hi,hj,bd);if(!ab(hm,w)){throw a1("EnvVars diff",1)}hk.admin=gx}catch(hf){}try{fE(df,e0,hj,hm,bd);hk.user=gx}catch(hl){dZ.error("Не удалось исправить переменную "+hj+' на "'+hm+'" в реестре',hl)
}try{hm=ba(hm);c1().$Environment("PROCESS").Item(hj)=hm;hk.process=gx}catch(hn){hn=ep(hn);try{b9().environmentWorker.setVariable(hj,hm);hk.process=gx}catch(hh){aL("setVariable("+hj+","+hm+")",hh);
if(dr){dZ.error("Не удалось исправить переменную "+hj+' на "'+hm+'" в IE',hn)}}}return hk}function aW(w){return w.replace(new RegExp("\\\\","g"),"\\\\")
}var dY;function cd(hg){if((hg||dI(dY))&&(b9()||c1())){var hn={"$AllUsers":["%ALLUSE","RSPROFILE%"],"$AppData":["%APP","DATA%"],"$Arch":["%PROCESSOR_","ARCHITECTURE%"],"$Cmd":["%Com","Spec%"],"$ComPFiles":["%Common","Program","Files%"],"$ComPFiles86":["%Common","Program","Files(x86)%"],"$CompName":["%Computer","Name%"],"$PFiles":["%Program","Files%"],"$PFiles86":["%Program","Files(x86)%"],"$PFiles64":["%Program","W6432%"],"$SystemDrive":["%System","Drive%"],"$Temp":["%TE","MP%"],"$UserDNSDomain":["%USERDNS","DOMAIN%"],"$UserDomain":["%USER","DOMAIN%"],"$UserName":["%USER","NAME%"],"$UserProfile":["%USER","PROFILE%"],"$Windows":["%System","Root%"]};
dY={};for(var hl in hn){dY[hl]=ba(hn[hl].join(""))}var hs=dY.$Windows,hh=["Internet ","Explorer"].join(""),hi="iexplore.exe",hk=gF.arch?gF.arch===64:~dY.$Arch.indexOf("64");
if(hk){dY.$PFiles64=dY.$PFiles64||dY.$PFiles;dY.$ComPFiles64=dY.$ComPFiles64||dY.$ComPFiles}else{dY.$PFiles86=dY.$PFiles64=dY.$PFiles;dY.$ComPFiles86=dY.$ComPFiles64=dY.$ComPFiles
}dY["$IE"]=B(dY.$PFiles,hh);dY["$IE86"]=B(dY.$PFiles86,hh);dY["$IEPATH"]=B(dY.$IE,hi);dY["$IEPATH86"]=hk?B(dY.$IE86,hi):dY.$IEPATH;var w="Application Data",hp=eY+"Explorer\\",hq=hp+"Shell Folders\\",hr=hp+"User Shell Folders\\",e0,hm,hj;
if(gF.winVer){hj=(gF.winVer>=600)}else{try{hj=(fn()>=6)}catch(hf){hj=(A.winNTVer>=6)}}if(hj){e0=dY.$AllUsers;hm=ba("%LOCALAPPDATA%")}else{e0=B(dY.$AllUsers,w);
hm=B(dY.$UserProfile,"Local Settings\\"+w)}var ho=function(hx,hw){try{return fm(hx,hr,hw,bd)}catch(ht){ht=ep(ht);try{return fm(hx,hq,hw,bd)}catch(hu){hu=ep(hu);
if(dg==hx){try{hu.innerError=ht}catch(hv){}throw hu}return ho(dg,hw)}}};dY["$Cache"]=(function(){try{return ba(ho(dG()?dg:df,"Cache"))}catch(ht){return""
}})();dY["$ComAppData"]=e0;dY["$LocalAppData"]=hm;dY["$System32"]=B(hs,["Sys","tem32"].join(""));dY["$SysWOW64"]=B(hs,["Sys","WOW64"].join(""));dY["$System"]=hk?dY.$SysWOW64:dY.$System32;
dY["$SysNative"]=hk&&hj?B(hs,["Sys","Native"].join("")):dY.$System32;dY["$SysTemp"]=B(hs,["Te","mp"].join(""))}return dY}function cg(){return B(cd().$System32,"msiexec.exe")
}function bI(hn,e0){var hi;try{if(e0||dI(hn.parse)){hi={};var hk=hn.split(new RegExp(",\\s*","g"));for(var hg=0,hm=hk.length;hg<hm;++hg){var hj=hk[hg],hh=hj.indexOf("=");
if(hh>=0){var hl=hj.substr(0,hh),ho=hj.substr(hh+1);if((hg<hm-1)&&('"'==ho.charAt(0))&&('"'!=ho.charAt(ho.length-1))){ho+=", "+hk[hg+1];hk[hg+1]=""}if(!hi[hl]){if(('"'==ho.charAt(0))&&('"'==ho.charAt(ho.length-1))){ho=ho.replace(new RegExp('^\\"|\\"$',"g"),"")
}hi[hl]=ho.replace(new RegExp('\\"\\"',"g"),'"')}}}}else{hi=hn.parse();for(var w in hi){if(hi[w] instanceof Array){hi[w]=hi[w][0]}}}}catch(hf){hi={}}return hi
}function bG(e0){if(!e0){return""}var w=gu([e0.SN||e0.Surname||"",e0.G||e0.GivenName||""].join(" "));return(w||"").replace(new RegExp("_","g")," ")}function bJ(e0){if(!e0){return eh
}var w=bG(e0);return(w&&w.length)?w:(e0.CN||e0.OU||eh)}function bK(hf){if(!hf){return""}var hh=hf.O;if(hh&&hh.length){return hh.replace(new RegExp('""',"g"),'"')
}var e0=bG(hf),hg=hf["ОГРНИП"]||hf.OGRNIP,w=hf.CN;if(w&&w.length){return((hg&&hg.length)?"ИП ":"")+w}if(e0&&e0.length){return((hg&&hg.length)?"ИП ":"")+e0
}return""}function bH(hq,hI){switch(hI){case ai.certViewPrivate:case ai.certViewDisallowed:var hf=hq[ai.certOID],hB=ai.newCertOID,hr="INN",hz="KPP",hu="ИНН",hA="КПП";
if(eh===hB){try{var hC="HKLM\\SOFTWARE\\"+ai.regOidPath+ai.regCertOID+"\\Name";hB=c1().$RegRead(hC)}catch(ho){hB=""}ai.newCertOID=hB}if(!hf){if(hB){hf=hq[hB]
}if(!hf){hf=hq[hu]||hq[hr];if(hf&&(hf.indexOf(hr)<0)){hf=hr+"="+hf}if(!hf){return eh}}}var hF=ai.vars.regex||(ai.vars.regex={}),hE=[hu,hr,hA,hz],hg=hF.certInfoRegex||(hF.certInfoRegex=new RegExp("\\s*[\\,\\/\\\\]\\s*","g")),w=hF.certEqRegex||(hF.certEqRegex=new RegExp("[=:\\s]+","g")),hl=hF.certTrailMinus||(hF.certTrailMinus=new RegExp("\\-$")),e0=hF.certHasInnKppRegex||(hF.certHasInnKppRegex=new RegExp("("+hE.join("|")+")[=:\\s]")),hi=hF.certInnKppInnfl||(hF.certInnKppInnfl=new RegExp("^\\d+(\\-\\d{9}(\\-\\d{12})?)?$")),hj=hF.certInnKppOgrn||(hF.certInnKppOgrn=new RegExp("^\\d+(\\-\\d{9}(\\-\\d{10,13})?)?$")),hn="[\\s\\,\\/\\\\]",hh=hF.certInnKppDelim||(hF.certInnKppDelim=new RegExp(hn,"g")),hk=hF.certInnKppTogether||(hF.certInnKppTogether=new RegExp("^\\s*(INN|ИНН)"+hn+"(KPP|КПП)"+hn+"(\\d+"+hn+"\\d{9})\\s*$","g")),hm={},hs=hk.exec(hf);
if(hs&&(hs.length>3)){hf=hs[3].replace(hh,"-")}var hG=hf.split(hg);for(var hw=0,hx=hE.length;hw<hx;++hw){var hD=hE[hw];if(hq[hD]){hm[hD]=hq[hD]}}function ht(){var hJ=hm[hr]||hm[hu];
if(hJ){var hK=hm[hz]||hm[hA];return hK?(hJ+"-"+hK):hJ}return eh}if(e0.test(hf)){for(var hv=0,hy=hG.length;hv<hy;++hv){var hH=hG[hv].split(w);if(2==hH.length){hm[hH[0]]=hH[1]
}}return ht()}hf=hf.replace(hh,"-").replace(hl,"");if(hi.test(hf)){return hf}if(hj.test(hf)){return hf.substr(0,hf.lastIndexOf("-"))}return ht();case ai.certViewRoot:case ai.certViewCA:return hq.CN||hq.OU;
case ai.certViewOther:var hp="Федеральная служба по регулированию алкогольного рынка";if(("Росалкогольрегулирование"==hq.CN)&&(hp==hq.O)){return hq.O}return bJ(hq);
default:ai.log.error("Ошибка вызова функции getIdentityFromCertInfo - неверный аргумент viewType: "+hI);throw a1("getIdentityFromCertInfo, viewType",1)
}}function bF(w){return Date.parse(w)}function cn(e0,hn,w){var hj=("string"==typeof(hn)),hp={};if(w){try{var hg=e0.call("Extensions");for(var hk=1,hl=hg.get("Count");
hk<=hl;++hk){var hh=hg.get("Item",[hk]),hm=hh&&hh.get("OID"),ho=hm&&hm.get("Value");if(hj){if(hn==ho){return hh}}else{if(da.contains(hn,ho)){hp[ho]=hh}}}}catch(hf){}}else{try{var hi=e0.getExtensions();
if(hj){return hi[hn]}bu(hn,function(hq){hp[hq]=hi[hq]})}catch(hf){}}return hj?eh:hp}function c6(e0,w){return !!cn(e0,"1.2.643.2.2.49.2",w)}function dt(hf,e0,hA){var hp,hq=bd,hs,hv="1.2.643.100.112",hi="2.5.29.32",hj={"1.2.643.100.113.1":gx,"1.2.643.100.113.2":gx,"1.2.643.100.113.3":gx,"1.2.643.100.113.4":gx,"1.2.643.100.113.5":gx,"1.2.643.100.113.6":gx},hz=[["CN","CommonName","2.5.4.3"],["INN","ИНН","1.2.643.3.131.1.1"],["SNILS","СНИЛС","1.2.643.100.3"],["SN","Surname","2.5.4.4"],["G","GivenName","2.5.4.42"],["S","State","2.5.4.8"],["C","Country","2.5.4.6"]],w={"MF4wXAYMKoUDA4EDh2wAAwMBMEwwSgYIKwYBBQUHAgEWPmgAdAB0AHAAOgAvAC8A\r\nZABwAC4AawBlAHkAZABpAHMAawAuAHIAdQAvAHAAbwBsAGkAYwB5AC4AZABvAGMA\r\n":gx};
try{for(var ht=0,hu=hz.length;ht<hu;++ht){var hy=hz[ht],hr=!hA||hA[hy[0]]||hA[hy[1]]||hA[hy[2]];if(!hr){return bd}}if(e0){var hg=cn(hf,[hi,hv],e0),hh=hg[hi];
hs=!!hg[hv];if(hh){var hk=hh.get("EncodedData"),hl=hk&&hk.get("Value");if(hl&&!w[hl]){var hn=hh.get("EncodedData").call("Decoder");for(var hw=1,hx=hn.get("Count");
hw<=hx;++hw){var hm=hn.get("Item",[hw]);if(hj[hm.get("OID").get("Value")]){hq=gx;break}}}}}else{hp=hf.getExtensions();hs=!!hp[hv];if(hs&&hp.policies){for(var hB in hp.policies){if(hj[hB]){hq=gx;
break}}}}return hq&&hs}catch(ho){return eh}}function bL(){var e0={};try{bu(document.cookie.split(new RegExp(";","g")),function(hh){var hg=hh.indexOf("=");
if(hg>0){var hf=gu(hh.substr(0,hg)),hi=gu(hh.substr(hg+1));if(hf&&hi){e0[hf]=unescape(hi)}}})}catch(w){dZ.error("Ошибка разбора кук",w)}return e0}function L(e0,w){var hf=B(e0,"KonturDiagnosticTempDir"+(cN()%10000));
if(w){bW(hf).create()}else{bW(hf).create().remove()}}function X(w){var e0=B(w,"KonturDiagnosticTempFile"+(cN()%10000)+".tmp");return ey.serial(function(){return g2(e0,"test",1251)
},function(){return be(e0).remove()},function(){return L(w)}).then(gx,bd)}function bb(w){bi(w).lie(function(){return bt(w)}).truth(function(){return ai.$getLocator().then(function(e0){return bi(B(e0.$Windows,"explorer.exe"))
}).truth(function(e0,hf){return fO(hf.path,{args:'/select,"'+w+'"',show:gx,wsWait:bd}).waitRun()},function(){gM.alert("Ошибка открытия файла - Проводник недоступен.")
})},function(){gM.alert("Файл не найден. Возможно, он был перемещен или удален.")});return bd}function ax(){return al(["Kontur_Toolbox","GuiService"])}var gO="Веб-страницы",bj={".dbf":"Файлы баз данных",".htm":gO,".html":gO,".txt":"Текстовые файлы",".xml":"XML документы"};
function gd(w,hf,hi,hg){var hh="",e0=1;if(w&&bj[w]){hh+=bj[w]+" (*"+w+")|*"+w+"|"}hh+="Все файлы (*.*)|*.*|";hf=hf||"";return ey.fork(hg,function(){if(dO>212){return ey.promisify(function(hk,hj){return b9().dialogs.showMultipleOpenDialogAsync(hi,hh,e0,hf,an(function(hm){try{hk(bA(hm))
}catch(hl){hj(hl)}}))})}return bA(b9().dialogs.showMultipleOpenDialog(hi,hh,e0,hf))},function(){if(dO>212){return ey.promisify(function(hk,hj){return b9().dialogs.showOpenDialogAsync(hi,hh,e0,hf,an(function(hm){try{hk(hm)
}catch(hl){hj(hl)}}))})}return b9().dialogs.showOpenDialog(hi,hh,e0,hf)}).caught(function(){var hk={title:hi,filter:hh,filterIndex:e0};if(hf){hk.initialDir=hf
}var hj=cb("Gui");if(hg){return hj.showMultipleOpenDialog(hk)}return hj.showOpenDialog(hk)}).caught(function(){var hl=ax();if(!hg){return hl.showOpenDialog()
}var hn=hl.showMultipleOpenDialog(),hm=hn?(new Function("return ("+hn+");")()):eh,ho=new RegExp("/","g"),hk=hm?(hm.folder||"").replace(ho,"\\"):eh,hj=[];
bu(hm&&hm.files,function(hp){if(hp){if(hp.indexOf("/")>=0){hp=hp.replace(ho,"\\")}if(!bS(hp).exist){hp=B(hk,hp);if(!bS(hp).exist){return}}hj.push(hp)}});
return hj}).caught(function(hj){throw a1("Ошибка открытия диалога выбора файлов",31337,hj)})}function gc(w,e0){return gd(w,e0,"Выберите файл",bd)}function gb(w,e0){return gd(w,e0,"Выберите файлы",gx)
}function ge(w,hh){var hj="Сохранить файл как",hi="",hg=1,hf=eh;if(w&&w.length){var e0=w.lastIndexOf(".");if(e0>0){hf=w.substr(e0).toLowerCase();if(bj[hf]){hi+=bj[hf]+"|*"+hf+"|"
}}}hi+="Все файлы|*.*|";return ey.when(function(){if(dO>212){return ey.promisify(function(hl,hk){return b9().dialogs.showSaveDialogAsync(w,hj,hi,hg,hh,an(function(hn){try{hl(hn)
}catch(hm){hk(hm)}}))})}return b9().dialogs.showSaveDialog(w,hj,hi,hg,hh)}).caught(function(){var hk={title:hj,filter:hi,filterIndex:hg};if(hh){hk.initialDir=hh
}return cb("Gui").showSaveDialog(w,hk)}).caught(function(){return ax().ShowSaveDialog(w)}).caught(function(){return al(["Kontur","ComDlgs"]).ShowSaveDialog(w)
}).caught(function(){var hk=gM.prompt("Введите имя файла:",w);if(hk&&hk.length){if(hf&&!(gk("\\"+hf+"$","i")(hk))){hk+=hf}return hk}return""}).caught("")
}function fU(){var w="Выбор папки с дистрибутивами";return ey.when(function(){if(dO>212){return ey.promisify(function(hf,e0){return b9().dialogs.selectFolderDialogAsync(w,"",an(function(hh){try{hf(hh)
}catch(hg){e0(hg)}}))})}return b9().dialogs.selectFolderDialog(w,"")}).caught(function(){return cb("Gui").selectFolderDialog({title:w})}).caught(function(e0){aL("selectFolderDialog("+w+', "")',e0);
var hf=1+4+512,hg=cI().BrowseForFolder(0,w,hf);return(hg&&hg.Self)?hg.Self.Path:""}).caught(function(){return ax().SelectFolderDialog()}).caught(function(){return al(["Kontur","ComDlgs"]).SelectFolderDialog()
}).caught("")}var D;function bE(){if(D){return D}var hk=B(dX(),"HelpKontur");try{var hj=bW(hk),hg={count:0},hh={count:0};function hf(){return(cN()+Math.floor(Math.random()*999)).toString(36)
}function hl(ho){var hn=bS(ho);return hn&&hn.exist?hn:eh}D={add:function(ho,hn){var hp=ho.name.toLowerCase(),hq=hn?hg:hh;if(!hq[hp]){hq[hp]=ho.path;++hq.count;
return gx}return bd},getCount:function(hn){return(hn?hg:hh).count},offer:function(hr,hn){try{var hq=bS(hr),hs=hq.name.toLowerCase(),hp=gF.productSizes&&gF.productSizes[hs];
if(hp&&(hq.size==hp)){return D.add(hq,hn)}}catch(ho){}return bd},$offer:function(ho,hn){return be(ho).get("sf").then(function(hs,hq){var hr=hq.name.toLowerCase(),hp=gF.productSizes&&gF.productSizes[hr];
if(hp&&(hs==hp)){return D.add(hq,hn)}return bd}).caught(bd)},get:function(ho){if(!ho){return eh}ho=ho.toLowerCase();var hp=hg[ho],hn;if(hp){hn=hl(hp);if(hn){hn.place=1;
return hn}else{delete hg[ho];--hg.count}}hp=hh[ho];if(hp){hn=hl(hp);if(hn){hn.place=2;return hn}}return eh},clear:function(){try{hj.remove();hg={count:0}
}catch(hn){dZ.error("Ошибка очистки кэша",hn)}},getFreePath:function(ho,hn,hq){var hp=B(hk,ho||hf());bW(hp).create();return(hn||hq)?B(hp,(hn||hf())+(hq||"")):hp
},$getFreePath:function(ho,hn,hq){var hp=B(hk,ho||hf());return bs(hp).create().then(function(){return(hn||hq)?B(hp,(hn||hf())+(hq||"")):hp})},moveToCache:function(ho){var hn=D.get(ho);
if(hn){var hq=D.getFreePath(eh,ho);hn.copy(hq);var hp=bS(hq);if(hp.exist){D.add(hp,gx);return hp}}return eh}};if(hj.exist){try{bu(hj.folders(),function(ho){var hp=gx,hn=bW(ho);
bu(hn.files(),function(hr){if(D.offer(hr,gx)){hp=bd}else{try{bS(hr).remove()}catch(hq){}}});if(hp){hn.remove()}});if(hg.count){var hi=[];for(var hm in hg){if(hm!=="count"){hi.push(hm)
}}dZ.debug("В кэше найдена часть дистрибутивов("+hg.count+"): "+hi.join(", "))}}catch(e0){dZ.error("Ошибка обработки кэш папки: "+hk,e0)}}else{hj.create()
}}catch(w){dZ.error("Не удалось создать объект Cache с указанием на папку: "+hk,w,eh,"cache");D=eh}return D}function cL(e0){var w=e0.allUsers,hf=function(hg){return bt(hg).truth(hg,ey.thrown())
};return ey.when(function(){var hg=w?e0.wsAll:e0.wsUser;if(!hg){throw new Error()}return c1().$SpecialFolders(hg)}).then(hf).caught(function(){var hg=w?e0.kdAll:e0.kdUser;
if(!hg&&(0!==hg)){throw new Error()}return ey.when(function(){return b9().getShellFolder(hg)}).then(hf)}).caught(function(){var hh=w?e0.regAll:e0.regUser;
if(!hh){throw new Error()}var hg=eY+"Explorer\\Shell Folders\\";return ey.when(function(){return fm(w?dg:df,hg,hh,bd)}).then(hf)}).caught(function(){return ey.when(cd).then(function(hk){var hi=gF.winVer>=600,hg=function(hm,hn){return e0[hm+hn]||(hi&&e0[hm+hn+"7"]||e0[hm+hn+"XP"])
},hh=function(hm){return hg(hm,w?"All":"User")||hg(hm,"")},hj=hh("loc");if(!hj){return eh}var hl=hk[hj]+(hh("append")||"");return hf(B(hl,e0.english)).caught(function(){return hf(B(hl,e0.russian)).caught(eh)
})})})}function ch(w){return cL({allUsers:w,wsUser:"MyDocuments",kdAdmin:46,kdUser:5,regAll:"Common Documents",regUser:"Personal",locAll:"$AllUsers",locUser:"$UserProfile",english:"Documents",russian:["Мои","документы"].join(" ")})
}function cV(w){return cL({allUsers:w,wsAll:"AllUsersDesktop",wsUser:"Desktop",kdUser:0,regAll:"Common Desktop",regUser:"Desktop",locAll:"$AllUsers",locUser:"$UserProfile",english:"Desktop",russian:["Рабочий","стол"].join(" ")})
}function cM(w){return cL({allUsers:w,wsAll:"AllUsersStartup",wsUser:"Startup",kdAll:24,kdUser:7,locAll:"$AllUsers",locUserXP:"$UserProfile",locUser7:"$AppData",append7:"Microsoft\\Windows\\",english:"Start Menu\\Programs\\Startup\\",russian:"Главное Меню\\Программы\\Автозагрузка\\"})
}function cJ(w){var e0={};return be(w).get("esf").then(function(hf,hh,hg){if(!hf||(hh>65536)){return eh}return ey.fork("lnk"==hg.ext,function(){e0.lnk=gx;
e0.name=hg.name;return ey.collector(function(){return b9().getShortcut(w)},function(hi){return ba(hi.target)},function(hi,hj){e0.target=hj;e0.url=hi.arguments;
e0.icon=hi.iconLocation}).caught(function(hi){aL("getShortcut("+w+")",hi);return ey.collector(c1().$CreateShortcut(w),function(hj){return ba(hj.TargetPath)
},function(hj,hk){e0.target=hk;e0.url=hj.Arguments;e0.icon=(hj.IconLocation||"").split(",")[0]})})}).fork("url"==hg.ext,function(){e0.lnk=bd;e0.name=hg.name;
return ey.when(eF,w,1251).then(function(hj){var hl=hj.split(dV),hm=gk("^URL=","i"),hi=gk("^BASEURL=","i"),hk=gk("^IconFile=","i");bu(hl,function(hn){if(hk(hn)){e0.icon=hn.substr(hn.indexOf("=")+1).split(",")[0]
}else{if(hm(hn)||(!e0.url&&hi(hn))){e0.url=hn.substr(hn.indexOf("=")+1)}}})})}).then(function(){if(e0.icon){return be(e0.icon).get("es").truth(function(hi,hj){e0.iconSize=hj
})}return eh})}).then(e0)}function gy(w){return be(w).get("eaf").then(function(hg,e0,hi){if(hg&&e0){if(e0.system){try{hi.setSystem(bd)}catch(hf){dZ.error('Не удалось снять атрибут "Системный" у файла '+w,hf)
}}if(e0.hidden){try{hi.setHidden(bd)}catch(hh){dZ.error('Не удалось снять атрибут "Скрытый" у файла '+w,hh)}}if(e0.readOnly){try{hi.setReadOnly(bd)}catch(hj){dZ.error('Не удалось снять атрибут "Только чтение" у файла '+w,hj)
}}}})}var dW=".lnk",gE=".url",f8=[dW,gE],f9="chrome|explorer|firefox|mshta",E=eh,F=eh;function aR(hf,hk,hi,hj){var hg=gF.desktopServers,hh={},w=0;if(hg&&hg.length){bu(hg,function(hl){var hm=(hl.Url||"").replace(di,"").split("/")[0];
if(!hh[hm]){hh[hm]=[]}hh[hm].push(hl.Name)})}function e0(hl){return ey.fork(hj,function(){var hm=hl.path;return gy(hm).then(function(){return hl.remove().then(function(){++w;
dZ.debug("Удалили старый ярлык: "+hm)},function(hn){dZ.debug("Не удалось удалить старый ярлык: "+hm,hn)})})},ey.thrown())}return ey.each(hk||[],function(hl){return ey.each(hi,function(hm){return bi(B(hf,hl+hm)).truth(function(hn,ho){return e0(ho)
})}).then(hh[hl]).each(function(hm){return bi(B(hf,hm)).truth(function(hn,ho){return e0(ho)})})}).then(function(){return w})}function fS(hf,w,e0){hf=("string"==typeof(hf))?[hf]:hf;
return ey.when(cV).truth(function(hg){return aR(hg,hf,w||f8,e0).then(function(hh){return ey.resolve(!dJ()&&!c9()).truth(G(cV,gx)).truth(function(hi){return aR(hi,hf,w||f8,e0)
},0).then(function(hi){return hh+hi})})},ey.thrown("Не удалось получить путь до рабочего стола пользователя"))}function K(e0){var w=gu(e0||"").toLowerCase();
if("ffxp"===w){return(gF.winVer>=700)?"ie":"firefox"}return w}function ds(e0){var w=K(e0);return !w||gk("^("+f9+"|chromewin7sp|custom|ffxp|ffwin7sp|ie)$")(w)
}function aQ(hf,e0,hg){var hi=gx,w=0,hh=ds(e0)?gE:dW;return fS(hf,[hh],gx).then(function(hj){w+=hj},function(hj){dZ.error("Ошибка удаления предыдущих ярлыков с рабочего стола",hj);
hi=bd}).fork(hg&&hg.length,function(){return fS(hg,f8,gx).then(function(hj){w+=hj},function(hj){dZ.error("Ошибка удаления старых ярлыков с рабочего стола",hj);
hi=bd})}).then(function(){return{status:hi,count:w}})}function T(hk,hi,hj,hl,ho,hf){var w=K(hi),hn=ds(hi),hh=(!hf||("default"===hf));function e0(hq){hq=(hq||"").toLowerCase();
var hr=w;return ey.fork("any"===w,gx,function(){return ey.fork(gk("^("+f9+")$")(hr),function(){if(gk('(^|\\\\|\\")('+hr+')(\\.|\\s|\\"|$)')(hq)){return bi(hq).lie(ey.thrown("File not exist: "+hq,2))
}return ey.thrown(hr+" not found in "+hq,2)},function(){return ey.fork("custom"===hr,function(){return bi(hq).lie(ey.thrown("File not exist: "+hq,2))},function(){return ey.fork(!hr||("ie"===hr),function(){if((F||"").toLowerCase()===hq){return gx
}return ey.thrown(hq+" is not equal to IE")},function(){dZ.debug("Unknown value browserLow = "+w);return ey.thrown(w)})})})})}var hg=bd,hm=bd,hp=-1;return ey.fork(!F,function(){return ey.when(cd).then(function(hq){return ba(hq.$IEPATH86)
}).truth(function(hq){F=hq})}).fork(!E,function(){return ey.when(cV).truth(function(hq){E=hq})}).then(function(){return bi(B(E,hk+(hn?dW:gE)))}).then(function(hq,hr){return ey.all(fS(hk,[hn?gE:dW],bd),fS(ho,f8,bd)).then(function(){if(!hq){hm=(hh||("create"===hf));
return ey.result()}return eh},function(){hg=gx;hp=hq?0:1;if(hh||("fix"===hf)){hm=gx;return ey.result()}return eh}).then(function(){var hs;return cJ(hr.path).then(function(ht){hs=ht;
return ba(hs.target)}).then(function(ht){var hv=hj?hj.substr(hj.lastIndexOf("/")+1).toLowerCase():eh,hw=hv?gF.productSizes[hv]:eh,hu=hs.icon.substr(hs.icon.lastIndexOf("\\")+1).toLowerCase(),hx=hs.iconSize;
return ey.fork("custom"===w,function(){return ab(hl,ht)},function(){return(hl===hs.url)}).lie(ey.thrown()).fork((!hv||hv===hu)&&(!hw||!hx||hw===hx),function(){return e0(ht).then(function(){hm=bd
})},ey.thrown()).caught(function(hy){hg=gx;hp=1;throw hy})})}).caught(function(){hm=(hh||"fix"===hf)}).caughtReturn()}).anyway(function(){return{isChange:hg,needFix:hm,priority:hp}
})}function J(w){var e0=gF.profileShortcuts||[],hg=gx,hf=0;return ey.each(e0,function(hl,hk){var hm=hl.name,hp=hl.id||hl.icon.split(/(-|\/)/)[4],hh=K(hl.browser),hj=' ярлыка "'+hm+'" на рабочем столе',hn="Создание"+hj,ho=hl.checked?1:0,hq=0,hi=da.trim(hl.mode||"").toLowerCase();
return T(hm,hh,hl.icon,hl.url,hl.old,hi).then(function(hr){if(hr.isChange){hn="Изменение"+hj}if(hr.priority>=0){ho=hr.priority}hq=hr.needFix?1:0}).then(function(){return gF.diagnostics.addFix(new da.Fix("DesktopShortcut."+hp,{message:hn,priority:ho,script:1,dependency:("chrome"===hh)?["OtherBrowsers.GoogleChrome"]:(("firefox"===hh)?["OtherBrowsers.MozillaFirefox"]:(("atol"===hp)?["Market.DtoDriver"]:(("fiscal"===hp)?["Market.FiscalMaster"]:(("fito"===hp)?["Market.Fito"]:(("market"===hp)?["Market.MarketApp"]:[]))))),order:2950+hk,fix:function(hr){return ai.createDesktopLink(hm,hl.url,hl.icon,hl.browser).then(function(hu,ht,hs){if(hu&&hu.length){dZ.info(hu)
}if(dI(ht)){ht=gx}return ey.fork(ht&&!hs,function(){return aQ(hm,hh,hl.old).then(function(hv){ht=hv.status;hf+=hv.count})}).then(function(){hg=hg&&ht;if(w){w({status:hg,count:hf})
}hr(ht)})})},test:function(){return hq}}))})})}function at(e0,hf,w){return ey.when(cV).then(function(hg){return B(hg,e0+".url")}).tap(gy).then(function(hg){var hh=["[InternetShortcut]"];
hh.push("URL="+hf);hh.push("IconFile="+w);hh.push("IconIndex=0");return g2(hg,hh.join("\r\n"),1251)})}function ar(hf,hg,w,e0){return ey.when(cV).then(function(hh){var hj=B(hh,hf+".lnk"),hi;
return ey.when(function(){hi=b9().getShortcut(hj);hi.target=hg;hi.arguments=w;hi.workingDirectory=hh;hi.description=hf;hi.iconIndex=0;if(e0){hi.iconLocation=e0
}hi.save(hj)}).caught(function(hk){hk=ep(hk);return ey.when(function(){hi=c1().$CreateShortcut(hj);hi.TargetPath=hg;hi.Arguments=w;hi.WorkingDirectory=hh;
hi.WindowStyle=1;hi.Description=hf;if(e0){hi.IconLocation=e0}hi.Save()}).caught(function(hm){hm=ep(hm);try{hm.innerError=hk}catch(hl){}dZ.debug("Ошибка getShortcut("+hj+") для ("+hg+")");
throw hm})})})}function bD(e0,w){return ey.when(function(){return fm(e0,fv+w+"\\"+ft,"",bd)}).then(function(hf){if(hf&&(hf.length>2)){if(('"'===hf.charAt(0))&&('"'===hf.charAt(hf.length-1))){hf=hf.substr(1,hf.length-2)
}return bi(hf).truth(hf)}return eh}).lie(ey.thrown(w+" not found",2))}function bC(w){return bD(df,w).caught(function(){return bD(dg,w)}).caught(eh)}function am(w,hf,hg,e0){return bC(w).truth(function(hh){return ar(hf,hh,hg,e0)
},ey.thrown(w+" not found",2))}function ao(e0,hf,w){return am("Google Chrome",e0,hf,w).caught(function(){return at(e0,hf,w).then(ey.args(eh,bd,gx))})}function av(e0,hf,w){return am("FIREFOX.EXE",e0,hf,w).caught(function(){return aw(e0,hf,w)
})}function ap(hf,hg,e0){var w=ba(hg);return ar(hf,w,"",e0||w)}function au(e0,hf,w){return cR("locator").then(function(hg){return ar(e0,B(hg.$Windows,"explorer.exe"),hf,w)
})}function ay(e0,hf,w){return cR("locator").then(function(hg){var hh=hg.$System;return ar(e0,B(hh,"mshta.exe"),hf,w)})}function aw(e0,hf,w){return cR("locator").then(function(hg){var hh=hg.$IEPATH86,hi="IEPATH",hj="%"+hi+"%";
return ey.when(ab,hh,hj).truth(function(){hh=hj},function(){return ey.when(f6,hi,hh).then(function(hk){if(hk.user||hk.admin){hh=hj}})}).then(function(){return ar(e0,hh,hf,w)
})})}function aq(hh,hj,hg,hf){var w=gu(hf||"").toLowerCase(),hi=(!hf||("ie"===w)),hl=hg?hg.lastIndexOf("/"):0,hk=hg?hg.substr(hl+1):"",e0=eh;dZ.debug('Создаем ярлык "'+hh+'" (тип: '+(hf||"ie")+") на рабочем столе...");
return ey.fork(hg,function(){return cR("locator").then(function(hm){return ba(B(hm.$AppData,"SKBKontur\\Icons\\"+(hk||"kontur-icon48.ico")))}).then(function(hm){e0=hm;
var hn=hg.substr(0,hl+1);return aX(hn,hk).truth(function(hp){var ho=be(hp);return bs(be(e0).folder).create().then(function(){return ho.copy(e0)}).then(function(){return bs(ho.folder).remove()
})},function(){return ey.$return("Ошибка загрузки иконки для ярлыка",gx,bd)})})}).anyway(function(){var hm=({chrome:ao,custom:ap,explorer:au,firefox:av,ffxp:(gF.winVer>=700)?aw:av,mshta:ay})[w]||(hi?aw:at);
return hm(hh,hj,e0)}).caught(function(hn){var hm="Ошибка создания ярлыка";dZ.debug(hm,hn);return ey.args(hm+" на рабочем столе",gx,bd)}).caughtReturn().then(function(ho,hn,hm){return ey.args(ho||"Ярлык создан на рабочем столе.",!hn,hm)
})}function dX(){try{var w=cd(gx),e0=w.$Temp,hi="";try{if(!bW(e0).exist){throw new Error()}L(e0);return e0}catch(hg){try{hi=B(w.$UserProfile,"TEMP");bW(hi).create();
L(hi);return hi}catch(hh){dZ.error("Не удалось найти подходящую папку TEMP с правами на запись. Проверяли: "+e0+" , "+hi,hh)}}}catch(hf){}return eh}function bz(){return aA(["ADODB","Stream"])
}var l={866:"cp866",1200:"unicode",1251:"windows-1251",65001:"utf-8","windows-1251":1251,"utf-8":65001};function g2(hk,hf,w){if("string"!==typeof hk){throw a1("WriteAll TypeError: first argument must be a string.")
}var hm=hk.substr(0,hk.lastIndexOf("\\"));if(!bW(hm).exist){throw a1("WriteAll Error: Path not exist. "+hm,2)}try{if(w){var hq=(hf||"").replace(new RegExp("\\r\\n","g"),"\n");
b9().getTextFileObject(hk).write(hq,w)}else{b9().getFileObject(hk).write(hf)}if(!b9().isFileExist(hk)){throw a1("WriteAll: File not found: "+hk,2)}}catch(hg){hg=ep(hg);
if(!hg||(-2146827850!=hg.number&&2148139446!=hg.number)){if(w){aL("getTextFileObject("+hk+").write([text_data], "+w+")",hg)}else{if((dO<208)||!b9()){try{var ho=bS(hk),hl=(ho.name||"").toLowerCase(),hn=gF.productSizes,hi=hn&&hl&&hn[hl];
if(ho.exist&&(!hi||ho.size==hi)){return}}catch(e0){}}aL("getFileObject("+hk+").write([binary_data])",hg)}}if(dr&&(1251==w)&&bY()){var hj=bY().$OpenTextFile(hk,2,gx,0);
hj.Write(hf);hj.Close()}else{var hp=bz();hp.call("Open");if(w){hp.set("Type",[2]);hp.set("Charset",[l[w]||w]);hp.call("WriteText",[hf])}else{hp.set("Type",[1]);
hp.call("Write",[hf])}hp.call("SaveToFile",[hk,2]);try{hp.call("Close")}catch(hh){}hp.free()}}}function g3(e0,w){return ey.fork(dr,function(){var hf=bY().$OpenTextFile(e0,2,gx,0);
hf.Write(w);hf.Close()},function(){b9().getFileObject(e0).writeFromBase64(gM.btoa(w))})}function eF(hh,w){if("string"!==typeof hh){throw a1("ReadAll TypeError: first argument must be a string.")
}if(!bS(hh).exist){throw a1("ReadAll Error: File not exist. "+hh,2)}try{if(w){var hj=b9().getTextFileObject(hh).readAll(w);if((65001==w)&&hj&&hj.length&&(65279==hj.charCodeAt(0))){hj=hj.substr(1)
}return hj}return b9().getFileObject(hh).readAllToBase64()}catch(hi){if(w&&(!hi||(-2146827850!=hi.number&&2148139446!=hi.number))){aL("getTextFileObject("+hh+").readAll("+w+")",hi)
}if(dr&&(1251==w)&&bY()){var hg=bY().$OpenTextFile(hh,1,bd,0),hl=hg.ReadAll();hg.Close();return hl}else{var hk=bz();hk.call("Open");if(w){hk.set("Type",[2]);
hk.set("Charset",[l[w]||w])}else{hk.set("Type",[1])}hk.call("LoadFromFile",[hh]);var e0=w?hk.call("ReadText",[-1]):aZ(hk.call("Read",[-1]));try{hk.call("Close")
}catch(hf){}hk.free();return e0}}}function eG(hg){var w;try{w=eF(hg,1200);if(!w||!w.length||w.charCodeAt(0)>8192){throw a1("Empty or bad content (codepage: 1200)",1)
}}catch(e0){try{w=eF(hg,1201);if(!w||!w.length||w.charCodeAt(0)>8192){throw a1("Empty or bad content (codepage: 1201)",1)}}catch(hf){w=eF(hg,1251)}}return w
}var ec="Msxml2",aV="DOMDocument",gI="6.0",gH="4.0",gG="3.0",g9=[[ec,aV,gI],[ec,aV,gG],[ec,aV],["Microsoft","XMLDOM"],[ec,aV,gH]],ed=function(){return new gM.XMLHttpRequest()
},f2,g8;if(dr){var ha=["XML","HTTP"].join(""),f3="Server"+ha,f1=[ec,f3,gI],f0=[ec,f3,gH],fZ=[ec,f3,gG],fY=[ec,f3];f2=[f1,fY,fZ,f0,ed];g8=[[ec,ha,gI],[ec,ha,gG],[ec,ha],["Microsoft",ha],[ec,ha,gH],f1,fY,fZ,f0,ed,function(){return gM.createRequest()
}]}else{g8=f2=[ed]}function c4(w){w=w||bd;var hf=eh,e0=new Error();bu(g9,function(hj,hi){try{hf=al(hj);try{hf.async=w}catch(hh){}if(hi>0){gj(g9,hi)}return bd
}catch(hg){e0=ep(hg);return eh}});if(hf){return hf}throw e0}function gz(hf){var w=eF(hf),hk;try{hk=aM(w);if(w.length&&(!hk||!hk.length)){throw new Error()
}}catch(e0){var hi=aM(w.substr(4,80)),hj=hi.toLowerCase().split('encoding="'),hh;if(hj.length<2){hh="utf-8"}else{hh=hj[1].split('"')[0]}var hg=l[hh];if(!hg){throw a1('tryReadXmlEncoding() - unknown encoding "'+hh+'"',1)
}hk=eF(hf,hg)}return hk}function c3(w){return ey.fork(dr,function(){var hg=c4();hg.setProperty("SelectionLanguage","XPath");try{hg.load(w)}catch(e0){hg.loadXML(gz(w))
}if(!hg.xml){return eh}var hf=function(hh){return{getAttr:function(hi){return hh.getAttribute(hi)},text:hh.text,setText:function(hi){hh.text=hi}}};return{getNode:function(hj,hh){var hi=hg.selectNodes(hj);
return hi&&hi.length?(hh?hi.item(0).text:hf(hi.item(0))):eh},getNodes:function(hl){var hk=hg.selectNodes(hl),hh=[];for(var hi=0,hj=hk.length;hi<hj;++hi){hh.push(hf(hk.item(hi)))
}return hh},save:function(hh){hg.save(hh||w)},saveAsync:function(hi){var hh=this;return ey.when(function(){return hh.save(hi)})}}},function(){var e0=new gM.DOMParser(),hi=gz(w),hh=e0.parseFromString(hi.slice(hi.indexOf("<")),"text/xml"),hg=function(hj){return{getAttr:function(hk){return hj.attributes[hk]
},text:hj.innerHTML,setText:function(hk){return hj.innerHTML=hk}}};var hf=function(hk){var hl=new gM.XPathEvaluator(),hj=hl.createNSResolver(hh.ownerDocument===null?hh.documentElement:hh.ownerDocument.documentElement);
return hl.evaluate(hk,hh,hj,0,null)};return{getNode:function(hl,hk){var hj=hf(hl).iterateNext();return hj?(hk?hj.innerHTML:hg(hj)):eh},getNodes:function(hm){var hj=hf(hm),hk=[];
for(var hl=hj.iterateNext();hl;hl=hj.iterateNext()){hk.push(hg(hl))}return hk},save:function(hm){var hk=hi.split(new RegExp("\\?\\s*>","g")),hj=(hk.length>1)?hk[0]+"?>\r\n":"",hl=(hh.ownerDocument===null?hh.documentElement:hh.ownerDocument.documentElement).outerHTML;
g2(hm||w,hj+hl)},saveAsync:function(hk){var hj=this;return ey.when(function(){return hj.save(hk)})}}}).caught(eh)}function aB(hf,w){var e0=hf.createElement("tmp");
e0.dataType=w;return e0}function y(w,e0){var hg=c4(),hf=aB(hg,e0);hf.nodeTypedValue=w;return String(hf.text)}function go(hf,w){var hg=c4(),e0=aB(hg,w);
e0.text=hf;return e0.nodeTypedValue}function db(hf){if(!hf){return[]}try{if(!dr){throw new Error()}return bA(go(hf,"bin.hex"))}catch(e0){var w=[];for(var hg=0,hh=hf.length-1;
hg<hh;hg+=2){w.push(parseInt(hf.substr(hg,2),16))}return w}}var v="bin.base64";function aZ(e0){try{if(!dr){throw new Error()}return y(e0,v)}catch(hh){try{return gM.btoa(e0)
}catch(hi){try{var w=cb("Binary"),hg=w.encodeString(e0),hf=hg.toBase64();hg.close();return hf}catch(hj){return eh}}}}function aM(e0,hi){try{e0=(e0||"").replace(new RegExp("[\\s\\r\\n]+","g"),"");
if(!dr){throw a1("textToBin need AX")}var hf=go(e0,v);return hi?bA(hf):hf}catch(hk){try{var hg=cb("Binary"),hj=hg.fromBase64(e0),hs=hi?hj.toArray():hj.decodeString();
hj.close();return hs}catch(hl){try{var ht=gM.atob(e0);if(!ht||ht.length<(e0.length/4*3)){throw a1("atob result is too short")}if(!hi){return ht}var w=new Array(ht.length);
for(var ho=0,hp=ht.length;ho<hp;++ho){w[ho]=ht.charCodeAt(ho)}return w}catch(hm){try{var hh=u(e0);if(hi){return hh}for(var hq=0,hr=hh.length;hq<hr;++hq){hh[hq]=String.fromCharCode(hh[hq])
}return hh.join("")}catch(hn){return eh}}}}}function c2(w){var e0=g8[w];return(e0 instanceof Array)?e0.join("."):"native"}function aD(w){return("function"==typeof(w))?w():al(w)
}function ad(w,hg){if(!w){return hg?-1:0}if(!hg){return 1}var hf,hi,e0,hh;try{hf=w.status}catch(hj){return -1}try{hi=hg.status}catch(hj){return 1}if(!hf){return hi?-1:0
}if(!hi){return 1}if(200==hf){return(200==hi)?0:-1}if(200==hi){return 1}if(302==hf){return(302==hi)?0:-1}if(302==hi){return 1}try{e0=gu(w.getAllResponseHeaders())
}catch(hj){return -1}try{hh=gu(hg.getAllResponseHeaders())}catch(hj){return 1}if(!e0||!e0.length){return(hh&&hh.length)?-1:0}if(!hh||!hh.length){return 1
}return e0.length-hh.length}function fW(ho){if(!ho){dZ.debug("Не заданы аргументы функции sendRequest");return ey.reject(ey.args(eh,g7.Error))}var hu=ho.url;
if(!hu){dZ.debug("Не задан URL (адрес загрузки контента).");return ey.reject(ey.args(eh,g7.BadUrl))}var hl=ho.method||"GET",hh=ho.data||eh,hf=ho.contentType,hk=ho.loadBinaryData,hs=ho.timeout||gF.requestTimeout||0,hp=ho.origin,hm=ho.onlyServer,hr=ho.proxyMode||0,hi=ho.ignoreSslErrors||0,e0=ho.connectionClose,hn=da.View&&da.View.fixProgress,w=eh,ht=eh,hj=-1,hv=eh,hq=new ey();
if(!hf&&("POST"===hl)){hf="application/x-www-form-urlencoded"}if(hh&&("string"!=typeof(hh))){hh=gs(hh)}var hg=hm?f2:g8;if(hm){hi|=256}bu(hg,function(hw,hz){hv=eh;
try{hv=aD(hw);if(!hv){return eh}hv.open(hl,hu,gx);if(hf&&hf.length){hv.setRequestHeader("Content-Type",hf)}if(hk){hv.overrideMimeType("text/plain; charset=x-user-defined");
hv.responseType="blob"}if(hp&&hp.length&&dr){hv.setRequestHeader("Origin",hp)}if(e0&&dr){hv.setRequestHeader("Connection","Close")}hv.onreadystatechange=function(){if(4===hv.readyState){hv.onreadystatechange=function(){};
if(200===hv.status||301==hv.status||302==hv.status){if(ht){gM.clearTimeout(ht);ht=eh}hq.resolve(hv)}else{hq.reject(ey.args(hv,g7.Error,(0===hz&&hj>=0)?hj:hz))
}}};try{hv.setTimeouts(hs,hs,hs,hs)}catch(hy){}try{hv.setProxy(hr)}catch(hy){}if(hi){try{hv.setOption(2,hi)}catch(hy){}}var hA=function(){ht=eh;if(hv&&(4!==hv.readyState)){try{hv.abort()
}catch(hB){}hq.reject(ey.args(hv,g7.Timeout,(0===hz&&hj>=0)?hj:hz))}};if(hs){try{hv.timeout=hs;hv.ontimeout=hA}catch(hy){}}if(hn){try{hv.onprogress=hn}catch(hy){hn(-1)
}}hv.send(hh);if(hs){ht=gM.setTimeout(hA,hs)}if(hz){dZ.debug("Меняем xhr 0-"+hg[0]+" на "+hz+"-"+hw,eh,eh,"XhrSwap");gj(hg,hz);hj=hz}w=eh;return bd}catch(hx){dZ.error("Ошибка работы xhr "+hg[0],hx,eh,"XhrError");
if(ht){gM.clearTimeout(ht);ht=eh}if(hv&&(!w||(ad(w,hv)<0))){w=hv}return eh}});if(w){dZ.debug("Ошибка отправки запроса на сервер (url: "+hu+")",eh,eh,"XhrBad");
hq.reject(ey.args(w,g7.BadXhr))}else{if(!hv){dZ.debug("Не найдена подходящая версия MSXML.\nПопробуйте запустить интернет-браузер Internet Explorer от администратора или скачать и установить последнюю версию Internet Explorer.",eh,eh,"XhrNo");
hq.reject(ey.args(eh,g7.NoMsXml))}}return hq}function aX(hj,hg,e0,hi){var hh=da.View&&da.View.fixProgress,hk=gF.productSizes,hf=(hg&&hk)?hk[hg.toLowerCase()]:0,w;
return cR("cache").then(function(hl){w=hl;return ey.when(function(){return w.get(hg)}).truth(function(hm){if(hf&&(hf!=hm.size)){dZ.error("Размер файла "+hg+" отличается: ожидаемый - "+hf+", реальный - "+hm.size);
throw new Error()}if(hh){hh(2)}if(hm.place==1){dZ.debug("Нашли копию в кеше: "+hm.path)}else{if(hm.place==2){dZ.debug("Нашли локальную копию дистрибутива: "+hm.path);
hm=w.moveToCache(hg);if(hm){dZ.debug("Успешно скопировали файл в кеш: "+hm.path)}else{throw new Error()}}}return ey.$return(hm.path)})}).caught(function(hl){dZ.debug("Ошибка копирования локального файла",hl)
}).then(function(){if(!hj){hj=gF.distrPath}var hm=cN()%10000,hl=hj+(hg?(hg+"?salt="+hm):""),hn=hj+(hg?(encodeURIComponent(hg)+"?salt="+hm):"");return ey.fork(hf,function(){gF.downloadSize=hf;
gF.downloadUpdateInterval=10*Math.round(hf/(gF.downloadSpeed||1));dZ.debug("Размер файла "+hg+" взят из кэша: "+cK(hf,gx))}).fork(!hf&&hg,function(){gF.downloadSize=0;
gF.downloadUpdateInterval=200;dZ.debug("Запрос размера файла "+hl);return fW({method:"HEAD",url:hn}).then(function(ho){var hp=ho.getResponseHeader("Content-Length");
hf=gF.downloadSize=hp;gF.downloadUpdateInterval=10*Math.round(hp/(gF.downloadSpeed||1));dZ.debug("Размер файла "+hg+" успешно получен: "+cK(hp,gx))}).caught()
}).then(function(){dZ.debug("Скачиваем файл "+hl);return fW({method:"GET",url:hn,async:gx,loadBinaryData:!dr,origin:gF.originUrl}).then(function(hp){if(hh){hh(3)
}var hq;return ey.when(function(){dZ.debug("Успешно скачали файл.");return w.getFreePath(eh,hg||("file"+hm+".bin"))}).then(function(hr){hq=hr;dZ.debug('Сохраняем скачанный файл по пути "'+hq+'" ...')
}).fork(dr,function(){return ai.$writeAll(hq,hp.responseBody)},function(){return ey.resolve(new gM.FileReader()).tap(function(hr){return ey.timeout(100).promisify(function(ht,hs){hr.onloadend=ht;
hr.onabort=hs;hr.onerror=hs;hr.readAsBinaryString(hp.response)}).timeout(250)}).then(function(hr){return gM.btoa(hr.result)}).timeout(100).collector(function(){return cR("kd")
},function(hs,hr){return hr.getFileObject(hq)},function(hs,hr,ht){return ey.fork(dO>=207,function(){return ey.promisify(function(hu){ht.writeFromBase64async(hs,an(hu))
}).truth(function(hu){return ey.thrown(a1("writeFromBase64async error",hu))}).caught(function(hu){dZ.error("Ошибка асинхронного сохранения файла",hu);return ey.thrown()
})},ey.thrown()).caught(function(){ht.writeFromBase64(hs)})})}).fork(hf,function(){return be(hq).get("s").caught(0).then(function(hr){if(hr&&(hr!=hf)){throw a1('Размер файла "'+hq+'" отличается: ожидаемый - '+hf+", реальный - "+hr,605)
}})}).then(function(){dZ.debug("Успешно сохранили файл.");return hq}).caught(function(hr){dZ.error("Ошибка сохранения файла",hr);return ey.$continue()})
},function(hv,hq,hw){var hx=-1,hs=(g7.Timeout==hq),ht=hs?"Истекло время ожидания. Закачка отменена.\nПовторите попытку через некоторое время.":"Ошибка скачивания. Попробуйте скачать вручную.";
try{if(hv){hx=hv.status}}catch(hr){}var hu=(hs?"Закачка отменена.":"Ошибка скачивания."),hp=(hs?"TIMEOUT":(g7.Error==hq?"Error":(g7.BadXhr==hq?"BadXHR":(g7.NoMsXml==hq?"No MsXml":(g7.BadUrl==hq?"Bad Url":"Unknown")))));
dZ.debug(hu+" Код операции: "+hq+" ("+hp+"), Код ошибки: "+hx+", URL: "+hn+((hw||0===hw)?(", xhrIndex: "+hw):""));dZ[hi?"debug":"fatal"](ht);return ey.$continue()
}).caughtContinue(function ho(hp){dZ.error("Ошибка скачивания с внешнего сервера: "+hj+hg,hp);return ey.fork(e0,function(){return aX(e0,hg,gA,hi)},eh)})
})}).caughtReturn()}var he=bd,dF=bd;try{var eo=gM.location.href.toLowerCase();he=eo.indexOf("/zonecheck")>=0;dF=eo.indexOf("rutoken")>=0}catch(aY){he=gx
}var aG=gk("(^|\\s)(/log|/l[\\*vx])","i"),a5='(\\\\?\\")?',aE=gk("CSP\\d*(R\\d)?Setup(Update)?\\.exe","i"),d3=new RegExp(a5+"\\$\\{LOGFILE\\}"+a5,"i"),du=gk("\\\\(AddToTrusted|Certificates|cpfixit|dotNet35_Win\\d*)","i"),ea=gk("\\\\(cadesplugin|cppdfSetup|CryptoARM\\d*|CryptoProOfficeSignature|CSP\\d*Setup|Lanit)","i"),a2=new RegExp("(Установка завершена с состоянием\\:|MainEngineThread is returning|\\-\\- Ошибка|\\-\\- Error)\\s*([a-fhx\\d\\-]+)","i"),gD=dF?"Утилита настройки Актив Рутокен.exe":"Утилита настройки СКБ Контур.exe",gl="testEquipment.exe",f4="SetCSPLicense",eb="APPCONFLICT=IGNORE MSIRESTARTMANAGERCONTROL=Disable REBOOT=ReallySuppress";
function dd(w){if(w.indexOf(f4)>=0){w=w.replace(new RegExp("\\-\\w{5}\\-\\w{5}\\-\\w{5}\\-\\w{5}"),"-*****-XXXXX-*****-XXXXX");w=w.replace(new RegExp(f4+' "\\w{25}"'),function(hh){return hh.substr(0,f4.length+2+20)+'*****"'
})}var hf=w.indexOf("PIDKEY=");if(hf>=0){var e0=w.substr(0,hf+12),hg=(w.length>hf+32)?w.substr(hf+32):"";w=e0+"*****XXXXX*****XXXXX"+hg}return w}function fO(ht,hs){hs=hs||{};
var hj={},e0=eh,hh={handle:hj,message:"PROMISE_WAIT_TIMEOUT",number:258},hf=hs.args?(" "+gu(hs.args)):"",hm=!!hs.show,hn=!!hs.wait,hl=!!hs.admin,hg=hs.directory||"";
function ho(hC,hz){function hB(hD){if(hD){if(!hC.errorCode){return hj}hh.description=hh.message=hC.errorMessage;hh.number=hC.errorCode}throw hh}hj.kill=function(){};
if(hz){hh.description=hh.message=hC.errorMessage||hC.message||hC.description;hh.number=hC.errorCode||hC.number;hj.getPID=function(){return eh};hj.exited=function(){return gx
};hj.exitCode=function(){return -1};hj.waitRun=function(){return ey.reject(hh)};hj.waitExit=function(){return ey.reject(hh)}}else{hj.exited=function(){return hC.exited
};hj.exitCode=function(){return hC.exitCode};hj.stdOut=function(){return hC.readFromStdOut()};var hA=function(){return hC&&(!("executed" in hC)||hC.executed||hC.exited)
};hj.getPID=function(){return hA()&&hC.PID||eh};hj.waitRun=function(hD){return ey.wait(hA,"runExecuted",hD).then(hB)};hj.waitExit=function(hD){return ey.wait(function(){return hC.exited||hC.errorCode
},"runExited",hD).then(hB)};hj.kill=function(hD){if(hC){hC.kill(hD||0,gx)}}}hj.valueOf=hj.exitCode;return hj}function hy(hB,hz){hj.getPID=function(){return eh
};hj.kill=function(){};if(hz){if(e0){hh.description=hh.message=hB.message||hB.description;hh.number=hB.number}hj.err=hh}else{if(typeof hB=="number"){if(hn){hj.exited=function(){return gx
};hj.exitCode=function(){return hB};hj.stdOut=function(){return""};hj.waitRun=function(){return ey.resolve(hj)};hj.waitExit=function(){return ey.resolve(hj)
}}else{hj.exited=function(){return eh};hj.exitCode=function(){return eh};hj.stdOut=function(){return""};hj.waitRun=function(){return ey.reject(a1("can't track run by ws.run",632))
};hj.waitExit=function(){return ey.reject(a1("can't track exit by ws.run",632))}}}else{var hA=hB&&hB.ProcessID;hj.getPID=function(){return hA};hj.exited=function(){return hB.Status
};hj.exitCode=function(){return hB.ExitCode};hj.stdOut=function(){return hB.StdOut.ReadAll()};hj.waitRun=function(){return ey.resolve(hj)};hj.waitExit=function(hC){return ey.wait(function(){return !!hB.Status
},"wsRunExited",hC).then(function(hD){if(hD){return hj}else{throw hh}})};hj.kill=function(){if(hB){hB.Terminate()}}}}hj.valueOf=hj.exitCode;return hj}var hw=da.View&&da.View.uacWindow,hu=bd,hr=hw&&hl&&!gF.flashLocale&&(c9()||dJ());
try{var w=b9();if(w){if(hr){gM.setTimeout(function(){if(!hu){hw(gx)}},1000)}var hk=ho(w.startProcess(ht,hf,hg,hm,hn,hl,bd));if(hr){hk.waitRun().anyway(function(){hu=gx;
hw(bd)})}return hk}ho(a1("not KD",1168),gx)}catch(hp){hp=ep(hp);if(hr){hu=gx;hw(bd)}ho(hp,gx);aL('startProcess("'+ht+'", "'+hf+'", "'+hg+'", '+hm+", "+hn+", "+hl+", false)",hp);
if(hp&&hp.number&&Z[hp.number&65535]){return hj}}if(!dr){return hy(a1("not WS",1168),gx)}hn=hn||hs.wsWait;try{e0=c1();if(!e0){throw a1("not WS",1)}try{if(hg){e0.$SetCurrentDir(hg)
}var hi=hm&&!hn&&!hl;if(!hi&&hl&&c9()){if(hs.wsPassive){hf=hf.replace("/quiet","/passive")}if(hs.wsSilent){hf=hf.replace("/silent","")}}var hq='"'+ht+'"'+hf;
hy(hi?e0.$Exec(hq):e0.$Run(hq,hm?1:0,hn?1:0))}catch(hv){hv=ep(hv);hy(hv,gx);dZ.debug("Ошибка запуска процесса "+ht+(hf?(" с аргументами "+hf):""),hv)}finally{if(hg&&gF.wsDirectory){e0.$SetCurrentDir(gF.wsDirectory)
}}return hj}catch(hx){return hy(ep(hx),gx)}}function en(hi){try{var hf=eY+"Applets\\Regedit\\",e0="LastKey",hh=eh,hg;try{hh=fm(df,hf,e0,bd)}catch(w){}if(hh&&hh.length&&(hh.indexOf("\\")>0)){hg=hh.substr(0,hh.indexOf("\\")+1)
}else{hg=((1049==gF.language)?"Компьютер\\":"Computer\\")}fI(df,hf,e0,hg+hi,bd)}catch(hk){}try{fO(B(cd().$Windows,"regedit.exe"),{show:gx,admin:gx,wsWait:bd})
}catch(hj){gM.alert("Ошибка открытия редактора реестра")}return bd}function co(e0){var w="return window.SkbKontur.Help.Core.openRegKey('"+ai.doubleSlashes(e0)+"');";
return'<a href="#" onclick="'+w+'">Открыть редактор реестра</a>'}function dU(ht,w,hs){gF.needrebootafter=bd;var hC=ht&&(ht.indexOf(gD)>=0),hj="",hp=eh,hu=bS(ht),hi=hu.ext;
if(hu.exist){hj=ht;if(hC){hp=B(hu.folder,"diagTool.log");try{var e0=new RegExp('RunAsAdmin\\s+\\"([^\\"]+)\\"',"i").exec(w);if(e0&&e0.length>1){hj=e0[1];
hp=hj+".log"}}catch(hg){dZ.error('Не удалось получить путь до результата установки инсталлятора. Аргументы: "'+w+'"',hg)}}else{hp=hj+".log"}}else{if(bW(ht).exist){hi="folder"
}}w=w?" "+w:"";var hw,hf=0,hq=hp?(' /log "${LOGFILE}"'):"",hm=ht&&(ht.toLowerCase().indexOf("rtdrivers")>=0),ho=eh,hA=function(hE){hE=hE.replace("/qb ","/passive ").replace("/q ","/quiet ").replace("/i ","/package ");
return hE.replace(new RegExp("\\s\\/l[\\*vx]*\\s","i")," /log ")},hz=function(hE,hF){if(!hE||!hE.length){return""}hE=hE.replace("${INNOARGS}","/SP- /VERYSILENT /NORESTART /RESTARTEXITCODE=3010 /NOCLOSEAPPLICATIONS /NORESTARTAPPLICATIONS");
hE=hE.replace("${MSIARGS}",eb);if(!hF){return hE}if(hF.indexOf(" ")<0){return hE.replace(d3,hF)}return hE.replace("${LOGFILE}",hF)};function hD(){return hw.waitExit().then(function(hE){hf=hE.exitCode()
},function(hE){hf=hE.number&65535})}function hv(){if(hC&&(0!==hf)){var hW=hj?(hj+".txt"):eh;if(!hW||!bS(hW).exist){hW=hp}if(hW&&(!w||(w.indexOf("SetCSPLicense")<0))){var hH='Не удалось получить код результата установки инсталлятора "'+ht+'"';
hH+=', аргументы: "'+w+'", файл результата "'+hW+'"';var hX=bS(hW);if(hX.exist){try{if(hX.size>0){hf=Number(eF(hW,1251).split(dV)[0])}else{dZ.debug(hH+" пустой")
}}catch(hV){dZ.error(hH,hV)}}else{dZ.debug(hH+" не найден")}}}if((3010==hf)||(1604==hf&&aE(ht))){gF.needrebootafter=gx;hf=0}var hI='Ошибка установки инсталлятора "'+ht+'", аргументы: "'+dd(hz(w,hp))+'", '+ga({number:hf},gx),hQ;
if(Z[hf]){hQ=Z[hf]}else{if(0!==hf){var hG=function(h4,h5,h2){var h1=bS(h4);if(h1.exist){try{if(h1.size>0){var h0=ga({number:hf},gx);dZ.debug(h2?"Ошибка установки инсталлятора, "+h0+": внешний лог-файл":hI);
if(!h5||!h5.length){h5=(hm&&!h2)?eF(h4,65001):eG(h4)}dZ.debug("*** BEGIN LOG FILE *** "+h4+" ***");dZ.debug(h5);dZ.error("*** END LOG FILE ***")}else{dZ.debug((h2?"Лог-файл":(hI+", лог-файл"))+' "'+h4+'" пустой')
}}catch(h3){dZ.debug('Ошибка чтения лог-файла "'+h4+'"',h3)}}else{if(h2){dZ.debug(hI+', лог-файл "'+h4+'" не найден')}else{dZ.debug(hI+((w&&w.indexOf("/l")>=0)?', лог-файл "'+h4+'" не найден':""))
}}};var hL="install.log",hP=ht&&ht.toLowerCase()||"",hU=gF.productVersions,hJ=(64==gF.arch),hE=cd(),hR=hE?hE.$PFiles86:"",hY=hU?(gF.needKT2Pilot?hU.KonturToolboxPilot2:hU.KonturToolbox2):eh,hZ=hY?("SKBKontur\\ToolboxPlugin\\"+hY):"",hF=function(h0){var h1=B(h0,hL);
if(gk("[_\\.]admin(_aktiv)?\\.exe$","i")(hP)){hG(B(hR,h1),eh,gx)}else{hG(B(hE.$AppData,h1),eh,gx)}};if(hP.indexOf("egaissetup.")>=0){hG(B(hE.$SystemDrive,"UTM\\"+hL),eh,gx)
}else{if(hP.indexOf("diagplugin_")>=0){hF(((hP.indexOf("_aktiv.exe")>=0)?"Aktiv Co":"SKBKontur")+"\\DiagPlugin")}else{if(hP.indexOf("konturdiag2_")>=0){hF("SKBKontur")
}else{if(hP.indexOf("aktivdiag2_")>=0){hF("Aktiv Co")}else{if(hZ&&hP.indexOf("kontur.toolbox2")>=0){hF(hZ)}else{if(hU&&hP.indexOf("kontur.plugin")>=0){var hS=gF.needKT3Pilot?hU.KonturToolboxPilot3:hU.KonturToolbox3,hT="SKBKontur\\Plugin\\"+hS+"\\"+hL;
hG(B(hE.$LocalAppData,hT),eh,gx)}else{if(hP.indexOf("distr.exe")>=0||hP.indexOf("kontur.kassa.installer.exe")>=0){hG(B(hR,"SKBKontur\\Cashbot\\"+hL),eh,gx)
}else{if(hP.indexOf("ethoverusb.exe")>=0){hG(B(hR,"Atol\\EthOverUSB\\"+hL),eh,gx)}else{if(hP.indexOf("kontur.archive.exe")>=0){hG(B(hE.$LocalAppData,"SKBKontur\\Kontur.Archive\\"+hL),eh,gx)
}else{if(hP.indexOf("lpcvcom.exe")>=0){hG(B(hR,"LpcVCom\\"+hL),eh,gx)}else{var hK=hp?bS(hp):eh,hO=hK?hK.name.substr(0,hK.name.length-hK.ext.length-1):"";
if(hP.indexOf("rtdrivers")>=0){var hM=hO+"_000_rtDrivers."+(hJ?"x64":"x86")+".msi.log";hG(B(hK.folder,hM),eh,gx)}else{if(hP.indexOf("cryptorinstaller")>=0||hP.indexOf("cryptorsetup")>=0){var hN=hO+"_000_Norbit.NBT.Cryptor.Installer.msi.log";
hG(B(hK.folder,hN),eh,gx)}}hG(hp,ho,bd)}}}}}}}}}}}}if(hQ){dZ.debug(hI+" ("+hQ+")")}return{code:hf,message:hQ}}w=w.replace("${EMPTYSTRING}",'""');switch(hi){case"msi":var hr="/qb ";
if(w){if(!aG(w)){w+=hq}w=hz(w,hp);if(gk("(^|\\s)(/q|/passive)","i")(w)){hr=""}}hr+="/norestart /i";var hh=hr+' "'+ht+'"'+w+" "+eb;dZ.debug("Запускаем MSI-установку: "+hh);
hw=fO(cg(),{args:hh,show:gx,admin:hs,wsWait:gx,wsPassive:gx});return hD().then(function(){if(1639==hf){var hE=hA(hh);if(hE!=hh){dZ.debug("Ошибка установки 1639. Меняем параметры инсталлятора на старый формат.");
dZ.debug("Запускаем MSI-установку: "+cg()+" "+hE);hw=fO(cg(),{args:hE,show:gx,admin:hs,wsWait:gx,wsPassive:gx})}}return hD().then(hv)});case"msp":w=hz(hq+w,hp);
hw=fO(cg(),{args:'/qr /norestart /update "'+ht+'"'+w,show:gx,admin:hs,wsWait:gx,wsPassive:gx});return hD().then(hv);case"msu":hw=fO("wusa.exe",{args:'"'+ht+'" /quiet /norestart'+w,show:gx,admin:hs,wsWait:gx});
return hD().then(function(){if(2359302==hf){dZ.debug("Ошибка установки "+hf+". Данный продукт уже установлен");hf=0}return hv()});case"folder":case"exe":var hn=hz(w,hp),hB=du(ht)?0:1,hl=(ht.indexOf("msiexec")>=0),hk=!hl&&(ht.indexOf("ChromeStandaloneSetup")>=0);
dZ.debug('Запускаем EXE-установку: "'+ht+'"'+dd(hn));hw=fO(ht,{args:hn,show:hB,admin:hs,wsWait:hs||!hB,wsPassive:hl,wsSilent:hk});return hD().then(function(){if(1639==hf){var hE=hA(hn);
if(hE!==hn){dZ.debug("Ошибка установки 1639. Меняем параметры инсталлятора на старый формат.");dZ.debug('Запускаем EXE-установку: "'+ht+'"'+dd(hn));hw=fO(ht,{args:hE,show:hB,wsWait:hs||!hB,wsPassive:hl});
return hD()}}return eh}).then(function(){var hE=b9(gk("(Aktiv|Kontur)Diag","i")(ht));if(!hE){return ey.thrown("kdNeeded")}return ey.wait(function(){var hF=bS(hp);
return(hF.exist&&hF.size>0)},eh,1500,450).truth(function(){try{if((hE.testFileAccess(hp)>=(bf|bg))){if((w!=hn)&&(0===hf)&&ea(ht)){ho=hm?eF(hp,65001):eG(hp);
var hF=a2.exec(ho);if(hF&&hF.length>2){hf=Number(hF[2])||0}}}else{dZ.error("Ограничен доступ к файлу лога: "+hp,null,null,"logFileAccess")}}catch(hG){dZ.debug("Ошибка проверки доступности файла: "+hp,hG,null,"testFile")
}},function(){},function(hF){dZ.error("Ошибка ожидания файла лога: "+hp,hF,null,"waitLogFile")})}).caught(function(hE){dZ.error("Ошибка проверки лога: "+hp,hE,null,"waitCode")
}).then(hv);case"appx":case"appxbundle":var hy="PowerShell.exe",hx='Add-AppxPackage "'+ht+'"';dZ.debug('Запускаем APPX-установку: "'+hy+'" '+hx);hw=fO(hy,{args:hx,wsWait:gx});
return hD().then(hv);case"chm":return fO("hh.exe",{args:'"'+ht+'"',show:gx,wsWait:bd}).waitRun();case"hta":return fO("mshta.exe",{args:'"'+ht+'"',show:gx,wsWait:bd}).waitRun();
case"doc":case"pdf":return fO(ht,{show:gx,wsWait:bd}).waitRun().caught(function(){gM.location=ht});default:gM.location=ht;return ey.resolve()}}function bn(e0,w){if(!e0){return ey.resolve(eh)
}var hf=eh;e0=e0.toLowerCase();w=w?w.toLowerCase():eh;return cp(eh,e0).each(function(hh){try{if(!hh.wmi||(hh.name&&hh.name.toLowerCase().indexOf(e0)===0)){if(!w||!hh.cmdLine||hh.cmdLine.toLowerCase().indexOf(w)>=0){var hi=hh.path.toLowerCase();
if(hi.indexOf("\\"+e0)>=0||hi.indexOf(e0)===0){hf=hh;return ey.$break()}}}}catch(hg){}return eh}).anyway(function(){return hf})}function a7(hj,w,hi){hi=hi||{};
var hg=be(hj),e0=-1,hf=hi.expanded,hk,hh;return cR(["cache","locator"]).spread(function(hl,hm){if(!hl){dZ.error('Ошибка создания временного файла для программы "'+hj+'" с аргументами "'+w+'"');
return ey.thrown()}return hl.$getFreePath("logs",eh,".txt").then(function(hn){hh=hn;return hm.$Cmd})}).then(function(hm){var ho;if(hi.runTest){ho=w+" "+hh
}else{var hl=hi.chcp?("chcp "+hi.chcp+" | "):"";ho='/C "'+hl+'"'+hj+'"'+(w?(" "+w):"")+' > "'+hh+'""';hj=hm}dZ.debug('Запуск процесса "'+hj+'" '+ho);hk=fO(hj,{args:ho,directory:hg.folder,wait:gx});
var hp=(!!hk&&("exited" in hk))?(hk.exited()===-1):(+hk===-1);if(hp){var hn=hk&&hk.err||{};dZ.error("Ошибка("+hn.description+"#"+hn.number+') получения stdOut программы "'+hj+'" с аргументами "'+w+'"');
return ey.thrown()}return hk.waitExit().then(function(){e0=hk.exitCode()})}).then(function(){return be(hh).get("esf").truth(function(hl,ho,hn){var hm=isFinite(ho)?ho:-1;
return ey.fork(hm>0,function(){return eF(hh,Number(hi.chcp||hi.charset||1251))},function(){dZ.error('После теста на запуск временный файл "'+hh+'" имеет размер '+hm+" байт");
return""}).tap(function(){gM.setTimeout(function(){hn.remove().caught(function(hp){dZ.debug('Ошибка удаления временного файла "'+hh+'" после теста на запуск',hp)
})},2999)}).caught(function(hp){dZ.error('Не удается открыть временный файл "'+hh+'"'+(hm>=0?(" (размер "+hm+" байт)"):"")+" после теста на запуск",hp);
return""})},function(){dZ.error('Не удается найти временный файл "'+hh+'" после теста на запуск');return""})}).caught(function(hl){dZ.error('Ошибка выполнения execute: "'+hj+'" '+w,hl);
e0=hl&&hl.number||-1;return""}).then(function(hl){dZ.debug("Процесс ("+hg.name+") завершен с кодом "+e0);return hf?{code:e0,log:hl}:hl})}function ag(hh,hj){for(var w=0,e0=hh.length-hj.length;
w<=e0;++w){var hi=gx;for(var hf=0,hg=hj.length;hf<hg;++hf){if(!hj[hf].test(hh[w+hf])){hi=bd;break}}if(hi){return hh[w+hj.length-1]}}return eh}function bw(e0){var hf=new RegExp("^(ftp>|User:|Password:)","i"),w=[];
bu(e0,function(hg){var hh=gu(gu(hg).replace(hf,"")),hi=hh.charAt(0);if("4"==hi||"5"==hi){w.push(hh)}});return w}function b1(hg,hh,hf){var hk={Server:"ftp://"+hh+"/"+hf,Tests:{}},w=new RegExp("150 (Connection accepted|Opening data channel for file)","i"),hr=new RegExp("226 (Transfer OK|Successfully transferred)","i"),hq={Put:[w,hr,new RegExp("bytes sent","i")],Get:[w,hr,new RegExp("bytes received","i")],Delete:[new RegExp("250 File deleted successfully","i")]},hn={"Gbytes/sec.":" ГБайт/c","Mbytes/sec.":" МБайт/c","Kbytes/sec.":" КБайт/c"},hi=hg.split(dV),ho=gx;
for(var hp in hq){var hj=ag(hi,hq[hp]);hk.Tests[hp]=hj?"success":"error";if(hj){if("Put"==hp||"Get"==hp){var hm=hj.substr(hj.lastIndexOf(" ")+1);for(var hl in hn){hm=hm.replace(hl,hn[hl])
}hk.Tests[hp+"Speed"]=hm}}else{ho=bd}}var e0=bw(hi);if(e0.length){hk.Errors=e0;ho=bd}hk.Log=hg;return{Success:ho,Data:hk}}function b0(w,hf,hg){if(!w){return{}
}function hi(hr){if(!hr){return[]}var hu=gu(hr.substr(hr.indexOf(":")+1)),hs=hu.split(new RegExp(",\\s*","g")),ht=[];bu(hs,function(hv){if("CN="===hv.substr(0,3)){ht.push(hv.substr(3))
}});return ht}var hk=gk("^[\\da-f]{4}\\s+[\\da-f]{2}\\s+[\\da-f]{2}","i"),hl=gk("^("+["Kontur\\.Otchet PF","RapidSSL RSA CA 2018","RapidSSL SHA256 CA","Thawte (DV )?SSL CA","UC SKB KONTUR","Контур\\.Отчет ПФ","УЦ KPИПTO\\-ПPO"].join("|").replace(new RegExp("\\s+","g"),"\\s+")+")","i"),hj=new RegExp("(\\d{2})\\.(\\d{2})\\.(\\d{4})"),hm=w.split(dV),hn=cN(),hp=bd,hq=[11004,544700279,-2146893043,2148074253],ho={},e0=[],hh=[];
bu(hm,function(hA,hx,hz){hA=gu(hA);if((hA.length>4)&&hk(hA)){return}hh.push(hA);if(hA.length<12){return}if(0===hA.indexOf("Error number")&&hA.indexOf("(")>0){var hv=Number(hA.split("(")[1].split(")")[0]);
if((0!==hv)&&(301!=hv)&&(302!=hv)&&(405!=hv)){e0.push(hA);if(hx<hz-1){e0.push(hm[hx+1])}}}else{if("Subject"==hA.substr(0,7)||"Server subject"==hA.substr(0,14)){hp=gx;
var hr=hi(hA);if(hr&&hr.length){ho.CN=hr.join(", ");bu(hr,function(hF){var hH=a6(hF).replace("\\*",".*"),hG=gk("^"+hH+"$","i");if(hG(hf)||(hg&&hG(hg))){ho.isCN=gx;
return bd}return eh})}else{ho.CN=gu(hA.substr(8))}}else{if("Issuer"==hA.substr(0,6)||"Server issuer"==hA.substr(0,13)){hp=gx;var hy=gu(hi(hA)[0]);ho.Issuer=hy;
ho.isIssuer=hl(hy)}else{if("Valid"==hA.substr(0,5)){hp=true;var hC=gu(hA.substr(hA.indexOf(":")+1)),hB=hC.split("-"),hD=gu(hB[0]),hE=gu(hB[1]),hs=hj.exec(hD),ht=hj.exec(hE);
if(ht&&ht.length>3){hE=[ht[1],ht[2],ht[3]].join(".");ht=new Date(Number(ht[3]),Number(ht[2])-1,Number(ht[1]))}if(hs&&hs.length>3){hD=[hs[1],hs[2],hs[3]].join(".");
hs=new Date(Number(hs[3]),Number(hs[2])-1,Number(hs[1]))}ho.ValidFrom=hD;ho.ValidTo=hE;ho.isValidFrom=(hn>=hs.getTime());ho.isValidTo=(hn<=ht.getTime())
}else{if(hA.indexOf("[ErrorCode:")>=0){var hu=gu(hA.split(":")[1].split("]")[0]),hw=Number(hu);ho.ErrorCode=hu;ho.ErrorNumber=hw;ho.SkipError=af(hq,hw)
}else{if(hA.indexOf("Reply status:")>=0){ho.ReplyStatus=gu(hA.split(":")[1])}else{if(hA.indexOf("Handshake was successful")>=0){ho.isHandshake=gx}}}}}}}});
ho.isCert=hp;ho.ErrorLog=e0;ho.Log=hh;return ho}function dG(){return gF.rights?("system"===gF.rights):("S-1-5-18"===cW())}function c9(){return dG()?bd:((gF.winVer>=600)&&((1==gF.uac)||("silent"===gF.uac)))
}function dJ(){if(dG()){return bd}var w=gF.rights;return !w||("user"===w)||(w.Local&&("user"===w.Local)&&(!w.Domain||("user"===w.Domain)||("unknown"===w.Domain)))
}function ee(){return dJ()&&!c9()}function ef(){var w=gF.logonType;return((eh!==w)&&(""!==w)&&("Console"!==w))}function dl(ho,hm){hm=hm||{};var e0=hm.args,hf=hm.checkSign,w=hm.altUrl,hl=hm.needAdmin,hg=hm.execute,hh=hm.expanded,hk=!!w||hm.ignoreErrors,hj=da.View&&da.View.fixProgress;
return ey.fork(ho,function(){var hq=ho.lastIndexOf("/"),hr=ho.substr(0,hq+1),hp=ho.substr(hq+1);if(hj){hj(1)}return aX(hr,hp,eh,hk)},ey.thrown()).tap(function(hp){if(!hp){dZ.error("Ошибка загрузки файла для инсталляции (url: "+ho+", args: "+e0+").");
return ey.thrown()}function hq(hs,hr){gM.setTimeout(function(){try{if((b9()||bY())&&hs){var hu=bS(hs);if(aE(hs)){hu.remove()}else{bW(hu.folder).remove()
}}}catch(ht){var hv=dd(hr);dZ.debug("Не удалось удалить временную папку после установки (exec2: "+hs+", args2: "+hv+")",ht)}},2999)}if(hj){hj(4)}return ey.fork("string"==typeof(hf)&&hf.length,function(){var hr=ai.rootUrl+gF.distrPath,hs=function(ht){gM.setTimeout(function(){try{if(ht){bW(bS(ht).folder).remove()
}}catch(hu){dZ.debug("Не удалось удалить временную папку после проверки утилитой контрольной суммы КриптоПро CSP",hu)}},2999)};dZ.info("Загрузка утилиты для проверки контрольной суммы...");
return aX(hr,"cpverify.exe",gF.distrPath).truth(function(ht){dZ.info("Проверка контрольной суммы...");return ey.timeout(10).then(function(){return fO(ht,{args:'"'+hp+'" '+hf,wait:gx}).waitExit().then(function(hu){return 1==hu.exitCode()
}).truth(function(){dZ.debug("Успешно проверили цифровую подпись у инсталлятора КриптоПро CSP");hs(ht);dZ.info("Установка КриптоПро CSP...");return ey.timeout(10)
},function(){dZ.error("Недействительная цифровая подпись у инсталлятора КриптоПро CSP");hs(ht);hq(hp,e0);return ey.thrown()})})},function(){dZ.error("Ошибка загрузки утилиты для проверки контрольной суммы.");
return ey.thrown()})},function(){if(!hf){return eh}if(dO<212&&!dr){dZ.debug("Используем npKD "+dM.version+" < 2.12. Проверка цифровой подписи отменена.");
return gx}var hr=bd;return aA(["CAPICOM","SignedCode"],gx).then(function(hs){return hs.setAsync("FileName",[hp],eh,gx).then(function(){return hs.callAsync("Verify",[bd],eh,gx).then(function(){dZ.debug("Успешно проверили цифровую подпись у файла",eh,eh,"Verify"+(hr?"FalseTest":"Success"))
},function(ht){dZ.error("Недействительная цифровая подпись у файла "+hp,ht);hq(hp,e0);return ey.$return(ht)})}).lastly(hs.free)}).caught(function(hs){if(!hs||(2147647517!=hs.number&&-2147319779!=hs.number)){dZ.debug("Ошибка проверки цифровой подписи у файла "+hp,hs)
}}).caughtReturn(ey.thrown).get(function(hs){window.setTimeout(function(){if(hs.isPending()){hr=gx;dZ.error("Timeout ожидания verify",eh,eh,"VerifyTimeout");
hs.reject()}},5000)})})}).then(function hn(hp){return ey.fork(hg,function(){hh=gx;return a7(hp,e0,hg)},function(){return dU(hp,e0,hl)}).tap(function(){bE().add(be(hp),gx)
}).caught(function(hq){dZ.error("Ошибка запуска инсталляции (url: "+ho+", exec2: "+hp+", args: "+e0+")",hq);return hg?eh:{code:-1}}).then(function(hq){return hh?hq:(hq.code===0)
})}).caught(function hi(){if(w){dZ.error("Ошибка установки с внешнего сервера: "+ho);delete hm.altUrl;return dl(w,hm)}return hh?{code:-1}:eh})}function gB(w,hf){if(w){var e0=cg(),hg="/quiet /norestart /uninstall "+w+" "+eb;
dZ.info("Удаление старой версии программы...");dZ.debug("Удаляем продукт с GUID "+w);return dU(e0,hg,hf).then(function(hi){var hh=hi&&hi.code;dZ.debug("Продукт с GUID "+w+" удален "+((0===hh)?"успешно.":(" с ошибкой (код: "+hh+")")));
bV().resetProgress();return hh===0}).caught(bd)}else{dZ.debug("При попытке удаления не был указан GUID");return ey.resolve()}}function gC(hf,e0){var w="";
function hg(){return ey.when(function(){return hf?cs(hf,gx):eh}).then(function(hh){if(hh&&hh.length&&(w!==hh)){w=hh;return gB(hh,e0).timeout(10).then(hg)
}return eh})}return ey.when(hg)}function fQ(e0,hg){var w=gF.distrPath+gD,hh="";try{hh=' "'+cd().$UserName+'"'}catch(hf){}return dl(ai.rootUrl+w,{altUrl:w,args:e0+hh+' "${LOGFILE}"',expanded:hg,needAdmin:gx})
}function fP(hh,e0){var w=gF.distrPath+gl,hg=gr(e0||{}),hf=encodeURIComponent(hg);dZ.debug("Запускаем TestEquipment, длина аргументов: "+hf.length,eh,eh,"te"+hh);
if(gF.winVer<700&&hf.length>1800){dZ.error("Слишком большая строка для TE.exe");return ey.resolve()}return dl(ai.rootUrl+w,{altUrl:w,args:hh+" "+hf+" "+gF.logTime,execute:{runTest:gx,testName:hh}}).then(function(hk){var hj=eh;
try{hj=fT(hk)}catch(hi){}if(hj&&hj.logs){var hl="\r\nte - ";dZ.debug("TestEquipment.Logs:"+hl+hj.logs.replace(new RegExp("\r\n","g"),hl))}else{dZ.debug('Нет данных после запуска TestEquipment с аргументами "'+hh+" "+hg+'"')
}return hj})}function dT(hi,hg,e0,hf){var w=b9(),hj=e0.length;function hh(hl){if(typeof hl=="string"){aL("wmiController.select("+hi+", "+hg+", ["+e0+"]) => "+hl);
throw a1(hl,1)}var hk=[];hl=bA(hl);for(var hn=0,ho=hl.length;hn<ho;){var hm={};for(var hp=0,hq=hj;hp<hq;++hn,++hp){hm[e0[hp]]=hl[hn]}if(hf){return hm}hk.push(hm)
}return hf?null:hk}return ey.when(function(){if(dr){throw a1("wmiController only in NP_KD",1)}if(!w){throw a1("no kd",6)}if(!hj){throw a1("row === 0",1)
}return ey.promisify(function(hl,hk){w.wmiController.select(hi,hg,e0,an(function(hm){try{hl(hh(hm))}catch(hn){hk(ep(hn))}}))},"kdWMI",20000)}).caught(function(hk){throw aL("wmiController.select("+hi+", "+hg+", ["+e0+"], callb)",hk,bd,w&&dZ.error)
})}function a8(hg,hf,w,e0){return e0?hg.ExecMethod_(hf,w,eh,ei):hg.ExecMethod_(hf,w)}function cD(e0,w,hf){return(fo[String(e0)]||e0)+(w||"").replace(es,"")+"\\"+(hf||"")
}function M(hi,hf,hj,hh,hk,e0){if(hi&&(-1!=hi)){var hg="Error call "+(e0?"x64:":"x32:")+hf,w=hg+" ("+cD(hj,hh,hk)+")";throw a1(w,(1==hi)?2:hi)}}function H(hj,w,hn,hm,hi){var hl=hi?cB():cA(),hg=hl.Methods_.Item(hj).InParameters.SpawnInstance_(),hh=("CheckAccess"===hj),hf=(!hh&&(hm||""===hm)),hk;
hg.hDefKey=w;hg.sSubKeyName=hn;if(hh){hg.uRequired=hm||3}else{if(hf){hg.sValueName=hm}}try{hk=a8(hl,hj,hg,hi)}catch(e0){M(e0?(e0.number||-1):-1,hj,w,hn,hm,hi);
return hm?eh:[]}if(hh){return hk.bGranted}M(hk.ReturnValue,hj,w,hn,hm,hi);function ho(hr){try{var hp=hr.toArray();return hp||[]}catch(hq){return[]}}if(hf){if("GetMultiStringValue"===hj){return ho(hk.sValue)
}if("GetStringValue"===hj||"GetExpandedStringValue"===hj){return hk.sValue}return hk.uValue}return ho(hk.sNames)}function eT(e0,w){if(e0&&~e0.indexOf("\\")){throw (w||a1('"\\" in valueName',1))
}}function eU(hf,e0){if((64==gF.arch)&&(gF.winVer>=600)&&(dg==hf||de==hf)){var hh=(e0||"").toUpperCase(),hi="SOFTWARE\\",hj="Wow6432Node\\";if((dg==hf)&&(hh.length>hi.length)&&(0===hh.indexOf(hi))){if(hh.indexOf(hi+"WOW6432NODE")<0){e0=hi+hj+e0.substr(hi.length)
}}else{if(de==hf){var hg=hh.indexOf("\\"),w=(hg>0)?hh.substr(0,hg):hh;if("|APPID|CLSID|INTERFACE|TYPELIB|".indexOf("|"+w+"|")>=0){e0=hj+e0}}}}return e0
}function gY(e0,hg,hf,w){if(!w){hf=eU(hg,hf)}return H(e0,hg,hf,eh,w)}function e4(hg,hf,e0){try{return bA(cC().enumKeys(hg,hf,!!e0))}catch(w){w=ep(w);if(dx(w)){throw w
}w=aL("enumKeys("+cD(hg,hf,"")+", "+e0+")",w);if(!dr){throw w}return gY("EnumKey",hg,hf,e0)}}function e5(hf,e0,w){return ey.when(function(){return bA(cC().enumValues(hf,e0,!!w))
}).caught(function(hg){hg=ep(hg);if(dx(hg)){throw hg}hg=aL("enumValues("+cD(hf,e0,"")+", "+w+")",hg);if(!dr){throw hg}return gY("EnumValues",hf,e0,w)})
}function gW(hk,hi,hg){var hj=hg?cB():cA(),hh="DeleteKey";function hl(hn){var ho=hj.DeleteKey(hk,hn);M(ho,hh,hk,hn,"",hg)}if(!hg){hi=eU(hk,hi)}try{hl(hi)
}catch(w){w=ep(w);try{var hm=e4(hk,hi,hg);if(!hm||!hm.length){throw a1("SubKeys not found",2)}bu(hm,function(hn){gW(hk,B(hi,hn),hg)});hl(hi)}catch(e0){e0=ep(e0);
try{e0.innerError=w}catch(hf){}dZ.debug("Ошибка удаления ключа реестра через WMI",e0);throw e0}}}function gX(hg,e0,hh,w){if(!w){e0=eU(hg,e0)}var hf=(w?cB():cA()).DeleteValue(hg,e0,hh);
M(hf,"DeleteValue",hg,e0,hh,w)}function e1(hf,e0,hg){e0=eU(hf,e0);try{eT(hg);c1().$RegDelete(cD(hf,e0,hg))}catch(w){if(hg&&hg.length){gX(hf,e0,hg,bd)}gW(hf,e0,bd)
}}function e2(hf,e0,w){return ey.when(function(){cC().deleteKey(hf,e0,!!w)}).caught(function(hg){aL("deleteKey("+cD(hf,e0,"")+")",hg,gx);if(w){gW(hf,e0,w)
}else{e1(hf,e0,"")}})}function e3(hf,e0,hg,w){return ey.when(function(){cC().deleteValue(hf,e0,hg,!!w)}).caught(function(hh){aL("deleteValue("+cD(hf,e0,hg)+")",hh,gx);
(w?gX:e1)(hf,e0,hg,w)})}function gZ(w,hf,e0,hg){return H(w,hf,e0,hg,bd)}function fe(hg,hi,hh,hj){hh=eU(hi,hh);if(("GetMultiStringValue"!==hg)&&("GetQWORDValue"!==hg)&&(!gF.codepage||(1251==gF.codepage))){try{eT(hj);
return c1().$RegRead(cD(hi,hh,hj))}catch(e0){if(e0&&(!e0.number||dx(e0)||dp(e0))){throw e0}return gZ(hg,hi,hh,hj)}}else{try{return gZ(hg,hi,hh,hj)}catch(hf){eT(hj,hf);
var w=c1();if(!w){throw hf}return w.$RegRead(cD(hi,hh,hj))}}}function ff(w,hf,e0,hg){return H(w,hf,e0,hg,gx)}function fd(e0,hg,hf,hh,w){return(w?ff:fe)(e0,hg,hf,hh)
}function fm(hg,hf,hh,e0){try{return cC().getStrValue(hg,hf,hh,!!e0)}catch(w){w=aL("getStrValue("+cD(hg,hf,hh)+", "+e0+")",w);if(!dr||dx(w)){throw w}return fd("GetStringValue",hg,hf,hh,e0)
}}function fn(){return parseFloat(fm(dg,eZ,aF,bd))}function fj(hg,hf,hh,e0){try{return bA(cC().getMultiStrValue(hg,hf,hh,!!e0))}catch(w){w=aL("getMultiStrValue("+cD(hg,hf,hh)+", "+e0+")",w);
if(!dr||dx(w)){throw w}return fd("GetMultiStringValue",hg,hf,hh,e0)}}function fk(hg,hf,hh,e0){try{return cC().getDwordValue(hg,hf,hh,!!e0)}catch(w){w=aL("getDwordValue("+cD(hg,hf,hh)+", "+e0+")",w);
if(!dr||dx(w)){throw w}return fd("GetDWORDValue",hg,hf,hh,e0)}}function fg(hg,hf,hh,e0){try{return bA(cC().getBinaryValue(hg,hf,hh,!!e0))}catch(w){w=aL("getBinaryValue("+cD(hg,hf,hh)+", "+e0+")",w);
if(!dr||dx(w)){throw w}return bA(fd("GetBinaryValue",hg,hf,hh,e0))}}function fh(hf,e0,hg,w){return ey.when(function(){var hh=cC().getValueType(hf,e0,hg,!!w);
switch(hh){case 1:return fm(hf,e0,hg,w);case 2:return ba(fm(hf,e0,hg,w));case 3:return fg(hf,e0,hg,w);case 4:return fk(hf,e0,hg,w);case 7:return fj(hf,e0,hg,w);
case 11:return fd("GetQWORDValue",hf,e0,hg,w);default:throw a1("regReadByType: unknown type: "+hh,1)}}).caught(function(hi){hi=aL("getValueType("+cD(hf,e0,hg)+", "+w+")",hi);
if(w){throw hi}eT(hg,hi);var hh=c1();if(!hh){throw hi}return hh.$RegRead(cD(hf,e0,hg))})}function fi(hf,e0,hg,w){return ey.fork(dO>208,function(){var hh=cC().acquireValue(hf,e0,hg,!!w);
if(("string"==typeof(hh))&&gk("^\\s*Registry type \\d+ not supported\\s*$","i")(hh)){return ey.thrown(hh,1)}return hh},ey.thrown()).caught(function(){return fh(hf,e0,hg,w)
})}function fl(hf,e0,hg,w){return ey.fork(!b9(),ey.thrown("no KD"),function(){return bA(cC().getBinaryValue(hf,e0,hg,!!w))}).then(function(hh){if(!hh||!dq(hh)||(8!=hh.length)){return ey.thrown("Bad QWORD",1)
}var hl="";for(var hj=hh.length-1;hj>=0;--hj){var hk=hh[hj];if(!hk&&!hl.length){continue}var hi=hk.toString(16);if(hi.length<2){hi="0"+hi}hl+=hi}return hl.length?("0x"+hl):hl
}).caught(function(hh){hh=aL("regReadQWord("+cD(hf,e0,hg)+")",hh);if(!dr||dx(hh)){throw hh}return ey.when(function(){return fd("GetQWORDValue",hf,e0,hg,w)
}).then(function(hi){return"0x"+Number(hi||"0").toString(16)})})}function fb(hj,hi,e0,hg,hf,hk){var hh={d:1,s:2,e:4,b:8,q:16,m:32};function w(hl){var hm=0;
bu(hl,function(hn){hm+=hh[hn]||0});if(!hm){throw a1("regMassRead(mask:"+hl+"): wrong mask",1)}return hm}return ey.when(function(){if(dO<206){throw a1("kd build: "+dO+"; Needed: 2.6+",1)
}try{var hp=cC().massRead(hj,hi,e0,w(hg),!!hf),ho=(hp||"").replace(new RegExp("([\\]\\}])\\s*,\\s*([\\]\\}])","g"),function(hr,hs,ht){return hs+ht}),hq=fT(ho),hn=hq&&hq.errors;
if(hn&&hn.length){hk=hk||{};var hm=[];bu(hn,function(hs,ht){var hr=hs.win32_error;if(!hk[hr]){hm.push((1+ht)+". "+hs["function"]+" "+hs.key+" "+hr)}});
if(hm.length){dZ.debug("massRead("+cD(hj,hi)+", "+e0+", "+hg+", "+hf+") has errors:");bu(hm,dZ.debug)}}return hq.tree}catch(hl){throw aL("massRead("+cD(hj,hi)+", "+hf+")",hl,gx)
}})}function g0(hj,hg,hm,hl,hk,e0){var hh=e0?cB():cA(),hf,hi=-1;if(!hh){throw a1("wmiRegWrite: stdRegProv is null",hi)}try{hh.CreateKey(hj,hg)}catch(w){}if(eN===hk){hf="SetDWORDValue";
hi=hh.SetDWORDValue(hj,hg,hm,hl)}else{if(eQ===hk){hf="SetQWORDValue";hi=hh.SetQWORDValue(hj,hg,hm,hl.toString())}else{if(eM===hk){hf="SetBinaryValue";hi=hh.SetBinaryValue(hj,hg,hm,p(hl))
}else{if(eO===hk){hf="SetExpandedStringValue";hi=hh.SetExpandedStringValue(hj,hg,hm,hl)}else{if(eR===hk){hf="SetStringValue";hi=hh.SetStringValue(hj,hg,hm,hl)
}else{if(eP===hk){hf="SetMultiStringValue";hi=hh.SetMultiStringValue(hj,hg,hm,hl)}else{throw a1("wmiRegWrite: unsupported type: "+hk,hi)}}}}}}M(hi,hf,hj,hg,hm,e0);
return hi}function fA(hj,hi,hm,hl,hk){hi=eU(hj,hi);try{if(eM==hk||eP==hk||eQ==hk){throw a1(hk+" isn't supported by WS",1)}eT(hm);var hh=cD(hj,hi,""),w=c1();
try{g5.$RegRead(hh)}catch(e0){try{w.$RegWrite(hh,"",eR)}catch(hf){}}w.$RegWrite(cD(hj,hi,hm),hl,hk);return 0}catch(hg){return g0(hj,hi,hm,hl,hk,bd)}}function fB(e0,w,hh,hg,hf){return g0(e0,w,hh,hg,hf,gx)
}function fz(hg,e0,hj,hi,hh,w){var hf=(w?fB:fA)(hg,e0,hj,hi,hh,w);if(hf!==0){throw a1("regWrite failed with code "+hf,hf)}}function fD(hk,hg,hm,hl,hj,hf){var hh=B(cd().$System32,"reg.exe"),hi=fo[String(hk)]+(hg||"").replace(es,""),w='add "'+hi+'" /v "'+hm+'" /t '+hj+" /d "+hl+" /f",e0=+fO(hh,{args:w,wait:gx});
if(0!==e0){throw a1("Ошибка reg.exe "+hf,e0)}dZ.debug("Успешно записали "+hj+" с помощью reg.exe")}function e(hg,e0,hi,hh,hf,w){return ey.when(cd).then(function(hj){var hl=B(hj.$System32,"reg.exe"),hm=fo[String(hg)]+(e0||"").replace(es,""),hk='add "'+hm+'" /v "'+hi+'" /t '+hf+" /d "+hh+" /f";
return fO(hl,{args:hk,wait:gx}).waitExit().then(function(ho){var hn=ho.exitCode();if(0!==hn){throw a1("Ошибка reg.exe "+w,hn)}dZ.debug("Успешно записали "+hf+" с помощью reg.exe")
})})}function fI(hg,hf,hi,hh,e0){try{cC().setStrValue(hg,hf,hi,hh,!!e0)}catch(w){aL("setStrValue("+cD(hg,hf,hi)+', "'+hh+'", '+e0+")",w);fz(hg,hf,hi,hh,eR,e0)
}}function fE(hg,hf,hi,hh,e0){try{cC().setExStrValue(hg,hf,hi,hh,!!e0)}catch(w){aL("setExStrValue("+cD(hg,hf,hi)+', "'+hh+'", '+e0+")",w);fz(hg,hf,hi,hh,eO,e0)
}}function fG(hg,hf,hi,hh,e0){try{cC().setDwordValue(hg,hf,hi,hh,!!e0)}catch(w){aL("setDwordValue("+cD(hg,hf,hi)+", "+hh+", "+e0+")",w);fz(hg,hf,hi,hh,eN,e0)
}}function fH(hg,e0,hi,hh,w){var hf=cD(hg,e0,hi);return ey.when(function(){return fz(hg,e0,hi,hh,eQ,w)}).caught(function(hj){var hk="при записи в "+hf+", тип "+eQ+", значение "+hh;
if(cZ()){dZ.debug("Ошибка WMI "+hk,hj)}return e(hg,e0,hi,hh.toString(),eQ,hk)})}function fC(hg,hf,hi,hh,e0){try{cC().setBinValue(hg,hf,hi,hh,!!e0)}catch(w){aL("setBinValue("+cD(hg,hf,hi)+', "'+hh+'", '+e0+")",w);
fz(hg,hf,hi,hh,eM,e0)}}function fF(hk,hh,hm,hl,hg){if(!hg){hh=eU(hk,hh)}var hj=cD(hk,hh,hm);try{cC().setMultiStrValue(hk,hh,hm,hl,!!hg)}catch(w){var hi=(hl||[]).join(", ");
aL("setMultiStrValue("+hj+', "'+hi+'", '+hg+")",w);try{g0(hk,hh,hm,hl,eP,hg)}catch(e0){var hf="при записи в "+hj+", тип "+eP+", значение "+hi;if(cZ()){dZ.debug("Ошибка WMI "+hf,e0)
}fD(hk,hh,hm,'"'+hl.join("\\0")+'"',eP,hf)}}}function f(hh,e0,hj,hi,w){if(!w){e0=eU(hh,e0)}var hg=cD(hh,e0,hj),hf=(hi||[]).join(", ");return ey.when(function(){cC().setMultiStrValue(hh,e0,hj,hi,!!w)
}).caught(function(hk){aL("setMultiStrValue("+hg+', "'+hf+'", '+w+")",hk);g0(hh,e0,hj,hi,eP,w)}).caught(function(hk){var hl="при записи в "+hg+", тип "+eP+", значение "+hf;
if(cZ()){dZ.debug("Ошибка WMI "+hl,hk)}return e(hh,e0,hj,'"'+hi.join("\\0")+'"',eP,hl)})}function fr(hf,e0,hg,w){return ey.when(function(){return cC().setOwner(hf,e0,hg,!!w)
})}function fq(hg,hf,hh,w,e0){if(w<0){w=w+4294967295+1}return ey.when(function(){return cC().setSecurity(hg,hf,hh,w,!!e0)})}function e6(hf,e0,w){return ey.when(function(){return cC().getSecurity(hf,e0,!!w)
})}function cF(){return ey.when(function(){if(gF.csp30||gF.csp36){throw a1("KD miss cpssl packet",120)}return fT(b9().sysAcquireSecurityPackages())}).map(function(w){return w.name
}).caught(function(w){if(b9()&&(!w||(w.number!=120))){dZ.error("sysAcquireSecurityPackages",w,eh,"ASP")}throw w})}var ek,el,cm=eh;function dk(){ek={};el={};
function w(hi,hg){if(!hi.key||(hi.key.search(/!5|!7/)<0)){return}var hh=hg[hi.key]={};bu(hi.values,function(hk){var hj=hk.value;if(hj instanceof Array){hj=hj.join(",")
}hh[hk.name]=hj})}function hf(hh){var hg=fu+ai.regOidPath;return ey.fork(b9(),function(){return fb(dg,hg,2,"dsb",hh,{2:gx})},ey.thrown()).caught(function(){var hi=[];
return ey.when(function(){return e4(dg,hg,hh)}).caught(function(hj){if(!dx(hj)){dZ.error("Ошибка перечисления OID-ов (x64 = "+hh+")",hj)}return[]}).each(function(hj){var hk=[];
return e5(dg,hg+hj,hh).caught(function(hl){if(!dx(hl)){dZ.error("Ошибка перечисления OID-ов (key = "+hj+", x64 = "+hh+")",hl)}return[]}).each(function(hl){var hm={cpextrainfo:fk,extrainfo:fg,name:fm}[(hl||"").toLowerCase()];
if(!hm){return ey.$continue()}return ey.when(function(){return hm(dg,hg+hj,hl,hh)}).then(function(hn){hk.push({name:hl,value:hn})}).caught()}).then(function(){hi.push({key:hj,values:hk})
})}).then(function(){return{subkeys:hi}})}).then(function(hi){bu(hi.subkeys,function(hj){w(hj,hh?el:ek)})})}var e0=(64==gF.arch);return hf(bd).fork(e0,x(this,hf,gx)).then(function(){cm=function(hg,hh){return hh?el[hg]:ek[hg]
}})}function R(hf,w,e0){if(e0){cm=ek=el=eh}return ey.fork(!cm,dk).then(function(){var hk=(hf.indexOf("!")>=0);if("string"==typeof(w)){w={Name:w};if(!hk){hf+="!7"
}}else{if(!hk){hf+="!5"}}var hl=(64==gF.arch);function hg(hn,hm,hr){var ho=cm(hf,hr),hp=ho&&(hm==ho[hn]);if(!hp){var hq=fu+(hr?"Wow6432Node\\":"")+ai.regOidPath;
throw a1('Ожидали "'+hm+'", получили "'+(ho?ho[hn]:"null")+'", путь: '+hq)}}for(var hj in w){var hh=w[hj];if(hh instanceof Array){hh=hh.join(",")}else{var hi=typeof(hh);
if("string"!==hi&&"number"!==hi){continue}}hg(hj,hh,bd);if(hl){hg(hj,hh,gx)}}})}function g4(hg,w){if("string"==typeof(w)){w={Name:w};hg+="!7"}else{hg+="!5"
}var e0=(64==gF.arch),hh=fu+ai.regOidPath+hg+"\\",hf=eh;return ey.each(w,function(hk,hl){var hm;if("string"==typeof(hl)){hm=fI}else{if("number"==typeof(hl)){hm=fG
}else{if(hl instanceof Array){hm=fC}else{return}}}try{hm(dg,hh,hk,hl,e0)}catch(hi){hf=ep(hi)}if(e0){try{hm(dg,hh,hk,hl,bd)}catch(hj){hf=ep(hj)}}}).then(function(){if(hf){throw hf
}})}function cW(hf){if(!hf&&gF.userSID){return gF.userSID}try{var hi=eZ+"ProfileList\\",hg=(64==gF.arch),hk=e4(dg,hi,hg);if(!hk||!hk.length){return eh}var hh=cd(),hn=(hh.$UserProfile||"").replace(new RegExp("\\\\+$"),""),hl=hn?hn.slice(hn.lastIndexOf("\\")+1):hh.$UserName,hm=gk("[^:]\\\\"+a6(hl)+"($|\\.|\\\\)","i"),w=eh,hj=eh;
bu(hk,function(hr){try{var hp=hi+hr+"\\",hq=fm(dg,hp,"ProfileImagePath",hg);if(hq&&hm(hq)){if(!hj||!w||(w.length>hq.length)){w=hq;hj=hr}}}catch(ho){}});
gF.userSID=hj;return hj}catch(e0){dZ.debug("Ошибка получения SID текущего пользователя",e0)}return eh}function ac(hg,w,e0){e0=((e0&&e0.length)?(", called in "+e0):"");
if(!hg){dZ.error("compareVersion("+((w&&w.length)?("current: '"+w+"'"):"")+"): expected is NULL or empty"+e0);return gx}if(!w){dZ.error("compareVersion(expected: '"+hg+"'): current is NULL or empty or object"+e0);
return bd}var hk=w.split("."),hh=hg.split("."),hl=hk.length,hm=hh.length;for(var hi=0,hj=hl<hm?hl:hm;hi<hj;++hi){var hf=hk[hi]-hh[hi];if(0!==hf){return(hf>0)
}}return(hl>=hm)}function aa(hf,e0){if(!hf||!hf.length){dZ.debug("compareDate: expected is NULL or empty");return(e0&&e0.length)?1:0}if(!e0||!e0.length){dZ.debug("compareDate: actual is NULL or empty");
return -1}var hh=function(hi){return Number(gu(hi).split(" ")[0].split(new RegExp("[\\.\\-\\/]+","g")).reverse().join(""))},hg=hh(hf),w=hh(e0);return w-hg
}function gJ(hg){hg=Number(hg);var w=hg>>24,e0=(hg>>16)-(w<<8),hf=hg%65536;return w+"."+e0+"."+hf}function aK(w){if(!w){return""}if(8!=w.length){return w
}return w.substr(6)+"."+w.substr(4,2)+"."+w.substr(0,4)}var ew={},ex={},m=bd,fw=eY+"Uninstall\\",fx=eY+"Installer\\UserData\\",c5=new RegExp("\\{[0-9A-F]{8}\\-([0-9A-F]{4}\\-){3}[0-9A-F]{12}\\}","i");
function dv(hf){var w="S-1-5-18";try{if(dD(w,hf)){return gx}else{return dD(cW(),hf)}}catch(e0){return bd}}function dD(hh,e0){var hf=(64==gF.arch),hg="\\Products\\"+fM(e0)+"\\InstallProperties\\";
try{fm(dg,fx+hh+hg,"DisplayName",hf);return gx}catch(w){return bd}}function cu(hh,e0,w,hf){var hg=fw+e0+"\\";return ey.fork("Version"===w,function(){return fh(hh||dg,hg,w,hf||bd)
}).then(function(){return fm(hh||dg,hg,w,hf||bd)})}function b5(hf,w,e0,hg){return ey.fork(m,function(){return cu(dg,hf,e0||w,hg)},function(){return b3().then(function(hh){return hh.getAsync("ProductInfo",[hf,w])
})}).caught(eh)}function b2(w,e0){return ey.resolve(ew[w].InstallDate).lie(function(){return ey.all(b5(w,"InstallDate",eh,e0),b5(w,"LocalPackage",eh,e0).then(function(hf){return be(hf).get("fed")
})).spread(function(hf,hh){hf=aK(hf);if(hf&&hh&&hh.exist&&ai.formatDate){var hg=ai.formatDate(new Date(hh.dateCreated),bd,bd);if(hg&&hg.length&&aa(hf,hg)>=0){return hg
}hg=ai.formatDate(new Date(hh.dateOpened),bd,bd);if(hg&&hg.length&&(hf.split(" ")[0]==hg.split(" ")[0])){return hg}}return ew[w].InstallDate=hf})})}function b4(w,e0){return ey.resolve(ew[w].Location).lie(function(){return b5(w,"InstallLocation",eh,e0).then(function(hf){return ew[w].Location=hf
})})}function ct(w,hf,e0){if(hf){ew={};ex={}}return ey.resolve(ex[w]).truth(function(hg){return ew[hg]},function(){var hk=[],hj="0.0.0",hh=("string"==typeof(w))?new RegExp(w,"i"):w,hi=(64==gF.arch);
function hg(hn,hl){var hm=ew[hn];hl=hm&&hm.isX64||hl;return ey.when(function(){return hm&&hm.Name||b5(hn,"ProductName","DisplayName",hl)}).then(function(hp){if(hp&&!hm){hm=ew[hn]={Guid:hn,isX64:hl,Name:hp}
}if(hp&&hh&&hh.test(hp)){var hq;var ho=function(){return ey.fork(ac(hj,hq),function(){hj=hq;return ey.all(b4(hn,hl),b2(hn,hl))}).then(function(){if(e0){return b2(hn,hl).then(function(hr){hk.push({Name:hp,Version:hq,InstallDate:hr});
hk=hk.sort();ew[hn].Versions=hk;ex[w]=hn})}else{if(!ex[w]||(hj==hq)){ex[w]=hn}}return eh})};return ey.when(function(){return hm&&hm.Version||b5(hn,"VersionString","DisplayVersion",hl)
}).truth(function(hr){hq=hr;ew[hn].Version=hq=hq.replace(new RegExp("[^\\d\\.]","g"),"");return ho()},ey.thrown()).caught(function(){if(!hm||!ew[hn].Version){hq=gK(b5(hn,"Version",eh,hl));
ew[hn].Version=hq}return ho()}).caught(function(){return ey.all(b4(hn,hl),b2(hn,hl)).then(function(){ex[w]=hn})})}return eh})}return ey.each(ew,function(hl){return hg(hl).then(ey.next(gx))
},bd).lie(function(){return ey.resolve(m?eh:b3()).truth(function(hl){return hl.getAsync("Products").then(function(hm){return ey.all(hm,hm.getAsync("Count"))
}).spread(function(ho,hm){var hn=-1;return ey.each(function(){++hn;if(hn<hm){return ho.getAsync("item",[hn])}else{return ey.$break()}},hg)}).caught(function(hm){dZ.error("Ошибка получения списка продуктов через Windows Installer",hm);
return ey.thrown(hm)})},ey.thrown("altProductMode OR (installer == NULL)",1)).caught(function(){m=gx;function hl(hm){return ai.$regEnumKeys(dg,fw,hm).each(function(hn){if(hn&&(38==hn.length)&&c5.test(hn)){return ai.$regReadNumber(dg,fw+hn,"WindowsInstaller",hm).caught(-1).then(function(ho){if((ho!=1)||dv(hn)){return hg(hn,hm)
}return eh})}return eh}).caught()}return hl(bd).fork(hi,G(hl,gx))}).caught(function(hl){dZ.error("Ошибка получения списка продуктов через реестр",hl)})
}).then(function(){return ew[ex[w]]})}).caught(eh)}function cs(w,e0){return ey.when(ct,w,e0).then(function(hf){return hf&&hf.Guid})}function cy(w,e0){return ey.when(ct,w,e0).then(function(hf){return hf&&hf.Name
})}function cz(w,e0){return ey.when(ct,w,e0).then(function(hf){return hf&&hf.Version})}function cr(w,e0){return ey.when(ct,w,e0,gx).then(function(hf){return hf&&hf.Versions
})}function cx(w,e0){return ey.when(ct,w,e0).then(function(hf){return hf&&hf.Location})}function cv(w,e0){return ey.when(ct,w,e0).then(function(hf){return hf&&hf.InstallDate
})}function bp(e0,w,hf){e0=new RegExp(e0,"i");return ey.when(cs,e0,gx).truth(function(hg){return b3().truth(function(hh){return hh.getAsync("ComponentPath",[hg,w])
},ey.thrown()).caught(function(){var hj=eY+"Installer\\UserData\\",hk=fM(w),hi=fM(hg),hh=(64==gF.arch);return ai.$regEnumKeys(dg,hj,hh).each(function(hl){return ai.$regReadString(dg,hj+hl+"\\Components\\"+hk,hi,hh).truth(ey.$break).caught()
},"")}).truth(function(hh){return hf?hh:aW(hh)},"")},"")}function gK(hg){var w=(hg>>24),e0=(hg>>16)-(w<<8),hf=hg%65536;return w+"."+e0+"."+hf}function d8(hf,w){if(!hf||hf==w){return w
}if(!w){return hf}var e0=ac(hf,w);return e0?w:hf}function fL(w){return w.split("").reverse().join("")}function fM(w){w=w.replace(new RegExp("[}{]","g"),"");
var hf=fL(w.substr(0,8));hf+=fL(w.substr(9,4));hf+=fL(w.substr(14,4));hf+=fL(w.substr(19,2));hf+=fL(w.substr(21,2));for(var e0=24;e0<36;e0+=2){hf+=fL(w.substr(e0,2))
}return hf}function eI(hs,hh,hf){if(!hh||!hf){return ey.resolve(bd)}if(!b9()&&(!bY()||(!cB()&&!c1()))){return ey.resolve(bd)}var hr=fM(hh),hk=(64==gF.arch),hm="",hn=(hs||"S-1-5-18"),hq=eY+"Installer\\UserData\\"+hn+"\\Products\\",ho=hq+hr+"\\InstallProperties\\";
try{hm=fm(dg,ho,"LocalPackage",hk)}catch(e0){}var hl=bS(hm);if(!hl.exist){return ey.resolve(bd)}var hj="";try{hj=fm(dg,ho,"InstallSource",hk)}catch(e0){}if(!hj){return ey.resolve(bd)
}function hp(){var ht='InstallFixer "'+hn+'" '+hr+' "'+B(hj,hf)+'"';return ey.all(fQ(ht),hj)}if("\\\\"===hj.substr(0,2)){hj=bE().getFreePath();if("\\"!==hj.charAt(hj.length-1)){hj+="\\"
}try{fI(dg,ho,"InstallSource",hj,hk)}catch(e0){return hp()}}var hi=bW(hj);if(!hi.exist){try{hi.create()}catch(e0){return hp()}}var hg=B(hj,hf);if(bS(hg).exist){return ey.resolve(gx,hj)
}try{hl.copy(hg);return ey.resolve(gx,hj)}catch(w){dZ.error('Не удалось скопировать файл инсталлятора из "'+hm+'" в "'+hg+'"',w);return ey.resolve(bd,hj)
}}da.CSPVersionDetect=function(){var hh=eh,e0="err",w="",hf=bd,hg=gF.productMasks;return cr(hg.CSP).then(function(hk){if(hk&&hk.length&&hk[0]&&hk[0].Name){var hi=new RegExp("with Rutoken support|Единый инсталлятор для","i"),hj=[];
bu(hk,function(hl){if(!hi.test(hl.Name)){hj.push(hl)}});hk=hj}return ey.fork(!hk||!hk.length,function(){hk=[];var hl=[gF.licenseCSP50Guid,gF.licenseCSP40Guid,gF.licenseCSP39Guid,gF.licenseCSP36Guid,"{247F4CC0-723C-40A5-9A38-E2E2C24DEB46}"];
return ey.each(hl,function(hm){return ey.all(cu(dg,hm,"DisplayVersion",gx),cu(dg,hm,"InstallDate",gx)).spread(function(ho,hn){if(ho&&hn){hk.push({Version:ho,InstallDate:aK(hn)})
}}).caught()})}).then(function(){if(hk.length){hf=(hk.length>1);hh=hk[0].Version;w=hk[0].InstallDate;for(var hl=1,hm=hk.length;hl<hm;++hl){var ho=hk[hl].Version,hn=hk[hl].InstallDate;
if(w&&hn&&(aa(w,hn)>=0)){hh=ho;w=hn}else{if((!w||!hn||w==hn)&&ac(hh,ho)){hh=ho;w=hn}}}}e0=(parseInt(hh)===0?"err":hh)||(gF.noSse2?"sse2":"not")})}).caught(function(hi){dZ.debug("Ошибка определения версии КриптоПро",hi)
}).then(function(){function hj(hl){return cu(dg,hl,"Version",bd).then(function(hm){switch(hm){case 33554432:return 2049;case 33556532:return 2100;case 33556536:return 2104;
default:return(hm>=33554432)?(hm-33554432):0}},0)}var hi="{02CB7B88-4F11-4575-A1BB-103A40B83A4D}",hk="{A4D03E85-CDD1-4A49-941E-7C566DC2BA78}";return ey.all(hj(hi),hj(hk)).spread(function(hm,hn){if((0===hm)&&(0===hn)){throw new Error()
}hh="";if(0!==hm){hh="2.0."+hm+" CSP"}if(0!==hn){hh+=(hh?", ":"")+"2.0."+hn+" TLS"}var hl=eh;return cu(dg,hi,"InstallDate",bd).then(function(ho){hl=ho;
if(!hl){hl="";throw new Error()}hl=aK(hl)}).caught(function(ho){dZ.debug("Ошибка получения даты установки КриптоПро 2.0",ho)}).then(function(){var ho=(!e0||"err"===e0||"not"===e0);
if(!ho&&(0!==hm)){hf=gx}if(ho||(0!==hm&&aa(w,hl)>0)){e0=hh;w=hl}})})}).caught(function(){if(!e0||"err"==e0){e0="not"}}).then(function(){gF.cspVersion=e0;
gF.cspInstallDate=w;gF.manyCryptoProDetected=hf})};var aN=32,aO=128,aP=1000,eu=dr?[dS,gV,g6]:[dS];function dS(w,hg,hk,e0){hg=hg||aN;hk=hk||aO;var hj={Name:w,Len:hg,TTLMax:hk},hi=0,hh;
try{hi=cN();hh=b9().ping(w,hg,hk,aP,e0);hi=cN()-hi}catch(hf){hf=ep(hf);hh=eh;if(hf&&(-2147013886==hf.number||-2147013846==hf.number||2147953410==hf.number||2147953450==hf.number)){hj.Status=11010
}else{hj.Status=1;aL("ping("+[w,hg,hk,aP,e0].join(", ")+")",hf)}}if(hh){hj.Status=hh.status;if(hj.Status===0){hj.Time=hi;hj.TTL=hh.TTL}hj.IP=hh.IP}return hj
}function gV(w,hh,hl,e0){var hj="SELECT * FROM Win32_PingStatus WHERE Address='"+w+"'",hi;if(hh&&hh!=aN){hj+=" AND BufferSize="+hh}if(hl&&hl!=aO){hj+=" AND TimeToLive="+hl
}if(e0){hj+=" AND NoFragmentation=TRUE"}try{if(!cZ()){throw new Error()}hi=gR(hj,eh,gx)}catch(hf){hi=eh}var hk={Name:w,Status:11010,Len:hh||aN};if(hi){try{hk.IP=hi.ProtocolAddress;
hk.Status=hi.StatusCode;hk.Name=hi.Address||w;if(hk.Status===0){hk.Time=hi.ResponseTime;hk.TTL=hi.ResponseTimeToLive}hk.TTLMax=hi.TimeToLive||aO}catch(hg){dZ.debug("Ошибка пинга "+w+"через WMI",hg)
}}return hk}function g6(w,hg,hi,hf){var e0=w+" -n 1";if(hg){e0+=" -l "+hg}hg=hg||aN;if(hi){e0+=" -i "+hi}if(hf){e0+=" -f"}var hh={Name:w,Status:11010,Len:hg,TTLMax:hi||255};
return cR("locator").then(function(hj){return a7(B(hj.$System32,"ping.exe"),e0,{charset:866})}).lie(hh,function(hj){var hk=w.replace(new RegExp("\\.","g"),"\\.").replace(new RegExp("\\-","g"),"\\-"),hm="(\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})",hn=new RegExp("\\s"+hk+"\\s*\\["+hm+"\\]","i").exec(hj);
if(hn&&hn.length>1){hh.IP=hn[1]}if(gk("Request timed out|General failure|Превышен интервал|Общий сбой","i")(hj)){return hh}var hl=hj.indexOf("Ответ от");
if(hl<0){hl=hj.indexOf("Reply from");if(hl<0){hh.Status=1;return hh}}hj=gu(hj.substr(hl).split("\n")[0]);var ho=new RegExp(hm+"\\:[^=]+\\=(\\d+)[^=\\d]+\\=(\\d+)[^=\\d]+=(\\d+)","i").exec(hj);
if(ho&&ho.length>4){hh.Status=0;hh.IP=ho[1];hh.Time=ho[3];hh.TTL=ho[4];return hh}var hp=new RegExp(hm+"\\:","i").exec(hj);if(hp&&hp.length>1){hh.IP=hp[1];
hh.Status=11013;return hh}hh.Status=1;return hh})}function et(hg){var w=hg.addr,hi=hg.size,hk=hg.tries||3,hl=hg.ttl,e0=!!hg.df,hf=hg.ignoreBadStatus,hh={},hj=1;
hi=hi===gx?1372:(hi||eh);return ey.each(hk,function(){return ey.each(eu,function(hn,hm){return ey.when(hn,w,hi,hl,e0).then(function(ho){if(ho&&(!hh.IP||!hh.IP.length||(ho.IP&&ho.IP.length))){hh=ho
}hj=hh.Status===0?0:1;if((0===hj)||hf){if((0===hj)&&hm){gj(eu,hm)}return ey.$break(ey.$break)}return eh})})}).then(function(){hh.State=hj;return hh})}function gm(hl,e0){var hh=eh,hf=1,hg="",hj="",w=0,hk=cN();
return fW({method:e0&&e0.method||"HEAD",url:hl,timeout:e0&&e0.timeout||20000,onlyServer:e0?e0.onlyServer:bd,proxyMode:e0?e0.proxyMode:eh,ignoreSslErrors:e0?e0.ignoreSslErrors:eh,connectionClose:e0?e0.connectionClose:bd,data:e0&&e0.size?{data:by(e0.size)}:eh}).caught(function(hn,hm){hh=(g7.NoMsXml==hm)?("nomsxml"+(gF.arch||"")):{Server:hl,Status:"err"};
w=hm;return hn}).then(function hi(hq){if(hq&&(g7.NoMsXml!=w)&&(!hh||w<0)){var hp=(g7.Timeout==w),ho="Не удалось получить результат теста порта",hs=function(ht){return dZ[(ht&&(-1072954817==ht.number||3222012479==ht.number))?"debug":"error"]
};if(!hp){try{hf=hq.status;hg=hq.statusText}catch(hn){hs(hn)(ho+" (responseStatus)",hn)}}if(!hh){hh={Server:hl,Status:hf}}if(("err"===hh.Status)&&hf){hh.Status=hf
}hh.Data="";if(!hp&&e0&&e0.returnStatusText){hh.StatusText=hg}hh.Time=Math.max(0,cN()-hk);if(!hp){try{hh.Data=fJ(hq.getAllResponseHeaders(),gx)}catch(hm){hs(hm)(ho+" (responseData)",hm)
}try{hj=hq.responseText;if(hj&&hj.length){hh.Body=hj.length<=300?hj:hj.substr(0,300)}}catch(hr){hs(hr)(ho+" (responseText)",hr)}}if((w>=0)||(4==hq.readyState)){w=((hf>=400)&&!({401:1,404:1,405:1}[hf]))?1:0
}if(!dr&&!w&&!hf&&!hh.Data){w=1;hh.Data="xhr"}}return ey.args(hh?w:g7.Timeout,hh)}).caught(function(hm){hh={Server:hl,Status:(hm&&ga(hm)||"err")};return ey.args(hh?g7.Error:g7.Timeout,hh)
})}function gn(hg,e0,hf,w){return ey.promisify(function(hi,hh){b9().testServerConnection(hg,e0,hf,an(function(hl,hj){try{hi({certificateInfo:hl.certificateInfo?{issuer:hl.certificateInfo.issuer,oid:hl.certificateInfo.oid,subject:hl.certificateInfo.subject,validFrom:hl.certificateInfo.validFrom,validTo:hl.certificateInfo.validTo}:gA,errorCode:hl.errorCode,headers:hl.headers,serverIP:hl.serverIP},Number(hj||0))
}catch(hk){hh(hk)}}),w?1:0)},eh,hf+2000)}function by(hf){var w=s.substr(0,62)+"-_",e0=fK(w,hf>>6);return(hf&63)?(e0+w.substr(0,hf&63)):e0}function fK(e0,w){return new Array(w+1).join(e0)
}function cK(hg,e0){if(!hg){return e0?"0 байт":""}if(hg!=Number(hg)){return hg}var hh=["байт","КБ","МБ","ГБ","ТБ"],w=0,hf=hg;while(hf>=1024){hf/=1024;++w
}if(w>1){hf=Math.floor(hf*100)/100}else{if(w>0){if(hf>990){hf=1;++w}else{hf=Math.floor(hf)}}}return hf+" "+hh[w]}function b6(w,hh,hk){var hl=hk.single,hj=hk.one;
if(w<1){return hh?hk.last:[hl,"1",hj].join(" ")}var hi=w%100,hf=hi%10,e0=hk.many,hg=((11!=hi)&&(1==hf))?hl:hk.multiple;if((hi<11)||(hi>14)){if(1==hf){e0=hj
}else{if(hf>=2&&hf<=4){e0=hk.little}}}return[hg,w,e0].join(" ")}function bO(w,e0){return b6(w,e0,{single:"остался",multiple:"осталось",one:"день",little:"дня",many:"дней",last:"сегодня последний день"})
}function bR(w,e0){if(w<31){return bO(w,e0)}if(w<367){return b6(Math.floor(w/30),bd,{single:"остался",multiple:"осталось",one:"месяц",little:"месяца",many:"месяцев"})
}return b6(Math.floor(w/365),bd,{single:"остался",multiple:"осталось",one:"год",little:"года",many:"лет"})}da.runFixFromComment=function(w,hj,hm){if(!gF.diagnostics||("function"!=typeof(gF.diagnostics.getFixer))){gM.alert("Не удалось запустить настройку");
return bd}var hk=hm?hm.hideHelp:bd,hl=hm?hm.hintText:bd,hg=hm?hm.enterText:eh,hf=hm?hm.enterLater:bd,hh=hm&&hm.externalArgs||{},hi=bV(),hn=hi.getFix(hj),e0=function(hy){if(hy&&!hy.code){var hq=hi.getFix(hj);
if(hq&&hq.license){var ht=hq.license,hs=ht.replace(new RegExp("(^\\-|\\-$)","g"),"").length,hz="window.SkbKontur.Help.View",hv=hz+".enterLicense(this, '"+hj+"','"+ht+"-', true)",hr='<div class="diag-fix-license" id="diag-fix-lic-'+ht+'-">';
hr+=(hg||"Для регистрации, пожалуйста, введите серийный номер");if(!hk){var hx="window.alert('"+(hl||ai.cspSerialHint)+"'); return false";hr+='<div class="help-button" onclick="'+hx+'">';
hr+="</div>"}hr+=':<br/><input type="text" id="'+ht+'-" style="border-color: #EEEEEE"';hr+=" onkeydown=\"var ev = window.event; if (ev && (13 == ev.keyCode || '13' == ev.which)) {"+hv+'; return false; }"';
hr+=' size="'+Math.ceil(hs*4/3)+'" maxlength="'+(hs+10)+'"/>';hr+='&nbsp;<input type="button" value="Ввести"';hr+=' onclick="return '+hv+'"/>';if(hf){var hw=hz+".skipLicense('"+hj+"','"+ht+"-')";
hr+='&nbsp;&nbsp;<a href="#" onclick="return '+hw+'">Ввести&nbsp;позже</a>'}hr+="</div>\r\n";if(w){w.outerHTML=hr}var hp=document.getElementById(ht+"-");
if(hp){try{hp.focus()}catch(ho){}}}else{var hu="Настроено";if(hq){if(hq.needreboot){hu+=", необходимо вручную перезагрузить компьютер"}else{if(hq.needrestart){hu+=", необходимо перезапустить браузер"
}}}if(w){w.outerHTML=hq&&hq.licenseresult||hu}hi.removeFix(hq)}}else{if(w){w.outerHTML="Не удалось настроить"}}gF.blockModalWindow=bd};gF.blockModalWindow=gx;
if(hn&&hn.license){hh.runFromComment=gx}if(w){w.onclick=eh;w.style.textDecoration="none";w.style.color="gray";w.innerHTML="Настройка...";hh.statusObj=w
}gt("FixCommentRun",hj);hi.runFix(hj,e0,hh);return bd};function gr(hi){var hh=typeof(hi),hg=[];if("string"===hh){hi=(hi||"").replace(new RegExp("\\\\","g"),"\\\\");
hi=hi.replace(new RegExp('\\"',"g"),'\\"');hi=hi.replace(new RegExp("\\r","g"),"\\r");hi=hi.replace(new RegExp("\\n","g"),"\\n");return'"'+hi+'"'}if(("number"===hh&&isFinite(hi))||"boolean"===hh||dw(hi)){return hi.valueOf()
}if(hi instanceof Array){for(var w=0,e0=hi.length;w<e0;++w){hg.push(gr(hi[w]))}return"["+hg.join(",")+"]"}if("object"===hh){for(var hf in hi){hg.push(gr(hf)+":"+gr(hi[hf]))
}return"{"+hg.join(",")+"}"}return"null"}function bU(w,hi,hm){hi=(hi||"Настроить");var hl="return SkbKontur.Help.runFixFromComment(this,'",hf=("string"==typeof(w)),e0=!hf&&(w instanceof da.Fix),hg=hf&&di.test(w);
if(hg||(hm&&hm.url)){var hj=e0?w.url:w,hh=e0?w.name:a6(w),hk="try { SkbKontur.Help.Core.trackEvent('FixCommentUrl', '"+hh+"'); } catch(e) {} return true";
return'<a rel="noopener" target="_blank" href="'+hj+'" onclick="'+hk+'">'+hi+"</a>"}if(e0){hl+=w.name}else{if(hf){hl+=w}else{dZ.error('Ошибка создания ссылки с настройкой "'+hi+'", т.к. объект не является Fix');
return""}}hl+=hm?("',"+gr(hm).replace(new RegExp('\\"',"g"),"'")+")"):"')";return'<a href="#" onclick="'+hl+'">'+hi+"</a>"}function f5(hg,hh,hj,hf,hi,e0,w,hk,hl){function hm(hq,hp){var ho=eV+hp+"\\";
fG(hq,ho,"EditFlags",2,bd);fI(hq,ho,"URL Protocol","",bd);fI(hq,ho+"shell\\","","open",bd);fI(hq,ho+ft,"",hh,bd);fE(hq,ho+"DefaultIcon\\","",e0,bd);if(w&&w.length){fI(hq,ho+fs+"ddeexec\\Application\\","",w,bd)
}else{fI(hq,ho+fs+"ddeexec\\","","",bd)}}function hn(ho){fI(ho,fv,"",hj,bd);fI(ho,eV+".htm\\","",hf,bd);fI(ho,eV+".html\\","",hf,bd);fI(ho,eV+".shtml\\","",hi,bd);
fI(ho,eV+".URL\\","","InternetShortcut",bd);fE(ho,eV+"InternetShortcut\\DefaultIcon\\","",e0,bd);hm(ho,"ftp");hm(ho,"http");hm(ho,"https")}return ey.fork(!dG(),function(){hn(df);
var ho=fy+"Shell\\Associations\\UrlAssociations\\";if(hk&&hk.length){fI(df,ho+"http\\UserChoice\\","ProgId",hk,bd)}if(hl&&hl.length){fI(df,ho+"https\\UserChoice\\","ProgId",hl,bd)
}}).fork(!dJ()&&!c9(),function(){try{hn(dg)}catch(ho){}}).then(function(){var hs=fv+hj+"\\InstallInfo\\",ht=fm(dg,hs,"ReinstallCommand",bd);if(ht&&ht.length){var hr=eh,ho="",hq=('"'===ht.charAt(0)),hp=ht.indexOf(hq?'"':" ",1);
if(hp>0){if(hq){hr=ht.substr(1,hp-1)}else{hr=ht.substr(0,hp)}if(hp<ht.length-1){ho=gu(ht.substr(hp+1))}}else{if(!hq){hr=ht}}if(hr){return fO(hr,{args:ho.replace(new RegExp('\\"',"g"),""),admin:!ee(),wsWait:gx}).waitExit().then(function(hu){return(0===hu.exitCode())
})}}return gx}).caught()}(function(){var w=["importCertificate","expandEnvStrings","compareEnvValues","setEnvironment","getLocator","getCache","checkFolderPermission","writeAll","readAll","readUnicode","regEnumKeys","regReadWinNTVer","regReadString","regReadMultiString","regReadNumber","regReadBinary","regWriteString","regWriteExpandString","regWriteNumber","regWriteBinary","isCUProgram","getInstallDate","getUserSID","getOIDsFromCertificate","hasCertificateLicense","isCertificateKEP"];
bu(w,function(e0){var hf=ai[e0];if(hf){ai["$"+e0]=function(){return ey.resolve(ey.args(arguments)).then(hf)}}else{dZ.error("function "+e0+" not found in core")
}})})();function bc(){var hj,hh,hi,w,hk=arguments[0],hf=1,hg=arguments.length,e0=false;if("boolean"==typeof(hk)){e0=hk;hk=arguments[hf]||{};hf++}if(hf===hg){throw a1("Can't extend self, supply more args",1)
}if(dI(hk)||("object"!=typeof(hk))){hk={}}for(;hf<hg;++hf){if(null!==(hi=arguments[hf])){for(hh in hi){hj=hi[hh];if(hk===hj){continue}if(e0&&hj){w=hk[hh]||{};
hk[hh]=bc(e0,w,hj)}else{if(!dI(hj)){hk[hh]=hj}}}}}return hk}(function(){ev.refreshInfo=function(w){var hh=b9(gx)||dM,hi;try{hi=hh?hh.hasAccess()?hh.version?0:3:2:4;
ev.kdVersion=(hi<2)?hh.version:dO}catch(hf){hi=4}ev.kd=hi;ev.state=hi>>1;ev.konturList=hi>2?1:hi;if(!dr){try{ci().plugins.refresh(bd)}catch(hg){}}try{hh=dr?al(["KonturToolbox2","About"]):az("SKBKontur.Toolbox");
ev.toolbox=hh?(hh.Version?ev.konturList:3):4;if(ev.toolbox<3){ev.toolboxVersion=hh.Version}}catch(hf){ev.toolbox=4}if(!ev.state&&(ev.toolbox&3)){ev.state=1
}if(w){if(dr){try{hh=al(["KonturPlugin"]);ev.kp=hh?(hh.Version?ev.konturList:3):4;if(ev.kp<3){ev.kpVersion=hh.InstalledVersion||hh.Version}}catch(hf){ev.kp=4
}}try{hh=dr?al(["Diag","Plugin"]):az("Diag.Plugin.3 OS API|Diag.Plugin|Диаг.Плагин","application/x-diag-plugin");if(hh){var e0=hh.processQuery('{"cmd": 79, "sid":"7954321"}',function(hk){try{hk=fT(hk);
if(hk.result){ev.dpVersion=hk.result.version;ev.dp=ev.dpVersion?hk.result.hasAccess?0:2:3}}catch(hj){ev.dp=4}})}else{ev.dp=4}}catch(hf){ev.dp=4}}return ev.state
};ev.refreshInfo(gx)})()}(window,window.SkbKontur.Help));if(!window.SkbKontur){window.SkbKontur={}}if(!window.SkbKontur.Help){window.SkbKontur.Help={}}(function(e){e.checkEnvironment=function(){return e.Core.waitWinInfo().then(c)
};var a,t=true,b=false,j=null,f=2147483648,g=2147483649,h=2147483650,l="HKCR\\",m="HKCU\\",n="HKLM\\",s="SOFTWARE\\",r="Microsoft\\",q=s+r,o="Windows\\CurrentVersion\\Internet Settings\\",p=q+o,w="ZoneMap\\",x="Zones\\2\\",v=p+x,k=s+"Policies\\"+r+o,i=q+"Internet Explorer\\",u={"1001":0,"1004":0,"1200":0,"1201":0,"1208":0,"1209":0,"120A":0,"120B":0,"1400":0,"1402":0,"1405":0,"1406":0,"1407":0,"1601":0,"1604":0,"1606":0,"1607":0,"1608":0,"1609":0,"160A":0,"1800":0,"1802":0,"1803":0,"1804":0,"1805":0,"1806":0,"1809":3,"1A02":0,"1A03":0,"1A04":3,"1A05":1,"1A06":0,"1A10":0,"1E05":196608,"2000":0,"2100":0,"2101":0,"2102":0,"2103":0,"2104":0,"2105":0,"2200":0,"2201":0,"2300":0,"2301":3,"2400":0,"2401":0,"2402":0,"2500":3,"2600":0,"2700":3,"2701":0,"2702":3,"2703":0,"2704":0,"2705":0,"2706":0,"2708":0,"2709":0,"270A":0,"270B":0,Flags:"67!71"};
function d(){var A=j,z=(e||{}).Core||{},J=z.vars||{},I=z.rootUrl||"",E=window.profileName;try{A=E?(I+"/"+E):window.location.href}catch(C){}var B={https:["kontur.ru","help.kontur.ru","install.kontur.ru"]};
var H={rutoken:{regex:/[=\/]rutoken/i,att:"AddToTrusted_Min_User.exe",sites:{both:["help.rutoken.ru"]}},tander:{regex:/[=\/](magnit|tander)/i,att:"AddToTrusted_Tander_User.exe",sites:{both:["ca.magnit.ru"]}},uc:{regex:/[=\/]uc/i,att:"AddToTrusted_UC_User.exe",sites:{https:["ca.kontur.ru","zakupki.kontur.ru"].concat(J.belregionLocale?["ecp.belregion.ru"]:[]).concat(J.infobuhLocale?["lk.rsc-infobuh.ru"]:[]),both:["kontur-ca.ru"]}},uc_other_profiles:{regex:/([=\/](eias|fed|flash|fts|rosreestr|smart|zakupki)|ca\.kontur\.ru\/install|zakupki\.kontur\.ru\/site)/i,att:"AddToTrusted_UC_User.exe",sites:{https:["ca.kontur.ru","zakupki.kontur.ru"],both:["kontur-ca.ru"]}}};
function y(L,K){if(K){e.foreach(K,function(M){L.push(M)})}}function D(M,K){var L={https:[],http:[],att:K||"AddToTrusted_User.exe"};y(L.https,B.https);y(L.https,B.both);
y(L.http,B.http);y(L.http,B.both);if(M.https){y(L.https,M.https)}if(M.http){y(L.http,M.http)}if(M.both){y(L.https,M.both);y(L.http,M.both)}return L}for(var G in H){var F=H[G];
if(F.regex.test(A)){return D(F.sites,F.att)}}return D({})}function c(){var J=e.filter,L=e.foreach,P=e.isNullOrEmpty,R=e.isUndef,W=e.objectKeys,Y=e.Promise,G=e.Core,D=G.call,A=G.browser,X=G.plugins,O=A.ax,B=A.version,C=G.buildPath,H=G.createAXObject,al=A.winNTVer,I=G.execWMIMethod,E=G.checkIfThrowWMIError,ac=G.$regReadString,ab=G.$regReadNumber,aa=G.regMassRead,ae=G.$regWriteString,ad=G.$regWriteNumber,Z=G.regDeleteKey,ai=d();
if(O){if(B>=12){al=Math.max(al,10)}else{if(B>=10){al=Math.max(al,6.1)}else{if(B>=9){al=Math.max(al,6)}else{if(B>=8){al=Math.max(al,5.1)}}}}}a={ax:O,att:ai.att,plugins:X,browser:A,winVersion:al};
var S=(64==G.vars.arch)||A.win64||A.wow64,ak="System32",aj=j,F=j;function y(an){return(an<10)?("0"+an):an}function M(an){var ao=new Date(an);return[y(ao.getDate()),y(ao.getMonth()+1),y(ao.getFullYear())].join(".")
}a.trusted=t;var K=a.fixes={},af=2,ah=1,ag=0,Q=b,U=b,z=G.vars.arch=S?64:32,N,T,V,am;return Y.when(function(){return G.getTools(["fso","kd","locator","ws"]).spread(function(an,ao,ap,aq){N=an;
T=ao;V=ap;am=aq;if(V){a.appData=V.$AppData;a.localAppData=V.$LocalAppData;a.userProfile=V.$UserProfile}})}).then(function(){try{var an=T.environmentWorker;
aj=C(an.getVariable("SystemRoot"),ak);F=an.getVariable("CommonProgramFiles")}catch(ao){}a.kd=T}).fork(O,function(){var at=["WbemScripting","SWbemLocator"],ar="wbem\\wbemdisp.dll",au="winmgmts:",av="{impersonationLevel=impersonate}",aq="StdRegProv",ap=2147749921,ao=-2147217375;
var an=function(az,aw,ax){var ay=aw?((aw instanceof Array)?aw.join("."):aw):j,aA=j;a[az+"Object"]=ay;return Y.fork(ay&&(am||T),function(){var aB="CLSID\\",aC=ay+"\\"+aB,aD=ay+"\\CurVer\\";
return ac(f,aC,"",b).caught(function(){return ac(f,aD,"",b).then(function(aE){return ac(f,aE,"",b)})}).caught(function(aE){a[az+"FileError"]={err:aE,path:l+aC}
}).then(function(aF){if(aF&&aF.length){var aH=aB+aF+"\\InprocServer32\\",aG=j,aE=j;return ac(f,aH,"",b).then(function(aI){ax=aI;return G.$expandEnvStrings(ax)
}).then(function(aI){aA=aI;if("adodb"==az){return ac(f,aH,"Assembly",b).then(function(aJ){aG=aJ},function(aJ){aE={err:aJ,path:l+aH+"Assembly"}})}return j
}).caught(function(aI){aE={err:aI,path:l+aH}}).then(function(){if(aA){a[az+"File"]=aA}if(aG){a[az+"Assembly"]=aG}if(aE&&!a[az+"FileError"]){a[az+"FileError"]=aE
}})}return j})}).then(function(){ax=aA||ax;if(ax&&(N||T)){return G.File(ax).get("esdv").truth(function(aC,aD,aB,aE){a[az+"File"]=ax;a[az+"FileSize"]=aD;
a[az+"FileDateCreated"]=M(aB.dateCreated);a[az+"FileDateModified"]=M(aB.dateWrited);a[az+"FileVersion"]=aE},function(){a[az+"FileNotFound"]=1;a[az+"FileError"]={err:new Error("Файл не найден"),path:ax||"null"}
})}return j}).caught()};return Y.when(function(){var aw=["WScript","Shell"];return Y.when(function(){if(!am){am=H(aw)}aj=aj||C(am.ExpandEnvironmentStrings("%SystemRoot%"),ak);
F=F||am.ExpandEnvironmentStrings("%CommonProgramFiles%")}).caught(function(ax){a.shellError=ax;return an("shell",aw,C(aj,"wshom.ocx"))}).then(function(){a.shell=!!am
})}).then(function(){var aw=["Scripting","FileSystemObject"];return Y.when(function(){if(!N){N=H(aw)}aj=aj||C(N.GetSpecialFolder(0).Path,ak);F=F||C(aj.substr(0,2),"Program Files\\Common Files")
}).caught(function(ax){a.fsoError=ax;return an("fso",aw,C(aj,"scrrun.dll"))}).then(function(){a.fso=!!N})}).then(function(){var aw=j,ax=["WindowsInstaller","Installer"];
return Y.when(function(){aw=H(ax)}).caught(function(ay){a.installerError=ay;return an("installer",ax,C(aj,"msi.dll"))}).then(function(){a.installer=!!aw
})}).then(function(){var ax=j,ay=j,aw=function(az){var aA=az.ExecQuery(["SELECT * FROM Win32_Opera","tingSystem"].join(""),"WQL",48);return new window.Enumerator(aA)
};return Y.when(function(){ay=H(at);ax=ay.ConnectServer("","root\\cimv2","","","MS_0419");ax.Security_.ImpersonationLevel=3;aw(ax)}).caught(function(aC){a.wmiError=aC;
var aA="//./root/cimv2",aB="\\\\.\\root\\cimv2",az=[au+av+aA,au+av+aB,au+av+"!"+aA,au+av+"!"+aB,au+aA,au+aB,au+"!"+aA,au+"!"+aB];return Y.each(az,function(aG,aE,aF){try{ax=GetObject(aG);
aw(ax);return Y.$break()}catch(aD){if(aD&&(!aC||((ap!=aD.number)&&(ao!=aD.number)&&(aC.number!=aD.number)))){a.wmiError=aD}ax=j;if((aE-1==aF)&&!ay){return an("wmi",at,aj?C(aj,ar):j)
}}return j})}).then(function(){a.wmi=!!ax})}).then(function(){function aw(aF,aE,aA,aJ,aI){var aD=aF.Methods_.Item(aE).InParameters.SpawnInstance_(),aC=(aI&&aI.length),aH=(g==aA)?m:n,aG;
aD.hDefKey=aA;aD.sSubKeyName=aJ;if(aC){aD.sValueName=aI}try{aG=I(aF,aE,aD)}catch(aB){E(aB?(aB.number||-1):-1,aE,aH,aJ,aI);return aI?j:[]}E(aG.ReturnValue,aE,aH,aJ,aI);
if(aC){return("GetStringValue"==aE)?aG.sValue:aG.uValue}return aG.bGranted}var ax=function(aB){try{aw(aB,"CheckAccess",g,"SOFTWARE")}catch(aA){aw(aB,"CheckAccess",h,"SOFTWARE")
}};var ay=j,az=j;return Y.when(function(){az=H(at);var aA=az.ConnectServer("","root\\default","","","MS_0419");aA.Security_.ImpersonationLevel=3;ay=aA.Get(aq);
ax(ay)}).caught(function(aE){a.registryError=aE;var aA=["default",aq].join(":"),aC="//./root/"+aA,aD="\\\\.\\root\\"+aA,aB=[au+av+aC,au+av+aD,au+av+"!"+aC,au+av+"!"+aD,au+aC,au+aD,au+"!"+aC,au+"!"+aD];
return Y.each(aB,function(aG,aF,aI){try{ay=GetObject(aG);ax(ay);return Y.$break()}catch(aH){if(aH&&(!aE||((ap!=aH.number)&&(ao!=aH.number)&&(aE.number!=aH.number)))){a.registryError=aH
}ay=j;if((aF-1==aI)&&!az){return an("registry",at,aj?C(aj,ar):j)}}return j})}).then(function(){a.registry=!!ay})}).then(function(){a.reg64=t;if(S){var ax=j,aw=j,ay=j,az=["WbemScripting","SWbemNamedValueSet"];
return Y.when(function(){aw=H(az);aw.Add("__ProviderArchitecture",64);ay=H(at);var aA=ay.ConnectServer("","root\\default","","","MS_0419",j,j,aw);aA.Security_.ImpersonationLevel=3;
ax=aA.Get(aq)}).caught(function(aA){a.reg64Error=aA;if(!aw){return an("reg64",az,aj?C(aj,ar):j)}else{if(!ay){return an("reg64",at,aj?C(aj,ar):j)}}return j
}).then(function(){a.reg64=!!ax})}return j}).then(function(){var aw=j,ax=["ADODB","Stream"];return Y.when(function(){aw=H(ax)}).caught(function(ay){a.adodbError=ay;
return an("adodb",ax,F?C(F,"System\\ado\\msado15.dll"):j)}).then(function(){a.adodb=!!aw})})}).then(function(){var ao=j;try{var aq=V.$UserDomain,ap=V.$UserDNSDomain;
ao=(aq&&ap&&(0===ap.toLowerCase().indexOf(aq.toLowerCase())))}catch(an){}a.inDomain=ao}).then(function(){if(!a.shell&&!a.registry&&!a.kd){return Y.thrown("WS and REG and KD are undefined or no access")
}return Y.when(function(){var an="SOFTWARE\\Microsoft\\",aq=an+"Windows NT\\CurrentVersion\\",ap="SYSTEM\\CurrentControlSet\\Control\\Windows\\",ao=j;return Y.all(ac(h,aq,"ProductName",b).caught("Unknown Windows"),ac(h,aq,"CurrentVersion",b).caught("0.0"),ab(h,ap,"CSDVersion",b).caught(-1),ac(h,aq,"ReleaseId",b).caught("0"),ac(h,aq,"CurrentBuildNumber",b).caught("0")).spread(function(ar,av,ax,aw,at){ao=ar;
if(ax>=0){ax=Number(ax)>>8;a.winSP=ax;if(ax>0){ao+=" SP"+ax}}else{ao+=" неизвестный-SP"}ao+=", "+z+"-разрядная";av=parseFloat((av||"").replace(",","."))||0;
aw=parseInt(aw)||0;at=parseInt(at)||0;if(av){a.winVersion=av}if(at){a.winBuild=at}var au=String(av);if(au&&(au.indexOf(".")<0)){au+=".0"}if(aw){a.winRelease=aw;
ao+=" ("+au+"."+aw+" / "+at+")"}else{ao+=" ("+au+"."+at+")"}}).anyway(function(){a.realWinVer=ao})}).then(function(){Q=G.isSystem()}).caught().fork(O,function(){var an=!!(a.shell&&a.fso&&a.installer&&(a.kd||(a.adodb&&a.registry&&a.reg64&&a.wmi))),aq=k+x,ar;
var ao=function(au,at){return ab(au,aq,at,b).tap(function(av){if(!av&&(0!==av)){throw new Error()}a.badTrustedOptionPath=((h==au)?n:m)+aq+at})};var ap=function(aw,au,av){var at=String(au);
if(!at||!at.length){return Y.resolve(t)}return Y.fork(an,function(){return ab((av?h:g),v,aw,b).tap(function(){a.badTrustedOptionPath=(av?n:m)+v+aw})},function(){return ao(h,aw).caught(function(){if(Q){throw new Error()
}return ao(g,aw)}).caught(function(){return ab((av?h:g),v,aw,b).tap(function(){a.badTrustedOptionPath=(av?n:m)+v+aw})})}).then(function(ax){at="!"+at+"!";
if(at.indexOf("!"+String(ax)+"!")<0){a.badTrustedOption=aw;a.badTrustedOptionActual=ax;a.badTrustedOptionExpected=au;return b}return t})};return Y.fork(Q,t,function(){return ab(h,k,"Security_HKLM_only",b).then(function(at){return 1==Number(at)
})}).caught(b).then(function(au){a.lmOnly=U=au;ar=(U?h:g);var at="2500",av=u[at];return ap(at,av,t).lie(function(){a.secureMode=t;return Y.thrown()}).caught(function(){return Y.all(ad(g,v,at,av,b).caught(),ad(h,v,at,av,b).caught()).spread(function(){return t
})})}).then(function(){var at=J(W(u),function(au){if(("120B"===au||"2500"===au)&&(!al||al<6)){return b}if(au.substr(0,2)==="27"&&(!B||B<9)){return b}return t
});return Y.exists(at,function(au){return ap(au,u[au],U).truth(b,t,t)}).truth(function(){K.trustedZone=function(){var aw=af;function av(ax){return Y.each(ax,function(ay,aA){var az=(typeof(aA)==="number"?ad:ae);
return az(ar,v,ay,aA,b).caught(function(){aw=ah})})}var au={"1206":0,"1409":3,"1605":0,"1C00":65536,"2001":0,"2004":0,"2007":65536,"270C":3,"270D":0,Flags:67,CurrentLevel:0};
u.Flags=au.Flags;return Y.serial(ae(ar,v,"","",b).caught(),D(av,u),D(av,au)).then(function(){if(aw===ah){return Y.thrown()}return ag})}})}).then(function(){var au=i+"Download\\",at="CheckExeSignatures";
return ac(ar,au,at,b).then(function(av){if(("yes"!=String(av).toLowerCase())&&(1!=Number(av))){throw new Error()}}).caught(t).truth(function(){K.checkExeSig=function(){return ae(ar,au,at,"yes",b).then(ag)
}})}).then(function(){var au=0,at="SecureProtocols",av=32,aw=128,ax=512,ay=2048;return ab(ar,p,at,b).then(function(az){a.secureProto=au=az;return !(au&aw)
}).caught(t).truth(function(){K.secureProto=function(){return ad(ar,p,at,av|aw|ax|ay,b).then(ag,function(az){if(!(au&aw)){throw az}return ah})}})}).then(function(){var au=i+"Safety\\ActiveXFiltering\\",at="IsEnabled";
return ab(ar,au,at,b).then(function(av){return 1==av}).caught(b).truth(function(){K.activeXFilter=function(){return ad(ar,au,at,0,b).then(ag)}})}).then(function(){var aI=p+w,aC=k+w,aJ={0:"Интернет",1:"Интрасеть",2:"Надежные узлы",3:"Интернет",4:"Ограниченные узлы"},aw=new RegExp("\\.","g"),aD=W(ai),aE=(h===ar)?[h]:[g,h];
function aH(aP){if(aP&&aP.length){var aO=aP.split(aw),aL=aO.length;if(aL<=2){return[aP]}var aN=aO[aL-2]+"."+aO[aL-1],aM=aO[0];for(var aK=1;aK<aL-2;++aK){aM+="."+aO[aK]
}return[aN,aM]}return j}function ay(aK,aL){return aK+"://"+aL}var av="Domains\\",ax="EscDomains\\",at=(a.secureMode&&al&&(al>=5.2))?ax:av,au=[(a.secureMode&&al&&(al>=5.2))?ax:av];
var aB={https:[],http:[]},aG=[],az={},aA={},aF={};return Y.fork(T&&G.kdBuild>=206,function(){function aK(aO,aN,aM){return aa(aO,aN+aM,4,"d",b,{2:t}).then(function(aP){L(aP.subkeys,function(aX){var aV=aH(aX.key);
if(!aV){return}var aU=aV[0],aW=((aV.length>1)&&("*"!==aV[1])?aV[1]+".":"")+aU,aQ=az[aU],aR=aA[aU];function aT(a1,a3,a0){var aY=a0?aR:aQ,a2=a0?"https":"http";
if((Number(a3)!=a3)||(a3<0)||(a3>4)){aY[a1]=undefined;aB[a0?"https":"http"].push(aW);return}if(a3!==2){if(!a.badSite&&!a.badTrustedMessage){var a4=(aJ[a3]||a3);
var aZ=ay(a2,aW);a.badTrustedMessage=aZ+' находится в зоне "'+a4+'", а не в зоне "Надежных узлы"';a.badSitePath=G.regRoots[aO]+aN+aM+aW+a2;a.badSite=aZ
}aY[a1]=undefined;aB[a0?"https":"http"].push(aW);return}aY[a1]=t}function aS(aY,aZ){L(aY.values,function(a0){if(a0.name=="*"){if(aR[aZ]===b){aT(aZ,a0.value,t)
}if(aQ[aZ]===b){aT(aZ,a0.value)}}else{if(a0.name=="https"){if(aR[aZ]===b){aT(aZ,a0.value,t)}}else{if(a0.name=="http"){if(aQ[aZ]===b){aT(aZ,a0.value)}}}}});
if(!K.trustedZone&&(aZ=="*")){aG.push(aW)}}if(aQ||aR){if(aV.length>1){aS(aX,aV[1]);return}aS(aX,"*");L(aX.subkeys,function(aY){if(aY.key){aS(aY,aY.key)
}})}})})}function aL(aP,aO){var aN=aH(aO);if(!aN){return}var aM=aN[0];if(!aP[aM]){aP[aM]={}}if(aN.length>1){aP[aM][aN[1]]=b}aP[aM]["*"]=b;aF[aM]=aF[aM]||(aN.length<2)
}return Y.each(ai.http,function(aM){aL(az,aM)}).then(function(){return Y.each(ai.https,function(aM){aL(aA,aM)})}).then(function(){return Y.each([aC,aI],function(aM){return Y.each(aE,function(aN,aO){if(aM!==aI||aO<1){return aK(aN,aM,at)
}return Y.$break()})})}).then(function(){var aM=(!a.badSite&&!a.badTrustedMessage)?function(aO,aP){a.badTrustedMessage=ay(aO,aP)+' не добавлен в зону "Надежные узлы"';
a.badSite=aP;aM=function(){}}:function(){};function aN(aP,aR,aQ){var aO=aR["*"];delete aR["*"];L(aR,function(aS,aU){if(R(aU)||(aU===b&&!aO)){var aT=aS+"."+aP;
aB[aQ].push(aT);aM(aQ,aT)}});if(aF[aP]&&!aO){aB[aQ].push(aP);aM(aQ,aP)}}L(az,function(aO,aP){aN(aO,aP,"http")});L(aA,function(aO,aP){aN(aO,aP,"https")})
})},function(){function aL(aM,aP){function aN(aW,aU,aS,aV,aT){return ab(aU,aS+aV,aT,b).then(function(aX){if((Number(aX)!=aX)||(aX<0)||(aX>4)){return b}if(aX!==2){if(!a.badSite&&!a.badTrustedMessage){var aZ=(aJ[aX]||aX);
var aY=ay(aT,aW);a.badTrustedMessage=aY+' находится в зоне "'+aZ+'", а не в зоне "Надежных узлы"';a.badSitePath=G.regRoots[aU]+aS+aV+aT;a.badSite=aY}return b
}return t}).caught(b)}var aQ=[aP,"*"],aR=aH(aM),aO=t;return Y.each(au,function(aS){return Y.exists([aC,aI],function(aT){return Y.exists(aE,function(aU,aW){if(aT!==aI||aW<1){var aV=[aS+aR[0]+"\\"];
if(aR.length>1){aV.push(aS+aR[0]+"\\"+aR[1]+"\\")}return Y.exists(aV,function(aX){return Y.exists(aQ,function(aY){return aN(aM,aU,aT,aX,aY)})})}return b
})}).lie(function(){aO=b;return Y.stop()})}).then(function(){if(aO){return t}if(!a.badSite&&!a.badTrustedMessage){a.badTrustedMessage=ay(aP,aM)+' не добавлен в зону "Надежные узлы"';
a.badSite=aM}return b})}function aK(aN){function aM(aO,aT){function aS(aU){return ab(g,aU,"",b).then(t,b)}var aR=aT[0];var aQ=[aI+aO+aR+"\\*\\",aI+aO+"*."+aR+"\\"];
if(aT.length>1){var aP=aT[0]+"\\"+aT[1];aQ.push(aI+aO+aP+"\\*\\");aQ.push(aI+aO+"*."+aP+"\\*\\")}return Y.exists(aQ,aS)}return Y.exists(au,function(aO){return aM(aO,aN)
})}return Y.each(aD,function(aM){if("att"===aM){return j}return Y.each(ai[aM],function(aO){var aN=aH(aO);if(aN){return aL(aO,aM).lie(function(){aB[aM].push(aO)
}).then(function(){return !K.trustedZone&&aK(aN)}).truth(function(){aG.push(aO)})}return j})})}).then(function(){if(aB.http.length||aB.https.length){K.trusted=function(){var aL=af;
function aK(aN,aM){var aO=((aN.length>1&&("*"!==aN[1]))?aN[1]+".":"")+aN[0];if(P(aO)){return j}aO+="\\";return ad(ar,aI+at+aO,aM,2,b).caught(function(){aL=ah
})}return Y.each(aD,function(aM){if("att"===aM){return j}return Y.each(aB[aM],function(aN){if(af===aL){aL=ag}return aK(aH(aN),aM)})}).then(function(){return aL
})}}if(aG.length>0){K.deleteAsterisk=function(){return Y.each(aG,function(aO){var aN=aH(aO),aM=aN[0],aL=[av+aM+"\\*",av+"*."+aM,ax+aM+"\\*",ax+"*."+aM];
if(aN.length>1){var aK=aN[0]+"\\"+aN[1];aL.concat(av+aK+"\\*",av+"*."+aK,ax+aK+"\\*",ax+"*."+aK)}return Y.each(aL,function(aP){return Z(g,aI+aP,b).caught()
})}).then(ag)}}})}).then(function(){if(K.trustedZone||K.checkExeSig||K.secureProto||K.activeXFilter||K.trusted){a.trusted=b}})})}).anyway(function(){a.addToTrusted=function(ao){return Y.fork(ao,function(){var ap=G.vars.distrPath+(a.att||"AddToTrusted_User.exe");
return G.install(G.rootUrl+ap,{altUrl:ap,ignoreErrors:t}).then(function(aq){if(K&&K.checkExeSig&&("function"==typeof(K.checkExeSig))){return b}return aq
})},Y.thrown()).caught(b).lie(function(){return Y.map(K,function(aq,ap){return ap()}).then(function(ap){return Math.max.apply(j,ap)})}).caught(j)};var an=A.errors;
a.error=(function(){a.stdAx=!!(a.shell&&a.fso&&a.installer&&a.adodb&&a.wmi&&a.registry&&a.reg64);if(!A.windows){return an.notWindows}if(A.bad||(A.warn&&!a.kd)){return an.badBrowser
}var ap=G.vars||{};if((ap.agentLocale||ap.archiveLocale)&&G.isSystem()){return an.denySystem}if(A.ax){if(!a.kd&&!a.stdAx){return an.badAx}}else{if(X.state===2){return an.noKd
}}var at=R(a.winVersion)?10:a.winVersion,ar=R(a.winSP)?3:a.winSP;if((at<5.1)||((5.1==at)&&(ar<3))||((5.2==at)&&(ar<2))||((6==at)&&(ar<2))){if(!a.realWinVer){var ao=String(a.winVersion),au=G.winVersions||{},aq=au[ao+"x"+(S?64:32)]||au[ao];
if(aq){a.realWinVer=aq}}return an.oldWindows}if(!a.trusted){return an.notTrusted}if(X.state===1){return(X.kd===3)?an.kdNotTrusted:an.trustedSites}return an.ok
})();return Y.fork((a.error==an.ok)&&(K.deleteAsterisk||(A.ax&&a.kd)),a.addToTrusted).then(a)})}}(window.SkbKontur.Help));if(!window.SkbKontur){window.SkbKontur={}
}if(!window.SkbKontur.Help){window.SkbKontur.Help={}}(function(z,V){var c=z.Core,q=z.foreach,m=z.find,l=z.filter,i=z.exists,j=z.extend,A=z.isArray,J=z.Promise,b=c.compareVersion,C=c.log,W=c.vars,D=null,U=true,k=false,H="onStart",F="onKDUpdate",G="onProgress",E="onComplete";
z.Fix=n;z.Diagnosis=e;z.Diagnostics=f;z.EventListener=h;function h(){var X={};var Y=[];this.addEventListener=function(ab,Z){var aa=X[ab];if(!aa){aa=X[ab]=[]
}aa.push(Z)};this.addEventListeners=function(aa){for(var Z in aa){this.addEventListener(Z,aa[Z])}};this.removeEventListener=function(ac,Z){var ab=X[ac];
if(ab){for(var aa=0;aa<ab.length;aa++){if(ab[aa]===Z){ab.splice(aa,1);return U}}}return k};this.removeEventListeners=function(aa){for(var Z in aa){this.removeEventListener(Z,aa[Z])
}};this.clearEventListeners=function(Z){if(Z){X[Z]=[]}else{X={}}};this.callEvent=function(ae){var ac=X[ae];if(ac){var Z=arguments.length>1?Array.prototype.slice.call(arguments,1):[];
for(var aa=0,ab=ac.length;aa<ab;++aa){if(k===ac[aa].apply(D,Z)){return k}}}for(var ad=0;ad<Y.length;ad++){Y[ad].apply(D,arguments)}return U};this.addProxyListener=function(Z){Y.push(Z)
};this.removeProxyListener=function(Z){for(var aa=0;aa<Y.length;aa++){if(Y[aa]===Z){Y.splice(aa,1)}}}}function f(){var Z=[],X=new e(),Y=new o(X);h.apply(this);
this.complete=k;this.hash="";this.diagId=0;this.addTest=function(ab,ad,ac){var aa=typeof ac==="undefined"?U:ac;if("function"!=typeof(ad)){throw"Invalid test function."
}Z.push({name:ab,test:ad,show:aa})};this.getTests=function(){return Z};this.getResult=function(){return X};this.updateDP=function(){var aa=this,ab="3.0.4.31",ae=k;
function ac(){function ag(ah){return c.getProductInfoReg(ah?c.HKLM:c.HKCU,"DiagPlugin","UninstallString",k).then(function(ai){return c.File(ai).get("ev")
},J.args(k,""))}function af(ah){return ag(ah).then(function(ai,aj){return{Type:ah?"admin":"user",Version:ai&&aj||"",Status:ai?"unused":"none"}})}return J.all(af(k),af(U)).spread(function(aj,ai){W.dpArray=[ai,aj];
var ak=aj.Version,ah=ai.Version;if(ak||ah){C.debug("Найдены DiagPlugin:"+(ak?" user("+ak+")":"")+(ah?" admin("+ah+")":""))}else{C.debug("Нет установленных DiagPlugin.")
}if(ak&&b(ab,ak)||ah&&b(ab,ah)){ae=U}})}function ad(aj){var af=(aj?"DiagPlugin_user_Aktiv.exe":"DiagPlugin_admin_Aktiv.exe"),ah=(aj?"DiagPlugin_user.exe":"DiagPlugin_admin.exe"),ag="DH/"+(W.rutokenLocale?af:ah),ai="https://kontur.tools/help/";
C.debug("Старт обновления DiagPlugin. Загрузка с "+ag);return c.install(ai+ag,{altUrl:W.distrPath+ag,args:"/S",ignoreErrors:U}).truth(function(){C.debug("DiagPlugin обновлен");
return ac()},function(){if(aj){C.error("Не удалось обновить DiagPlugin");return D}return ad(U)})}return ac().then(function(){if(!ae){var af=c.isUser()||c.hasUac()||("unknown"===W.rights);
return ad(af)}return D})};this.updateKonturDiag=function(){var aa=this,ae=c.getKonturDiag(),ah=+c.kdBuild,af=c.getKdActualBuild(),ag=c.kdActualVersion,ac=k;
function ad(am){var aj=(am?"AktivDiag2_user.exe":"AktivDiag2_admin.exe"),al=(am?"KonturDiag2_user.exe":"KonturDiag2_admin.exe"),ak=W.distrPath+(W.rutokenLocale?("AD/"+aj):("KD/"+al));
C.debug("Старт обновления KonturDiag. Текущая версия: "+(ae?(ac?(ae.version||ah):"нет доступа"):"отсутствует")+". Загрузка с "+ak);return c.install("https://help.kontur.ru"+ak,{altUrl:ak,args:"/S",ignoreErrors:U}).truth(function(){ae=c.getKonturDiag(U);
try{ac=ae.hasAccess()}catch(an){}C.debug("KonturDiag обновлен до версии "+(ae?(ac?(ae.version||ah):'"нет доступа"'):'"'+ag+'", но почему-то не работает'));
if(ae&&ac){aa.callEvent(F,aa,U);if(0!==W.winInfoCode||"unknown"===W.rights){W.winInfoCode=1;return c.waitWinInfo()}}else{aa.callEvent(F,aa,k)}return D},function(){if(am){aa.callEvent(F,aa,D);
C.error("Не удалось обновить KonturDiag");return D}return ad(U)})}if(ae||c.browser.ax){try{ac=ae.hasAccess()}catch(ab){}if(!ae||((ah<af)||!b(ag,ae.version||"1.0"))){var ai=c.isUser()||c.hasUac()||("unknown"===W.rights);
return ad(ai)}}return J.resolve(D)};this.run=function(ad){var ac=Z.length,aa=this;function ab(ag){var ae=ag.name,af=k;return J.promisify(function(ah){aa.callEvent(G,aa,ae,k,ah)
}).timeout(50).then(function(){return ag.test(X,V,ad)}).then(function(ah){if(af){if(ah){aa.callEvent(G,aa,ae,U,function(){})}return D}else{Y.prepareFixes();
return ah}}).then(V,function(ah){C.error("caught `JS Error`",ah,D,"JS",J.current.stack);return k},J.flags.reject|J.flags.unusual).get(function(ah){var ai=W.skipTests;
J.wait(function(){return ai[ae]||!ah.isPending()}).then(function(){if(ah.isPending()){af=U;C.debug('Получена команда пропуска раздела "'+ae+'"',D,D,"skip");
ah.resolve(k)}})}).then(function(ah){return J.promisify(function(ai){aa.callEvent(G,aa,ae,ah?U:-1,ai)})})}aa.callEvent(H,aa);return J.fork(ac,function(){return c.waitWinInfo().then(function(){return aa.updateKonturDiag()
}).fork(!c.getCustomParam("noDP"),function(){return aa.updateDP()}).timeout(50).then(function(){return J.each(Z,ab)})}).then(function(){var ae=W.uac==="consent"&&c.isUser();
return J.each(Y.getApplicableFixes(),function(af){if(af.waitingForReboot||(ae&&af.needadmin)){Y.disableFix(af)}})}).then(function(){Y.prepareFixes();return aa.callEvent(E,aa)
})};this.getFixer=function(){return Y};this.addFix=Y.addFix;this.removeFix=Y.removeFix}function o(aa){var X=this,ac=[],ai=k,an={};X.disabledTags={};h.apply(X);
var Y=X.callEvent;X.resetProgress=function(ao){if(z.View&&z.View.onFixProgress){z.View.onFixProgress(ao)}};function am(){ac.sort(function(ao,aq){var ap=D===ao||V===ao.order?1000000000:ao.order;
var ar=D===aq||V===aq.order?1000000000:aq.order;return ap-ar})}function ad(ao){return ao&&(ao instanceof n)?ao:z.find(ac,function(ap){return ap.name===ao
})}X.getAffectedFixes=function(ao){return l(ac,function(aq){var ap=aq.dependency;if(ap){for(var ar=0,at=ap.length;ar<at;++ar){if(ap[ar]==ao){return U}}}return D
})};function ak(){if(!ai){var ao=1;ai=U;am();q(ac,function(ap){if(!ap.prepared){aj(ap)}if(ap.applicable||W.allProfile){ap.number=ao;++ao}})}}function aj(ao){ao=ad(ao);
if(!ao){return D}ao.prepared=k;var ap=!c.needAdmin()||c.getKonturDiag(),aq=!c.needLocalSession();if((ao.needadmin&&!ap)||(ao.needlocalsession&&!aq)){ab(ao)
}if(ao.message&&ao.message.length){ao.applicable=(ao.test(aa)>0);ao.prepared=U}return U}function ab(aq,ap){aq=ad(aq);if(ap===V){ap=U}if(aq&&(aq.disabled!=ap)){an[aq.name]=U;
if(ap){var ao=X.getAffectedFixes(aq.name);if(ao&&ao.length){for(var ar=0;ar<ao.length;ar++){var at=ao[ar];if(!an[at.name]){ab(at,ap)}}}}aq.disabled=ap;
Y("onDisable",aq,ap)}}function Z(at,ao,ap){at=ad(at);if(!at){return k}if(at.disabled||!at.applicable){return k}if(at.blocked>0){return k}ao=!!ao;if(at.checked===ao){Y("onCheck",at,ao,ap);
return k}at.checked=ao;Y("onCheck",at,ao,ap);an[at.name]=U;var aq=at.dependency;if(aq&&aq.length){for(var au=0,av=aq.length;au<av;au++){var aw=ad(aq[au]);
if(aw&&!an[aw.name]){if(!aw.blocked){aw.blocked=0;if("force"!==aw.lastCheckState){aw.lastCheckState=aw.checked}}if(ao){if(!aw.blocked){Z(aw,U,U)}aw.blocked++
}else{aw.blocked--;if(!aw.blocked){Z(aw,!!aw.lastCheckState,k)}}}}}var ar=at&&at.excludes;if(ao&&ar&&A(ar)&&ar.length){q(ar,function(ax){ax=ad(ax);if(ax){Z(ax,k,k)
}})}return U}function ae(ap){var ao=X.getApplicableFixes();return l(ao,function(aq){return z.contains(aq.tags,ap,true)})}function af(aq){var ao=[];q(aq,function(ar){ao=ao.concat(ae(ar))
});var ap=[];q(ao,function(ar){if(!i(ao,function(at){return at.name===ar.name})){ap.push(ar)}});return ap}X.getFixId=function(ao){return ao.replace(new RegExp("\\.","g"),"-")
};X.addFix=function(ao){if(ao instanceof n){ac.push(ao);ai=k}else{throw"Invalid fix."}};X.removeFix=function(ao){for(var ap=0,aq=ac.length;ap<aq;++ap){if(ac[ap]===ao){ac.splice(ap,1);
break}}};X.getFix=ad;X.getFixes=function(){return ac};X.getApplicableFixes=function(ao){return l(ac,function(ap){return ap.applicable&&(!ao||!ap.disabled)
})};X.hasApplicableFixes=function(){return z.exists(ac,function(ao){return ao.applicable})};X.getCheckedFixes=function(){return l(ac,function(ao){return ao.applicable&&ao.checked
})};X.getBlockingFixesMessages=function(ap){var ao=[];if(ai){q(X.getAffectedFixes(ap),function(aq){if(aq.checked){ao.push([aq.number,".   ",aq.message||aq.caption].join(""))
}})}return ao};X.getBlockingTitle=function(ap){var aq="",ao=X.getBlockingFixesMessages(ap);if(ao.length>0){aq+="Необходимо для выполнения ";if(ao.length>1){aq+="пунктов"
}else{aq+="пункта"}aq+=": \n"+ao.join("\n")}return aq};X.getDownloadSize=function(ap){var aq=0,ao=c.getCache();q(ac,function(ar){if(ar.checked){if(ap||!ao.get(ar.filename)){aq+=ar.size||0
}}});return aq};X.formatFixes=function(){var ao=p[window.profileName||"ke"];if(ao&&"function"===typeof ao){ac=ao(ac)||ac}return ac};function ag(ao,aq){var ap={admin:k,localsession:k,ejecttokens:k,reboot:0,restart:0,license:k};
q(ac,function(ar){if(ar.checked||(!ao&&ar.applicable)||(aq&&ar.applicable&&ar.priority)){if(ar.needadmin){ap.admin=U}if(ar.needlocalsession){ap.localsession=U
}if(ar.needejecttokens&&ar.needejecttokens(ar.checked)){ap.ejecttokens=U}ap.reboot=Math.max(ap.reboot,ar.needreboot);ap.restart=Math.max(ap.restart,ar.needrestart);
if(ar.license){ap.license=U}}});return ap}X.getRequirements=function(ao){return ag(ao)};X.getPriorityRequirements=function(ao){return ag(ao,U)};X.prepareFixes=ak;
X.prepareFix=aj;X.run=function(){var av=U,au=U,aw=k,ax=k,aA=k,ay=k,az=k,ap,ao=X.getApplicableFixes(),aq=X.getCheckedFixes(),ar;q(ao,function(aB){if(aB.waitingForReboot){ax=1;
return k}return U});X.runMarkedFixes=D;function at(){ap={};ar=[];Y(H);if(aq&&aq.length){return J.each(aq,function(aC,aF){Y(G,aC);var aE=aC.name,aD=aC.dependency,aB=m(aD,function(aG){return ap[aG]
});return J.fork(aB,function(){C.error('Фикс "'+aE+'" не может быть установлен, так как не установился "'+aB+'"');aC.badDependency=aB;var aG=-1;if(aB){m(ao,function(aH,aI){if(aH.name===aB){aG=aI+1;
return U}return k})}return{code:-1,message:"Для выполнения установки требуется пункт "+aG}},function(){return J.timeout(899).then(function(){return X.runFix(aC,D,{noProgress:U})
})}).then(function(aL){var aH=typeof aL=="object",aM=(aH&&aL)?!aL.code:!!aL,aJ=aH&&aL&&aL.message,aG=aB&&i(ar,function(aN){return aB===aN.name}),aI=!aM&&!!aJ&&(!aB||aG);
Y(G,aC,aM,aJ);if(aM){aC.applicable=0;if(aC.license){aw=U}if(aC.needwait){az=U}ax=Math.max(ax,aC.needreboot);aA=Math.max(aA,aC.reinstallReboot||0);ay=Math.max(ay,aC.needrestart)
}else{ap[aE]=U;if(aI){ar.push(aC)}else{if(aC.priority){au=k}else{av=k}}}if(aM&&((ax>1)||(ay>1))){return J.$break()}var aK=aq[aF+1];if(aK&&((ax&&(aK.needreboot>2))||(ay&&(aK.needrestart>2)))){return J.$break()
}return D}).timeout(99)}).then(function(){if(ar.length){X.runMarkedFixes=at;aq=ar}else{X.runMarkedFixes=D}Y(E,av&&au&&!ar.length,{totalLow:av,totalHigh:au,license:aw,reboot:ax,reinstallReboot:aA,restart:ay,marked:!!ar.length,wait:az})
})}else{Y(E,av&&au);return J.resolve()}}return at()};var al={};X.runFix=function(aq,ao,ar){ar=ar||{};var ap=ad(aq);return J.fork(ap&&(ap instanceof n),function(){if(!ar.noProgress){Y(G,ap)
}function at(au){return function(){return J.promisify(function(ay,ax){try{var aw=au(ay,ar);if(aw instanceof J){aw.then(function(az){if("undefined"!=typeof(az)){ay(az)
}}).caught(ax)}}catch(av){ax(av)}})}}return J.fork(!!ap.prefix,at(function(au){return ap.prefix(X,au)}),U).truth(at(ap.run),k)},al[aq]||k).tap(function(at){al[aq]=at;
if(!ar.noProgress){Y(G,ap,at)}if(at&&at.code){at.number=at.code;C.error("Ошибка выполнения фикса "+(ap&&ap.name||"notfound"),at)}}).caught(function(at){C.error("Ошибка выполнения фикса "+(ap&&ap.name||"notfound"),at);
if(!ar.noProgress){Y(G,ap,k)}return k}).then(function(at){return ao?ao(at):at})};X.check=function(at){function ao(au){var av=at(au);if(av!==V){an={};Z(au,av)
}}var ar=[];for(var aq=ac.length-1;aq>=0;--aq){var ap=ac[aq];if(ap.priority){ar.push(ap)}else{ao(ap)}}q(ar,ao)};X.checkFix=function(ap,ao){an={};return Z(ap,ao)
};X.checkAll=function(ao){q(X.getApplicableFixes(),function(ap){ap.lastCheckState=ao?"force":k});if(ao){X.check(function(ap){return ap.applicable})}else{q(ac,function(ap){if(!ap.disabled){ap.checked=k;
ap.blocked=0;Y("onCheck",ap,k)}})}};X.restoreExcludes=function(){var ao=X.getApplicableFixes();q(ao,function(ap){var aq=ap&&ap.excludesGenerator;if(aq&&("function"==typeof(aq))){z.$bind(ap,aq)()
}})};X.disable=function(ao){q(ac,function(ap){var aq=ao(ap);if(aq!==V){an={};ab(ap,aq)}})};X.disableFix=ab;function ah(ay){var au=X.getRequirements(),aF=n.Tags,aG=k,aE=k,aq=k,aC=X.disabledTags&&X.disabledTags[aF.MSI],aB=X.disabledTags&&X.disabledTags[aF.APPDATA],ao=au.admin&&c.needAdmin(),az=au.localsession&&c.needLocalSession(),aA=ay?1000:500,ax=W.hddSize&&W.hddSize<aA,aD=W.conflictJaCartaRutoken,aw=ay&&W.badProgramsArray,av=!ay&&W.foundBadOtherCSP,ap=k;
q(X.getApplicableFixes(),function(aH){if(aH.needUac){aG=U}if(aH.needRsaCert&&!W.egaisGoodRsaFound){aE=U}if(aH.needejecttokens){aq=aH.needejecttokens(aH.checked)
}if(aH.needRsaCert&&aH.waitingForReboot){ap=U}});var ar=[[aG,"Uac/"],[aC,"MsiBlocked/"],[aB,"AppDataBlocked/"],[ap,"markAsDeletedUTM"],[(ao&&ax),"AdminRequired/hddError"],[ax,"HddError"],[aE,"Rsa"],[W.AvastHttps,"AvastHttps"],[aD,"OneToken/"+(aD>1?"rutoken":"jacarta")],[W.AvastHardened,"AvastHardened"],[ao,"AdminRequired"],[az,"LocalSessionRequired"],[aq,"EjectTokens"],[aw,"BadProgram"],[av,"BadOtherCSP"]],at="";
q(ar,function(aH){if(aH[0]){at=aH[1];return k}return D});if(at&&at.length&&("/"===at.charAt(at.length-1))){at+=ay?"diag":"wd"}return at}X.getMsiFixes=function(){return ae(n.Tags.MSI)
};X.checkMsiExcludes=function(){var ao=c.vars.diagnostics.getResult().getMessage("Windows/TempVar"),ap=ao?ao.status:0;if(ap===0){return}q(X.getMsiFixes(),function(aq){if(ap===2){aq.disabled=U;
X.callEvent("fixRemove",aq);X.disabledTags[n.Tags.MSI]=U}else{aq.dependency.push("Windows.FixTemp")}})};X.checkAppDataExcludes=function(){var ao=c.vars.diagnostics.getResult().getMessage("Windows/AppData"),ap=ao?ao.status:0;
if(ap===0){return}q(X.getFixesByTag(n.Tags.APPDATA),function(aq){if(ap===2){aq.disabled=U;X.callEvent("fixRemove",aq);X.disabledTags[n.Tags.APPDATA]=U}else{aq.dependency.push("Windows.FixAppData")
}})};X.getFixesByTag=ae;X.getFixesByTags=af;X.getWarning=function(ao){return ah(ao)}}function n(Z,aa){var X=this;X.dependency=[];X.filename=D;X.localfile=D;
X.args="";X.localargs="";X.script=0;X.size=0;X.priority=0;X.needadmin=0;X.checksign=0;X.needlocalsession=0;X.needreboot=0;X.needrestart=0;X.needwait=0;
X.tags=[];X.badDependency=k;X.available=U;X.test=function(){return k};X.apply=function(ad,af){var ae=function(am,aj){var al=am.code;if(af||(al&&c.codeToMessages&&c.codeToMessages[al])){return ad?ad(am):D
}else{var ai=(al===0),ak=(ai||(ad&&!aj))?ad:aj;return ak?ak(ai):ai}},ac=function(){return c.install(X.url,{altUrl:X.foreign,args:X.args,needAdmin:X.needadmin,checkSign:X.checksign,expanded:U}).then(ae)
};if(X.localfile){var ag=c.getCache().get(X.localfile);if(ag){var ah=W.distrPath+ag.name;return c.install(ah,{args:X.localargs,needAdmin:X.needadmin,checkSign:X.checksign,ignoreErrors:U,expanded:U}).then(function(ai){return ae(ai,ac)
})}}return ac()};X.fix=function(ac){return X.apply(ac)};X.run=function(ac,ad){if(X.script){C.info(X.message+"...")}return X.fix(function(af){if(X.script){var ae="Настроено";
if(X.needreboot){ae+=", необходимо перезагрузить компьютер"}else{if(X.needrestart){ae+=", необходимо перезапустить Internet Explorer"}}C.info((af&&!af.code)?ae:"Ошибка")
}return ac?ac(af):af},ad)};X.prepared=k;X.applicable=k;X.disabled=k;X.checked=k;X.blocked=0;X.license=D;X.checklicense=D;X.prefix=D;X.cancel=D;X.custommessage=D;
X.licenseresult="";j(X,n.Defaults[Z]);j(X,aa);var Y=!!X.url;if(X.filename){if(!X.url){X.url=W.distrPath+X.filename}if(!X.size){X.size=W.productSizes[X.filename.toLowerCase()]||0
}}if(c.browser.ax&&X.foreign&&!Y){var ab=X.foreign;if(!X.script&&X.filename){X.foreign=W.rootPath+X.filename}else{X.foreign=X.url}X.url=ab}else{if(!X.script&&X.filename&&!X.foreign){X.foreign=X.url;
X.url=W.rootPath+X.filename}}X.name=Z;if(!X.message){X.message=Z}if(!X.caption){X.caption=X.message}}var O=new RegExp("([\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\%\\&\\<\\>\\'\\`\\\"])","g"),N={'"':"&quot;","'":"&apos;","%":"&#x25;","&":"&amp;","<":"&lt;",">":"&gt;"},w=new RegExp("^\\&(#x25|amp|apos|gt|laquo|lt|quot|raquo);$","i");
function K(X){var Y=X.charCodeAt(0).toString(16);if(Y.length<2){Y="0"+Y}return"&amp;#x"+Y+";"}var g=e.encode=function(ab){if(ab instanceof Array){for(var X=0,Y=ab.length;
X<Y;++X){ab[X]=g(ab[X])}return ab}var aa=typeof ab;if(D===ab||"undefined"===aa){return""}if((ab instanceof Date)||"number"===aa||"boolean"===aa){return ab
}if("object"===aa){for(var Z in ab){ab[Z]=g(ab[Z])}return ab}return ab.length?ab.replace(O,function(ac,ae,af){if("&"===ac){if(af>=0){var ad=ab.indexOf(";",af)+1-af;
if((ad>0)&&w.test(ab.substr(af,ad))){return"&"}}}return N[ac]||K(ac)}):""};n.prototype.toXml=function(){var aa=this,Z=(aa.checked&&aa.blocked),X=['name="'+g(aa.message)+'"',(aa.script||!aa.size)?"":'size="'+aa.size+'"','order="'+(aa.order||"0")+'"','priority="'+(aa.priority?"high":"normal")+'"','admin="'+(aa.needadmin?"1":"0")+'"','restart="'+(aa.needrestart?"1":"0")+'"','reboot="'+(aa.needreboot?"1":"0")+'"','disabled="'+(aa.disabled?"1":"0")+'"','depends="'+(Z?"1":"0")+'"'];
if(Z){var ab=W.diagnostics.getFixer(),Y=ab.getBlockingTitle(aa.name);if(Y){X.push('blocking-title="'+g(Y)+'"')}}return"<fix "+X.join(" ")+" />"};n.Defaults={};
n.toXml=function(X){if(X&&X.length){var ac=c.getCurrentUrl(),Z=!!(z.View&&z.View.onDiagnosisClick),aa=!Z&&ac&&z.Test("//help\\d?\\.|:(4917|5017|56450|57450)","i")(ac),ad=W.diagnostics.getFixer().getWarning(Z||aa),ae=["<fixes"+(ad?' warning="'+ad+'"':"")+">"];
for(var Y=0,ab=X.length;Y<ab;++Y){ae.push(X[Y].toXml())}ae.push("</fixes>");return ae.join("")}return""};n.Tags={APPDATA:"appdata",MSI:"msi",KE:"ke",UC:"uc"};
function e(){var Z={},Y={},X=this;X.setValue=function(ab,ad,ac,aa){M(Z,ab,ad);if(arguments.length>2){X.setMessage(ab,ac,aa)}};X.setValueEx=function(aa,ad){var ac=ad.length;
if(0!==ac%2){throw new Error("Invalid count of pathValues")}if("/"!==aa.substr(aa.length-1,1)){aa+="/"}for(var ab=0;ab<ac;ab+=2){M(Z,aa+ad[ab],ad[ab+1])
}};X.getValue=function(aa){return t(Z,aa)};X.setMessage=function(ab,ac,aa){M(Y,ab,{status:ac,comment:aa},function(ad){if(("undefined"!=typeof(ac))&&(!ad.status||ad.status<ac)){ad.status=ac;
if(ad.status<0){ad.status=0}}})};X.getMessage=function(aa){return t(Y,aa)};X.setMessages=function(aa){Y=aa};X.getValues=function(){return Z};X.setValues=function(aa){Z=aa
};X.toXml=function(ac){function aa(ad){var ae="";if(ad){if("undefined"!=typeof(ad.status)){ae+=' status="'+ad.status+'"'}if(ad.comment&&ad.comment.length){ae+=' comment="'+g(ad.comment)+'"'
}}return ae}function ab(al,ag,af){var am="",ak=typeof(al);if("string"===ak){am+=g(al)}else{if("number"===ak||"boolean"===ak||z.isDate(al)){am+=al.valueOf()
}else{if(al instanceof Array){am+="<values>";for(var ad=0,ae=al.length;ad<ae;++ad){var ah=ag?ag[ad]:D;am+="<value"+aa(ah)+">";am+=ab(al[ad],ah||{},af+1)+"</value>"
}am+="</values>"}else{if((D!==al)&&("object"==ak)){for(var aj in al){var ai=ag?ag[aj]:D;am+='<item id="'+g(aj)+'"'+aa(ai)+">";am+=ab(al[aj],ai||{},af+1)+"</item>";
if(af<3){am+="\r\n"}}}}}}return am}return"<diagnosis>"+ab(Z,ac?Y:{},1)+"</diagnosis>"};X.toHtml=function(ab,aa){return r(aa?X.getValue(aa):Z,Y,aa||"",aa?1:0,{withHeaders:ab})
}}function a(X,Y){return(X&&X.length)?X+"/"+Y:Y}var d=V,I=V;function L(){d=V;I=V}function Q(ac,ad,ab){ab=ab||{};if(V===I){var X=e.TranslatesData;d=X["Assay/Default/"];
I=X["Assay/ByProfile/"];if(I){I=I[(window.profileName||"")+"/"]}}var aa=(ac?(ac+"/"):"")+ad;if(I){try{return P(I,aa,U)}catch(Y){}}try{return P(d,aa,U)}catch(Z){}return ab.defaultValue||String(ab.noencode?ad:g(ad))
}function y(Y,ad){var ac=ad.split("/"),X=Y,ab="";for(var Z=0,aa=ac.length;Z<aa;++Z){ab+=ac[Z];if(Z<aa-1){ab+="/"}if(V!==X[ab]){X=X[ab];ab=""}else{if(Z>=aa-1){return false
}}}return true}function x(Z,X){var Y=e.TranslatesData["Fixes/"];return y(Y,X?Z+"/caption":Z)}function S(Z,X){var Y=e.TranslatesData["Fixes/"];return X?{caption:P(Y,Z+"/caption"),message:X+" "+P(Y,Z+"/message")}:P(Y,Z)
}function r(ab,Y,aa,X,Z){return J.resolve(e.Formatters[aa||""]||e.defaultFormatter).then(function(ac){return ac(ab,(Y&&aa)?(Y[aa]||Y):(Y||D),aa,X||0,Z)
})}function s(X){if(X&&X.comment&&X.comment.length){return'<div class="diag-comment">'+X.comment+"</div>"}return""}function B(){return((W.diagnostics||W.diagnosis||{}).diagId||0)<=4083690
}function R(Z,X,Y){if(X&&X.comment&&X.comment.length){Y=(Y||B())?{noencode:U}:D;return'<div class="diag-comment">'+Q(Z,X.comment,Y)+"</div>"}return""}var v=e.getStatusHtml=function(Y,X){if(!Y||V===Y.status){return""
}return'<span class="'+(X?"diag-head-status-":"diag-status-")+Y.status+'">&nbsp;</span>'};e.defaultFormatter=function(af,aa,ac,Z,ab){var ag=ab&&ab.withHeaders;
if(aa&&aa.CryptoPro&&("undefined"!=typeof(aa.CryptoPro.status))){var ad=0;q(aa.CryptoPro,function(ai,ah){ad=ah&&ah.status&&ah.status>ad?ah.status:ad});
aa.CryptoPro.status=ad}var Y="",ae=typeof(af);if("string"===ae||"number"===ae||"boolean"===ae){Y=Q(ac,af);if(aa){Y+=R(ac,aa)}}else{if(z.isDate(af)){Y=af.toLocaleString();
if(aa){Y+=R(ac,aa)}}else{if("undefined"!==ae&&D!==af){++Z;if(af instanceof Array){if(aa){Y+=R(ac,aa)}Y+='<div class="diag-array">';return J.each(af,function(ai,ah){return r(ai,aa?aa[ah]:D,ac,Z).then(function(aj){Y+='<div class="diag-array-item">'+aj+"</div>"
})}).then(function(){return Y+"</div>"})}else{if("object"===ae){var X=k;return J.fork(1===Z,function(){return J.each(af,function(ai,ak){var ah=aa&&aa[ai],aj=ah&&ah.status;
Y+='<div class="diag-script'+((aj>0)?"-"+aj:"")+'">';if(aa){Y+=v(ah,U)}Y+=Q(ac,ai)+"</div>";return r(ak,ah,a(ac,ai),Z,ab).then(function(al){Y+='<div id="diag-script-'+ai+'">'+al+"</div>"
})}).then(function(){return Y})},function(){return J.fork(aa,function(){Y+=R(ac,aa);for(var ai in af){var ah=aa[ai];if(ah&&("undefined"!=typeof(ah.status))){X=U;
break}}}).then(function(){Y+='<table class="diag-object diag-level-'+Z+'">';return af}).each(function(ai,aj){Y+='<tr id="'+ai+'">';var ah=aa?aa[ai]:D;if(X){Y+='<td class="diag-status">'+v(ah)+"</td>"
}if(ag||(2!==Z)){Y+='<td class="diag-key">'+Q(ac,ai)+"</td>"}return r(aj,ah,a(ac,ai),Z).then(function(an){an=(an||(0===an))?an:"&nbsp;";var al=("string"==typeof(an)),ak=al?"&nbsp;":an.first,am=al?an:an.second;
if(ah&&ah.allwidth){Y+="<td>"+ak+"</td></tr>";Y+="<tr>"+(X?"<td>&nbsp;</td>":"");Y+='<td class="diag-value" colspan="2">'+am}else{Y+='<td class="diag-value">';
Y+=(am||ak||"&nbsp;")}Y+="</td></tr>"})}).then(function(){Y+="</table>";return Y})})}}}}}return J.resolve(Y)};e.createArrayFormatter=function(X){return function(af,ad,ae,ac){if(!(af instanceof Array)){return e.defaultFormatter(af,ad,ae,ac)
}var Y=k,aa,ab;if(ad){for(aa=0,ab=af.length;aa<ab;++aa){if(V!==ad[aa]){Y=U;break}}}var Z=[];if(ad){Z.push(ae?R(ae,ad):s(ad))}Z.push('<table class="diag-object-array"><tr>');
if(Y){Z.push("<td></td>")}for(aa=0,ab=X.length;aa<ab;++aa){Z.push('<th class="diag-key">'+Q(ae,X[aa])+"</th>")}Z.push("</tr>");return J.each(af,function(ai,ag){Z.push("<tr>");
var ah=ad?ad[ag]:D;if(Y){Z.push('<td class="diag-status">'+v(ah)+"</td>")}return J.each(X,function(aj){return r(ai?ai[aj]:"",ad?(ah?(ah[aj]||ah):ad[aj]):D,a(ae,aj)).then(function(ak){Z.push('<td class="diag-value">'+((ak&&ak.length)?ak:"&nbsp;")+"</td>")
})}).then(function(){Z.push("</tr>")})}).then(function(){Z.push("</table>");return Z.join("\r\n")})}};e.pivotFormatter=function(ac,Z,ab,Y){if("string"==typeof(ac)){return e.defaultFormatter(ac,Z,ab,Y)
}var X=[],aa;if(Z){X.push(ab?R(ab,Z):s(Z))}X.push('<table class="diag-object-pivot"><tr>');for(aa in ac){X.push('<th class="diag-key">'+Q(ab,aa)+"</th>")
}X.push("</tr><tr>");return J.each(ac,function(ad,ae){return r(ae,Z?Z[ad]:D,a(ab,ad),Y+1).then(function(af){X.push('<td class="diag-value">'+af+"</td>")
})}).then(function(){X.push("</tr></table>");return X.join("\r\n")})};function u(X){if(!X){throw"Invalid path"}return(X instanceof Array)?X:X.split("/")
}function t(Y,ac){var X=Y,aa=u(ac);for(var Z=0,ab=aa.length;Z<ab;++Z){X=X[aa[Z]];if(X===V){break}}return X}function M(Z,ae,af,Y){if("undefined"==typeof(af)){af={}
}var X=Z,ac=u(ae),ad=ac.length-1;for(var aa=0;aa<ad;++aa){var ab=ac[aa];if("undefined"==typeof(X[ab])){X[ab]={}}if(Y){Y(X[ab])}X=X[ab]}X[ac[ad]]=af}function P(Y,ae,af){var ad=ae.split("/"),X=Y,ac="";
for(var aa=0,ab=ad.length;aa<ab;++aa){ac+=ad[aa];if(aa<ab-1){ac+="/"}if(V!==X[ac]){X=X[ac];ac=""}else{if(aa>=ab-1){var Z="translation missing: "+ae;if(af){throw new Error(Z)
}return"("+Z+")"}}}return X}function T(aa){var X=e.TranslatesData["Warnings/"],Y=aa.split("/"),ab="",Z="";q(Y,function(ac){ac=Z+ac;ab+=P(X,ac);Z=ac+"/"
});return ab}var p={archive:function(X){var Y={"Certificates.Capicom":U,"CryptoPro.CSP3X":U,"KonturExtern.KonturArchive":U,"KonturExtern.KonturToolbox2":U,"KonturExtern.KonturToolbox3":U,"KonturExtern.NET40Full":U,"KonturExtern.NET40Patch":U,"Windows.CryptSvc":U,"Windows.FixAppData":U,"Windows.FixTemp":U,"Windows.KonturDiag":U,"Windows.TrustedInstaller":U};
q(X,function(Z){Z.priority=Y[Z.name]?1:0});return X}};e.resetAssays=L;e.translateAssay=Q;e.translateComment=R;e.translateFix=S;e.hasTranslation=x;e.translateWarning=T;
e.getComment=s;e.Translates={};e.Formatters={}}(window.SkbKontur.Help));window.SkbKontur.Help.Core.vars.productSizes={"alko-icon48.ico":22486,"archive-icon48.ico":22486,"bank-icon48.ico":18902,"buhgalteria-icon48.ico":21278,"ca-icon48.ico":22486,"crypto-icon48.ico":22486,"csp.ico":1406,"cspoff.ico":1150,"diadoc-eco48.ico":22486,"diag-icon48.ico":22486,"edi-icon48.ico":22486,"egais-icon48.ico":22486,"eias.ico":17542,"elba-icon48.ico":22486,"etprf.ico":9062,"extern-icon48.ico":22486,"fms-icon48.ico":22486,"fts-icon48.ico":22486,"kassa-icon48.ico":21278,"kelite-icon48.ico":22486,"kemb-icon48.ico":22486,"kontur-icon48.ico":22486,"ktb.ico":3638,"kub-icon48.ico":12014,"market-icon48.ico":22486,"normativ-icon48.ico":22486,"ofd-icon48.ico":22486,"otchet-eco48.ico":18902,"pnv.ico":16958,"rosreestr.ico":1406,"rpn-eco48.ico":18902,"sberbank.ico":1150,"school-icon48.ico":22486,"sverka-icon48.ico":22486,"ubrr.ico":3382,"vnc-icon48.ico":22486,"zakupki-icon48.ico":22486,"7z-x64.exe":1381582,"7z.exe":1110564,"7za.exe":652800,"acrordrdc1500720033_ru_ru.exe":50569888,"adberdr11000_ru_ru.exe":38273168,"addtotrusted.exe":132168,"addtotrusted.zip":102864,"addtotrusted_egais.exe":131656,"addtotrusted_egais.zip":102660,"addtotrusted_egais_user.exe":130120,"addtotrusted_egais_user.zip":101594,"addtotrusted_etprf.exe":131656,"addtotrusted_etprf.zip":102547,"addtotrusted_etprf_user.exe":130120,"addtotrusted_etprf_user.zip":101492,"addtotrusted_ktb.exe":131656,"addtotrusted_ktb.zip":102539,"addtotrusted_ktb_user.exe":130120,"addtotrusted_ktb_user.zip":101483,"addtotrusted_min.exe":135792,"addtotrusted_min.zip":105653,"addtotrusted_min_user.exe":134768,"addtotrusted_min_user.zip":105313,"addtotrusted_tander.exe":131656,"addtotrusted_tander.zip":102503,"addtotrusted_tander_user.exe":130120,"addtotrusted_tander_user.zip":101455,"addtotrusted_uc.exe":133632,"addtotrusted_uc.zip":104341,"addtotrusted_uc_user.exe":133120,"addtotrusted_uc_user.zip":103715,"addtotrusted_user.exe":131656,"addtotrusted_user.zip":102308,"adipnv.msi":26836992,"adipnv_2.5.3.msi":21282816,"adipnv_2.5.3_x64.msi":21188608,"adipnv_x64.msi":26775552,"agzrtcryptprovider.setup.exe":1023208,"aktivdiag2_admin.exe":509760,"aktivdiag2_user.exe":507576,"blank.htm":336,"cadesplugin.exe":6505104,"cadessites.exe":96792,"capicom.exe":282544,"certfix.exe":574520,"certificates_centerinform_admin.exe":568760,"certificates_centerinform_user.exe":568760,"certificates_csp_admin.exe":306664,"certificates_csp_user.exe":306664,"certificates_fed_admin.exe":461240,"certificates_fed_user.exe":461240,"certificates_kontur_admin.exe":586168,"certificates_kontur_user.exe":586168,"certificates_market_admin.exe":286184,"certificates_market_user.exe":286184,"certificates_rpn_admin.exe":568248,"certificates_rpn_user.exe":568248,"certificates_tander_admin.exe":283624,"certificates_tander_user.exe":283624,"chromestandalonesetup49.exe":46581664,"chromestandalonesetuplatest.exe":49821800,"chromestandalonesetuplatestx64.exe":50296936,"comoverusb.exe":2933243,"comproxywindows.exe":1211624,"cpfixit.exe":89208,"cpfox.win32.exe":42696992,"cpnetsetup.exe":1547520,"cppdfsetup.exe":4996000,"cpverify.exe":76056,"cryptoarm4.exe":32928680,"cryptoarm5.exe":51134296,"cryptomoscow.exe":1032219,"cryptoproofficesignature10.exe":1052872,"cryptoproofficesignature20.exe":1864232,"cryptorinstaller.exe":30512696,"csp36r4setup.exe":4225664,"csp39r2setup.exe":4532904,"csp39setup.exe":4322568,"csp39setupupdate.exe":4377888,"csp40r2setup.exe":5418256,"csp40setup.exe":4817240,"cspclean.exe":118312,"cspcom_v2.msi":196608,"diag.helper@skbkontur.ru.crx":14220,"diag.helper@skbkontur.ru.opera.crx":12439,"diag.helper@skbkontur.ru.xpi":16687,"diagplugin_admin.exe":341832,"diagplugin_admin_aktiv.exe":345944,"diagplugin_user.exe":339000,"diagplugin_user_aktiv.exe":343472,"dotnet35_win10.exe":77937360,"dotnet35_win10_x64.exe":144903784,"dotnet35_win7.exe":80544,"dotnet35_win8.exe":31323504,"dotnet35_win81.exe":31346072,"dotnet35_win81_x64.exe":57391216,"dotnet35_win8_x64.exe":57449352,"dotnetfx35setup.exe":2959376,"dotnetfx40_client.exe":887896,"dotnetfx40_full.exe":889416,"drvfr.exe":6724688,"egaiscryptosetup.exe":13140208,"egaissetup.exe":27566880,"egaissetup_java.exe":45386848,"eias.reporting.msi":40520291,"enableplugins.exe":136648,"enableplugins_or.exe":119488,"esmart_token_usb_64k_pcsc_driver.msi":1516032,"esmart_token_usb_64k_pcsc_driver_x64.msi":1896448,"ethoverusb.exe":10732016,"ffactivex-setup-r36.exe":395398,"firefoxsetup.exe":45335016,"firefoxsetupesr.exe":45642448,"firefoxsetuplatest.exe":37225680,"firefoxsetuplatestx64.exe":40111392,"fiscalmaster.exe":3406848,"fito.exe":1350848,"fixdll2003.exe":3149184,"fixdll7.exe":4009472,"fixdllvista.exe":3539536,"fixdllxp.exe":1434400,"fixie64.zip":796,"flash_player_activex.exe":20302848,"flash_player_plugin.exe":20822528,"flash_player_uninstall.exe":1348096,"fsrar-crypto2.exe":6916512,"ftps.exe":279416,"ftssignpluginsetup.msi":2490368,"ibank2key-driver-windows-x64-1.11.exe":2912840,"ibank2key-driver-windows-x86-1.11.exe":2761168,"ie10-windows6.1-x64-en-us.exe":44335120,"ie10-windows6.1-x64-ru-ru.exe":46684160,"ie10-windows6.1-x86-en-us.exe":23062528,"ie10-windows6.1-x86-ru-ru.exe":25368576,"ie11-windows6.1.exe":2077392,"ie8-windowsserver2003-x64-enu.exe":33972080,"ie8-windowsserver2003-x64-rus.exe":34141024,"ie8-windowsserver2003-x86-enu.exe":16862576,"ie8-windowsserver2003-x86-rus.exe":17011056,"ie8-windowsvista-x64-enu.exe":25492336,"ie8-windowsvista-x64-rus.exe":26526576,"ie8-windowsvista-x86-enu.exe":13944160,"ie8-windowsvista-x86-rus.exe":14958960,"ie8-windowsxp-kb2586448-x86-enu.exe":10565504,"ie8-windowsxp-kb2586448-x86-rus.exe":10571648,"ie8-windowsxp-x86-enu.exe":16883056,"ie8-windowsxp-x86-rus.exe":17028448,"ie9-windows7-x64-enu.exe":36380976,"ie9-windows7-x64-rus.exe":36984112,"ie9-windows7-x86-enu.exe":18124080,"ie9-windows7-x86-rus.exe":18708784,"ie9-windowsvista-x64-enu.exe":36138288,"ie9-windowsvista-x64-rus.exe":36902704,"ie9-windowsvista-x86-enu.exe":18005296,"ie9-windowsvista-x86-rus.exe":18751792,"ifcplugin-x64.msi":6017024,"ifcplugin.msi":2686976,"install-ke.exe":164352,"install-ke.zip":129015,"jacartaunifiedclient_x64.msi":64704512,"jacartaunifiedclient_x86.msi":44171264,"jc-webclient.msi":11161600,"jre-7u80-windows-i586.exe":29509544,"jre-8u161-windows-i586.exe":64333888,"kelite-center-inform.msi":9646080,"kelite-latest.msi":9412608,"kelite-sibtel.msi":9457664,"kkt_8_full.exe":72870541,"kontur-plugin-3.1.1.xpi":10470,"kontur-plugin.xpi":17753,"kontur.1c_2.0.admin.msi":2334720,"kontur.1c_2.0.msi":1441792,"kontur.1c_3.0.admin.msi":2322432,"kontur.1c_3.0.msi":1429504,"kontur.agent.installer.exe":2684400,"kontur.archive.exe":4028232,"kontur.diadoc.addon.exe":2849840,"kontur.kassa.installer.exe":1552440,"kontur.plugin.exe":5885176,"kontur.toolbox-1.1.10.msi":303104,"kontur.toolbox.forall-1.1.10.msi":307200,"kontur.toolbox2.admin.exe":2485232,"kontur.toolbox2.exe":2482752,"konturdiag2_admin.exe":505488,"konturdiag2_or_admin.exe":492232,"konturdiag2_or_user.exe":489976,"konturdiag2_user.exe":502648,"konturmarketkassa.appxbundle":9264942,"konturvnc-test.exe":2926944,"konturvnc.exe":2928272,"kvnviewer-test.exe":1341056,"kvnviewer.exe":1341520,"lanit.exe":184752,"localstorage.forall.msi":413696,"localstorage.msi":413696,"lpcvcom.exe":5224368,"microsoft.net.native.framework.1.3.appx":2665923,"microsoft.net.native.runtime.1.4.appx":201180,"microsoft.vclibs.x86.14.00.appx":607410,"msxml6_x64.msi":2610688,"msxml6_x86.msi":1462272,"ndp40-kb2468871-v2-x64.exe":28640160,"ndp40-kb2468871-v2-x86.exe":19556328,"netfx2.0-kb948609-v6001-x64.msu":30479328,"netfx2.0-kb948609-v6001-x86.msu":19571330,"netfx20sp2_x64.exe":48524296,"netfx20sp2_x86.exe":25001480,"pcsc.msp":39936,"pkiclient.exe":365648,"pnvlauncher.exe":127776,"regdll.exe":107168,"regdll2.exe":104536,"regoids.exe":113440,"rtcomlite.exe":572024,"rtdrivers.exe":15352368,"rtsup_cryptopro.x64.v.2.43.00.0164.exe":1616944,"rtsup_cryptopro.x86.v.2.43.00.0164.exe":1405984,"rutokenfix.exe":480608,"rutokenplugin.msi":4952064,"sha256.zip":11366197,"silentsetup-2_0_3.exe":74191982,"silverlight.exe":7029472,"silverlight_x64.exe":13166304,"ssceruntime_x64-enu.exe":2638632,"ssceruntime_x64-rus.exe":2678368,"ssceruntime_x86-enu.exe":2397488,"ssceruntime_x86-rus.exe":2436352,"teamviewer9.exe":7176392,"teamviewerqs_kontur9.exe":5066344,"teamviewerqs_sibtel-crypto10.exe":5463248,"testequipment.exe":144328,"updatetimezones_enu.exe":199888,"updatetimezones_rus.exe":200848,"vcredist_2008_sp1_x86_en.exe":4216840,"vcredist_2008_sp1_x86_ru.exe":4129616,"vcredist_2010_x86.exe":4995416,"wcftocom.exe":137392,"windows-kb890830-v5.55.exe":41329824,"windows-kb890830-x64-v5.55.exe":42151072,"windows6.0-kb942288-v2-x64.msu":3086960,"windows6.0-kb942288-v2-x86.msu":1768236,"windowsserver2003-kb2758857-x86-enu.exe":826936,"windowsserver2003-kb2758857-x86-rus.exe":840248,"windowsserver2003-kb942288-v4-x64.exe":4691480,"windowsserver2003-kb942288-v4-x86.exe":3071512,"windowsserver2003.windowsxp-kb2758857-x64-enu.exe":1919048,"windowsserver2003.windowsxp-kb2758857-x64-rus.exe":1934896,"windowsupdateagent30-x86.exe":6776168,"windowsxp-kb2758857-x86-enu.exe":815144,"windowsxp-kb2758857-x86-rus.exe":828480,"windowsxp-kb2802968-x86-enu.exe":760880,"windowsxp-kb2802968-x86-rus.exe":768048,"windowsxp-kb942288-v3-x86.exe":3327000,"утилита настройки актив рутокен.exe":96552,"утилита настройки скб контур.exe":101624};
(function(G){var f=G.Core,n=G.Diagnosis,s=G.foreach,T=G.map,S=f.getLocator(),w=f.getCertificateDate,y=f.getCertificateInfo,z=f.getCertificateName,x=f.getCertificateIdentity,A=f.getCertificateOrg,D=f.getDMYString,J=f.importCertificate,L=f.isCertificateKEP,an=f.certViewDisallowed,ao=f.certViewOther,ap=f.certViewPrivate,m=n.defaultFormatter,p=n.encode,ai=n.translateComment,ak=f.vars;
f.formatDate=t;var U=ak.microsoftLinkRoot="http://download.microsoft.com/download/",o=U+"c/6/e/c6e88215-0178-4c6c-b5f3-158ff77b1f38/";ak.dotNetLink32=o+"NetFx20SP2_x86.exe";
ak.dotNetLink64=o+"NetFx20SP2_x64.exe";ak.dotNetLink35SP1=U+"2/0/e/20e90413-712f-438c-988e-fdaa79a8ac3d/dotnetfx35.exe";var V="F/F/D/FFDF76E3-9E55-41DA-A750-1798B971936C/ENU/",W="2/1/B/21BD14B2-F928-46A9-BCDB-A2EB05B03986/RUS/";
ak.mssql40ce32enu=U+V+"SSCERuntime_x86-ENU.exe";ak.mssql40ce32rus=U+W+"SSCERuntime_x86-RUS.exe";ak.mssql40ce64enu=U+V+"SSCERuntime_x64-ENU.exe";ak.mssql40ce64rus=U+W+"SSCERuntime_x64-RUS.exe";
ak.cspDownloadLink="https://www.cryptopro.ru/products/csp/downloads";var k="www.cryptopro.ru/sites/default/files/products/",i=k+"net/files/1.0.6397.0/NETSetup.exe",j=k+"pdf/files/20/811/cppdfsetup.exe";
ak.cspNETLink="https://"+i;ak.cspNETHttpLink="http://"+i;ak.cspPDFLink="https://"+j;ak.cspPDFHttpLink="http://"+j;var ac="ftp://ftp.rutoken.ru/software/Rutoken/",aa=ac+"Drivers/Current/",ab="rtDrivers.exe",ag="v.2.43.00.0164",af=ac+"Support_CryptoPro/CSP/"+ag+"/",ad=ak.rutokenSupExe32="rtSup_CryptoPro.x86."+ag+".exe",ae=ak.rutokenSupExe64="rtSup_CryptoPro.x64."+ag+".exe";
ak.rutokenDrv=aa+ab;ak.rutokenSup32=af+ad;ak.rutokenSup64=af+ae;ak.iBank2KeyDriver32="iBank2Key-Driver-Windows-x86-1.11.exe";ak.iBank2KeyDriver64="iBank2Key-Driver-Windows-x64-1.11.exe";
var a="http://ardownload.adobe.com/pub/adobe/reader/win/";ak.adobeReader11Link=a+"11.x/11.0.00/ru_RU/AdbeRdr11000_ru_RU.exe";ak.adobeReaderDCLink=a+"AcrobatDC/1500720033/AcroRdrDC1500720033_ru_RU.exe";
ak.downloadSpeed=28000;ak.maxUploadFileCount=15;ak.maxUploadFileSize=15728640+10486;var h="^(КриптоПро|CryptoPro)\\s+",X="^Microsoft\\s+SQL\\s+Server\\s+Compact",am="^(MS|Microsoft)?\\s*Visual\\s*C\\+\\+\\s*",al="\\s+(Redist(ributable)?)?([\\s\\(\\-]*x86|[\\s\\(\\-]*32-bit|\\s*$)";
ak.licenseCSP36Guid="{54A08450-B343-40B0-924E-68F031450996}";ak.licenseCSP39Guid="{39D25A86-A5E6-42FC-9C8F-EFA4C138B08C}";ak.licenseCSP40Guid="{407E5BA7-6406-40BF-A4DC-3654B8F584C1}";
ak.licenseCSP50Guid="{50F91F80-D397-437C-B0C8-62128DE3B55E}";ak.productMasks={AdobeAcrobat:"^Adobe\\s+Acrobat\\s+[D\\d]",AdobeReader:"^(Acrobat|Adobe(\\s+Acrobat)?)\\s+Reader",AdiPNV:"^PNV$",AdobeFlashAX:"^Adobe\\s*Flash\\s*Player\\s*\\d+\\s*ActiveX",AdobeFlashNP:"^Adobe\\s*Flash\\s*Player\\s*\\d+\\s*NPAPI",CadesCOM:h+"(CADESCOM|ЭЦП Browser plug\\-in)",ComOverUSB:"^Virtual\\s*Com\\s*port\\s*driver",CryptEC:"^CryptEC-D",CryptoARM:"^(CryptoARM|КриптоАРМ)",CSPCOM:"^ЕФРСБ\\s*\\S\\s*компонент подписи ЭЦП",CSPCOMFF:"^Firefox\\s*ActiveX\\s*Plugin\\s*r36",CSP:h+"CSP",CSP_EFS:h+"EFS",CSP_FKC:h+"(FKC|ФКН)\\s+CSP",CSP_NET:h+"\\.NET\\s*((Client|Server|Клиент|Сервер)\\s*)?$",CSP_NETSDK:h+"\\.NET\\s+SDK",CSP_OffSign:h+"Office\\s+Signature",CSP_PDF:h+"PDF",CSP_RT:h+"(Rutoken|Рутокен)\\s+CSP",CSP_UEC:h+"(UEC|УЭК)\\s+CSP",Egais:"^ФСРАР\\s*(УТМ|ЕГАИС\\s*\\-\\s*ТРАНСПОРТ)",EIAS:"^(ФАС\\s*России)?\\s*(EИАС|ЕИАС)\\s*Мониторинг",ESmartDriver:"^ESMART\\s*Token\\s*USB\\s*64K\\s*PC\\/SC\\s*Driver",ETokenSCOM:"^EToken (for|для) signal\\-?com",FsrarCrypto:"^ФСРАР[\\s\\-]*Крипто\\s*[\\d\\.]+",GosUslugi:"^Плагин\\s+пользователя\\s+систем\\s+электронного\\s+правительства",IBank2KeyDriver:"^iBank 2 Key Driver",ICLSetup:"^Crypt\\s+V\\s*[\\d\\.]+",JCClient:"^JC\\-Client(x64)?\\s*[\\d\\.]+",JCGOSTClient:"^JC\\-GOSTClient\\s*[\\d\\.]+",JCUnifiedClient:"^Единый [Кк]лиент JaCarta",JCWebClient:"^JC\\-WebClient",KELite:"^(Контур[\\-\\.]Экстерн\\s+Лайт|Kontur[\\-\\.]Extern\\s+Lite)\\s*",Kontur1C:"^Компоненты интеграции .Контур[\\-\\.]Экстерн. и 1С",KonturToolbox:"^((Components\\s+of\\s+the\\s+)?Kontur[\\-\\.]Extern(\\s+components)?|Компоненты\\s+.?Контур[\\.\\-]Экстерн)",Lanit:"^Ланит\\.?\\s*Компонент\\s+формирования\\s+подписи",MSSQLCE35:X+"\\s+3\\.5\\s+SP[23456]\\s+(x64\\s+)?(ENU|RUS)",MSSQLCE40:X+"\\s+4\\.0\\s+SP[12345]\\s+(x64\\s+)?(ENU|RUS)",RutokenDriver:"^(Rutoken[\\'\\\"\\s]+Drivers|Драйвер[аы][\\'\\\"\\s]+Рутокен)",RutokenPlugin:"^(Rutoken Plugin|Рутокен Плагин)",RutokenSupport:"^(Rutoken\\s+support\\s+module|Модуль\\s+поддержки\\s+(Rutoken|Рутокен))",Silverlight:"^Microsoft\\s+Silverlight\\s*$",VCRedist2005:"("+am+"2005"+al+"|^\\s*MSVCRT80)",VCRedist2008:"("+am+"2008"+al+"|^\\s*MSVCRT90)",VCRedist2010:"("+am+"2010"+al+"|^\\s*MSVCRT100)",ViPNetClient:"^ViPNet Client",ViPNetCSP:"^ViPNet CSP"};
ak.productVersions={AdiPNVold:"1.6.9999",AdiPNVmid:"2.4.9999",AdiPNV:"4.4.0",AdobeReader11:"11.0",AdobeReaderDC:"15.7",CadesCOMMin:"2.0.12888",CadesCOM:"2.0.13064",Capicom:"2.1.0.2",ComOverUSB:"1.4.0",ComProxyJre7:"7.0.800.15",ComProxyJre8:"8.0.650.17",CPFoxMin:"45.0",CPFox:"45.1.2",CryptEC:"1.0.0",CryptoARM4:"4.7.1",CryptoARM5:"5.4.1",CryptoMoscow:"1.0.2.4",Cryptor:"1.1.0.81",CSP30SP0:"3.0.3293",CSP30SP1:"3.0.3300.1",CSP30SP2:"3.0.3300.2",CSP30:"3.0.3300.3",CSPupdateR3:"3.6.5365",CSP36R1:"3.6.5402",CSP36R2:"3.6.6497",CSP36R3:"3.6.7491",CSP36R4:"3.6.7777",CSP39:"3.9.8227",CSP39R2:"3.9.8495",CSP40:"4.0.9708",CSP40R2:"4.0.9842",CSP40_SSE2:"4.0.9844",CSP_NET:"1.0.6397",CSP_Ofs10:"1.0.870",CSP_Ofs20:"2.0.11980",CSP_PDF:"2.0.811",CSPCOM:"1.0.3",DiadocPrint:"1.3.2.0",DtoDriver:"8.14.2.2",EgaisRealMin:"2.0.1",EgaisRealMid:"2.0.3",EgaisReal:"2.1.6.2",EgaisJava:"1.8.0.65",EgaisJVM:"8.0.650.17",EgaisAgent:"2.0.0",EgaisInstaller:"2.0.0",EgaisMonitoring:"2.0.0",EgaisTransporter:"2.0.3",EgaisUpdater:"2.0.0",EIAS:"1.12.390",ESmartDriver:"1.0.0",FirefoxMin:"47.0",Firefox:"51.0.1",FirefoxESR:"52.6.0",FirefoxLatest:"58.0",FirefoxLastNPAPI:"54",FirefoxBadMin:"55",FirefoxBadMax:"59.999",FlashPlayerAX:"28.0.0.161",FlashPlayerFF:"28.0.0.161",FsrarCryptoMin:"1.0.0",FsrarCrypto:"2.0.2.6",FoxitReaderSufficient:"6.0",FoxitReaderLatest:"7.0.8.1216",GoogleChrome41:"41.0.2272.89",GoogleChrome49:"49.0.2623.112",GoogleChromeLatest:"64.0",GosUslugi:"2.0.6.0",IBank2KeyDriver:"1.11",IEDefault:"8.0",IE2000:"6.0",IEXP:"8.0.6001.18702",IEVista:"9.0.8112.16421",IEWin7:"10.0.9200.16521",IE8:"8.0.6001.18702",IE9:"9.0.8112.16421",IE10:"10.0.9200.16521",IE11:"11.0.9600.16428",JCUnifiedClientMin:"2.7.0",JCUnifiedClient:"2.9.0.1531",JCWebClientMin:"3.4.1",JCWebClient:"3.4.1.1010",KELiteSettings:"2.4.0",KELite:"4.21.0",KELiteInform:"4.21.0",KELiteSibtel:"4.21.0",Kontur1C:"1.3.6177",KonturAgent:"2.1.2.144",KonturArchive:"1.1.1",KonturKassa:"1.1.0.126",KonturToolboxMin2:"2.9.3.15",KonturToolboxHta2:"2.9.0.828",KonturToolbox2:"2.9.3.15",KonturToolboxPilot2:"2.9.3.15",KonturToolboxMin3:"3.9.1.202",KonturToolboxCrypto:"3.9.1.202",KonturToolboxKEMB:"3.9.1.202",KonturToolboxRAR:"3.9.1.202",KonturToolbox3:"3.9.1.202",KonturToolboxPilot3:"3.9.1.202",Lanit:"1.0.5",LesEgais:"2.3.252",MSSQLCE35:"3.5.8080",MSSQLCE40:"4.0.8876",OperaMin:"12.17",OperaStableMin:"24.0",OperaStableBad:"38.0",RtCOMLite:"1.0.3.1",RutokenDriverMin:"2.100.0",RutokenDriver:"4.3.2.0",RutokenPlugin:"4.0.2.0",RutokenSupport:"2.43.0",RutokenSupportFile:"1.82.2",RutokenSupportFile40:"1.82.3",ShFR:"4.13",Silverlight:"5.1.50428",WindowsInstaller:"4.5",WUApi:"7.4.7600.226",WcfToCom:"7.4.2.0",YandexBrowserMin:"12.0"};
ak.productStatus={installed:"ok",notInstalled:"not",error:"err"};if(!ak.productSizes){ak.productSizes={}}if(!ak.fileVersions){ak.fileVersions={}}var P="KonturToolbox2.",R=f.getKT2Version();
if(R&&R.length){var Q=R.split(new RegExp("\\.","g"));if(Q.length>3){R=[Q[0],Q[1],Q[2]].join(".")}}var N=[P+"About",P+"BinaryObject",P+"BinaryObjectService",P+"Certificate",P+"CertificateCollection",P+"CertificateStore",P+"CompressionService",P+"CryptoService",P+"FileObject",P+"FileSystemService",P+"GuiService"];
if(f.compareVersion("2.3.0",R)){if(f.compareVersion("2.5.1",R)){N.push(P+"BinaryStream");N.push(P+"ZipArchive")}N.push(P+"CryptoProvider");N.push(P+"OperationToken")
}var O=[];s(N,function(){O.push(R)});ak.konturToolbox2ObjectKeys=N;ak.konturToolbox2ObjectVersions=O;function E(au,at){var ar="Установка расширения ";if(!at){return ar+au
}return{chrome:ar+au+" для Google Chrome",ff:ar+au+" для Mozilla Firefox",opera:ar+au+" для Opera",yandex:ar+au+" для Яндекс.Браузера"}}var aj={"Actions/":{install:"Установка",reinstall:"Переустановка",remove:"Удаление",update:"Обновление"},"Adobe/AdobeFlashAxVersion":"Adobe Flash Player ActiveX","Adobe/AdobeFlashVersion/":{Main:"Adobe Flash Player",Plugin:"Adobe Flash Player Plugin"},"Adobe/AdobeReaderVersion/":{"11":"Adobe Reader 11",DC:"Adobe Reader DC"},"Adobe/PdfAssociation":"Настройка ассоциации файлов PDF","Adobe/SilverlightVersion":"Microsoft Silverlight","Antivirus/CompatibilityFlags":"Настройка параметров совместимости приложений","Antivirus/Autorun":"Отключение конфликтных программ в автозагрузке","Antivirus/Services":"Отключение конфликтных служб (MoviesToolbar, GuardMailRu, QipGuard)","Antivirus/Installed":"Проверка компьютера антивирусом Microsoft (декабрь 2017)","Antivirus/ScheduledJobs":"Удаление конфликтных задач из планировщика","Certificates/Capicom/":{message:"CAPICOM",caption:"CAPICOM"},"Certificates/CertOIDUC/":{fts:"Регистрация OID сертификатов для ФТС",uc:"Регистрация OID сертификатов для УЦ",rosreestr:"Регистрация OID сертификатов для УЦ и Росреестра"},"Certificates/Lanit/":{message:"Ланит - плагина для Портала Госзакупок",caption:"Ланит - плагин для Портала Госзакупок"},"Certificates/GosUslugi/":{message:"плагина для Портала Госуслуг",caption:"Плагин для Портала Госуслуг"},"Certificates/CSPCOM/":{common:"ЕФРСБ - компонент подписи ЭЦП для IE","fed/":{message:"плагина Федресурса для IE",caption:"Плагин Федресурса для IE"},"uc/":{message:"ЦРКИ - компонента подписи ЭП для IE",caption:"ЦРКИ - компонент подписи ЭП для IE"}},"Certificates/CSPCOMFF/":{common:"ЕФРСБ - компонент подписи ЭЦП для Firefox","fed/":{message:"плагина Федресурса для Firefox",caption:"Плагин Федресурса для Firefox"},"uc/":{message:"ЦРКИ - компонента подписи ЭП для Firefox",caption:"ЦРКИ - компонент подписи ЭП для Firefox"}},"Certificates/AgzrtCrypt/":{message:"плагина AgzrtCrypt для zakazrf.ru и etprf.ru",caption:"Плагин AgzrtCrypt для zakazrf.ru и etprf.ru"},"Certificates/CryptoMoscow/":{message:"Крипто компоненты для портала поставщиков Москвы",caption:"Крипто компонента для портала поставщиков Москвы"},"Certificates/LesEgais/":{message:"плагина для портала ЕГАИС древесины lesegais.ru",caption:"Плагин для портала ЕГАИС древесины lesegais.ru"},"Certificates/VCRedist2008/":{uc:'MS VC++ 2008 Runtime для АСЭЗ "Газпром"',rpn:"MS VC++ 2008 Runtime"},"Certificates/VCRedist2010/":{uc:'MS VC++ 2010 Runtime для АСЭЗ "Газпром"',rpn:"MS VC++ 2010 Runtime"},"Certificates/CACerts/":{message:"сертификатов УЦ",caption:"Сертификаты УЦ"},"Connection/MSXMLDLL":"Восстановление файла MSXML","CryptoARM/ARMVersion":"КриптоАРМ","CryptoARM/ARMLicense":"Ввод лицензии КриптоАРМ","CryptoPro/RegCryptography":"Восстановление прав ветки реестра Cryptography","CryptoPro/RegSettings":"Настройка прав в реестре для КриптоПро CSP","CryptoPro/CSPVersion":"КриптоПро CSP","CryptoPro/CSPVersion/":{nover:"КриптоПро CSP","3.9":"КриптоПро CSP 3.9","3.9R2":"КриптоПро CSP 3.9 R2","4.0":"КриптоПро CSP 4.0","4.0R2":"КриптоПро CSP 4.0 R2"},"CryptoPro/CSPLicLevel":"Настройка подавления запросов лицензии КриптоПро CSP","CryptoPro/CSPNewGost":"Скрывать сообщения КриптоПро о переходе на новый ГОСТ","CryptoPro/CSPLicense":"Продление лицензии КриптоПро CSP","CryptoPro/CSPCarriers":"Увеличение макс. кол-ва контейнеров","CryptoPro/CSPReaders":"Настройка считывателей КриптоПро","CryptoPro/CSPRandom":"Настройка Биологического ДСЧ в КриптоПро CSP","CryptoPro/CadesCOM":"КриптоПро ЭЦП Browser plug-in","CryptoPro/CadesSites":"Настройка надежных узлов для КриптоПро ЭЦП Browser plug-in","CryptoPro/CSPOffSign/":{"1.0":"КриптоПро Office Signature 1.0","2.0":"КриптоПро Office Signature 2.0"},"CryptoPro/CSPOffSigLic":"Продление лицензии КриптоПро Office Signature","CryptoPro/CSPNet":"КриптоПро .NET","CryptoPro/CSPPdf":"КриптоПро PDF","CryptoPro/VipNetCSPConflict":"Настройка работы КриптоПро CSP и ViPNet CSP","CryptoPro/ContinentApConflict":"Настройка работы КриптоПро CSP и Континент-АП","CryptoPro/SupLegCS":"Включение старых шифров в КриптоПро CSP","IE/TrustedSettings":'Настройка зоны "Надежные узлы"',"IE/StartWindowsUpdate":'Запуск службы "Автоматическое обновление"',"IE/KB2586448/":{message:"обновления KB2586448",caption:"Обновление KB2586448"},"IE/IEVersion/":{nover:"Microsoft Internet Explorer","8":"Microsoft Internet Explorer 8.0","9":"Microsoft Internet Explorer 9.0","10":"Microsoft Internet Explorer 10","11":"Microsoft Internet Explorer 11"},"IE/UserAgent":"Изменение неверного UserAgent у Internet Explorer","IE/CompatMode":"Отключение режима совместимости Internet Explorer","IE/ParentalControl":"Отключение родительского контроля в Internet Explorer","IE/EnterpriseMode":"Настройка Режима Предприятия для Internet Explorer","IE/SyncMode":"Изменение режима кеширования страниц Internet Explorer","IE/DOMStorage":"Настроить размер хранилища DOM","IE/ClearTemp":"Очистка Cookies и временных файлов Internet Explorer","IE/AdditionalSettings":"Корректировка дополнительных настроек Internet Explorer","IE/Addons":"Отключение конфликтных надстроек IE (ICQ Toolbar и прочих)","IE/IEisDefault":"Сделать Internet Explorer интернет-браузером по умолчанию","Java/JavaVersion/":{"1.7":"Java Runtime 1.7","1.8":"Java Runtime 1.8"},"Java/FsrarCrypto/":{message:"модуля ФСРАР-Крипто 2",caption:"Модуль ФСРАР-Крипто 2"},"Java/EgaisJava":"Java Runtime 1.8 для ЕГАИС","Java/EgaisReal/":{message:"продуктивного модуля УТМ ЕГАИС",caption:"Продуктивный модуль УТМ ЕГАИС"},"Java/UTMToken/":{jacarta:"Перенастройка и запуск УТМ для работы с JaCarta SE",rutoken:"Перенастройка и запуск УТМ для работы с Рутокен ЭЦП 2.0",other:"Перенастройка и запуск УТМ для работы с другим USB-токеном"},"Java/TransportSvc/":{install:'Установка и запуск службы "Transport" для УТМ ЕГАИС',run:'Запуск службы "Transport" для УТМ ЕГАИС'},"Java/TransportMonitoringSvc/":{install:'Установка и запуск службы "Transport-Monitoring" для УТМ ЕГАИС',run:'Запуск службы "Transport-Monitoring" для УТМ ЕГАИС'},"Java/TransportUpdaterSvc/":{install:'Установка и запуск службы "Transport-Updater" для УТМ ЕГАИС',run:'Запуск службы "Transport-Updater" для УТМ ЕГАИС'},"Java/KonturKassa":"Контур.Кассовый агент","KELite/KELiteVersion":"Контур.Экстерн Лайт","KELite/Firebird":"Запуск службы Firebird для Контур.Экстерн Лайт","KELite/Accounts":"Дополнительная настройка Firebird для Контур.Экстерн Лайт","KonturExtern/NetFramework/":{xp:".NET Framework 2.0 SP2",win7:"Включение .NET Framework 2.0-3.5 в Windows 7",win8:".NET Framework 2.0-3.5 для Windows 8",win81:".NET Framework 2.0-3.5 для Windows 8.1",win10:".NET Framework 2.0-3.5 для Windows 10"},"KonturExtern/NET40Full":".NET Framework 4.0 Full","KonturExtern/NET40Patch/":{message:"обновления KB2468871 для .NET 4.0",caption:"Обновление KB2468871 для .NET 4.0"},"KonturExtern/KonturAgent":"Контур.Агент","KonturExtern/KonturArchive":"Контур.Архив","KonturExtern/KonturToolbox/":{message:"компонента Контур.Тулбокс",caption:"Компонент Контур.Тулбокс"},"KonturExtern/KonturToolbox2/":{message:"компонента Контур.Тулбокс",caption:"Компонент Контур.Тулбокс"},"KonturExtern/KonturToolbox3/":{message:"компонента Контур.Плагин",caption:"Компонент Контур.Плагин"},"KonturExtern/EIASVersion":"ЕИАС Мониторинг","KonturExtern/Kontur1C/":{message:"модуля Контур.Экстерн для 1C",caption:"Модуль Контур.Экстерн для 1C"},"KonturExtern/DiadocPrint/":{message:"модуля для печати зашифрованных документов",caption:"Модуль для печати зашифрованных документов"},"KonturExtern/Cryptor/":{message:"крипто-утилиты для подписания файлов",caption:"Крипто-утилита для подписания файлов"},"Market/DevMode":"Включение режима разработчика Windows","Market/MarketApp/":{message:"приложения для кассы Контур.Маркет",caption:"Приложение для кассы Контур.Маркет"},"Market/DtoDriver/":{message:"драйверов ДТО",caption:"Драйверы ДТО"},"Market/EoU":'Настройка службы "EoU"',"Market/ComOverUSB/":{message:"компонента COM-over-USB",caption:"Компонент COM-over-USB"},"Market/ComProxyJava":"Java Runtime 1.8 для ComProxy","Market/ComProxy":'Настройка службы "ComProxy"',"Market/WcfToCOM":'Настройка службы "wcf2com"',"Market/WcfToCOM/":{install:'Установка службы "wcf2com"',update:'Обновление службы "wcf2com"'},"Market/Fito":"Установка программы Fito","Market/ShFR/":{message:"драйвера ШТРИХ-М",caption:"Драйвер ШТРИХ-М"},"Market/LpcVCom":"Установка драйвера LpcVCom","Market/FiscalMaster":"Установка программы FiscalMaster","Market/VNC":"Установка Контур.VNC","OtherBrowsers/FirefoxPlugins":"Включение плагинов в Firefox","OtherBrowsers/OperaEnableNPAPI":"Включение плагинов в Opera","OtherBrowsers/ChromeEnableNPAPI":"Включение плагинов в Google Chrome","OtherBrowsers/MozillaFirefox/":{message:"браузера Mozilla Firefox",caption:"Браузер Mozilla Firefox"},"OtherBrowsers/CPFox/":{message:"браузера КриптоПро Fox",caption:"Браузер КриптоПро Fox"},"OtherBrowsers/GoogleChrome/":{message:"браузера Google Chrome",caption:"Браузер Google Chrome"},"OtherBrowsers/DiagExtension":E('"Помощник диагностики"'),"OtherBrowsers/DiagExtension/":E('"Помощник диагностики"',true),"OtherBrowsers/PluginExtension":E("Контур.Плагин"),"OtherBrowsers/PluginExtension/":E("Контур.Плагин",true),"OtherBrowsers/FFAutoStart":"Настройка печати в Firefox для Контур.Экстерн","OtherBrowsers/MozillaPlugins":"Отключение конфликтных плагинов","OtherBrowsers/MozillaFirefoxCache":"Очистка временных файлов Mozilla Firefox","OtherBrowsers/GoogleChromeCache":"Очистка временных файлов Google Chrome","OtherBrowsers/OperaCache":"Очистка временных файлов Opera","OtherBrowsers/YandexBrowserCache":"Очистка временных файлов Яндекс.Браузера","PNV/NET40":".NET Framework 4.0 Client Profile","PNV/MSSQLCE40":"Microsoft SQL Server Compact 4.0","PNV/AdiVersion":"Модуль природопользователя","Rutoken/SmartCardFiles":'Восстановление файлов службы "Смарт-карты"',"Rutoken/WindowsDriverFoundation":'Запуск службы "Windows Driver Foundation"',"Rutoken/SmartCardsService/":{install:'Установка службы "Смарт-карты"',restart:'Перезапуск службы "Смарт-карты"',fix:'Настройка службы "Смарт-карты"',run:'Запуск службы "Смарт-карты"'},"Rutoken/CalaisRights":"Настройка прав на ветку реестра Calais","Rutoken/CalaisReadersRights":"Настройка прав на ветку реестра Calais\\Readers","Rutoken/Scfilter":"Настройка фильтров драйвера смарт-карт","Rutoken/CoDeviceInstallers":"Настройка CoDeviceInstallers фильтров смарт-карт","Rutoken/CertPropSvc/":{"function":'Включение функции "Распространение сертификатов"',service:'Запуск службы "Распространение сертификатов"'},"Rutoken/RutokenVersion":"Драйверы Рутокен","Rutoken/RutokenPlugin":"Плагин Рутокен для nalog.ru","Rutoken/ESmartVersion":"Драйверы eSmart","Rutoken/JCUnifiedClient":"Единый клиент JaCarta 2.9.0","Rutoken/JCWebClient":"Плагин JaCarta для nalog.ru","Rutoken/IBank2KeyDrivers":"Драйверы для USB-токенов iBank2","Rutoken/RutokenSupport":"Модуль поддержки Рутокен для КриптоПро CSP","Rutoken/RtCOMLite":"Компонент диагностики Рутокен","Rutoken/RutokenReaders":"Удаление неиспользуемых считывателей смарт-карт","Rutoken/RutokenDevices":"Установка драйверов на новые устройства Рутокен","Rutoken/InstallFromTokens":"Установка личных сертификатов с Рутокена","Windows/InstallerVersion":"Windows Installer 4.5","Windows/FixLocale":"Настройка языка программ, не поддерживающих Юникод","Windows/KonturDiag/":{aktiv:"Актив.Diag для всех пользователей",kontur:"Контур.Diag для всех пользователей"},"Windows/WUApiDLL":"Windows Update Agent","Windows/Kernel32":"Обновление KB2758857 (kernel32.dll)","Windows/KB2802968":"Обновление KB2802968","Windows/CryptSvc":'Запуск "Службы криптографии"',"Windows/TrustedInstaller":'Запуск службы "Установщик модулей Windows"',"Windows/DateZone":"Обновление часовых поясов","Windows/FixAppData":"Настройка расположения папок профиля в реестре","Windows/FixTemp":"Исправление расположения временной папки","Windows/FixCacheFolder":"Настройка расположения временных файлов Internet Explorer","Common/CreateShortcuts":"Создание на рабочем столе ярлыков для входа в сервисы"};
var aq={"":"",Uac:"Пожалуйста, включите UAC (Контроль учетных записей)<br/>для настройки УТМ ЕГАИС и заново пройдите ","Uac/":{wd:"установочный диск",diag:"диагностику"},Rsa:"Для настройки УТМ необходим действующий RSA-сертификат,<br/>который можно получить на<a rel='nofollow noopener noreferrer' target='_blank' href='https://service.egais.ru/checksystem/check'> Портале ЕГАИС</a>",OneToken:"Для настройки УТМ отключите все USB-токены, кроме ","OneToken/":{rutoken:"Рутокен ЭЦП 2.0",jacarta:"JaCarta SE"},AvastHttps:'Проверьте, что в настройках антивируса Avast <a rel="nofollow noopener" target="_blank" href="http://www.kontur-extern.ru/support/faq/34/566">отключено сканирование HTTPS</a>',AdminRequired:"Для установки некоторых программ<br/>необходимо войти под учетной записью с правами Администратора","AdminRequired/":{hddError:"<br/>и рекомендуется не менее 1000 МБайт свободного места на диске"},MsiBlocked:"Часть компонентов недоступна для выбора.<br/>","MsiBlocked/":{wd:"Нет прав на запись в папку "+(S?n.encode(S.$Temp):"%TEMP%"),diag:"Подробнее в пункте <a href='#' onclick=\"SkbKontur.Help.View.onDiagnosisClick('Windows', '#diag-temp'); return true;\">параметр TEMP</a>"},AppDataBlocked:"Часть компонентов недоступна для выбора.<br/>","AppDataBlocked/":{wd:"Нет прав на запись в папку "+(S?n.encode(S.$AppData):"%AppData%"),diag:"Подробнее в пункте <a href='#' onclick=\"SkbKontur.Help.View.onDiagnosisClick('Windows', '#diag-appdata'); return true;\">параметр AppData</a>"},AvastHardened:"Проверьте, что в настройках антивируса Avast отключен &quot;усиленный режим&quot;",HddError:"Для корректной установки всех программ<br/>рекомендуется не менее 1000 МБайт свободного места на диске",LocalSessionRequired:"Некоторые программы нельзя установить через<br/>удаленный рабочий стол или терминальную сессию.",BadProgram:"Обнаружены <a href='#' onclick=\"SkbKontur.Help.View.onDiagnosisClick('Antivirus', '#diag-pup'); return true;\">установленные программы</a>,<br/>которые могут мешать нормальной работе в системе",EjectTokens:"Для установки драйверов Рутокен необходимо убедиться,<br/>что отключены все устройства Рутокен",markAsDeletedUTM:"Текущий статус служб не позволяет установить УТМ.<br/>Необходимо перезагрузить компьютер"};
n.TranslatesData={"Fixes/":aj,"Warnings/":aq};ak.checkNetTable={check:'Для проверки связи перейдите на страницу <a rel="noopener" target="_blank" href="'+f.rootUrl+'/check">"Проверка связи"</a>',err:"Ошибка",Name:"Имя узла",IP:"Адрес",Status:"Статус",Len:"Длина",Time:"Время",TTL:"TTL","Status/":{0:"Успешно",1:"Ошибка",11001:"Недостаточно размера буфера",11002:"Сеть недостижима",11003:"Компьютер недоступен",11004:"Протокол недоступен",11005:"Порт недоступен",11006:"Нет ресурсов",11007:"Плохие параметры",11008:"Ошибка оборудования",11009:"Пакет слишком большой",11010:"Истекло время ожидания ответа",11011:"Плохой запрос",11012:"Плохой путь",11013:"Истек TTL",11014:"TimeToLive Expired Reassembly",11015:"Неверные параметры",11016:"Source Quench",11017:"Слишком большие параметры",11018:"Плохая цель",11032:"IPSEC был отвергнут",11050:"Аппаратный сбой"}};
ak.customTokenIcons={};n.addCustomTokenIcon=function(at,aw,av){if(at){var au=at.split(".")[0],ar=null;if(54==au){ar="lite-cloud"}else{if(au>=51&&au<=53){ar="lite-k"
}}if(ar){if(aw&&aw.length){ak.customTokenIcons[aw.toLowerCase()]=ar}if(av){ak.customTokenIcons[String(av).toLowerCase()]=ar}}}else{if(aw&&aw.length){ak.customTokenIcons[aw.toLowerCase()]="jacartalt"
}}};n.getWindowsUpdateCmt=function(av,at,ar){var aA=at?"Рекомендуем увеличить оперативную память до 2&nbsp;ГБ (2048&nbsp;МБ) и обновить Windows до:":"<u>Рекомендуется обновить операционную систему до</u>:",au="(только с КриптоПро CSP <b>3.9 R2</b> или <b>4.0 R2</b> и выше).",az=[["Windows 7","с пакетом обновления 1 (SP1) и выше;"],["Windows 8.1","(только с КриптоПро CSP <b>3.9</b> и выше);"],["Windows 10 ",au]],aB=[["Windows Server 2008 R2","с пакетом обновления 1 (SP1) и выше;"],["Windows Server 2012 R2","(только с КриптоПро CSP <b>3.9</b> и выше);"],["Windows Server 2016",au]],ax={xp:["8 апреля 2014 года","https://support.microsoft.com/ru-ru/help/14223/windows-xp-end-of-support"],"2003":["14 июля 2015 года","http://www.microsoft.com/ru-ru/server-cloud/products/windows-server-2003/"],vista:["11 апреля 2017 года","https://support.microsoft.com/ru-ru/help/22882/windows-vista-end-of-support"]},aw=ax[av],ay="";
s(("2003"===av)?aB:az,function(aC){ay+="<li>"+(ar?"&minus;":"")+'<span style="font-weight: 600">'+aC[0]+"</span>";ay+=" "+aC[1]+"</li>"});return"Ваша операционная система "+(ar?'<span class="diag-windows-name" style="font-weight: 600"></span><br/>':"")+'перестала поддерживаться <a id="diag-windows-end" rel="nofollow noopener noreferrer" target="_blank" href="'+aw[1]+'">'+aw[0]+"</a> компанией Microsoft.<br/>"+aA+"<br/><ul>"+ay+"</ul>"
};function t(au,aB,ax){var aA=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],aw=au.getHours(),ay=au.getMinutes(),aC=au.getSeconds(),av=au.getDate(),az=au.getMonth(),aE=au.getFullYear(),ar=f.addZero,aD=(0===aw&&aw==ay&&ay==aC)?"":(" "+[ar(aw),ar(ay),ar(aC)].join(":")),at=ax?[av,aA[az],aE].join(" "):[ar(av),ar(az+1),aE].join(".");
return aB?at:(at+aD)}var I=n.htmlTag=function(au,ar,at){return"<"+au+(ar?(' class="'+ar+'"'):"")+">"+at+"</"+au+">"};var H=G.htmlDiagComment=function(ar){return I("div","diag-comment",ar)
};var e=n.convertToPrintableDate=function(at,av,au){var ar=new Date();ar.setTime(at);return isNaN(ar)?"Ошибка":t(ar,av,au)};n.pingTimeFormatter=function(av,at,au){var ar=ai(au,at);
if(av&&(Number(av)==av)){return av+"мс"+ar}if(0===av){return"&lt;1мс"+ar}return(("string"==typeof(av))?p(av):"")+ar};function d(ar){return(0===ar)?0:((ar>0)?1:-1)
}function r(au,ar,at){if(au>0){return -r(-au,at,ar)}if(0===au){return 0}if(ar.isOld&&!at.isOld){ar.isOld=0;at.isOld=1}return d(au)}function M(){return f.isUCProfiles()
}function v(ar){return ar.CertId+((ar.SNILS&&M())?("-"+ar.SNILS):"")}var l=f.cyrillicFirstCompare,Y=l(),Z=l("Name");function c(at,ar){return function(au,ax){if(!au){return ax?-1:0
}if(!ax){return 1}var av=Number(au.Quality||0),ay=Number(ax.Quality||0);if(av!==ay){return d(ar?(ay-av):(av-ay))}if(ar){var aw=Number(au.Status||0),az=Number(ax.Status||0);
if(aw!==az){return d(az-aw)}}var aB=Z(au,ax),aA=ar?aB:Y(v(au),v(ax));if(aA){if(at&&aB){return d(aB)}return d(aA)}if(au.ValidFrom&&ax.ValidFrom&&Math.abs(ax.ValidFrom-au.ValidFrom)>(6*60*60*1000)){return r(ax.ValidFrom-au.ValidFrom,au,ax)
}return r((ax.ValidTo||ax.ValidToTime||0)-(au.ValidTo||au.ValidToTime||0),au,ax)}}var b=1,F=c(false),u=c(true),q=c(true,true);function ah(ar){return Math.floor(ar/86400000)
}var K='<span class="diag-status" style="display: inline-block">';function B(au,av,ar){var at=[];if(av){at.push('<a href="#" style="text-decoration: none !important" title="'+av+'" ');
at.push("onclick=\"window.alert('"+(ar||av)+"'); return false\">")}at.push('<span class="diag-status-'+au+'" style="margin-left: 1px; width: 18px">&nbsp;&nbsp;&nbsp;</span>');
if(av){at.push("</a>")}return at.join("")}var C=n.getContStatus=function(at,au,ar){return K+B(at,au,ar)+"</span>"};var g=new RegExp("(Crypto|Крипто)[\\s\\-]?(Pro|Про)(\\s|$)","i");
n.tableCertificatesFormatter=function(aW,aL){var aE=(ap===aW)||(an===aW),aD=(ao===aW),aV=new Date().getTime(),aT="\\\\",aQ=new RegExp("^("+aT+aT+"\\."+aT+")?Registry"+aT,"i"),aS=new RegExp("(^SCARD\\\\rutoken|\\\\Aktiv\\s*(Co\\.\\s*)?ruToken)","i"),aK=new RegExp("(^SCARD\\\\rutoken_lt_|\\\\(Aktiv\\s*)?Rutoken\\s*lite)","i"),aB=new RegExp("^SCARD\\\\ETOKEN","i"),aF=new RegExp("^SCARD\\\\JACARTA","i"),aG=new RegExp("^SCARD\\\\JACARTA_LT","i"),aH=new RegExp("^FSRAR\\-RSA\\-","i"),aA=new RegExp("^SCARD\\\\ESMART","i"),aw=new RegExp("^(SCARD|REGISTRY\\\\?|"+aT+aT+"\\.)"+aT,"i"),ay=new RegExp("^("+aT+aT+"\\."+aT+")?FAT1[26]","i"),aI=-1,ax=[],aU=[],au="Один из сертификатов (в цепочке) истек или не наступил (на момент диагностики)",av="При отсутствии лицензии КриптоПро&nbsp;CSP работа с сертификатом невозможна.",ar="Зацикливание цепочки доверия сертификатов",at={CTL_IS_NOT_SIGNATURE_VALID:"Недействительная цифровая подпись CTL",CTL_IS_NOT_TIME_VALID:"Истекло время использования CTL",CTL_IS_NOT_VALID_FOR_USAGE:"Неверное использование сертификата CTL",CYCLIC:ar,INVALID_EXTENSION:"Неверное расширение сертификата",INVALID_NAME:"Неверное поле имени сертификата",NOT_SIGNATURE_VALID:"Один из сертификатов в цепочке неверно подписан",NOT_SUPPORTED_NAME:"Неподдерживаемое поле имени сертификата",NOT_TIME_NESTED:"Один из сертификатов в цепочке имеет неверный период действия",NOT_TIME_VALID:au,NO_CSPLICENSE:av,NOT_VALID_FOR_USAGE:"Один из сертификатов в цепочке используется не по назначению",OFFLINE_REVOCATION:"Не удается проверить статус аннулирования сертификата",PARTIAL_CHAIN:"Ошибка построения цепочки до корневого сертификата",REVOCATION_STATUS_UNKNOWN:"Неизвестный статус аннулирования сертификата",REVOKED:"Один из сертификатов в цепочке отозван",UNTRUSTED_ROOT:"Корневой сертификат не в хранилище доверенных сертификатов",CERT_KEY_NIL:"Длина ключа равна нулю",INVALID_CONT_NAME:"Ошибка в имени контейнера",MISSING_CONT:"Точное расположение контейнера определить не удалось","Зацикливание цепочки доверенности":ar,"Один из сертификатов в цепочке истек":au};
function aC(aX){var aY=aX.IssuerName;return(aY&&"pki.fsrar.ru"===aY)}function aO(aY){var a2="",a0=aY.Errors,a5=aY.Warnings,a3=(aY.ProvName||aY.ProviderName),a4=(aY.ProvType||aY.ProviderType),aX=aY.ContName||aY.ContainerName;
if(aX){if(a4&&(1==a4)&&!aC(aY)&&a3&&g.test(a3)){a2+=C(1,"ОС считает, что алгоритм закрытого ключа - RSA, а не ГОСТ")}if(a0&&G.isArray(a0)&&G.contains(a0,"INVALID_CONT_NAME")){a2+=C(2,"Ошибка в имени контейнера")
}else{if(aY.ContExist){a2+=C(0,"Контейнер присутствует")}else{if(a5&&G.isArray(a5)&&G.contains(a5,"MISSING_CONT")){a2+=C(1,"Точное расположение контейнера определить не удалось")
}}}if(aQ.test(aX)){a2+=C("reg","Контейнер в реестре");a2+=aX.replace(aw,"")}else{if(aK.test(aX)){var a1=aX.toLowerCase().split("rutoken_lt_"),aZ=null;if(a1.length>1){a1=a1[1].split("\\")[0];
aZ=ak.customTokenIcons[a1]}else{a1=aX.split(new RegExp("Rutoken\\s*lite","i"));if(a1.length>1){a1="aktiv rutoken lite"+a1[1].split("\\")[0].toLowerCase();
aZ=ak.customTokenIcons[a1]}}a2+=C(aZ||"lite","Контейнер на Рутокене Лайт");a2+=aX.replace(aw,"")}else{if(aS.test(aX)){a2+=C("rutoken","Контейнер на Рутокене S");
a2+=aX.replace(aw,"")}else{if(aH.test(aX)){a2+=C("jacartalt","Контейнер на токене JaCarta SE");a2+=aX.replace(aw,"")}else{if(aG.test(aX)){a2+=C("jacartalt","Контейнер на токене JaCarta Nano");
a2+=aX.replace(aw,"")}else{if(aF.test(aX)){a2+=C("jacarta","Контейнер на токене JaCarta");a2+=aX.replace(aw,"")}else{if(aA.test(aX)){a2+=C("esmart","Контейнер на токене eSmart");
a2+=aX.replace(aw,"")}else{if(aB.test(aX)){a2+=C("etoken","Контейнер на eToken");a2+=aX.replace(aw,"")}else{if(ay.test(aX)){a2+=C("disc","Контейнер на флешке, дискете или жестком диске");
a2+=aX.replace(aw,"")}else{if(aX=="fail"){a2+=C(1,"Не удалось определить имя контейнера");a2+="Не удалось определить имя контейнера"}else{a2+=aX}}}}}}}}}}}else{a2+=C(2,"Без имени контейнера");
a2+="Без имени контейнера"}a2+="<br/>\r\n";if(a3=="fail"){a2+=C(1,"Не удалось определить имя криптопровайдера");a2+="Не удалось определить имя криптопровайдера"
}else{if(a3){a2+=a3}else{a2+=C(1,"Неизвестный криптопровайдер");a2+="Неизвестный криптопровайдер"}}return a2}var az="eiasreportingappserver2",aR="ФС по надзору в сфере природопользования",aM=new RegExp("Сертум\\-Про|СКБ Контур","i"),aJ=new RegExp("^\\w+$","i");
function aP(aZ){var a1=aZ.Name,aX=String(aZ.SerialNumber),aY=aZ.Thumbprint,a3=[];try{var a0=aZ.CertId;if(a0&&(a0!=aX)&&(a0!=aY)){a3.push(p(a0))}if(aX&&(!aY||(aX!=aY))){a3.push(p(aX))
}if(aY){a3.push(p(aY))}if(aZ.HasPrivateKey){a3.push(aO(aZ))}else{if((az!=a1)&&(aR!=a1)){a3.push('<span style="color: red; font-weight: 700">Нет закрытого ключа</span>')
}}}catch(a2){a3.push("Нет закрытого ключа")}return a3.join("<br/>")}function aN(a6,bI){var a3=a6.Thumbprint&&String(a6.Thumbprint),a1=Number(a6.Status),bv=Number(a6.Quality),bL=a6.ValidTo||a6.ValidToTime,bn=(aV<bL),a4=a6.Warnings,aX=a6.Errors,aZ=a6.isOld,a8=String(a6.OrgName),bm=String(a6.IssuerOrg),bj=ak.ignoreRootCerts||{},bh=ak.ignoreCACerts||{},bi=a3&&(bh[a3]||bj[a3]),a7=String(a6.Name),bb=ak.egaisLocale;
a7=(a7&&a7.length&&("err"!==a7))?a7:"Без имени";a8=(a8&&a8.length&&("err"!==a8))?a8:(aC(a6)?"":"Без организации");bm=bm?bm.replace("<","&lt;"):"АО &laquo;ПФ &laquo;СКБ Контур&raquo;";
if(!bI&&bi){a6.Status=-1;a6.Quality=-1;ax.push(a6);return}if(aI!=bv){aI=bv;var a5=aL?"5":(aE?(bb?"6":"7"):"6"),bJ='<tr><td colspan="'+a5+'" style="background-color: ',bc="</td></tr>";
switch(aI){case -1:aU.push(bJ+'#CCCCFF">Устаревшие сертификаты (не требуют обновления)'+bc);break;case 0:aU.push(bJ+'#CCFFCC">Действительные сертификаты с закрытым ключом'+bc);
break;case 1:aU.push(bJ+'#FFFFCC">Сертификаты без закрытого ключа'+bc);break;case 2:aU.push(bJ+'#FFCCCC">Сертификаты с ошибками (нажмите на значок слева для получения сведений)'+bc);
break;default:break}}aU.push("<tr>");if(aZ){if(0!==a1){a1=-2}aU.push("<td>&nbsp;</td>")}var a2=[],aY=a6.License,a0=false,bq=false;if(aE&&!aL&&!aY&&a6.HasPrivateKey){var bt=(a6.ProvName||a6.ProviderName||"");
if(bt&&g.test(bt)){a0=true;if(bn&&(ak.expireCSPLicenseDays<=0)&&aM.test(bm)){bq=true;if(a1>=0&&a1<2){a1=1;if(!a4||!a4.length){a4=[av]}}}}}aU.push('<td style="vertical-align: top">');
var bB=ak.revokedCerts||{};var bE=bB[a3];if(bE){aX=aX||[];aX.push("REVOKED")}switch(a1){case -2:case -1:if(!a0){a2.push(B("cert"))}break;case 0:aU.push(B(a1));
break;case 1:var bp="Список предупреждений:",bg=(a4&&a4.length);if(bg){a4=T(a4,function(bP){return at[bP]||bP})}var bO=bg?("&#x0A- "+a4.join("&#x0A- ")):null,bN=bg?("\\n- "+a4.join("\\n- ")):null;
aU.push(B(1,bp+bO,bp+bN));break;case 2:var bo="Список ошибок:",bf=(aX&&aX.length);if(bf){aX=T(aX,function(bP){return at[bP]||bP})}var be=bf?("&#x0A- "+aX.join("&#x0A- ")):null,bd=bf?("\\n- "+aX.join("\\n- ")):null;
aU.push(B(2,bo+be,bo+bd));break;default:break}if((aE||aD)&&!aL){if(aY||a6.KEP){a2=[];if(aY){a2.push(B("csp","Сертификат со встроенной лицензией КриптоПро CSP"))
}if(a6.KEP){a2.push(B("kep","Квалифицированный сертификат"))}}if(b===a6.Location){a2.push(B("comp","Сертификат в хранилище компьютера (доступен всем пользователям)"))
}}if(a0){a2.push(B("cspoff","Нет встроенной лицензии КриптоПро CSP"))}if(a2.length){aU=aU.concat(a2)}aU.push("</td>");aU.push(aZ?'<td align="left">':'<td colspan="2">');
if(a3&&aJ.test(a3)){aU.push('<a href="#" onclick="return SkbKontur.Help.displayCert(\''+a3+"',"+aW+')">'+p(a7)+"</a>")}else{aU.push(p(a7))}if(aE&&!aL){aU.push("<br/>"+p(a8));
if(bq){aU.push("<br/>"+H(av))}}aU.push("</td>");if(aE){aU.push('<td align="left">'+p(aL?a8:bm)+"</td>\r\n")}var br=e(bL,true,true);if(!bn){var bK="Истек "+br;
br=(aZ||bi)?bK:('<font color="red">'+bK+"</font>")}else{if(aE||aD){var bC={3:"4. Имя пользователя или другая информация в сертификате изменена",4:"2, 3. Сертификат заменен другим",5:"5. Сертификат более не нужен для целей, которых он выдавался"};
var bM=e(bL,true,false);if(bE){var bA=e(bE.Date),bz=bE.Code,bl=("undefined"!=typeof(bz)),bx=bl?" по причине:":"",bw=bl?(bC[bz]||bz):"",bF="Отозван "+bA.replace(" ","&nbsp;"),bG=bF+bx+(bl?" "+bw:""),by=bF+bx+(bl?"\\n"+bw:""),bD=[];
bD.push('<a href="#" style="color: red; text-decoration: none !important" title="'+bG+'" ');bD.push("onclick=\"window.alert('"+by+"'); return false\">");
bD.push(bF+"</a><br/>");bD.push('<font color="gray">(до&nbsp;'+bM+")</font>");br=bD.join("")}else{var a9=D(ah(Math.abs(bL-aV)));a9=a9.substr(a9.indexOf(" ")+1).replace(" ","&nbsp;");
br="Через "+a9;br+='<br/><font color="gray">('+bM+")</font>"}}}aU.push('<td align="center">'+br+"</td>");if(!aL){if(!bb){var bu;try{bu=a6.PublicKeyLen;
if(isNaN(parseInt(bu))||!isFinite(bu)){throw new Error()}}catch(ba){bu="?"}aU.push('<td align="center">'+bu+"</td>")}var bs,bH=String(a6.SerialNumber);
if(aE){bs=aP(a6)}else{if(aD){var bk=[];if(bH){bk.push(p(bH))}if(a3){bk.push(p(a3))}bs=bk.join("<br/>")}else{bs=p(a3||bH)}}aU.push('<td align="left" nowrap="nowrap">'+bs+"</td>")
}aU.push("</tr>")}return function(bf,a7,bc,a6){if(!bf||!bf.length||("string"==typeof(bf))){return m(bf,a7,bc,a6)}if(aE||aD){var be=[];s(bf,function(bg){if((ak.eiasLocale||ak.sertumLocale||(az!==bg.Name))&&(ak.rpnLocale||(aR!==bg.Name))){be.push(bg)
}});if(!be.length){return m("none",a7,bc,a6)}bf=be}var bb="Название&nbsp;организации",a8=(aE?(M()?'одинаковыми полями "ИНН-КПП-ИННФЛ" и "СНИЛС"':'одинаковым полем "ИНН-КПП-ИННФЛ"'):"одинаковым именем");
aU=[H("Сертификаты с "+a8+" отображаются в виде дерева.")];aU.push(ai(bc,a7));aU.push('<table class="diag-object">');aU.push('<tr align="center"><th>&nbsp;</th>');
aU.push('<th class="diag-key" colspan="2">Владелец&nbsp;сертификата'+((aE&&!aL)?", "+bb:"")+"</th>");if(aE){aU.push(I("th","diag-key",aL?bb:"Кем&nbsp;выдан"))
}aU.push(I("th","diag-key","Окончание действия"));if(!aL){if(!ak.egaisLocale){aU.push(I("th","diag-key","Длина ключа"))}var a5;if(aE){a5="<nobr>ИНН-КПП-ИННФЛ</nobr>, Cерийный&nbsp;номер, Отпечаток, Контейнер, CSP"
}else{if(aD){a5="Cерийный&nbsp;номер, Отпечаток"}else{a5="Отпечаток"}}aU.push(I("th","diag-key",a5))}aU.push("</tr>");aI=-1;ax=[];var aY=ak.certsByThumb,bd=ak.revokedCerts||{},aX=new RegExp("<br\\s*\\/?>","gi");
var a0=function(bp,bo){var bj=!!bo.free,bh=y(bo.getSubject(),bj),bm=z(bh),bl=y(bo.getIssuer(),bj),bn=bp.OrgName,bk=bn&&bn.length&&("err"!==bn);if(!bp.Name||(bm&&(bm.length>bp.Name.length))){bp.Name=bm
}if(!bk){bp.OrgName=A(bh);bp.IssuerName=z(bl);if(("O"===bp.OrgName)&&aC(bp)){bp.OrgName=""}}if(!bp.CertId){var bg=x(bh,ap);if(bg){bp.CertId=bg}}if(!bp.SNILS){bp.SNILS=bh["СНИЛС"]||bh.SNILS
}if(!bp.ValidFrom){bp.ValidFrom=w(bo.getValidFrom())}if(!bp.ValidTo){bp.ValidTo=bp.ValidToDate||w(bo.getValidTo())}if(!bp.IssuerOrg){bp.IssuerName=z(bl);
bp.IssuerOrg=A(bl)}var bi=!bh||bh.INN||bh["ИНН"]||bh["1.2.643.3.131.1.1"];if(!bi||(true!==bp.KEP&&false!==bp.KEP)){bp.KEP=L(bo,bj,bh)}return bp};if(aY&&bf.length&&bf[0]&&!bf[0].Thumbprint){s(aY,function(bl,bi){try{var bh=bi.replace(aX,"\r\n"),bg=J(bh),bk=bg.getSerialNumber();
s(bf,function(bm,bn){if(bm.SerialNumber==bk){bf[bn].Thumbprint=bg.getHash().toHexString().toUpperCase();if(aE){bf[bn]=a0(bf[bn],bg)}return false}return null
});if(bg.free){bg.free()}}catch(bj){}})}if(aY&&aE){var a3=M();s(bf,function(bi,bn){var bk=bi.Thumbprint,bj=aY[bk],bo=bi.OrgName,bm=bo&&bo.length&&("err"!==bo);
if(bd[bk]){bi.Status=2}if(0===Number(bi.Quality)&&!bi.HasPrivateKey){bi.Quality=1}if(bj&&(!bi.CertId||(a3&&!bi.SNILS)||!bm||!bi.IssuerOrg||!bi.ValidFrom||(true!==bi.KEP&&false!==bi.KEP))){try{var bh=bj.replace(aX,"\r\n"),bg=J(bh);
bf[bn]=a0(bi,bg);if(bg.free){bg.free()}}catch(bl){}}})}bf=bf.sort(F);function a1(bg){return aE&&v(bg)||bg.Name}var aZ=[],ba={},a9=[];s(bf,function(bg){var bh=a1(bg);
if(ba[bh]){bg.isOld=1;ba[bh].push(bg)}else{bg.isOld=0;aZ.push(bg);ba[bh]=[]}});aZ=aZ.sort(aE?u:q);s(aZ,function(bg){a9.push(bg);var bh=a1(bg);ba[bh]=ba[bh].sort(u);
s(ba[bh],function(bi){a9.push(bi)});ba[bh]=[]});aI=-1;s(a9.length?a9:bf,function(bg){return aN(bg,false)});s(ax,function(bg){return aN(bg,true)});aU.push("</table>");
var a4=aU.join("\r\n"),a2=n.getTableSpoiler;if(!a2||aE||(a7&&a7.status>0)){return a4}return a2("certsTable"+aW,"таблицу сертификатов",a4,null)}}}(window.SkbKontur.Help));
if(!window.SkbKontur){window.SkbKontur={}}if(!window.SkbKontur.Help){window.SkbKontur.Help={}}(function(c){var b=["A1DB6393916F17E4185509400415C70240B0AE6B","A8985D3A65E5E5C4B2D7D66D40C6DD2FB19C5436","DAC9024F54D8F6DF94935FB1732638CA6AD77C13","DE28F4A4FFE5B92FA3C503D1A349A7F9962A8212","D69B561148F01C77C54578C10926DF5B856976AD","E0AB059420725493056062023670F7CD2EFC6666","91C6D6EE3E8AC86384E548C299295C756C817B81","4EB6D578499B1CCF5F581EAD56BE3D9B6744A5E5","85371CA6E550143DCE2803471BDE3A09E8F8770F","8CAE88BBFD404A7A53630864F9033606E1DC45E2"],g=["33F74E7ECC006444014C6CB454BAEFBA67290E6A","44027213D590D57895AA36F2378ABCED941F6996","6185B11E898702148BCCA3BD75F9B026918502E8","DA042BE8472971E782375249F89D4069EEC83EB3","A9ABAA61DE0FAFC963F956BBBAD21F2D7367B2F5","C71F104607E391C519A87D8421F290BB0402423F","BFA9BF8C4F265B47CDB3B8B0712B455B50501947","E282C33A7F25AD1D23F6B680A4AB92CED612F031","29B4FDA08C8FEC67B6C804CB167BB7B8F553C27B","17AA76F95A4AA1F7AD7177D2F92F4C2B20A11E02","6D1761CF74C45C5361DB215E785F88D77D2799CC","4D1B10A32E4729F4079E956E9D5CE0DB7025BF7F","3DF344B23C9FF9ABB91A9B632C5CEA1027CF7D7C","A9B4D170D1466DD15C6EFF44DE01801B42CE19FE","5BCAAD85D36C1FE5D357E007F0BFA2B564CB3151"],i=["00906393E5E79BE9697E7A6409B375EC1BCA73D1","93597C56EAFDF2A6E52C32BE32960C2E36189598","028BCA5AD4EE945042BA8510C9A95B9FF8F1B8BF","F7C371391DDCC550CB6AE9D616E8E62864EAE8A6","EF74815F2C2ADD5EE05B81C1EFDA207A60FB54B0","8808679003AEE79F0A170241C5DF0FCB6D2FF822","490C401A68E47348F5A3DE4A8AFBECA5035EDA72","AF085F0367CB7B0AB110DA3EA2E90D9D1ABEF04A","38E6E0C5808A626111D97508EFA4B48B498FB8F0","8F7074830914EB5D37AD57B2D1E088E1FE977DEE","2DF356292AD3DB847AA42DC77763F94BBC93D8FD","A968F61477365F017D7AB17BDF97B043EBA3835B","18B5038F7CB67A77AA5896163EB44EFC134CAC4A","1686AA5BD279618C30624F5C37AC188EF9426254","FBB96D952259DF992C8A5C849244D5F45F13D296","27A386580B116D5D0F162F52107D1670CF6E505B","481D4AD6CF5060B64765E7ACCC0295EBAE0FDB44","B0F2846DC01103EE218DDC8B9202399A08E1C7B7"],h=["C864484869D41D2B0D32319C5A62F9315AAF2CBD"],a=["91843BBD936D86EAFA42A3AFBF33E92831068F99","E6A3B45B062D509B3382282D196EFE97D5956CCB","98C6A8DC887963BA3CF9C2731CBDD3F7DE05AC2D","C86EDBC71AB05078F61ACDF3D8DC5DB61EB75FB6","808D62642B7D1C4A9A83FD667F7A2A9D243FB1C7","D00CFDBF46C98A838BC10DC4E097AE0152C461BC","73E42686657AECE354FBF685712361658F2F4357","6C07453FFDDA08B83707C09B82FB3D15F35336B1","32F30882622B87CF8856C63DB873DF0853B4DD27","62F3C89771DA4CE01A91FC13E02B6057B4547A1D","5DEB8F339E264C19F6686F5F8F32B54A4C46B476"],d=["9E78A331020E528C046FFD57704A21B7D2241CB3","1AF6FCE68CE3F822C6FAD4CB32AD58FF59FBC221","9D05A704C8C1E565ACDE5878FE0BB96EC53C2A40","0408435EB90E5C8796A160E69E4BFAC453435D1D","0932E483C4420E668F64D360006D0BEB0BFACCA7","538AD264547716302401CDFB316B287DB12BA675","B11108FFDCAD99D7A845023AB552CB1ABE845A1B"],e=["32F7AF19F9F4B443BB0D37E19DFA1A9541573070","4B9FBE39CD907326EA855CE07E9CF8AB1968A72A","EACA5A40BF0CE98E237C9D72A7D19E15E1A03AA1","159A03BA52B196AD5391B5937BFEF767FDCAA904","9974D37884CADFFDCD112CEACB0D389621C53915","942DE921AC12359A06086F8C92960E45DB180E52","33574F0220EAD6C82195B05E3143276B0EC79B29","6B1CD59D1AB09B8D44C80DB88910D84AB91A3526","26D8A84A2E0A7ADA93D9B0D6DA5DA719A7FE85A7","D2CEFC92CEC075CA53CC24C592F62682C55EAAB4","D9988D9CC7D1605C9D12384DFD222A8575BB0A51","B7D3E314FF1FE06DA10FC56E3EF864AF823CF101","30699C1B90CE2DE8D855CC44A4CDDD9543349D7D","AE7895B17319BBD13164F72C3A4707BA131A7DE8","738C3707DA9E4AF22F2FFF27E5ACB4B3113903C0","866DB46A99B4F56BCCE7591373B737494DA49C48","5A7CD1210F1E981F25BE834553DBACAB6E19611E","124D37EF8900295D4724B1A7118524E87D40772F","4065B7815AB71E23715D4684C2925D385D0B2D57","19E02D7A735B9BD30EEE5C0E4C198C137CF5C539","6EE421E94655F15FA77CEE86AD55639854F82AD7","C44C28EAF898897180FFAB2E7F026C7A3FE90D8A","3A673802359A6B647BB669DA5A046C4FDD4BE179","DC839EEF40356CF54E7A6F47A477B3789AA86D6F","870DFC738F82F473E4A5F3DD27C1EBDF9E881B12","CE92604EEE26B95B25BBAE72A8021B3C16F5935E","0DC1D4AC55CF9F6CC6A151DB454FC3C7662398CB","247F7306407138EA352235DF035B3F99E0E7356C","FCFF1413048E2E631EBF76821CA8E1C852915A99","1AC557E5752EC76FFDF5299CE6954AD85BCE384D","34E3E49E325CD2ED8257A52E4EDF62B63C99E30D","6DD584A8E4B090CF5D77405D98ECA72056BFA549","E231B8CB1EDE0C16B5611F0CAC9FD4CCF21CC77D","1E8BAB9F68F0828D87CB1D7C6CABE609A092F489"],f=["AD7758D649BE895DD179D9A9DE255AD60BD51A4D","703B8B1CB7F8AE54DCEC86F33C783E0AC6094B8A","5F5577A2FE4D48871B098A3671EFDEBBA515294A","3532E19CC9C207B968A9062E100B882F00E77C89","460B97F34AF1AA20C31467A30203DB755F1FDF36"];
c.getCertConfig=function(){var s=c.Core,I=s.vars,D="ROOT",E="ROOTRemove",n="CA",o="CARemove",x="My",A="AddressBook",H=true;I.ignoreRootCerts={F16B80398D52F3758BFD359390BF82327AAAA7BD:H,"6064C21761C7985BBD83FF026AFF133401F25D96":H,F6E43519F5C854EBE4DFD8385116FC3CC5F52FD6:H,"03D54DF74CF46BEAF663BE08E8267BF09F2FA8FF":H,"72B4955D0B5B07B02A81AB443D046780612572B6":H,"8020762738AAEBAD57347DFE4716C9458EE52904":H,A5D707AF59BE5DCFA6E7C7F4E2DCB74EE30EDCED:H,D34387F1F0E9694528CFB6D4EBA9851BA6DCBEB4:H,B268460D627B57FDEE1BEC89B76EEBD2E2B54943:H,F2E15F0086A5748D7BCAAF7B08BFAC59BBD8E2F0:H,"0712469ECF5809C1D30C6E826EA854D3E0155AA0":H,"39F91B42F979B6E8515211E274DA3F5625661A00":H,"74D36A955D7C0541F28C3CE46DA0871595DEDE86":H,"39210AFA7D09DB0572EF90A0684B13720D6905CB":H,F2126CAC768274AB0DBF2BBE2545D71FFC52E033:H,"0ADF9CCE6AACA987CD47C6F9382251A6B3AF2F9E":H,EC753187C019AE245ABDB5B0F0AABBD79FA9D7C2:H,"2FF7BF124C7C40F0E0E6BD365CC935A4E8E027CF":H,DA86F5FB1CA44F7A06A40EFC613303EC1DEA951A:H,F9965BEF2C2A3E0F6DB689EC2C6C7A328833EFD0:H,EB7E27BF1151B3327946070B2E09DDC337DEDD9F:H,"44DDB31A97A13E341ED132C0EA00A9E5F9B279F7":H,DD62AB5240504B3F5AE03AB1F081BC4489205E1B:H,D361265601A33928C04BCFDDCF83353F5702FC76:H,"0B2F2617C14B7EF44601BE7D8AC2C1B02BEAE064":H,"5A1B7171D48EA336A15A44AC55841B16E8772B12":H,"430BDEC1F3CCE307C3C640CF0B60C82FF8D3BF9B":H,E582FD706EA042B0FA40F2B1D240D5DDF09961B7:H,"8AA44F36E35B373036206F830F004A97ABD5092F":H,"471B97C1E92091D96E77669E4EF3335D64CB0BFF":H};
I.ignoreCACerts={A242001586549655EDFBFA4B402FBE0CCC2D0515:H,"8D17EADECEFE3F53A20922825F5460696A0BF2D1":H,"1CDDA2A855A1C54FAFDFA8BC62BBE6DE3AA0D395":H,"21B18C5F42ABB4EBB7CF92A6437396A9C2A5676B":H,"8C43ECB4043DA1E34F8BE0228AB5E78BB52993B4":H,DD286904B1FC0A3F7C8DF676B3D24C09049D85A0:H,EC8D16B2767C7299EDB785974BEB20E9C9F446DC:H,D5F19C83DB6F57C38D0FF6766B88660EB4EFCCAD:H,D9DFACAF9C24650E540667352E8560C72F2D6E43:H,"3BC1CDB48F5DC94445E8F1293CEDE4634ADDD93A":H,"5EF892741F93ACF50E519C36FA494A8830DCA716":H,D9988D9CC7D1605C9D12384DFD222A8575BB0A51:H,B7D3E314FF1FE06DA10FC56E3EF864AF823CF101:H,"30699C1B90CE2DE8D855CC44A4CDDD9543349D7D":H,AE7895B17319BBD13164F72C3A4707BA131A7DE8:H,"738C3707DA9E4AF22F2FFF27E5ACB4B3113903C0":H,"866DB46A99B4F56BCCE7591373B737494DA49C48":H,"5A7CD1210F1E981F25BE834553DBACAB6E19611E":H,"124D37EF8900295D4724B1A7118524E87D40772F":H,"8FF6DE4EDC6A71B066C23B78F9632FDCA180412E":H,"9EBB6C13B638590726BA6D83D4F9D5D44F215323":H,"75ADBA4C53515A4A37F3D5F822CCC22D6A75C8BA":H,C9A49B795CE8B493B3371BC5CED93A5E59853EB2:H,"5BE4DCEE231CE883FFD907604CA8CCCBC1226C21":H,"788A4A8F37CBC0265E4E019FF35F1442E6A8E83F":H,"51634858AB17AF7437496B4253A5CABE0E6F9A8D":H,A28AD3EA6EC4E9CA52EF40D806897B27748FB8DC:H,"51A1A5C825513FEB7A3277BB46EF3FE6FF6736D5":H,D4DEC033782549B12095099B8D2F25AAD38574B9:H,"1733FBFEE0CB575130E8CF8EC32EDC09F73E3801":H,"86DB726A575FA9E843D34B529A9B7A2BF39734DA":H,F7C4ED4A0969E8524402DA0A41997688E2FD626A:H,F484DE11B66693B8A4DABF768826B48AC144A673:H,"3102D344AB85FD47527FED409C5CC6A59CCF65BA":H,DB7CAF8DDA913505C18FD5B28C680ACE28022633:H,"90CD0DCA3BFA656316AD96CEC303C402EB7BE671":H,F0D9CB6D85DB74DA9B90D612D23FE0D73EB99600:H,"2E5D9F6F11C87404EAFD7DB3FB4D162B95C1EF43":H,CB44101E60A5F21ADB4F7F3524405C1DF55C40AF:H,"8EA3BAA4E3C9E9EB7B15C8C53C12D9675388FD36":H,A8952143B70E795D211F30B9520751F370C4AFBA:H,"66A8D9F5826454BFB0F2EFE9939179329B5FA8C5":H,F4B286F30BF9B76DC6CCD52636FDA9F0E01F7795:H,"1834DC4FBC9B67B7A9A69CADF3B2D2C6E016AED2":H,"875D80EBC73720D17E77E3F000E121CE305FA601":H,"3A5CD8268990E93D1A6573BC85A0E30964464420":H,"8BF148CFC3D2D87CF8DF8A43BC99A819C776D410":H,"6609A6B7B7CA67F6F53B6AA034AD878A130070B5":H,CCB710A0A9E6987D683FBD117D238FCD5F1AB613:H,"8F9A883DB2895A2252475DA61AD7874E101DD818":H,"99F8B2C38DF363D00EBC1A0FF7AC80187DE5E956":H,"4408AFD122A30D97AFB2C8832CB8AD1D96F16559":H,"187E638E877314DB2B28B7C697A031AB319235F8":H,"5411B97DAF85906B9B08A234C66DC19AE8BA37ED":H,DE48BD47CA4B2C3409769BC1DC172A6C60250750:H,F669AE3E099B9D06C3672DD1C8CB83B6FFB44B82:H,"8BE4C32471CBDB0BFD614268507D628280617DEF":H,B9765AB016CED8C9348645687F273C8747EBA3A8:H,"0AD95CEB9DF40B6167B9481778CBDB454973623C":H,"846505451214A4D6856BA3F20EC58D8271DC23AC":H,"435B24F28188D12C62A3A4AC63A8F6AE1868D1C0":H,"0FC7117875AF2C397229734BE4532C2BF5750B24":H,"23F165486EB1EDACF15323E42A1C613E4B22E0AB":H,"5C059DF6F1E33E991E644B9E636C613BD139F20D":H,DB9676837A0F76DC950B378C57C75DD5AB053197:H,"6B1A5C466E6D51F81F1D81CFC2DCA6DFEF521A0F":H,"252BBAB1746D9AB0564F3290EFD1AEE5609DC89C":H,BBED65BE2F2FBC57D43BA1C737BE1737E116ACB7:H,"0C3E2135410B020AAA36F252A488F3C099A6D6B2":H,"9CA406C98D3CD4353A0F0425D00DAA5EE38DE59A":H,"443240A07A780739034468EAEC4C7222197CF32C":H,FF54BF33D458168721724E8654FC19FC2EDB0D0B:H,"04D5B860E5972DC8B700171673AB8BBDE611DA89":H,D6FC9683F01A494163A5A26025FD346F11848089:H,"3D8CD82E71F67FB4D95277AEED78C33C8BBB7818":H,"981F67B937E93B15221737C1032E2152E49B4A17":H,"8D2FECB7E9894C850C38F6B587302DEB2DA59A2D":H,"2C0A6ED647DF7D407D859E00981794134CAF1F79":H,C8BA8EBAAD51760C01D3E41A32528B541622D82C:H,D56FFF0DCE83C3C267233F3B037CC60827EC6E07:H,D748D2125D28EA1091BF46D6D7953AC56CC08C99:H,"77B1E28DC5832BB080AD7469F6FD8CE42BD596E8":H,ADF01E4EE76D1C0C8A188D2EF898999DC48F27FD:H,"3ECD538FDEA87A2D5092B174B9189F7AB2D61A87":H,"68727C44BEBEE2F5141DE8A40219189AD7CC575A":H,A88EADB2A78F39CBE52BEC152741F8D910A999BD:H,"298423572DEE7B07F8C95DF197F706FB03E46D01":H,"11F3D0F12F48634DCC087654D6411B72EF48F33B":H,"2FCF79224C9292A387DE58625815D5F41A589C74":H};
var t=I.cryptoproLocale,w=I.marketLocale,G=I.tanderLocale,v=s.isUCProfiles(),y=(t||I.rutokenLocale||w||G),r={My:[],AddressBook:[],ROOTRemove:[].concat(d).concat(h).concat(y?[]:[].concat(e).concat(f)),ROOT:[].concat(b).concat(y?[]:g),CARemove:y?[]:[].concat(i),CA:[].concat(a).concat(d).concat(y?[]:["A38AC40B56298F79C8AB63F962931FC10798D566","9D27A609EB1C3D15CDB57C91A03674DC3C9725F5","EF553EA1D02A60228D471CDCA692F2C22AA56B94","F13925BE472867303D7CE4EAADE3CD4662330742","F8BE8929ADDE1D4515C7CE1D0777E8BB36F8A01E","BD83CF1FA9DC9F1360554C37F3EB37BC38443F1E","4FFE09C476ABE2FC91F5B25FE8C173901CF8728E","906ED765531C7C31A582019A20A526E137DB4B2C","CEBAC24A28A5A5EE434AFBFC8AA98095BBC8F3D0","FC03BDD8BFA16038DB186D08BFB89BF13C25D490","599963504C94EAA4128267B1A19F5ED223AF34DE","864E514A0B28F87ED1642242B5CDA575D20D6A6F","D6CD1A17AFFA34E986AB359BEF5C0D57764CB920"])};
var q=["759CD4B440C62BC45758F6D2CACEE7D0C4DF1260"],p=["8F7791F0363F5F4D1768494E32563D825B907C05","46E4961491730DDD81AD8FA016FF59FE15E0A9FF","ECF1E1705DC35A1B2022D24A60661F07CC44754B","F94201A701E2FA6D31D890C04AD4EDE7555453B8","2CECFAC73D0368BC78958709C0EE5DFD2F679918","DB7A3F66C2061B051CD87C7CBBCCC8A0D41F0327","9564200D1457E546A3C4F9AAE8254344786BB130","D7B6B851AD41CB3130DE8AC2717D8366109C21A4","7C1C8D3CA44DD018266FDB1FED17DA286F6EE7AB","1285B106A0757AD1F3516302484C5F34CB77BF06","7F2EC6DEBD8FB546910855DC0D1A2CB9E25EC632","27DE3B5488F6BC94F3398506EC765ACC4ABE5E86","D32D5ACE93CA0A1A1F8BAE193D6F56B72340A55B","73B883ACFF42F848F2166EBF475A6E443F90B557","31ACE9E511EC658704ECFD58C1B9571FB3CF83E1","00DD4330E3709C2A47B676E5196F20E5D2FB3849","7C1684680F933A8DDFBB2EA08EB3C6A2879BCB2A","A583EE274FE1986B65EC99F701899163A8F9A364","88EAE62A6C4794A8E3FA647D2D45DDB7E2B8F267","F446844A2EA50BB2E98FFDC2BC089367907E3D9E","7BCBEB399D52BF6CF5AEA9C076F5077A41424CB1","9DC965A45ED3C057BE1F1C949B4B89A445E24436","F47D3B3692411AFDB7EE3B9F558C53EF8DE13E1F","3CDC8B14BA185A8838559684EBE979C6A2015C09","CE3CF0D4A923289F5FF9C7B79628C72FFDF176E0","E47A66A57B1425ADA94EC09FE022B7F34447FF03","1E25A896E4F54B187FE7A5FBB1B1094D0E880608","A9FAC5EBE42B0A5FA71AE005E3ED0FD2E47BB7BE","F4A0C614B32EBEA041CAE7D23B82EC5ACA87D399","E4FC1E1CA148B44843ACEC64D5CF379DE2D13DC6","3FB8A0F90092D5EF661FC9BD0CB58B747A9BD0B6","348363768B85DB503838291B0642806C3F03898A","1C30B2CF7D0DCC4157F2268C16E2766B45BBA6E6","E82FB677FA02368703F41461729DD3382EBC5547","D753FBF61E3FEE3EE220FE50D7CF8A4B57B54E9A","084FEBE2B36355D5409295D9E0E647929D592BD4","A4B941EC87F75A2E4C46B122860904E7681D6F9C","B6E5CE18A27D47B63159BD427EAEEE47DE20B345","1358DDC2D2BD81B9ABA1EAA9B1EE516B096A76FA","7B2BDE09E4184854DAF6FA7B7A1E862F4AAFA45B","724AFF1F373948F4CCB037A492E7A850DB233800","E27823706D72D6714DACE832E43C25400B3E5CFA","30D0B0662F7FD412A0D861599EF7AFDB6C7A9D2D","2484FA891956BDFA288BB036747F7D4B9CE13243","E81E6AAB19FCE09BAC099B08CC1A49C65E250FF2","27256CAA668BBD14DAD13CCD00A1F8C26129968F","6A54D09B34EE403FE3F6A422E7FCBE3CCEF2F061","9143FC98FDD18F782F034CB295B6DB558565A208","A173BB917C123B6DEFD7194584F84507CF3BF65D","A5039AB6B5A6C6E54386C63B08BEAAE655DE7793","816C728D7B2AFC371764CB064A5E11BC245B354B","18BD87F2584014B79E997AFB10DEBE73F912236A","6F3DF82ADD495709D47EA4B2AB6DCB0D6D36CFE4","64E1ED0874DE8F991983290AF343799A392DA400","4EBE4AB204B852F488D5BA14319F7B66F49A2319"],F=["779B6DCA238029F331CB75E22ABB4D2659093B1E","D1B56A224A956E04D802231BBDE23B3B1F73EC32","2175A5902F4CA7069E3473E7F56AB86EC8DEB6F3","747E845F803E91530E6742BE4067191DB326B8FC","E5FC9D4C37CE15A46316BC0F21E516FE1036DEC9","AE74AA8455497EC4E4969DEF968409F72F8A67A0"],m=[],C=[],j=[],B=[],k=[],l=[],u=I.flashLocale,z=I.ofdLocale;
if(I.fedLocale){m=m.concat(i);B=B.concat(e)}else{if(!y){C=C.concat(i);j=j.concat(e).concat(f)}}if(I.centerInformLocale){j=j.concat(F).concat(p).concat(["56B2E3F195F7D5DCCFF44980BA8B4494803B4FBC","414E3174B08CC0F8685763F0549971F064B2EDCD","A70072253CBB4CD4F51CF57E9B2FD480B723E136"]);
l=l.concat(["AB61A3BF1D74EF736A1CDE585AB09628EED9CE5E"]);C=C.concat(q).concat(p).concat(["43E468AD5379AD3D3E1CFE2DB522DCCA10805531"]);B=B.concat(q)}if(I.practicLocale){m=m.concat(["F7C0617D2BD258D7C52E554885EFA346B9B84938","69C06A9B81F259FE34D98C645E14ABFD0C11ED32"]);
C=C.concat(["A709F35D99FB3C9F68D14B6990D7DB696AF0F2C3","71AEF5DF4266E77FC63D18AE18758BBE9FAA09E3","AD2099970229D3DE6889C420AF211B057BA31C0E","3655467A76319217DCE874C0A31D99E3571FC77D"]);
j=j.concat(["A81CEF7E449A582044FCD445DBBEB153384214EF","2C1713E9195DEC179FD2B641F0AEF036BD08F733","E79B0E334E8849B497BC313AB5D778C51A7ED7CC","DA1FD5E338415DEC0924CE26FD2EECEFBD77FDF2","DF13ED996EB30D64ED67DD40D5225B60D3139F15","A9F74AB9EA8C49AA2B1C728F3334F1CA01EF32F7","C8960A8F706A0DA34F3462D52C90A54B54C64F5B","C848BB931548A401F49B11154ED0D464961B5FCA","2B0FB2673F182EE0D675DADB0844BC0C99F86370","8C7B803FBD575FE8CBD570EFA6935089D26CBB48"])
}if(I.infoTrustLocale){m=m.concat(["9EDF8C366C91FE864AAA11F910304A8D848775F8","764421FDDE9B28AD224EB3BE3A8B62BFEB3F6633","0009C840F4B6205244D5A3D798D2710E80564C83"]);
C=C.concat(["EB0702B26B2A8A11F60E829CF6BF7395827AFC3B","B58ECB3215342FDC7E0D0B0D2CFE0938ED5F2033","FB8F835BE7EF06BBC6258A03872656BA2BE1C68D","107344F0EB6F418BB67B383E09A88268CC0791B3"]);
j=j.concat(["3E0B3C0646FF5AD06A81ECE9A31D361A9B9B84F9","467467FDC7ECDDD1EBAE53C87A10E8C025E5D750","E7D89DB4AB9DE8111B68E08DE47F630DDAA4A336","CFA1F9F41BE53419F1B0E0771DA8B9D0C021AE73","E5DAFBACDC0CCC6BA59ED728FA7650D242987EA2","26691F36F72089C4D31558DEF2453EAC61A52696","72AC7F7E87EBC9529D7F5AC460BDB67BC1DB7148","EB21C9E002C5BC99CA5B277051E0F8B0D819EA2D","4D26A3286BE8F7E82E89BB216831B24DE2B7C3B0","CBC7F86824CC438F2F569E263B31CB44406660D4","9778BD6556E7D54DFDC79FB7FC25A411B9910156","4BD40B91EBE9324BC3EAB85F1751349567C5603E"])
}if(I.parcLocale){m=m.concat(["E482493D5FAA8E1307E1190145B8C3002A4276A9"]);C=C.concat(["853741956C3677803C478313B85569D76DD3B24E","48DF08DF67B3495619F254189D077B846FD4DC0F","93DA7F3DABA669AD47B66B2874796C68E327D5D3"]);
j=j.concat(["4CC0C66FC03C6194A31A48ADA8C9EC0AF5BC2ABD","D306DC7886603043CF2166AFFAA43F237903D544","703A379FB3ACA5066EEDCE3B81282965FD11C547"])}if(I.sibTelLocale){j=j.concat(["6E59951149B206A74FD670C2AC57302539DD1B0B","78B08A331F8DAA9134B53B9FD38A43732885BDA2","6CA10D38DB1A6692D5DA08C807DB8D62A91AB2A9","E14428C3524CBBF9275B23BA1BC40C865D736996"])
}if(I.tomlineLocale){C=C.concat(["C39A4E81E16803BF75CD6DDCFCE8F10CEC6167E8","C54FECAFBB317C01F615B7156FFA8DE06AAD8E21","F8F38765F290E19CC73410F4A445AAA14DBE71D7"]);
j=j.concat(["D0DD42B48A99D6AA05D02E6AD48F5636DEADC134","654C6CCE3EFEAAF2CA4C873E05EAAA76978BBF31","594265D1F8DB26265412B3B06BEF160325C2B3DB","6881DB856A7C00DD8AA58BF189B0DDCDFAA758BB","04DF27161D8A3EC3781D1313435F2F3660DC6F36","81C77A89ECE4C5AA608EC6D106ED37B523F06CB1","1528D85F980C448BB80D56357D348C436C9D88E1"])
}if(t){m=m.concat(["4D616B0C73534351260CE7F48F3C7BDD71214945","410E3BAF6F7234F5D247349E1F8E64EEDE2BB280","9DE7E723CC15E2DDD7886C965CD0257CC1963F0B","535426C39A9121F49DF524ECE141D6D715BDFAC0","0CFFEFEA2849F8755317CB93177AD0240C7E5AD4","8EA23236AE168BC7BC962D431501919E8B0A07D2","8CC8806AF60DD8E44938B2F8FA30AC9B79017801","FE0E51EE00F5668267DD7B6760E3B1BB1C9CAFD6","B4F345AF1BE59264D4382F06D6E6E3C16047A2CA","C6FC463AB400707B7A00CC560529838565FE9F07","052A7FA1B7AEA1BA4888ECBFF7123BE0ABF23E11","31BEC58434686B1D5E6AAB2E0B5FFFB29F2D62A2","86EBC03E3B3B14EE4CA70CA5CCD7DB30EB80E258","3B41B9931B7D8BB4FA54850686AABFEF0AFF7B6F","FEDC83C35FA928A8BDCF73B56EEBAE8AE19F0BBF","B9EF4F166257A1A986CBFAE17E01E3881DAE6279","8FE86288D70086692686086BD422575E43881D1B"]);
j=j.concat(["98E24BC7E714D5BFB797C987DE8FF9C01D5A8FDA"])}else{if(G){j=j.concat(["01D60F201889F279278B56B9CD7C219555EAA6A1","2C209D76498F3C23626D43C93C2D88A2EB53A242"])
}else{m=m.concat((v||z)?["9D7B9433BBFF7C2ABC5E326EBAFB3673277A450D","30EF8B31CB2B67501E523D741273A378E3AA3A59"]:["4A81145D43741076A61EFD02F76DCE3E8E6FA498","88A9BED7A922AFEE5C420AFF55B347B034370D8D","4CEE49AAC520A2B6233E371D568136AFCBF6A40F","E91B64677769DBD9A851515D1D67C366825E6A90"])
}}if(v||z||I.keAllLocale){m=m.concat(["D5756FB81DE59B18C386917DFA8DCEEBA94745FC","E22BE24F07B6DB37BF6740DDE61459AFFB3FD5F3"]);j=j.concat(["A1E670219A5467A79D3E861481B107508FB63559","C13F4C72C437ED3666F0CC6D1FE3108E69C51A81"])
}if(I.sertumLocale||I.ucLocale||u||z||I.etprfLocale){m.push("A1A96DBAB294E3BFE457D302E63699364A2751DC")}if(I.infobuhLocale){j.push("F8E1B671A1951B469C3695BD324C63CEF56F34C8");
j.push("75B8450E0276756AFEA9F83B4491A9EA41B71EF4")}if(I.ktbLocale){m.push("531DF32A6CD3730FC77B5FF4205459029AEF00B6")}if(I.rpnLocale){k.push("1E2AA9A3DB0C112A81490C0094A51404C6F4B599");
j.push("E4D111A14B19FC5E3AB77B7F7205294CEFF187C8")}if(I.egaisLocale){m.push("BC86616F78CD1744D60A96BBAE575B4429F482A1")}r[E]=r[E].concat(C);r[D]=r[D].concat(m);
r[o]=r[o].concat(B);r[n]=r[n].concat(j);r[x]=r[x].concat(k);r[A]=r[A].concat(l);return r}}(window.SkbKontur.Help));if(!window.SkbKontur){window.SkbKontur={}
}if(!window.SkbKontur.Help){window.SkbKontur.Help={}}(function(I,aA){var aD=I.View={getDiagnosticsHtml:D,getDiagnosisHtml:C,onDiagnosisClick:aA,progressCallback:W,skipTest:ar,startCallback:at,updateInstallOptions:aB,enterLicense:n,skipLicense:aq,getFixesHtml:F,runFixes:ai,runMarkedFixes:aj,uacWindow:az,extensionWindow:q};
var g=I.Core,i=I.Diagnosis,y=I.foreach,av=I.Test,Z=I.Promise,s=I.filter,o=I.exists,d=g.buildPath,B=g.getCustomParam,G=g.getIntervalString,H=g.getSizeString,M=g.log,aa=g.rebootComputer,ap=g.showSaveDialog,aw=g.trackEvent,aC=g.vars,ax=i.translateAssay;
var O=null,ay=true,r=false,T="onLicense";var al=I.saveToFile=function(aH,aF,aG){return Z.collector(g.getUserDesktop,function(aI){return ap(aF,aI)},function(aI,aK){if(aK&&aK.length){var aJ=aK,aL=false;
if(aK.indexOf("\\")<0){if(!aI||!aI.length){return O}aK=d(aI,aJ);aL=true}return ak(aK,aH,aG).then(function(){if(aL){window.alert("Отчет был сохранен на рабочем столе под именем "+aJ)
}},function(aM){M.fatal("Ошибка сохранения в файл:\n"+aJ+"\n"+g.showErrorInfo(aM))})}return O})};I.saveDiagnosticsToFile=function(aF){var aG=aF||aC.diagnostics;
if(aG){var aH=aG.getResult;return Z.when(function(){return("function"==typeof(aH))?aH().toHtml(ay):aG.toHtml(ay)}).then(function(aJ){var aI=aG.diagId||0;
return al(aJ,"kontur-diagnostic"+(aI>0?("-"+aI):"")+".htm",aI)})}return O};function z(aF){if("string"==typeof(aF)){return document?document.getElementById(aF):null
}return aF}function am(aF,aG){z(aF).innerHTML=aG}var b=I.$display=function(aH,aF,aM){if("undefined"!=typeof($)){var aJ=("string"==typeof(aH))?$("#"+aH):$(aH);
if(aJ&&aJ[0]){if("visible"==aF||"hidden"==aF){aJ.css("visibility",aF)}else{if("string"==typeof(aF)){aJ.css("display",aF)}else{if(aF){aJ.show();aJ.css("visibility","visible")
}else{aJ.hide()}}}return}}try{var aL=z(aH);if(aL||!aM){if("visible"===aF||"hidden"===aF){aL.style.visibility=aF}else{if("string"==typeof(aF)){aL.style.display=aF
}else{aL.style.display=(aF?"block":"none");if(aF){aL.style.visibility="visible"}}}}}catch(aG){var aK="Не удалось ";aK+=(("string"===typeof(aF))?("присвоить видимость "+aF):(aF?"отобразить":"скрыть"));
aK+=", элемент "+aH;M.debug(aK,aG);var aI="Ошибка работы интерфейса.\nПожалуйста, повторите попытку позже или обратитесь в техподдержку, указав время возникновения этой ошибки.";
M.fatal(aI)}};var j=new RegExp("btn\\-(primary|second|success|warning)","i"),k={};var a=I.$disable=function(aG,aF,aI){var aH=z(aG);if(aH||!aI){aH.disabled=aF;
if(aH.id){if(aF){aH.className=aH.className.replace(j,function(aJ){k[aH.id]=aJ;return"btn-disabled"})}else{aH.className=aH.className.replace("btn-disabled",k[aH.id]||"btn-primary")
}}}};var l=I.disableLink=function(aG,aF){if(!aG){return}aG.setAttribute("disabled","disabled");if(aF){aG.className+=" link-disabled";aG.oldonclick=aG.onclick;
aG.onclick="return false;"}else{aG.removeAttribute("disabled");aG.className=aG.className.replace(" link-disabled","");aG.onclick=aG.oldonclick||"return false;"
}};function ak(aN,aO,aM){var aT=g.rootUrl,aL=aT+"/content/",aR=aL+"images/",aK=["<!DOCTYPE html>"];aK.push("<!-- saved from url=(00"+(aT.length+1)+")"+aT+"/ -->");
aK.push('<html lang="ru-RU"><head>');aK.push('<meta http-equiv="Content-Type" content="text/html; charset=windows-1251" />');aK.push("<title>Результаты диагностики "+(aM?(aM+" "):"")+"АО «ПФ «СКБ Контур»</title>");
aK.push('<meta http-equiv="ImageToolbar" content="no" />');aK.push('<meta http-equiv="ClearType" content="on" />');aK.push('<meta name="SKYPE_TOOLBAR" content="SKYPE_TOOLBAR_PARSER_COMPATIBLE" />');
aK.push('<style type="text/css">');aK.push('@font-face { font-family: "Segoe UI"; font-weight: 300; src: local("Segoe UI Light"); }');aK.push('@font-face { font-family: "Segoe UI"; font-weight: 400; src: local("Segoe UI"); }');
aK.push('@font-face { font-family: "Segoe UI"; font-weight: 600; src: local("Segoe UI Semibold"); }');aK.push('@font-face { font-family: "Segoe UI"; font-weight: 700; src: local("Segoe UI Bold"); }');
aK.push('@font-face { font-family: "Segoe UI"; font-style: italic; font-weight: 400; src: local("Segoe UI Italic"); }');aK.push('@font-face { font-family: "Segoe UI"; font-style: italic; font-weight: 700; src: local("Segoe UI Bold Italic"); }');
aK.push("body {");aK.push("	background: #FFF; margin: 0 0 0 1px;");aK.push('	font-family: "Segoe UI", "Helvetica Neue", Arial, Tahoma, "sans-serif", Verdana;');
aK.push("	-webkit-font-smoothing: antialiased;");aK.push("	-ms-touch-action: auto; touch-action: auto; }");aK.push(".diag-view { font-size: 14px; }");aK.push(".diag-view h2 { font-size: 22px; font-weight: 400; }");
aK.push(".diag-view table { border-collapse: collapse; font-size: 14px;}");aK.push(".diag-view table table { font-size: 13px; width: auto; }");aK.push(".diag-view table td table td, .diag-view table td table th {");
aK.push("	border: 1px solid gray;");aK.push("	width: auto; }");aK.push(".diag-script, .diag-script-1, .diag-script-2 {");aK.push("	font-weight: 700; font-size: larger; padding: 10px 0; }");
aK.push(".diag-object td.diag-key, .diag-object th.diag-key {");aK.push("	text-align: left; padding: 5px; vertical-align: top;");aK.push("	font-weight: 600; }");
aK.push(".diag-object td { padding: 5px; }");aK.push(".diag-object td.diag-key { padding-right: 10px; }");aK.push(".diag-object-array td.diag-value { vertical-align: top; }");
aK.push(".diag-object-pivot td.diag-value { vertical-align: top; }");aK.push(".timezone-outer { display: inline-block }");aK.push(".timezone { background-color: #f0f8ff; padding: 5px 10px; font-size: 13px; }");
aK.push(".diag-comment { padding: 5px 0; color: gray; }");aK.push(".diag-comment-500 { padding: 5px 0; color: gray; width: 500px; max-width: 500px; }");
aK.push(".diag-array-item { padding: 0 0 5px 0; }");aK.push("div.diag-array-item table { width: 100%; }");aK.push(".diag-status, .diag-head-status { vertical-align: top; }");
var aP="width: 17px;\n	height: 17px;\n	",aI=" display: block;\n",aQ=aI+"	float: left;\n	clear: left;\n	",aS=" no-repeat ",aJ=aS+" center center; ",aG="background: url('"+aR,aH=aI+aP+aG,aF=aQ+aP+aG+"iconset.png')"+aS;
aK.push(".diag-head-status-0 {"+aF+"-32px -32px;}");aK.push(".diag-head-status-1 {"+aF+"-16px -16px;}");aK.push(".diag-head-status-2 {"+aF+"0 0;}");aK.push(".diag-head-status-unknown {"+aF+"-48px -48px;}");
aK.push(".diag-status-0 {"+aF+"-112px -112px;}");aK.push(".diag-status-1 {"+aF+"-96px -96px;}");aK.push(".diag-status-2 {"+aF+"-80px -80px;}");aK.push(".diag-status-reg {"+aH+"reg.gif')"+aJ+"}");
aK.push(".diag-status-rutoken {"+aH+"token_rutoken.gif')"+aJ+"}");aK.push(".diag-status-lite {"+aH+"token_lite.gif')"+aJ+"}");aK.push(".diag-status-lite-k {"+aH+"token_liteK.gif')"+aJ+"}");
aK.push(".diag-status-lite-cloud {"+aH+"token_liteCloud.gif')"+aJ+"}");aK.push(".diag-status-etoken {"+aH+"token_etoken.gif')"+aJ+"}");aK.push(".diag-status-jacarta {"+aH+"token_jacarta.gif')"+aJ+"}");
aK.push(".diag-status-jacartalt {"+aH+"token_jacartalt.gif')"+aJ+"}");aK.push(".diag-status-esmart {"+aH+"token_esmart.gif')"+aJ+"}");aK.push(".diag-status-magistra {"+aH+"token_magistra.gif')"+aJ+"}");
aK.push(".diag-status-bifit {"+aH+"token_bifit.gif')"+aJ+"}");aK.push(".diag-status-ibank2 {"+aH+"token_ibank2.gif')"+aJ+"}");aK.push(".diag-status-disc {"+aH+"token_flash.gif')"+aJ+"}");
aK.push(".diag-status-cert {"+aF+"-128px -128px;}");aK.push(".diag-status-csp {"+aQ+aP+"background: url('"+aL+"csp.ico')"+aJ+"}");aK.push(".diag-status-cspoff {"+aQ+aP+"background: url('"+aL+"cspoff.ico')"+aJ+"}");
aK.push(".diag-status-kep {"+aQ+"width: 18px;\n	height: 21px;\n	"+aG+"cert-KEP.png')"+aJ+"}");aK.push(".diag-status-comp {"+aQ+aP+aG+"pc.gif')"+aJ+"}");
aK.push("</style>");aK.push(["<scr",'ipt id="diag-scr','ipt-alone" type="te',"xt/java","scr",'ipt">'].join(""));aK.push("var testCats = [];");aK.push('function ge(id) { return ("string"==typeof(id)) ? document.getElementById(id) : id; }');
aK.push('function $display(id, vis) { ge(id).style.display = vis ? "" : "none"; }');aK.push("function expand(id) {");aK.push("	var table = ge(id);");aK.push("	if (table) {");
aK.push('		table.style.display = ("none" == table.style.display) ? "" : "none";');aK.push("	}");aK.push("	return false; }");aK.push("function changeAll(state) {");
aK.push("	for (var i = 0, il = testCats.length; i < il; ++i) {");aK.push("		$display(testCats[i], state);");aK.push("	}");aK.push("	return false; }");aK.push("function hideAll() { return changeAll(false); }");
aK.push("function showAll() { return changeAll(true); }");aK.push("function getEnpandFunc(id) { return function() { return expand(id); }; }");aK.push("function onLoad() {");
aK.push('	var childs = ge("results").childNodes, prev = null, diagFound = false,');aK.push(['		idRegex = new RegExp("^diag\\\\-scr','ipt\\\\-");'].join(""));
aK.push("	for (var i = 0, il = childs.length; i < il; ++i) {");aK.push("	  var node = childs[i];");aK.push("	  if (prev && idRegex.test(node.id)) {");aK.push("		diagFound = true;");
aK.push("		testCats.push(node.id);");aK.push("		prev.onclick = getEnpandFunc(node.id);");aK.push('		prev.style.cursor = "pointer";');aK.push("	  }");aK.push("	  prev = node;");
aK.push("	}");aK.push("	hideAll();");aK.push('	if (diagFound) { $display("btn-panel", true); }');aK.push("}");aK.push('window.SkbKontur = { "Help": {} };');
aK.push("window.SkbKontur.Help.displayCert = function() {");aK.push('	window.alert("Отсутствует локальная копия сертификата для отображения.");');aK.push("};");
aK.push("window.onload = onLoad;");aK.push(["	</scr","ipt>"].join(""));aK.push("</head><body>");aK.push(["<noscr","ipt>"].join(""));aK.push('<center><font color="red">');
aK.push(["Кнопки и ссылки не функционируют по причине отключенного Ja","vaScr","ipt"].join(""));aK.push("</font></center>");aK.push(["</noscr","ipt>"].join(""));
if(aM){aK.push("<div>Номер диагностики: <b>"+aM+"</b></div>")}aK.push('<div id="btn-panel" style="display: none">');aK.push('<button onclick="return hideAll()">Скрыть все</button>');
aK.push("&nbsp;&nbsp;&nbsp;&nbsp;");aK.push('<button onclick="return showAll()">Показать все</button>');aK.push("</div>");aK.push('<div id="results" class="diag-view">');
aO=aO.replace(new RegExp('\\"\\/content\\/components\\/',"gi"),'"'+aL+"components/");aO=aO.replace(new RegExp('\\"\\/content\\/images\\/',"gi"),'"'+aR);
aK.push(aO.replace(new RegExp("\\r\\n","g"),"\n"));aK.push("</div></body></html>");return g.$writeAll(aN,aK.join("\n"),1251)}function A(aF){return G(aF,r,{single:"выбран",multiple:"выбрано",one:"компонент",little:"компонента",many:"компонентов"})
}var aE="window.SkbKontur.Help.View",X=0,Y,h,p=false,e=av("^(Windows|Java|Market|CryptoPro|Rutoken|KonturExtern|KELite|IE|Certificates|Antivirus|Connection)$","i");
function at(){}function ar(aF){aF=aF||h;if(aF){aC.skipTests[aF]=ay;b("diag-"+aF+"-skip",r);b("diag-test-skip",r,ay)}return r}function W(aH,aM,aF,aK){h=null;
var aJ="diag-"+aM;var aG="diag-status-progress";var aN=aM.toLowerCase().indexOf("hidden")!==0;if(!aN){h=aM;if(aK){aK()}return}if(aF){if(X==Y){b("diag-progress",r);
if(!p){b("diag-complete",ay)}}var aI="diag-head-status-",aP=z(aJ+"-status"),aO=z(aJ+"-skip");if(aO){b(aO,r)}b("diag-test-skip",r,ay);if(aP){if(-1===aF){if(aG==aP.className){aG=aI+"unknown"
}}else{var aL=aH.getResult().getMessage(aM),aQ=0;y(aL,function(aS,aR){aQ=aR&&aR.status&&aR.status>aQ?aR.status:aQ});aG=aI+aQ}aP.className=aG}if(aD.onDiagnosisClick){b(aJ+"-text",r);
b(aJ+"-link",ay)}}else{++X;am("diag-progress-percent",Math.floor(100*X/Y));am("diag-section-name",'Тест "'+ax(O,aM)+'"...');h=aM;window.setTimeout(function(){if(h===aM){var aR=z(aJ+"-skip");
if(aR){b(aR,ay);b("diag-test-skip",ay,ay)}}},e(aM)?30000:5000);z(aJ+"-status").className=aG}if(aK){aK()}}function D(){var aG=aC.diagnostics,aJ="&nbsp;&nbsp;&nbsp;&nbsp;",aF=[],aK=[],aL=I.filter(aG.getTests(),function(aN){return aN.name.toLowerCase().indexOf("hidden")!==0
});Y=aL.length;var aM=['<div id="diag-expand-block" style="width: 85%; margin: 3px 0 10px 0">'];aM.push('<a id="diag-expand" href="#" onclick="return '+aE+'.expandTable()">');
aM.push("Показать результаты (только для опытных пользователей)</a></div>");aM.push('<div id="diag-complete" style="width: 85%; font-size: 24px; display: none">Диагностика завершена</div>');
aM.push('<table id="diag-progress" cellpadding="0" cellspacing="0"><tr><td>');aM.push('<img id="diag-progress-img" width="24" height="24" alt=" " src="/content/images/progress24.gif"/>');
aM.push('</td><td>&nbsp;</td><td class="nobr" colspan="2">');aM.push('<span id="diag-progress-text" style="font-size: 24px">');aM.push(B("again")?"Идёт повторная проверка системы ":"Идёт проверка системы ");
aM.push('(<span id="diag-progress-percent">0</span>%)...</span>');aM.push("</td></tr>");aM.push('<tr id="diag-progress-section"><td colspan="2">&nbsp;</td><td>');
aM.push('<span id="diag-section-name" style="color: gray; font-size: 18px">Идёт проверка системы...</span>');aM.push("</td><td>");aM.push('<span id="diag-test-skip" style="display: none">&nbsp;');
aM.push('<a href="#" style="text-decoration: none; border-bottom: 1px dashed" onclick="return '+aE+'.skipTest()">');aM.push("Пропустить</a></span>");aM.push("</td></tr></table>");
y(aL,function(aP){if(!aP.show){return}var aO=aP.name,aN=I.Scripts[aO];if(aN){var aR="<nobr>"+ax(O,aO)+"</nobr>",aQ=[];aQ.push('<td id="diag-'+aO+'-status" class="diag-head-status" style="width: 16px; margin: 5px 8px 5px 0">'+aJ+"&nbsp;</td>");
aQ.push('<td align="left" style="line-height: 26px">');aQ.push('<span id="diag-'+aO+'-text">'+aR+"</span>");if(aD.onDiagnosisClick){aQ.push('<a id="diag-'+aO+'-link" style="display: none" href="#" onclick="return '+aE+".onDiagnosisClick('"+aO+"')\">");
aQ.push(aR+"</a>");aK.push(aO+" - "+aR)}aQ.push('<span id="diag-'+aO+'-skip" style="display: none">');aQ.push("&nbsp;&nbsp;&nbsp;");aQ.push('<a href="#" style="text-decoration: none; border-bottom: 1px dashed" onclick="return '+aE+".skipTest('"+aO+"')\">");
aQ.push("Пропустить</a></span>");aQ.push("</td>\r\n");aF.push(aQ.join(""))}else{M.error("Ошибка создания раздела Диагностики "+aO+" - пустой скрипт")}});
M.debug("Отобразили тесты: "+(aK.length?aK.join(", "):"(пусто)"));if(0!==(aF.length&1)){aF.push("<td>&nbsp;</td><td>&nbsp;</td>")}aM.push('<table id="diag-test-table" class="diag-test-table" cellpadding="0" cellspacing="0" style="display: none">');
for(var aH=0,aI=(aF.length>>1);aH<aI;++aH){aM.push("<tr>"+aF[aH]+'<td width="40">'+aJ+"</td>"+aF[aH+aI]+"</tr>")}aM.push("</table>");return aM.join("\r\n")
}aD.expandTable=function(){am("diag-expand",(p?"Показать":"Скрыть")+" результаты");b("diag-progress",p&&X!=Y);b("diag-complete",p&&X==Y);b("diag-test-table",!p);
p=!p;return r};function C(aG){var aF="<nobr><h2>"+ax(O,aG)+"</h2></nobr>\r\n";return aC.diagnostics.getResult().toHtml(ay,aG).then(function(aH){return aF+aH
})}var u,ag,w,V=window.profileName,L="Номер лицензии (необязательно)",ac="Для продолжения работы необходимо перезагрузить компьютер",ad="Для продолжения установки перезагрузите компьютер<br/>и вновь зайдите по адресу ",ah="Для продолжения работы перезапустите браузер<br/>и вновь зайдите по адресу ",t="Установка и настройка завершены",au="h.kontur.ru"+(V?("/"+V):""),v={fixButtonCaption:"Начать установку и настройку",noFixesSelected:"Не выбран ни один компонент для установки",fixProgressWarning:"Не&nbsp;закрывайте&nbsp;Диагностику до конца установки",fixCompleteStatusMessage:t,fixCompleteStatusReboot:ac,fixCompleteStatusReboot2:ad+"<b>"+au+"</b>",fixCompleteStatusRestart:ah+"<b>"+au+"</b>",needReboot:"Перезагрузите&nbsp;компьютер",needRestart:"Перезапустите&nbsp;браузер",repeatDiagnostics:"Пройти диагностику заново",repeatFixes:"Повторить установку и настройку",rebootNow:"Перезагрузить сейчас",rebootNowText:"Перезагрузка...",rebootConfirmTitle:"Подтверждение&nbsp;перезагрузки",rebootConfirmText:"Внимание! Перед&nbsp;перезагрузкой сохраните все&nbsp;открытые<br/>документы и закройте&nbsp;важные&nbsp;программы!",rebootConfirm:"Подтвердить перезагрузку",rebootLaterText:"Закройте&nbsp;все&nbsp;программы и перезагрузите&nbsp;компьютер.",rebootLater:"Перезагрузить позже",answerPositively:"На вопросы системы об установке компонентов<br/>отвечайте положительно",autorizeAdmin:"При необходимости введите логин/пароль администратора",useCustomButtons:0,autorunAfterReboot:0};
aB({rebootHost:g.rootUrl});function ai(){if(u.getCheckedFixes().length){try{window.location.hash="#diag-fix-top"}catch(aF){}u.run()}}function aj(){if(u.runMarkedFixes){u.runMarkedFixes()
}}function E(aF,aI,aG){var aH='<div id="diag-fix-message"'+((aF<1||aI==aG)?(' style="'+(aF<1?"display: none":"white-space: nowrap")+'"'):"")+">";aH+='Для установки <span id="diag-fix-total-count">'+A(aF);
aH+='</span> (<span id="diag-fix-total-size">';if(aI==aG){aH+=H(aI,ay)}else{aH+="загружено "+H(aI-aG,ay);aH+=", осталось "+H(aG,ay)}aH+="</span>)</div>";
return aH}function m(aG,aF){b(z("checkbox-wrapper-"+aG),!!aF,ay)}function P(aO,aI,aG){var aL=z("diag-fix-id-"+u.getFixId(aO.name));if(aL){aL.checked=aI;
aL.disabled=!!aG}if(aC.ejectTokensWarning&&aO.needejecttokens){b("diag-fix-warning",aO.needejecttokens(aI))}var aH=g.getCache(),aS=0,aN=0,aK=u.getCheckedFixes(),aM=aK.length;
y(aK,function(aV){var aU=aV.size||0;aS+=aU;if(!aH||!aH.get(aV.filename)){aN+=aU}});if(aO.applicable){var aF=u.getApplicableFixes(),aJ=s(aF,function(aU){if(aU.checked){return ay
}var aV=aU.excludes;if(aV&&aV.length){return o(aV,function(aW){aW=u.getFix(aW);if(aW&&aW.checked){return ay}return r})}return r});z("diag-fix-check-all").checked=(aM&&aJ.length==aF.length)
}var aP=z("diag-fix-total-count");if(!aP){z("diag-fix-message").outerHTML=E(aM,aS,aN);aP=z("diag-fix-total-count")}if(aP){aP.innerHTML=A(aM)}var aQ=z("diag-fix-total-size");
if(aQ){var aT;if(aS==aN){aT=H(aS,ay)}else{aT="загружено "+H(aS-aN,ay);aT+=", осталось "+H(aN,ay)}aQ.innerHTML=aT}var aR=(aM>0);b("diag-no-fix-message",!aR);
b("diag-fix-message",aR);a("diag-fix-run",!aR)}function S(){var aF=u.getApplicableFixes();ag=u.getRequirements(ay);y(aF,function(aI){var aJ=u.getFixId(aI.name),aH=z("diag-fix-id-"+aJ);
if(aH){aH.onclick="";m(aJ,r)}b("diag-fix-result-"+aJ,r,ay);b("diag-fix-remark-"+aJ,r,ay);if(!aI.checked){b("diag-fix-line-"+aJ,r)}});b("diag-check-all-row",r);
b("diag-fix-marked-run",r);b("diag-fix-run",r);b("diag-reboot-later",r);var aG=z("diag-fix-warning-text");aG.innerHTML=v.fixProgressWarning;if(g.hasUac()&&ag.admin){if(g.isUser()){aG.innerHTML+="<br/>"+v.autorizeAdmin
}else{aG.innerHTML+="<br/>"+v.answerPositively}}b("diag-fix-warning",ay)}function ao(aG){var aF=z("diag-fix-message");if(aF){aF.innerHTML=aG}}function U(aF){w=-2;
ao(aF)}function x(aG){function aF(){if(w<0){return}var aH="Скачивание файла... ";if(w>99){ao(aH+"осталось совсем немного...")}else{ao(aH+w+"% завершено.");
++w}window.setTimeout(aF,aC.downloadUpdateInterval)}w=-2;if(aG){if(aG.lengthComputable!==aA){ao("Скачивание файла... загружено "+((100*Math.min(1,aG.loaded/(aG.total||1)))^0)+"%")
}else{if(aG==1){ao("Скачивание файла...");aC.downloadUpdateInterval=100}else{if(aG==2){ao("Нашли копию в кэше...")}else{if(aG==3){ao("Сохранение файла в кэш...")
}else{if(aG==4){ao("Установка файла... подождите...")}else{if(aG==-1){w=0;aF()}}}}}}}else{ao("Выполнение рекомендуемых действий...")}}function R(aI,aR,aP){var aK=aI?aI.name:O,aJ=aK?u.getFixId(aK):"",aT=aR&&!aR.code,aF="diag-fix-status-";
if("undefined"==typeof(aR)){aF+="progress";M.detach("info",U);M.attach("info",U);if(aK){b("diag-fix-remark-"+aJ,r,ay)}x()}else{if(aK){var aS=aT?"0":"2",aN=aI.license,aQ=(aI.runFromComment?"-":""),aO=aN?z(aN+aQ):O;
if(aT&&aN&&aN.length&&aO){aS="progress";var aL=z("diag-fix-lic-"+aN+aQ);if(aL){b(aL,ay)}else{if(aQ){b("diag-fix-lic-"+aN,ay)}}if(aI.serial){try{aO.value=aI.serial
}catch(aG){}}if(aO.value&&aO.value.length){var aM=z("diag-lic-btn-"+aN);if(aM&&!aM.disabled){aS="0";aM.click()}}else{U("Ожидание ввода серийного номера...")
}}aF+=aS;if(!aT&&aP){b("diag-fix-remark-"+aJ,ay);am("diag-fix-remark-"+aJ,aP)}M.detach("info",U)}}if(aK){var aH=z("diag-fix-status-"+aJ);if(aH){m(aJ,r);
aH.className=aF;b(aH,ay)}}}function N(aJ,aH){var aF=z("diag-window"),aG=z("fix-window"),aK=z("uac-modal-overlap"),aI=z("modal-overlap");if(aF||aG){if(aF){aF.style.zIndex=aJ?8000:9999
}if(aG){aG.style.zIndex=aJ?8000:9999}}if(aK){aK.style.zIndex=aJ?8000:8100;aK.onclick=null}if(aI){aI.style.zIndex=aJ?10:8000}b("uac-modal-overlap",!!aJ);
b(aH,!!aJ)}function az(aG){var aF="uac-lb";z(aF).style.width="500px";N(aG,aF)}function q(aF){N(aF,"extension-lb")}function af(){var aL=B("XUACompatible"),aH=aL&&(aL==Number(aL)),aI="?again"+(aH?"&XUACompatible="+aL:"")+(V?"&p="+V:""),aJ=O;
try{aJ=window.location}catch(aG){}if(aJ){var aK=window.location.search;if(aK&&aK.length>1){if(av("[\\?\\&]again(\\&|$)","i")(aK)){aI=aK}else{aI=aK+"&again"
}}}var aF=this;a(aF,ay);window.setTimeout(function(){try{a(aF,r)}catch(aM){}},7000);if(aJ==aI){window.location.reload(ay)}else{window.location=g.addOrigin(aI)
}return r}function c(){return Z.fork(v.autorunAfterReboot,function(){return g.addToRunOnce(v.rebootLocation,0)},O)}function J(aF){b("diag-fix-run",r);b("diag-reboot-later",r);
z("diag-fix-warning-text").innerHTML=aF}function ae(){aw("Repair","RebootNow");J(v.rebootNowText);c().then(aa);return r}function f(){var aG=z("diag-fix-title");
if(aG){aG.innerHTML=v.rebootConfirmTitle}b("diag-fix-table",r);z("diag-fix-warning-text").innerHTML=v.rebootConfirmText;b("diag-fix-warning",ay);var aF=z("diag-fix-run");
aF.innerHTML=v.rebootConfirm;aF.onclick=ae;b(aF,ay);u.callEvent("onConfirmReboot",O)}function ab(){aw("Repair","RebootLater");J(v.rebootLaterText);c();
return r}function Q(aU,aR){var aO=aR.reboot,aP=!!aR.reinstallReboot,aQ=aR.restart,aK=aR.license,aL=aR.marked,aN=(aO||aQ||aL),aF=z("diag-fix-run");if(aN){if(aO||aP){var aI=z("diag-reboot-later");
aI.onclick=ab;b(aI,ay);aF.innerHTML=v.rebootNow;aF.onclick=f;b(aF,ay)}else{if(aQ){b(aF,r)}}if(aL){var aH=z("diag-fix-marked-run");b(aH,ay)}}else{aF.innerHTML=v.repeatDiagnostics;
aF.onclick=af;b(aF,ay)}var aS=v.fixCompleteStatusMessage,aT=(aU?" успешно":" с ошибками"),aM=aS?(aS+aT):O;if(aO||aP){aw("Repair",aP?"RebootReinstall":"NeedReboot");
aM=aM?(aM+"<br/>"):"";aM+=v["fixCompleteStatusReboot"+((aO>1||aP)?"2":"")]}else{if(aQ){aw("Repair","NeedRestart");aM=aM?(aM+"<br/>"):"";aM+=v.fixCompleteStatusRestart
}}if(!aM||(aT===aM)){aM=t+aT}M.info(aM);if(!aK){ao(aM)}var aG=z("diag-fix-warning"),aJ=z("diag-fix-warning-text");b(aG,r);if(aO||aP){aJ.innerHTML=v.needReboot;
b(aG,ay)}else{if(aQ){aJ.innerHTML=v.needRestart;b(aG,ay)}}}function aB(aF){if(aF){for(var aG in aF){v[aG]=aF[aG]}if(aF.rebootHost){var aH="?again";y(aC.customFixParams,function(aI){if(B(aI)){aH+="&"+aI
}});v.rebootLocation=aF.rebootHost+(V?("/"+V):"")+aH}}return v}function an(aG){var aF=z("diag-fix-id-"+u.getFixId(aG));aF.title=u.getBlockingTitle(aG);
return false}function K(){if(!u){u=aC.diagnostics.getFixer();u.addEventListener("onCheck",P);u.addEventListener("onStart",S);u.addEventListener("onProgress",R);
u.addEventListener("onComplete",Q);aD.checkFix=u.checkFix;aD.checkAllFixes=u.checkAll;aD.runFix=u.runFix;aD.fixProgress=x;aD.onFixProgress=R;aD.showDependency=an
}}function F(aT){aT=aB(aT);K();var aJ=u.getApplicableFixes(),aW=new RegExp("\\s+","g"),aH=aC.cspVersion,aQ=!!(u.getFix("CryptoPro.CSP3X")||u.getFix("CryptoPro.CSP3XUpdate")),aG=u.getCheckedFixes().length,aX=0,aI=0,aY=aT.useCustomButtons,aP='<div id="diag-fix-warning"',aZ='<img border="0" src="/content/images/warning.gif" width="16" height="16" alt=" " />',a1=(aY?aZ+"<span":"<div")+' id="diag-fix-warning-text">';
var a0=u.getWarning(!!aD.onDiagnosisClick);if(!a0){aP+=' style="display:none"'}aP+=">"+a1+i.translateWarning(a0);aP+=(aY?"</span>":"</div>")+"</div>";var aS=g.isMSHTA(),aV='<div class="checkbox-wrapper"><input id="diag-fix-check-all" type="checkbox" onclick="'+aE+'.checkAllFixes(this.checked)"',aO='<table id="diag-fix-table" class="diag-fix-table" cellpadding="0" cellspacing="0" ',aR=[];
if(aY){aR.push(aP)}aR.push(aO+(aY?'style="margin: 15px 0 0 11px">':'style="margin-top: 10px">'));aR.push('<tr id="diag-check-all-row" style="border: none">');
if(aJ.length&&(aJ.length==aG)){aV+=' checked="checked"'}else{if(!u.getApplicableFixes(ay).length){aV+=' disabled="disabled"'}}aV+=" /></div>";aR.push('<td class="diag-fix-status" style="background-color: #e6e6e6">'+aV+"</td>");
aR.push('<td style="background-color: #e6e6e6">&nbsp;&nbsp;&nbsp;</td>');aR.push('<td style="background-color: #e6e6e6;display:inline-block;vertical-align:top;padding-right: 10px;"><label for="diag-fix-check-all" style="color: #404040 !important">Выбрать&nbsp;все</label></td>');
aR.push('<td width="99%" style="backround: none !important">&nbsp;</td></tr>');y(aJ,function(bd,bm){var a2=g.getCache(),bj=bd.name,bg=u.getFixId(bj),bi=bd.localfile,br=a2&&a2.get(bi),bs=br&&br.name.toLowerCase(),bl=bs?(aC.productSizes[bs]||0):(bd.size||0),bk=bd.priority?1:0,be=bd.checked,bf=bd.disabled,bq=br||(a2&&a2.get(bd.filename)),a6="diag-fix-custommessage-"+bg,a9="diag-fix-remark-"+bg,a3="checkbox-wrapper-"+bg,a7="diag-fix-id-"+bg,a8="diag-fix-line-"+bg,ba="diag-fix-result-"+bg,bb="diag-fix-status-"+bg;
if(be){aX+=bl;if(!bq){aI+=bl}}var bw="";if(!bf){bw=["onmouseover=\"return SkbKontur.Help.View.showDependency('",bj,"');\""].join("")}aR.push('<tr id="'+a8+'"><td class="diag-fix-status" '+bw+">");
aR.push('<div id="'+bb+'" style="display:none">&nbsp;</div>');if(bf){aR.push('<div class="diag-fix-disabled">&nbsp;</div>')}else{var a4='<div id="'+a3+'" class="checkbox-wrapper">';
a4+='<input id="'+a7+'" onclick="return '+aE+".checkFix('"+bj+'\', this.checked)" type="checkbox" ';if(be){a4+=' checked="checked"'}if(bd.blocked){a4+=' disabled="disabled"'
}aR.push(a4+=" /></div>")}aR.push("</td><td>&nbsp;</td>");var bh='<td colspan="2"><label for="'+a7+'">'+bd.number+".&nbsp;"+bd.message+"</label>";if(!aQ&&bd.dependency&&bd.dependency.length&&I.contains(bd.dependency,"CryptoPro.CSP3X")){if(I.isNullOrEmptyOrBad(aH)){bh+=" <i>(нужен&nbsp;"+g.getFixComment(aC.cspDownloadLink,"КриптоПро&nbsp;CSP",{url:ay})+")</i>"
}}var bz=H(bl);if(bz&&bz.length){if(bq){bz+=", уже загружено"}bh+=' <span class="diag-fix-size">('+bz.replace(aW,"&nbsp;")+")</span>"}aR.push(bh);var by='<div class="diag-fix-priority">';
by+='<div class="diag-fix-priority-'+bk+'"'+(1==bk?' title="Важный компонент"':"")+">&nbsp;</div>";by+="</div>";aR.push(by);var bn=bd.script;if(bd.url&&!bn){var bA=' <span style="vertical-align: middle; line-height: 16px">';
bA+=' <a rel="nofollow noopener"'+(aS?' target="_blank"':"")+' href="'+bd.url;bA+='" title="Скачать и сохранить файл"><div class="save-button"></div></a>';
if(bq){var bc=g.doubleSlashes(bq.path),bx="Открыть файл в проводнике";bA+=' <div class="open-button" title="'+bx+'" onclick="';bA+="return window.SkbKontur.Help.Core.exploreFile('"+bc+"')";
bA+='"></div>'}bA+="</span>";aR.push(bA)}aR.push("<br/>");var bo=bd.license;if(bo){var bu=aE+".enterLicense(this, '"+bj+"','"+bo+"');",bv="window.alert('"+(bd.licensehint||g.cspSerialHint)+"'); return false",bp=' <span class="diag-fix-license" id="diag-fix-lic-'+bo+'" style="display: none">';
bp+='<table cellpadding="0" cellspacing="0">';bp+="<tr><td>Для регистрации, пожалуйста, введите серийный номер</td>";bp+='<td><div class="help-button" onclick="'+bv+'"></div></td>';
bp+="<td>:</td></tr></table>\r\n";bp+='<table><tr><td><input type="text" id="'+bo+'"';bp+=" onkeydown=\"var ev = window.event; if (ev && (13==ev.keyCode || '13'==ev.which))"+bu+'"';
bp+=' size="'+Math.ceil(bo.length*4/3)+'" maxlength="'+(bo.length+10)+'"/></td>';bp+='<td>&nbsp;<input type="button" id="diag-lic-btn-'+bo+'" value="Ввести" onclick="return '+bu+'"/></td>';
if(bd.licenselater){var bt=aE+".skipLicense('"+bj+"','"+bo+"')";bp+='<td>&nbsp;&nbsp;<a href="#" onclick="return '+bt+'">';bp+="Ввести&nbsp;позже</a></td>"
}bp+="</tr></table></span>";aR.push(bp)}var a5=bd.custommessage;if(a5){aR.push(' <span class="diag-fix-license" id="'+a6+'" style="display: none">'+a5+"</span>")
}aR.push(' <span class="diag-fix-remark" id="'+a9+'" style="display: none"></span>');aR.push("</td></tr>")});aR.push("</table>");aR.push('<div class="diag-fix-panel">');
var aM="",aL='<div id="diag-no-fix-message" style="'+((aG>0)?"display: none; ":"")+'color: red; font-weight: 700; white-space: nowrap">'+aT.noFixesSelected+"</div>",aF=(aG<1)?"btn-disabled":"btn-primary",aK='<button id="diag-fix-marked-run" onclick="'+aE+'.runMarkedFixes()" class="btn btn-warning btn-auto" style="margin-bottom: 10px; display: none">'+aT.repeatFixes+"</button>",aN='<button id="diag-fix-run" onclick="'+aE+'.runFixes()" class="btn '+aF+' btn-auto"'+((aG<1)?' disabled="disabled"':"")+">"+aT.fixButtonCaption+"</button>",aU='<button id="diag-reboot-later" class="btn btn-second btn-auto" style="margin-left: 30px; display: none">'+aT.rebootLater+"</button>";
aM+='<div class="wd_delim"></div>';if(!aY){aM+=aP;aM+='<div class="wd_delim"></div>'}aM+='<table cellpadding="0" cellspacing="0" style="width: 100%">';
aM+='<tr><td style="text-align: center;">'+aK+'</td></tr><tr><td style="text-align: center;">'+aN+aU+"</td>";aM+='</tr><tr><td style="color: #505050; font-weight: 300; vertical-align: middle; padding-top: 15px; text-align: center;">';
aM+=aL+E(aG,aX,aI);aM+="</td></tr>";if(aY){aM+='<tr><td colspan="4" style="padding-top: 10px">';aM+='<a id="diag-skip-install" href="#" style="display: none">Пропустить установку необязательных компонентов</a>';
aM+="</td></tr>"}aM+="</table>";aR.push(aM);aR.push("</div>");return aR.join("\r\n")}function aq(aF,aH){K();u.callEvent(T,O);var aG=z("diag-fix-status-"+u.getFixId(aF));
if(aG){aG.className="diag-fix-status-0"}if(aH){b("diag-fix-lic-"+aH,r)}return r}function n(aK,aI,aN,aP){var aG=z(aN),aQ=aG.value||"";if(L==aQ){return r
}aK.disabled=ay;var aM=aQ.replace(new RegExp("\\s","g"),"");aG.value=aM;var aF=new RegExp("\\-","g"),aO=aM.replace(aF,""),aL=aN.replace(aF,"").length;if(av("[^\\d\\w]+","i")(aO)){window.alert("Лицензия может состоять только из английских/латинских букв, цифр и дефисов-разделителей.");
aK.disabled=r;return r}if(aL!=aO.length){window.alert("Неверная длина серийного номера лицензии.\nДолжно быть "+aL+" символов (без учета дефисов),\nсейчас - всего "+aO.length);
aK.disabled=r;return r}K();var aH=u.getFix(aI);if(!aH){M.debug("Ошибка: Для проверки лицензии не найден фикс с именем: "+aI);M.fatal("Ошибка проверки лицензии: системная ошибка. Попробуйте ввести лицензию вручную через ее собственную программу.");
aK.disabled=r;return r}function aJ(aU,aS){var aT="display: inline-block; margin-top: 5px",aR='<span style="'+aT+'" class="diag-status diag-status-'+aS+'">';
return aR+"&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<span>"+aU+"</span>"}aH.checklicense(aO,function(aW){aK.disabled=r;var aS=z("diag-fix-status-"+u.getFixId(aH.name));
if(aW){var aT=(aH.licenseresult||"Лицензия успешно активирована."),aU=(aT.indexOf("Сбой")>=0)?2:0;z("diag-fix-lic-"+aN).innerHTML=aJ(aT,aU);if(aS){aS.className="diag-fix-status-"+aU
}try{U("")}catch(aR){}if(aP){u.removeFix(aH)}}else{if(r===aW){var aV=aH.licenseresult||"Ошибка ввода лицензии.";if(aV.indexOf("Попробуйте еще раз")<0){if(aS){aS.className="diag-fix-status-2"
}try{U(v.fixCompleteStatusMessage+" с ошибками")}catch(aR){}}if(aV.indexOf(" href=")>=0){z("diag-fix-lic-"+aN).innerHTML=aJ(aV,2)}else{window.alert(aV)
}}else{if(aS){aS.className="diag-fix-status-1"}}}u.callEvent(T,aW)});return r}})(window.SkbKontur.Help);(function(Y,aQ){var ai=Y.SkbKontur||(Y.SkbKontur={}),aP=ai.Toolbox={},ah=["2.100","2.9.3","2.9.2","2.9.1","2.9.0","2.8.2","2.8.1","2.8.0","2.7.1","2.7.0","2.6.0","2.5.1","2.5.0","2.4.0","2.3.0","2.2.0",""],W,am={},x;
aP.version="2.9.3.15";function F(){}function I(a3){for(var aZ=1,a1=arguments.length;aZ<a1;aZ++){var a2=arguments[aZ];for(var a0 in a2){a3[a0]=a2[a0]}}return a3
}function Z(aZ,a2,a1){function a0(){}a0.prototype=a2.prototype;var a3=new a0();if(a1){I(a3,a1)}a3.constructor=aZ;aZ.prototype=a3;return aZ}function y(a0,aZ){function a1(){return a0.apply(this,aZ)
}a1.prototype=a0.prototype;return new a1()}(function(){function a0(a1){return"KT: "+(a1||"")}var aZ=Y.console;if(aZ){x={info:function(a2){try{aZ.info(a0(a2))
}catch(a1){}},error:function(a2){try{aZ.error(a0(a2))}catch(a1){}}}}else{x={info:F,error:F}}}());(function(){var a0=null,aZ=[new al(),new b()];W=function(a4){if(a0!==null&&!a4){return a0
}a0=null;am={};var a3=null;for(var a1=0;a1<aZ.length;a1++){a3=aZ[a1];if(a3.init()){break}a3=null}if(a3){var a2=a3.getInfo();if(a2&&!a2.denied&&!a2.disabled){a0=a3
}}else{a3=new d()}x.info("API v"+aP.version);x.info(a3.getInfoMessage());return a3}}());function B(aZ){return W().create(aZ)}function X(a0){var aZ=am[a0];
if(!aZ){aZ=W().create(a0);am[a0]=aZ}return aZ}aP.getPluginInfo=function(){return W().getInfo()};aP.refresh=function(){return W(true).getInfo()!==null};
aP.reset=aP.refresh;function w(a1,aZ,a0,a2){if(a0){a0=new aJ(a1,W().getException(a0));K(a0);aZ(a0)}else{aZ(aQ,a2)}}var H=/^\[([0-9]+)\]\s*/,aS=/\(([0-9a-zA-Z]+):/;
aP.onerror=function(aZ){x.error(aZ)};function G(a0,aZ){this.method=a0;this.message=aZ}G.prototype.toString=function(){return this.message||"unknown error"
};function ak(a0,aZ){G.call(this,a0,'ActiveX/NPAPI component "'+(a0||"")+'" is not installed');this.exception=aZ}function aG(aZ){G.call(this,aZ,'Access to create "'+(aZ||"")+'" object is denied');
this.accessDenied=true}function c(a0,aZ){G.call(this,a0,'Invalid argument "'+aZ+'" for method "'+a0+'"');this.argument=aZ}function aJ(a2,a0){var a1,aZ=-1,a4=-1;
if(a0){a1=a0.message||a0.toString();if(a1){var a3=H.exec(a1);if(a3&&a3.length>1){aZ=Y.parseInt(a3[1]);a1=a1.substring(a3[0].length)}a3=aS.exec(a1);if(a3&&a3.length>1){a4=a3[1];
if(a4.indexOf("0x")!==0){a4="0x"+parseInt(a4,10).toString(16)}}}}G.call(this,a2,'Error at "'+a2+'": '+(a1||"unknown"));this.exception=a0;this.errorCode=aZ;
this.winErrorCode=a4}aP.Error=G;aP.SystemError=Z(aJ,G);aP.ArgumentError=Z(c,G);aP.NotInstallError=Z(ak,G);aP.SecurityError=Z(aG,G);function K(aZ){if(aP.onerror){try{aP.onerror(aZ)
}catch(a0){}}}function aF(aZ){K(aZ);throw aZ}function aL(a0,aZ){aF(new G(a0,aZ))}function aK(a0,aZ){aF(new c(a0,aZ))}function aO(a0,aZ){if(!(aZ instanceof G)){aZ=new aJ(a0,W().getException(aZ))
}aF(aZ)}function aM(a0,aZ){aF(new ak(a0,aZ))}function aN(aZ){aF(new aG(aZ))}function ad(aZ){return aZ!==null&&aZ!==aQ}function p(a1,aZ,a0){if(!ad(a1)){aK(aZ,a0)
}}function u(a1,a2,aZ,a0){if(typeof(a2)!==a1){aK(aZ,a0)}}function t(a1,aZ,a0){return u("string",a1,aZ,a0)}function r(a1,aZ,a0){return u("number",a1,aZ,a0)
}function n(a1,aZ,a0){return u("boolean",a1,aZ,a0)}function q(aZ,a0,a1){if(typeof(aZ)!=="function"){aK(a0,a1||"function")}}function d(){this.create=function(aZ){aM(aZ)
};this.init=function(){return false};this.getInfo=function(){return null};this.getException=function(aZ){return aZ};this.getDate=function(aZ){return aZ
};this.getArray=function(aZ){return aZ};this.getInfoMessage=function(){var aZ=this.getInfo();if(!aZ){return"plugin is not installed."}var a0="plugin v"+(aZ.version||"0.0")+" ("+aZ.name;
if(aZ.disabled){a0+=", disabled"}if(aZ.denied){a0+=", denied"}a0+=")";return a0}}function L(){if("CollectGarbage" in Y){try{Y.CollectGarbage()}catch(aZ){}}}aP.garbageCollect=L;
function b(){d.call(this);var aZ,a1=null;function a0(a4,a5){var a3="KonturToolbox2."+a4;if(a5&&a5.length){a3+="."+a5}return new Y.ActiveXObject(a3)}function a2(){a1=null;
var a3;try{var a9=a0("About"),a8=a9.RegVersion;if(!a8||!a8.length){throw"regVersion"}aZ=a8.substring(0,a8.lastIndexOf("."));a3=(a9.Version===a8)?a9:a0("About",aZ)
}catch(a4){for(var a6=0,a7=ah.length;a6<a7;++a6){try{a3=a0("About",ah[a6]);aZ=a3.Version;aZ=aZ.substring(0,aZ.lastIndexOf("."));break}catch(a5){if((a6+1)===a7){throw a5
}}}}a1={name:"ActiveX",version:a3?a3.Version:null};if("HasAccess" in a3){a1.denied=!a3.HasAccess()}if("WinVersion" in a3){a1.winVersion=a3.WinVersion()
}}this.init=function(){var a4=false;if("ActiveXObject" in Y){try{a2();a4=true}catch(a3){}L()}return a4};this.getInfo=function(){return a1};this.getDate=function(a3){return new Date(a3)
};this.getArray=function(a3){return new Y.VBArray(a3).toArray()};this.create=function(a4){try{return a0(a4,aZ)}catch(a3){return aM(a4,a3)}}}function al(){d.call(this);
var a0=Y.document,a6="application/x-kontur-toolbox",a9="skbkontur.toolbox",a7="visibility:hidden;width:0px;height:0px;max-width:0;max-height:0;margin:0;padding:0;border:0px none;position:absolute;",ba=new RegExp("\\d\\.\\d\\.\\d(\\.\\d+)?"),a8=null,a5=false,a4=null;
function a3(bb){if(bb){var bc=ba.exec(bb);if(bc){return bc[0]}}return""}function aZ(bf,bi){if(bf===bi){return 0}if(!bf||!bf.length){return -1}if(!bi||!bi.length){return 1
}var bg=bf.split("."),bj=bi.split("."),be=bg.length,bh=bj.length;for(var bc=0,bd=(be<bh)?be:bh;bc<bd;++bc){var bb=Number(bg[bc])-Number(bj[bc]);if(0!==bb){return(bb>0)?1:-1
}}return(be===bh)?0:((be>bh)?1:-1)}function a2(bb){return bb.version||a3(bb.filename)}function a1(){var bi=Y.navigator.plugins,bb=null,bc=null;bi.refresh(false);
for(var be=0,bf=bi.length;be<bf;++be){var bh=bi[be],bg=bh.name;if(bg&&(bg.toLowerCase()===a9)){var bd=a2(bh);if(bd&&aZ(bd,bc)>0){bc=bd;bb=bh}}}return bb
}this.init=function(){a5=false;if(a8&&(!a4||!a4.disabled)){a0.body.removeChild(a8);a8=null;a4=null}var bf=a1();if(!bf){return false}if(!a8){var bi=a0.createElement("object");
bi.setAttribute("type",a6);bi.setAttribute("style",a7);a0.body.appendChild(bi);var bg=a6,bh=bi.RegVersion;if(bh){bg=a6+"-"+bh.substring(0,bh.lastIndexOf("."))
}else{for(var bc=0,bd=ah.length;bc<bd;++bc){var be=a6+"-"+ah[bc];if(Y.navigator.mimeTypes[be]){bg=be;break}}}if(bh&&(bi.Version===bh)){a8=bi}else{a0.body.removeChild(bi)
}if(!a8){a8=a0.createElement("object");a8.setAttribute("type",bg);a8.setAttribute("style",a7);a0.body.appendChild(a8)}}try{a4={name:"NPAPI",version:a8.Version,denied:!a8.HasAccess()};
if(a8.WinVersion){a4.winVersion=a8.WinVersion()}a5=true}catch(bb){a4={name:"NPAPI",version:a2(bf),disabled:true}}return !!a4};this.getInfo=function(){return a4
};this.create=function(bd){if(a5){var bc="Create"+bd;try{return a8[bc]()}catch(bb){return aN(bd)}}return aM(bd)};this.getException=function(bb){if(bb){if(bb.message){bb.message=decodeURIComponent(bb.message)
}else{bb=decodeURIComponent(bb.toString())}}return bb}}function af(aZ){return aZ instanceof aI}function s(a1,aZ,a0){if(!(a1 instanceof aI)){aK(aZ,a0||"stream")
}}function v(a0){if(a0&&af(a0)){try{a0.close()}catch(aZ){}}}function aI(){}aI.bufferSize=65536;aI.prototype={constructor:aI,readAll:function(){return this.read(this.getSize())
},readBase64:function(a1){var a0=this.read(a1);try{var aZ=a0.toBase64();a0.close();return aZ}catch(a2){a0.close();throw a2}},readBase64Async:function(a0,aZ){this.readAsync(a0,function(a3,a2){if(a3){aZ(a3,null)
}else{var a1=a2.toBase64();a2.close();aZ(null,a1)}})},writeBase64:function(aZ){var a0=e.fromBase64(aZ);try{this.write(a0);a0.close()}catch(a1){a0.close();
throw a1}},writeBase64Async:function(aZ,a1){var a0=e.fromBase64(aZ);this.writeAsync(a0,function(a2){a0.close();a1(a2)})},copyTo:function(a1,a0){var a2="Stream.copyTo";
s(a1,a2,"dest");if(!a0||a0<0){a0=aI.bufferSize}r(a0);while(true){var aZ=this.read(a0),a3=aZ.getSize();a1.write(aZ);aZ.close();if(a3<a0){break}}},copyToAsync:function(a1,a0,aZ){var a2="Stream.copyToAsync",a4=this;
s(a1,a2,"dest");q(a0,a2,"callback");if(!aZ||aZ<0){aZ=aI.bufferSize}r(aZ);function a3(){a4.readAsync(aI.bufferSize,function(a6,a5){if(a6){a0(a6)}else{var a7=a5.getSize();
a1.writeAsync(a5,function(a8){a5.close();if(a8){a0(a8)}else{if(a7<aI.bufferSize){a0(null)}else{a3()}}})}})}a3()}};function an(aZ){if(!aZ){aZ=B("OperationToken")
}this._handle=aZ}an.prototype={constructor:an,isCanceled:function(){try{return this._handle.IsCanceled()}catch(aZ){return aO("OperationToken.isCanceled",aZ)
}},setCanceled:function(){try{return this._handle.SetCanceled()}catch(aZ){return aO("OperationToken.setCanceled",aZ)}},progress:function(){try{return this._handle.Progress()
}catch(aZ){return aO("OperationToken.progress",aZ)}}};aP.OperationToken=an;var ag;(function(){var aZ=/["\\\x00-\x1f\x7f-\x9f]/g,a0={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};
function a4(a7){if(aZ.test(a7)){return'"'+a7.replace(aZ,function(a8){return a0[a8]||("\\u00"+(a8.charCodeAt()&255).toString(16))})+'"'}return'"'+a7+'"'
}function a2(a7){return a7<10?"0"+a7:a7}function a6(a7){var a8=a7.getUTCMilliseconds();if(a8<100){a8=a8<10?"00"+a8:"0"+a8}return a7.getUTCFullYear()+"-"+a2(a7.getUTCMonth()+1)+"-"+a2(a7.getUTCDate())+"T"+a2(a7.getUTCHours())+":"+a2(a7.getUTCMinutes())+":"+a2(a7.getUTCSeconds())+"."+a8+"Z"
}function a3(a7){if(!a7||!a7.length){return aQ}return(new Function("return "+a7))()}function a5(a9){if(null===a9){return"null"}if(a9===aQ){return a9}var bd=typeof(a9);
if("number"===bd||"boolean"===bd){return String(a9)}if("string"===bd){return a4(a9)}if(a9 instanceof Date){return'"'+a6(a9)+'"'}var ba=[];if(a9 instanceof Array){for(var a7=0,a8=a9.length;
a7<a8;++a7){ba.push(a5(a9[a7])||"null")}return"["+ba.join(",")+"]"}if("object"===bd){for(var bb in a9){if(a9.hasOwnProperty(bb)){var bc;if("string"==typeof(bb)){bc=a4(bb)
}else{if("number"==typeof(bb)){bc='"'+bb+'"'}else{continue}}var be=a9[bb];if(("function"!=typeof(be))&&aQ!==be){ba.push(bc+":"+a5(be))}}}return"{"+ba.join(",")+"}"
}if("function"===bd){return a5(a9.toString())}return""}var a1=Y.JSON;ag={parse:a1&&a1.parse?a1.parse:a3,stringify:a1&&a1.stringify?a1.stringify:a5,_parse:a3,_stringify:a5}
}());aP.JSON=ag;var D=65001,aR=1200;function e(aZ){if(!aZ){aO("Invalid binary handle")}this._handle=aZ}function aa(aZ){return aZ instanceof e}function aT(aZ){return new e(aZ)
}function m(a1,aZ,a0){if(!aa(a1)){aK(aZ,a0||"binary")}}function z(){var a1=null,a3=["Msxml2.DOMDocument.6.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM","Msxml2.DOMDocument.4.0"];
for(var a0=0,a2=a3.length;a0<a2;a0++){try{return new Y.ActiveXObject(a3[a0])}catch(aZ){a1=aZ}}throw a1}function g(a0,a5,a1){var aZ=a1?new Array(a1):[];
try{for(var a3=a5,a4=0;a4<a1;++a3,++a4){aZ[a4]=a0._handle.GetByte(a3)}}catch(a2){aO("Binary.toArray",a2)}return aZ}e.prototype={constructor:e,chunkSize:32768,getSize:function(){try{return this._handle.Size
}catch(aZ){return aO("Binary.getSize",aZ)}},getByte:function(aZ){var a1="Binary.getByte";r(aZ,a1,"byteIndex");try{return this._handle.GetByte(aZ)}catch(a0){return aO(a1,a0)
}},getCrc32:function(a0){var a1="Binary.getCrc32";if(ad(a0)){r(a0,a1,"initial")}try{var a2;if(!ad(a0)){a2=this._handle.GetCrc32()}else{a2=M().GetCrc32(this._handle,a0)
}return a2>>>0}catch(aZ){return aO(a1,aZ)}},getCrc32Async:function(a0,aZ){var a2="Binary.getCrc32Async";if(typeof(a0)==="function"){aZ=a0;a0=0}r(a0,a2,"crc");
q(aZ,a2,"callback");try{M().GetCrc32Async(this._handle,a0,function(a3,a4){w(a2,aZ,a4,a3>>>0)})}catch(a1){aO(a2,a1)}},getMd5:function(){var a1="Binary.getMd5";
try{var a0=M().GetMd5(this._handle);return aT(a0)}catch(aZ){return aO(a1,aZ)}},getMd5Async:function(aZ){var a1="Binary.getMd5Async";q(aZ,a1,"callback");
try{M().GetMd5Async(this._handle,function(a3,a2){var a4=a2?aQ:aT(a3);w(a1,aZ,a2,a4)})}catch(a0){aO(a1,a0)}},getSha256:function(){var a1="Binary.getSha256";
try{var a0=M().GetSHA256(this._handle);return aT(a0)}catch(aZ){return aO(a1,aZ)}},getSha256Async:function(aZ){var a1="Binary.getSha256Async";q(aZ,a1,"callback");
try{M().GetSHA256Async(this._handle,function(a3,a2){var a4=a2?aQ:aT(a3);w(a1,aZ,a2,a4)})}catch(a0){aO(a1,a0)}},equals:function(aZ){if(aZ===null||aZ===aQ){return false
}if(aZ instanceof e){try{return this._handle.Equals(aZ._handle)}catch(a0){return aO("Binary.equals",a0)}}return aK("Binary.equals","bin")},toBase64:function(){try{return this._handle.ToBase64()
}catch(aZ){return aO("Binary.toBase64",aZ)}},toHexString:function(){try{return this._handle.ToHexString()}catch(aZ){return aO("Binary.toHexString",aZ)}},decodeString:function(aZ){if(aZ===aR){return this.decodeUnicodeString()
}var a1="Binary.decodeString";if(aZ===aQ){aZ=D}r(aZ,a1,"codePage");try{return this._handle.ToString(aZ)}catch(a0){return aO(a1,a0)}},decodeUnicodeString:function(){try{return this._handle.ToUnicodeString()
}catch(aZ){return aO("Binary.ToUnicodeString",aZ)}},writeFile:function(a0){var a1="Binary.toFile";t(a0,a1,"fileName");try{this._handle.ToFile(a0)}catch(aZ){aO(a1,aZ)
}},toXml:function(){var a0=null,a1=this.toXmlString();try{if("ActiveXObject" in Y){a0=z();a0.async=false;a0.loadXML(a1)}else{a0=(new Y.DOMParser()).parseFromString(a1,"text/xml")
}}catch(aZ){aO("toXml",aZ)}return a0},toXmlString:function(){try{return this._handle.ToXmlString()}catch(aZ){return aO("Binary.toXmlString")}},toArray:function(a4,a1){var a3="Binary.toArray";
if(a4===aQ||a4===null){a4=0}else{r(a4,a3,"offset")}if(a1===aQ||a1===null){a1=this.getSize()}else{r(a1,a3,"count")}try{if(a1>this.chunkSize){var aZ=[];var a0=Math.floor(a1/this.chunkSize)+(a1%this.chunkSize?1:0);
while(a0>0){aZ.push.apply(aZ,W().getArray(this._handle.ToArray(a4,this.chunkSize)));a4+=this.chunkSize;--a0}return aZ}return W().getArray(this._handle.ToArray(a4,a1))
}catch(a2){return g(this,a4,a1)}},close:function(){try{this._handle.Reset()}catch(aZ){aO("Binary.reset")}},reset:function(){this.close()}};aP.Binary=e;
function M(){return X("BinaryObjectService")}e.empty=function(){var aZ=B("BinaryObject");return new e(aZ)};e.createStream=function(){var a1="Binary.createStream";
try{var a0=M().CreateStream();return new f(a0)}catch(aZ){return aO(a1,aZ)}};e.fromBase64=function(aZ){var a2="Binary.fromBase64";t(aZ,a2,"base64String");
try{var a1=M().BinaryObjectFromBase64(aZ);return aT(a1)}catch(a0){return aO(a2,a0)}};e.fromHex=function(a1){var a2="Binary.fromHex";t(a1,a2,"hexString");
try{var a0=M().BinaryObjectFromHex(a1);return aT(a0)}catch(aZ){return aO(a2,aZ)}};e.encodeString=function(a3,aZ){if(aZ===aR){return e.encodeUnicodeString(a3)
}var a2="Binary.encodeString";t(a3,a2,"string");if(aZ===aQ){aZ=D}r(aZ,a2,"codePage");try{var a1=M().BinaryObjectFromString(a3,aZ);return aT(a1)}catch(a0){return aO(a2,a0)
}};e.encodeUnicodeString=function(a2){var a1="Binary.encodeUnicodeString";t(a2,a1,"string");try{var a0=M().BinaryObjectFromUnicodeString(a2);return aT(a0)
}catch(aZ){return aO(a1,aZ)}};e.readFile=function(a0){var a2="Binary.readFile";t(a0,a2,"fileName");try{var a1=M().BinaryObjectFromFile(a0);return aT(a1)
}catch(aZ){return aO(a2,aZ)}};function f(aZ){if(!aZ){throw"Required file handle"}this._handle=aZ}function ab(aZ){return aZ instanceof f}Z(f,aI,{getPosition:function(){try{return this._handle.Position
}catch(aZ){return aO("BinaryStream.getPosition",aZ)}},getSize:function(){try{return this._handle.Size}catch(aZ){return aO("BinaryStream.getSize",aZ)}},close:function(){try{this._handle.Close()
}catch(aZ){aO("BinaryStream.close",aZ)}},resize:function(a1){var a0="BinaryStream.resize";r(a1,a0,"size");try{this._handle.Resize(a1)}catch(aZ){aO(a0,aZ)
}},seek:function(a2,a0){var a1="BinaryStream.seek";r(a2,a1,"position");if(a0===aQ||a0===null){a0=0}else{r(a0,a1,"location")}try{return this._handle.Seek(a2,a0)
}catch(aZ){return aO(a1,aZ)}},read:function(aZ){var a1="BinaryStream.read";r(aZ,a1,"count");try{return aT(this._handle.Read(aZ))}catch(a0){return aO(a1,a0)
}},write:function(aZ,a3,a0){var a2="BinaryStream.write";m(aZ,a2);if(a3===aQ||a3===null){a3=0}else{r(a3,a2,"offset")}if(a0===aQ||a0===null){a0=aZ.getSize()
}else{r(a0,a2,"count")}try{this._handle.Write(aZ._handle,a3,a0)}catch(a1){aO(a2,a1)}},writeAsync:function(aZ,a4,a1,a0){var a3="BinaryStream.writeAsync";
m(aZ,a3);if(typeof(a4)==="function"){a0=a4;a4=0;a1=aZ.getSize()}else{r(a4,a3,"offset");r(a1,a3,"count");q(a0,a3,"callback")}try{this._handle.WriteAsync(aZ._handle,a4,a1,function(a6,a5){w(a3,a0,a5)
})}catch(a2){aO(a3,a2)}},readAsync:function(a0,aZ){var a2="BinaryStream.readAsync";r(a0,a2,"count");q(aZ,a2,"callback");try{this._handle.ReadAsync(a0,function(a4,a3){var a5=a3?aQ:aT(a4);
w(a2,aZ,a3,a5)})}catch(a1){aO(a2,a1)}},writeToAsync:function(a5,aZ,a4,a1,a0){var a3="BinaryStream.writeToAsync";r(a5,a3,"position");m(aZ,a3);if(typeof(a4)==="function"){a0=a4;
a4=0;a1=aZ.getSize()}else{r(a4,a3,"offset");r(a1,a3,"count");q(a0,a3,"callback")}try{this._handle.SeekAndWriteAsync(a5,aZ._handle,a4,a1,function(a7,a6){w(a3,a0,a6)
})}catch(a2){aO(a3,a2)}},readFromAsync:function(a3,a0,aZ){var a2="BinaryStream.readFromAsync";r(a3,a2,"position");r(a0,a2,"count");q(aZ,a2,"callback");
try{this._handle.SeekAndReadAsync(a3,a0,function(a5,a4){var a6=a4?aQ:aT(a5);w(a2,aZ,a4,a6)})}catch(a1){aO(a2,a1)}}});function aY(aZ,a0){if(!ad(aZ)){throw"Required zip archive handle"
}if(!ad(a0)){throw"Required zip archive stream"}this._handle=aZ;this._stream=a0}function aX(aZ,a0){return new aY(aZ,a0)}aY.prototype={constructor:aY,getEntries:function(){var aZ="";
try{aZ=this._handle.GetEntries()}catch(a0){aO("ZipArchive.getEntries",a0)}return ag.parse(aZ)},addEntry:function(a3,a1,aZ){var a2="ZipArchive.addEntry";
t(a3,a2,"name");s(a1,a2,"input");q(aZ,a2,"callback");try{this._handle.AddEntry(a3,a1._handle,function(a5,a4){w(a2,aZ,a4,null)},null)}catch(a0){aO(a2,a0)
}},getEntryStream:function(a0,a3,aZ){var a2="ZipArchive.getEntryStream";if(typeof(a0)!=="number"&&typeof(a0)!=="string"){aK(a2,"entry")}if(arguments.length>2){s(a3,a2,"output")
}else{aZ=a3;a3=J.createTemp()}q(aZ,a2,"callback");try{if(typeof(a0)==="number"){this._handle.GetEntryByIndex(a0,a3._handle,function(a5,a4){w(a2,aZ,a4,a3)
},null)}else{this._handle.GetEntryByName(a0,a3._handle,function(a5,a4){w(a2,aZ,a4,a3)},null)}}catch(a1){aO(a2,a1)}},extract:function(a0,a3,aZ){var a2="ZipArchive.extract";
if(arguments.length>2){if(typeof(a0)!=="number"&&typeof(a0)!=="string"){aK(a2,"entry")}}else{aZ=a3;a3=a0;a0=""}t(a3,a2,"path");q(aZ,a2,"callback");try{if(typeof(a0)==="number"){this._handle.ExtractByIndex(a0,a3,function(a5,a4){w(a2,aZ,a4,null)
},null)}else{this._handle.ExtractByName(a0,a3,function(a5,a4){w(a2,aZ,a4,null)},null)}}catch(a1){aO(a2,a1)}},close:function(){try{this._handle.Close();
this._stream.close();this._stream=null}catch(aZ){aO("ZipArchive.close",aZ)}},getStream:function(){try{this._handle.Close();this._stream.seek(0);var a0=this._stream;
this._stream=null;return a0}catch(aZ){return aO("ZipArchive.getStream",aZ)}}};function Q(){return X("CompressionService")}aP.GZip={pack:function(aZ){var a1="GZip.pack";
m(aZ,a1);try{return aT(Q().GZip(aZ._handle))}catch(a0){return aO(a1,a0)}},unpack:function(aZ){var a1="GZip.unpack";m(aZ,a1);try{return aT(Q().GUnzip(aZ._handle))
}catch(a0){return aO(a1,a0)}},create:function(a2){var a0="Zip.create";if(ad(a2)){s(a2,a0,"stream")}else{a2=J.createTemp()}try{var a1=Q();return aX(a1.OpenZipArchive(a2._handle),a2)
}catch(aZ){return aO(a0,aZ)}},open:function(a2){var a0="Zip.open";s(a2,a0,"stream");try{var a1=Q();return aX(a1.OpenZipArchive(a2._handle),a2)}catch(aZ){return aO(a0,aZ)
}},compress:function(a3,a2,aZ){var a1="Zip.compress";t(a3,a1,"path");if(arguments.length>2){s(a2,a1,"output")}else{aZ=a2;a2=J.createTemp()}q(aZ,a1,"callback");
try{Q().Compress(a3,a2._handle,function(a5,a4){w(a1,aZ,a4,a2)},null)}catch(a0){aO(a1,a0)}}};aP.Zip={pack:function(aZ){var a1="Zip.pack";m(aZ,a1);try{return aT(Q().PKZip(aZ._handle))
}catch(a0){return aO(a1,a0)}},unpack:function(aZ,a1){var a3="Zip.unpack";m(aZ,a3);if(a1!==aQ&&typeof(a1)!=="number"){aK(a3,"fileIndex")}try{var a2;var a4=Q();
if(a1!==aQ){a2=a4.PKUnzipN(aZ._handle,a1)}else{a2=a4.PKUnzip(aZ._handle)}return aT(a2)}catch(a0){return aO(a3,a0)}}};var ao=(function(){function a0(a2){return a2===" "||a2==="\r"||a2==="\t"||a2==="\n"
}function a1(a2){return a2?(a2.trim?a2.trim():a2.replace(/^\s+|\s+$/g,"")):a2}function aZ(a4,a3,a5){if(a3 in a4){var a2=a4[a3];if(!(a2 instanceof Array)){a4[a3]=a2=[a2]
}a2.push(a5)}else{a4[a3]=a5}}return function(a8){if(!a8||!a8.length){return{}}var ba=0,a5="",a7={},a9=0,a4=false,a3,a6=a8.length;for(a3=0;a3<a6;++a3){var a2=a8.charAt(a3);
switch(ba){case 0:if(!a0(a8.charAt(a3))){ba=1;a9=a3;if(a2==='"'){a4=true;a9++}}break;case 1:if(a2==="="){a5=a1(a8.substr(a9,a3-a9-(a4?1:0)));ba=2;a4=false
}break;case 2:if(!a0(a8.charAt(a3))){if(a2===","||a2===";"){ba=0;aZ(a7,a5,"");a5=""}else{ba=3;a9=a3;if(a2==='"'){a4=true;a9++}}}break;case 3:if(a2==='"'){if(!a4||a8.charAt(a3+1)!=='"'){var bb=a8.substr(a9,a3-a9);
if(a4){bb=bb.replace(/""/g,'"')}aZ(a7,a5,bb);a5="";a4=false}else{a3++}}else{if((a2===","||a2===";")&&!a4){ba=0;if(a5){aZ(a7,a5,a1(a8.substr(a9,a3-a9)));
a5=""}}}break;default:break}}if(a5){aZ(a7,a5,a1(a8.substr(a9,a3-a9)))}return a7}}());function k(a0){var aZ=null;this.toString=function(){return a0||""};
this.parse=function(){if(aZ===null){aZ=ao(a0)}return aZ};this.getValue=function(a1){if(aZ===null){aZ=ao(a0)}var a2=aZ[a1];if(a2 instanceof Array){return a2.join(";")
}return a2}}aP.CertificateDistinguishedName=k;function i(aZ){if(aZ===null||aZ===aQ){throw"Required certificate handle"}this._handle=aZ}function ac(aZ){return aZ instanceof i
}function aU(aZ){return new i(aZ)}function o(a1,aZ,a0){if(!ac(a1)){aK(aZ,a0||"certificate")}}function O(a0,aZ){if(a0===aQ){return""}var a1=typeof(a0);if(a1==="string"){return a0
}else{if(a1==="object"){return ag.stringify(a0)}else{return aK(aZ,"query")}}}function h(aZ,a2){try{var a3=O({hash:aZ.getHash().toHexString()},a2);var a0=R().GetCertificates(a3);
if(a0.Count>0){return aU(a0.Item(0))}}catch(a1){}return aZ}i.prototype={constructor:i,getName:function(a0){var a1="Certificate.getName";if(a0===aQ){a0=false
}else{if(typeof(a0)!=="boolean"){aK(a1,"forIssuer")}}try{return a0?this._handle.IssuerName:this._handle.CommonName}catch(aZ){return aO(a1,aZ)}},getIssuer:function(){try{return new k(this._handle.Issuer)
}catch(aZ){return aO("Certificate.getIssuer",aZ)}},getSubject:function(){try{return new k(this._handle.Subject)}catch(aZ){return aO("Certificate.getSubject",aZ)
}},getValidFrom:function(){try{return W().getDate(this._handle.ValidFrom)}catch(aZ){return aO("Certificate.getValidFrom",aZ)}},getValidTo:function(){try{return W().getDate(this._handle.ValidTo)
}catch(aZ){return aO("Certificate.getValidTo",aZ)}},getPublicKeyLength:function(){try{return this._handle.PublicKeyLength}catch(aZ){return aO("Certificate.getPublicKeyLength",aZ)
}},hasPrivateKey:function(){try{return this._handle.HasPrivateKey}catch(aZ){return aO("Certificate.hasPrivateKey",aZ)}},getExtensions:function(){var a0=null;
try{a0=this._handle.GetExtensions()}catch(aZ){aO("Certificate.getExtensions",aZ)}return ag.parse(a0)},getHash:function(){try{return aT(this._handle.Hash)
}catch(aZ){return aO("Certificate.getHash",aZ)}},getContent:function(){try{return aT(this._handle.Content)}catch(aZ){return aO("Certificate.getContent",aZ)
}},getSerialNumber:function(){try{return aT(this._handle.SerialNumber)}catch(aZ){return aO("Certificate.getSerialNumber",aZ)}},verify:function(a1){var a2="Certificate.verify";
if(a1!==aQ){r(a1,a2,"flags")}else{a1=1073741824}try{var aZ=R();return aZ.VerifyCertificate(this._handle,a1)}catch(a0){return aO(a2,a0)}},verifyAsync:function(a2,aZ){var a3="Certificate.verifyAsync";
if(arguments.length>1){r(a2,a3,"flags")}else{aZ=a2;a2=1073741824}q(aZ,a3,"callback");try{var a0=R();a0.VerifyCertificateAsync(this._handle,a2,function(a5,a4){w(a3,aZ,a4,a5)
})}catch(a1){aO(a3,a1)}},getArchived:function(){try{return this._handle.Archived}catch(aZ){return aO("Certificate.getArchived",aZ)}},setArchived:function(aZ){var a1="Certificate.setArchived";
try{if(aZ===aQ){aZ=true}else{if(typeof(aZ)!=="boolean"){aK(a1,"archived")}}this._handle.Archived=aZ}catch(a0){aO(a1,a0)}},getDescription:function(){try{return ag.parse(this._handle.Description)
}catch(aZ){return aO("Certificate.getDescription",aZ)}},getVersion:function(){try{return this._handle.Version}catch(aZ){return aO("Certificate.getVersion",aZ)
}},getRdnValue:function(a2,a0){var a1="Certificate.getRdnValue";if(a0===aQ){a0=false}else{if(typeof(a0)!=="boolean"){aK(a1,"forIssuer")}}t(a2,a1,"oid");
try{return this._handle.GetRdnValue(a2,a0)}catch(aZ){return aO(a1,aZ)}},getContainerInfo:function(){try{return ag.parse(this._handle.GetContainerInfo())
}catch(aZ){return aO("Certificate.getContainerInfo",aZ)}},getOnlineCertificateStatusProtocol:function(){try{return this._handle.GetOnlineCertificateStatusProtocol()
}catch(aZ){return aO("Certificate.getOnlineCertificateStatusProtocol",aZ)}},display:function(){try{this._handle.Display()}catch(aZ){aO("Certificate.display",aZ)
}},uninstall:function(){try{this._handle.Uninstall()}catch(aZ){aO("Certificate.uninstall",aZ)}}};aP.Certificate=i;var j=i.Collection={create:function(a2){var aZ=B("CertificateCollection");
if(a2===aQ||a2===null){return aZ}if(ac(a2)){aZ.Add(a2._handle)}else{if(a2 instanceof Array){for(var a0=0,a3=a2.length;a0<a3;a0++){var a1=a2[a0];if(!ac(a1)){return aQ
}aZ.Add(a1._handle)}}else{return aQ}}return aZ},toArray:function(a0){if(!a0){throw"invalid collection handle"}var a2=[];for(var a1=0,a3=a0.Count;a1<a3;
a1++){var aZ=a0.Item(a1);a2.push(new i(aZ))}return a2}};function N(aZ,a1){if(aZ===null||aZ===aQ){aK(a1,"certificates")}var a0=j.create(aZ);if(a0===aQ){aK(a1,"certificates")
}return a0}function C(aZ){this._getHandle=function(){return aZ||R()}}function aV(aZ){return new C(aZ)}C.prototype={constructor:C,getName:function(){try{return this._getHandle().Name
}catch(aZ){return aO("CryptoProvider.getName",aZ)}},getType:function(){try{return this._getHandle().Type}catch(aZ){return aO("CryptoProvider.getType",aZ)
}},encrypt:function(aZ,a0){var a4="CryptoProvider.encrypt";m(aZ,a4);var a1=N(a0,a4);try{var a3=this._getHandle().Encrypt(aZ._handle,a1);return aT(a3)}catch(a2){return aO(a4,a2)
}},encryptAsync:function(aZ,a1,a0){var a4="CryptoProvider.encryptAsync";m(aZ,a4);q(a0,a4,"callback");var a2=N(a1,a4);try{this._getHandle().EncryptAsync(aZ._handle,a2,function(a6,a5){var a7=a5?aQ:aT(a6);
w(a4,a0,a5,a7)})}catch(a3){aO(a4,a3)}},decrypt:function(aZ){var a2="CryptoProvider.decrypt";m(aZ,a2);try{var a1=this._getHandle().Decrypt(aZ._handle);return aT(a1)
}catch(a0){return aO(a2,a0)}},decryptAsync:function(aZ,a0){var a2="CryptoProvider.decryptAsync";m(aZ,a2);q(a0,a2,"callback");try{this._getHandle().DecryptAsync(aZ._handle,function(a4,a3){var a5=a3?aQ:aT(a4);
w(a2,a0,a3,a5)})}catch(a1){aO(a2,a1)}},rawSign:function(aZ,a0){var a3="CryptoProvider.rawSign";m(aZ,a3);o(a0,a3);try{a0=h(a0,a3);var a2=this._getHandle().RawSign(aZ._handle,a0._handle);
return aT(a2)}catch(a1){return aO(a3,a1)}},sign:function(a0,a1,aZ){var a4="CryptoProvider.sign";m(a0,a4);o(a1,a4);if(ad(aZ)){n(aZ,a4,"addCertChain")}else{aZ=false
}try{a1=h(a1,a4);var a3;if(aZ){a3=this._getHandle().Sign(a0._handle,a1._handle,aZ)}else{a3=this._getHandle().Sign(a0._handle,a1._handle)}return aT(a3)}catch(a2){return aO(a4,a2)
}},attachedSign:function(a0,a1,aZ){var a4="CryptoProvider.attachedSign";m(a0,a4);o(a1,a4);if(ad(aZ)){n(aZ,a4,"addCertChain")}else{aZ=false}try{a1=h(a1,a4);
var a3;if(aZ){a3=this._getHandle().AttachedSign(a0._handle,a1._handle,aZ)}else{a3=this._getHandle().AttachedSign(a0._handle,a1._handle)}return aT(a3)}catch(a2){return aO(a4,a2)
}},signAsync:function(a0,a2,aZ,a1){var a4="CryptoProvider.signAsync";m(a0,a4);o(a2,a4);if("function"==typeof(aZ)){a1=aZ;aZ=false}else{n(aZ,a4,"addCertChain");
q(a1,a4,"callback")}try{a2=h(a2,a4);var a5=function(a7,a6){var a8=a6?aQ:aT(a7);w(a4,a1,a6,a8)};if(aZ){this._getHandle().SignAsync(a0._handle,a2._handle,a5,aZ)
}else{this._getHandle().SignAsync(a0._handle,a2._handle,a5)}}catch(a3){aO(a4,a3)}},attachedSignAsync:function(a0,a2,aZ,a1){var a4="CryptoProvider.attachedSignAsync";
m(a0,a4);o(a2,a4);if(typeof(aZ)==="function"){a1=aZ;aZ=false}else{n(aZ,a4,"addCertChain");q(a1,a4,"callback")}try{a2=h(a2,a4);var a5=function(a7,a6){var a8=a6?aQ:aT(a7);
w(a4,a1,a6,a8)};if(aZ){this._getHandle().AttachedSignAsync(a0._handle,a2._handle,a5,aZ)}else{this._getHandle().AttachedSignAsync(a0._handle,a2._handle,a5)
}}catch(a3){aO(a4,a3)}},addSignerToSignature:function(a4,a0,aZ){var a3="CryptoProvider.addSignerToSignature";m(a4,a3);if(!aa(a0)){aZ=a0;a0=new e()}o(aZ,a3);
try{aZ=h(aZ,a3)._handle;var a2=this._getHandle().AddSignerToSignature(a4._handle,a0._handle,aZ);return aT(a2)}catch(a1){return aO(a3,a1)}},verifySignature:function(aZ,a5,a0){var a1=null,a4="CryptoProvider.verifySignature";
m(aZ,a4);m(a5,a4,"signature");if(a0){a1=N(a0,a4)}try{var a3=this._getHandle().VerifySignature(aZ._handle,a5._handle,a1);return j.toArray(a3)}catch(a2){return aO(a4,a2)
}},verifySignatureAsync:function(aZ,a5,a1,a0){var a2=null,a4="CryptoProvider.verifySignatureAsync";m(aZ,a4);m(a5,a4,"signature");if(typeof(a1)==="function"){a0=a1
}else{if(a1){a2=N(a1,a4)}q(a0,a4,"callback")}try{this._getHandle().VerifySignatureAsync(aZ._handle,a5._handle,a2,function(a8,a7){var a6=a7?aQ:j.toArray(a8);
w(a4,a0,a7,a6)})}catch(a3){aO(a4,a3)}},verifyAttachedSignature:function(a4,aZ){var a0=null,a3="CryptoProvider.verifyAttachedSignature";m(a4,a3,"signature");
if(aZ){a0=N(aZ,a3)}try{var a2=this._getHandle().VerifyAttachedSignature(a4._handle,a0);return j.toArray(a2)}catch(a1){return aO(a3,a1)}},verifyAttachedSignatureAsync:function(a4,a0,aZ){var a1=null,a3="CryptoProvider.verifyAttachedSignatureAsync";
m(a4,a3,"signature");if(typeof(a0)==="function"){aZ=a0}else{if(a0){a1=N(a0,a3)}q(aZ,a3,"callback")}try{this._getHandle().VerifyAttachedSignatureAsync(a4._handle,a1,function(a7,a6){var a5=a6?aQ:j.toArray(a7);
w(a3,aZ,a6,a5)})}catch(a2){aO(a3,a2)}},installCertificateResponse:function(a3,aZ,a4){var a2="CryptoProvider.installCertificateResponse";t(a3,a2,"response");
if(arguments.length>2){t(aZ,a2,"containerPath")}else{a4=aZ}t(a4,a2,"storeName");try{var a1;if(arguments.length>2){a1=this._getHandle().InstallCertificateResponseEx(a3,aZ,a4)
}else{a1=this._getHandle().InstallCertificateResponse(a3,a4)}return aU(a1)}catch(a0){return aO(a2,a0)}},createCertificationRequest:function(aZ,a5,a0,a3,a2,a7){var a6="CryptoProvider.createCertificationRequest";
t(aZ,a6,"containerName");r(a5,a6,"keySpec");m(a0,a6,"distinguishedName");m(a3,a6,"extensions");if(aQ!==a2){if("boolean"!=typeof(a2)){aK(a6,"exportable")
}}else{a2=true}if(aQ!==a7){if("boolean"!=typeof(a7)){aK(a6,"silent")}}else{a7=false}try{var a4=this._getHandle().CreateCertificationRequest(aZ,a5,a0._handle,a3._handle,a2,a7);
return aT(a4)}catch(a1){return aO(a6,a1)}},createCertificationRequestEx:function(aZ,a5,a0,a4,a1,a3,a8){var a6="CryptoProvider.createCertificationRequestEx";
t(aZ,a6,"containerName");r(a5,a6,"keySpec");m(a0,a6,"distinguishedName");m(a4,a6,"extensions");if(!aa(a1)){a8=a3;a3=a1;a1=null}if(aQ!==a3){if("boolean"!=typeof(a3)){aK(a6,"exportable")
}}else{a3=true}if(aQ!==a8){if("boolean"!=typeof(a8)){aK(a6,"silent")}}else{a8=false}try{var a7;if(a1===null){a7=this._getHandle().CreateCertificationRequestEx(aZ,a5,a0._handle,a4._handle,a3,a8)
}else{a7=this._getHandle().CreateCertificationRequestExV2(aZ,a5,a0._handle,a4._handle,a1._handle,a3,a8)}return ag.parse(a7)}catch(a2){return aO(a6,a2)}},createCertificationRequestGOST:function(a6,a4,aZ,a2,a0){var a3="CryptoProvider.createCertificationRequestGOST";
t(a6,a3,"slot");t(a4,a3,"pin");m(aZ,a3,"distinguishedName");m(a2,a3,"extensions");if(a0){m(a0,a3,"enrollmentParameters")}try{var a5;if(a0){a5=this._getHandle().CreateCertificationRequestGOSTV2(a6,a4,aZ._handle,a2._handle,a0._handle)
}else{a5=this._getHandle().CreateCertificationRequestGOST(a6,a4,aZ._handle,a2._handle)}return ag.parse(a5)}catch(a1){return aO(a3,a1)}},installCertificateResponseGOST:function(a3,aZ,a2){var a1="CryptoProvider.installCertificateResponseGOST";
t(a3,a1,"response");t(aZ,a1,"containerPath");t(a2,a1,"pin");try{this._getHandle().InstallCertificateResponseGOST(a3,aZ,a2)}catch(a0){aO(a1,a0)}},copyKeyContainer:function(aZ,a0){var a2="CryptoProvider.copyKeyContainer";
o(aZ,a2,"certificate");t(a0,a2,"destination");try{aZ=h(aZ,a2);this._getHandle().CopyKeyContainer(aZ._handle,a0)}catch(a1){aO(a2,a1)}},getTokenCerts:function(a1){var a0="CryptoProvider.getTokenCerts";
t(a1,a0,"tokenId");try{return ag.parse(this._getHandle().GetTokenContainers(a1))}catch(aZ){return aO(a0,aZ)}}};function R(){return X("CryptoService")}aP.Crypto=new C();
I(aP.Crypto,{getName:aQ,getType:aQ,getCertificates:function(a2){var a1="Crypto.getCertificates";a2=O(a2,a1);try{var a0=R().GetCertificates(a2);return j.toArray(a0)
}catch(aZ){return aO(a1,aZ)}},getPersonalCertificates:function(){return aP.Crypto.getCertificates({storeName:"My",hasPrivateKey:true})},getCertificatesAsync:function(a2,aZ){var a1="Crypto.getCertificatesAsync";
q(aZ,a1,"callback");a2=O(a2,a1);try{R().GetCertificatesAsync(a2,function(a5,a4){var a3=a4?aQ:j.toArray(a5);w(a1,aZ,a4,a3)})}catch(a0){aO(a1,a0)}},findCertificate:function(a1){var a0="Crypto.findCertificate";
a1=O(a1,a0);try{return aU(R().FindCertificate(a1))}catch(aZ){return aO(a0,aZ)}},findCertificateAsync:function(a2,aZ){var a1="Crypto.findCertificateAsync";
q(aZ,a1,"callback");a2=O(a2,a1);try{R().FindCertificateAsync(a2,function(a5,a4){var a3=a4?aQ:aU(a5);w(a1,aZ,a4,a3)})}catch(a0){aO(a1,a0)}},extractCertificatesFromSignature:function(a2){var a1="Crypto.extractCertificatesFromSignature";
m(a2,a1,"signature");try{var a0=R().ExtractCertificatesFromSignature(a2._handle);return j.toArray(a0)}catch(aZ){return aO(a1,aZ)}},extractContentFromSignature:function(a2){var a1="Crypto.extractContentFromSignature";
m(a2,a1,"signature");try{var a0=R().ExtractContentFromSignature(a2._handle);return aT(a0)}catch(aZ){return aO(a1,aZ)}},getCertificatesFromSignature:function(a2){var a1="Crypto.getCertificatesFromSignature";
m(a2,a1,"signature");try{var a0=R().GetCertificatesFromSignature(a2._handle);return j.toArray(a0)}catch(aZ){return aO(a1,aZ)}},getContentFromSignature:function(a2){var a1="Crypto.getContentFromSignature";
m(a2,a1,"signature");try{var a0=R().GetContentFromSignature(a2._handle);return aT(a0)}catch(aZ){return aO(a1,aZ)}},createCertificateFromContent:function(a1,aZ){var a3="Crypto.createCertificateFromContent";
m(a1,a3,"content");try{var a0=aU(R().CreateCertificateFromContent(a1._handle));if(!!aZ){var a4=O({hash:a0.getHash().toHexString()},a3);return aU(R().FindCertificate(a4))
}return a0}catch(a2){return aO(a3,a2)}},generateCertificateRenewalRequest:function(a1,aZ){var a2="Crypto.generateCertificateRenewalRequest";if(typeof(a1)!=="boolean"){aK(a2,"isPkcs7")
}o(aZ,a2);try{return R().GenerateCertificateRenewalRequest(a1,aZ._handle)}catch(a0){return aO(a2,a0)}},getTokenDriverVersion:function(a0){try{return R().GetTokenDriverVersion(a0)
}catch(aZ){return aO("Crypto.getTokenDriverVersion",aZ)}},getProvidersInfos:function(){var a0="Crypto.getProvidersInfos";try{var a1=R().GetCryptoProvidersInfo();
return a1?ag.parse(a1):aL(a0,"method returns null")}catch(aZ){return aO(a0,aZ)}},getTokensInfos:function(){try{return ag.parse(R().GetTokensInfo())}catch(aZ){return aO("Crypto.getTokensInfos",aZ)
}},getTokensInfosAsync:function(aZ){var a1="Crypto.getTokensInfosAsync";q(aZ,a1,"callback");try{R().GetTokensInfoAsync(function(a3,a2){w(a1,aZ,a2,(a2?aQ:ag.parse(a3)))
})}catch(a0){aO(a1,a0)}},getCryptoProLicense:function(a0){var a1="Crypto.getCryptoProLicense";if(a0!==aQ){t(a0,a1,"guid")}else{a0=""}try{return R().GetCryptoProLicense(a0)
}catch(aZ){return aO(a1,aZ)}},getDefaultCryptoProvider:function(){try{var a0="Default.Crypto.Provider";var a1=am[a0];if(a1===aQ){a1=R().GetDefaultCryptoProvider();
am[a0]=a1}return aV(a1)}catch(aZ){return aO("Crypto.getDefaultCryptoProvider",aZ)}},getCryptoProvider:function(a2,a4){var a1="Crypto.getCryptoProvider";
t(a2,a1,"name");r(a4,a1,"type");try{var a0=a4.toString();var a3=am[a0];if(a3===aQ){a3=R().GetCryptoProvider(a2,a4);am[a0]=a3}return aV(a3)}catch(aZ){return aO(a1,aZ)
}}});function J(aZ){if(aZ===null||aZ===aQ){throw"Required file handle"}this._handle=aZ}function aW(aZ){return new J(aZ)}function ae(aZ){return aZ instanceof J
}Z(J,aI,{getPath:function(){try{return this._handle.Path}catch(aZ){return aO("File.getPath",aZ)}},getPosition:function(){try{return this._handle.Position
}catch(aZ){return aO("File.getPosition",aZ)}},getSize:function(){try{return this._handle.Size}catch(aZ){return aO("File.getSize",aZ)}},read:function(aZ){var a1="File.read";
r(aZ,a1,"count");try{return aT(this._handle.Read(aZ))}catch(a0){return aO(a1,a0)}},write:function(aZ,a3,a0){var a2="File.write";m(aZ,a2);if(a3===aQ||a3===null){a3=0
}else{r(a3,a2,"offset")}if(a0===aQ||a0===null){a0=aZ.getSize()}else{r(a0,a2,"count")}try{this._handle.Write(aZ._handle,a3,a0)}catch(a1){aO(a2,a1)}},writeAsync:function(aZ,a4,a1,a0){var a3="File.writeAsync";
m(aZ,a3);if(typeof(a4)==="function"){a0=a4;a4=0;a1=aZ.getSize()}else{r(a4,a3,"offset");r(a1,a3,"count");q(a0,a3,"callback")}try{this._handle.WriteAsync(aZ._handle,a4,a1,function(a6,a5){w(a3,a0,a5)
})}catch(a2){aO(a3,a2)}},readAsync:function(a0,aZ){var a2="File.readAsync";r(a0,a2,"count");q(aZ,a2,"callback");try{this._handle.ReadAsync(a0,function(a4,a3){var a5=a3?aQ:aT(a4);
w(a2,aZ,a3,a5)})}catch(a1){aO(a2,a1)}},writeToAsync:function(a5,aZ,a4,a1,a0){var a3="File.writeToAsync";r(a5,a3,"position");m(aZ,a3);if(typeof(a4)==="function"){a0=a4;
a4=0;a1=aZ.getSize()}else{r(a4,a3,"offset");r(a1,a3,"count");q(a0,a3,"callback")}try{this._handle.SeekAndWriteAsync(a5,aZ._handle,a4,a1,function(a7,a6){w(a3,a0,a6)
})}catch(a2){aO(a3,a2)}},readFromAsync:function(a3,a0,aZ){var a2="File.readFromAsync";r(a3,a2,"position");r(a0,a2,"count");q(aZ,a2,"callback");try{this._handle.SeekAndReadAsync(a3,a0,function(a5,a4){var a6=a4?aQ:aT(a5);
w(a2,aZ,a4,a6)})}catch(a1){aO(a2,a1)}},close:function(){try{this._handle.Close()}catch(aZ){aO("File.close",aZ)}},resize:function(a1){var a0="File.resize";
r(a1,a0,"size");try{this._handle.Resize(a1)}catch(aZ){aO(a0,aZ)}},flush:function(){try{this._handle.Flush()}catch(aZ){aO("File.flush",aZ)}},seek:function(a2,a0){var a1="File.seek";
r(a2,a1,"position");if(ad(a0)){r(a0,a1,"location")}else{a0=0}try{return this._handle.Seek(a2,a0)}catch(aZ){return aO(a1,aZ)}}});aP.File=J;function S(){return X("FileSystemService")
}var a={Read:1179785,Write:1179926,ReadWrite:1180063};var aj={CreateNew:1,Create:2,Open:3,OpenOrCreate:4,Truncate:5};var aH={None:0,Read:1,Write:2,ReadWrite:3,Delete:4};
J.flags={access:a,mode:aj,share:aH};J.getTempPath=function(){try{return S().GetTempFolder()}catch(aZ){return aO("File.getTempPath",aZ)}};var E={access:a.ReadWrite,mode:aj.Open,share:aH.ReadWrite};
J.open=function(a5,a1){var a3="File.open";t(a5,a3,"path");a1=a1||E;var aZ=a1.access,a4=a1.mode,a6=a1.share;if(ad(aZ)){r(aZ,a3,"access")}else{aZ=E.access
}if(ad(a4)){r(a4,a3,"mode")}else{a4=E.mode}if(ad(a6)){r(a6,a3,"share")}else{a6=E.share}try{var a2=S().OpenFile(a5,aZ,a4,a6);return aW(a2)}catch(a0){return aO(a3,a0)
}};J.openRead=function(a0){try{return J.open(a0,{access:a.Read,mode:aj.Open,share:aH.ReadWrite})}catch(aZ){return aO("File.openRead",aZ)}};J.openWrite=function(a0){try{return J.open(a0,{access:a.Write,mode:aj.Open,share:aH.ReadWrite})
}catch(aZ){return aO("File.openWrite",aZ)}};J.create=function(a1,a0){try{return J.open(a1,{access:a.ReadWrite,mode:!a0?aj.CreateNew:aj.Create,share:aH.ReadWrite})
}catch(aZ){return aO("File.create",aZ)}};J.createTemp=function(){try{return aW(S().CreateTempFile())}catch(aZ){return aO("File.createTempFile",aZ)}};J.getSize=function(a1){var a0="File.getSize";
t(a1,a0,"path");try{return S().GetFileLength(a1)}catch(aZ){return aO(a0,aZ)}};J.getCreateDate=function(a2){var a1="File.getCreateDate";t(a2,a1,"path");
try{var aZ=S().GetCreateDate(a2);return W().getDate(aZ)}catch(a0){return aO(a1,a0)}};J.getLastAccess=function(a2){var a1="File.getLastAccess";t(a2,a1,"path");
try{var aZ=S().GetLastAccess(a2);return W().getDate(aZ)}catch(a0){return aO(a1,a0)}};J.getLastModified=function(a2){var a1="File.getLastModified";t(a2,a1,"path");
try{var aZ=S().GetLastModified(a2);return W().getDate(aZ)}catch(a0){return aO(a1,a0)}};J.exists=function(a1){var a0="File.exists";t(a1,a0,"path");try{return S().IsFileExists(a1)
}catch(aZ){return aO(a0,aZ)}};J.remove=function(a1){var a0="File.remove";t(a1,a0,"path");try{S().FileDelete(a1)}catch(aZ){aO(a0,aZ)}};J.moveAsync=function(a3,a2,aZ,a4){var a1="File.moveAsync";
t(a3,a1,"oldPath");t(a2,a1,"newPath");q(aZ,a1,"callback");try{S().FileMoveAsync(a3,a2,function(a6,a5){w(a1,aZ,a5)},ad(a4)?a4._handle:null)}catch(a0){aO(a1,a0)
}};J.copyAsync=function(a3,a2,aZ,a4){var a1="File.copyAsync";t(a3,a1,"oldPath");t(a2,a1,"newPath");q(aZ,a1,"callback");try{S().FileCopyAsync(a3,a2,function(a6,a5){w(a1,aZ,a5)
},ad(a4)?a4._handle:null)}catch(a0){aO(a1,a0)}};J.createDir=function(a1){var a0="File.createDir";t(a1,a0,"path");try{S().CreateDir(a1)}catch(aZ){aO(a0,aZ)
}};function U(){return X("GuiService")}function T(a0,aZ){if(a0===aQ){return""}var a1=typeof(a0);if(a1==="string"){return a0}else{if(a1==="object"){return ag.stringify(a0)
}}return aK(aZ,"options")}aP.Gui={showOpenDialog:function(a1){var a0="Gui.showOpenDialog";a1=T(a1,a0);try{var a2=U().ShowOpenDialog(a1);return a2&&a2.length?a2:aQ
}catch(aZ){return aO(a0,aZ)}},showSaveDialog:function(a0,a2){var a1="Gui.showSaveDialog";if(a0===aQ){a0=""}else{t(a0,a1,"fileName")}a2=T(a2,a1);try{var a3=U().ShowSaveDialog(a0,a2);
return a3&&a3.length?a3:aQ}catch(aZ){return aO(a1,aZ)}},selectFolderDialog:function(a1){var a0="Gui.selectFolderDialog";a1=T(a1,a0);try{var a2=U().SelectFolderDialog(a1);
return a2&&a2.length?a2:aQ}catch(aZ){return aO(a0,aZ)}},showMultipleOpenDialog:function(a7){var a6="Gui.showMultipleOpenDialog";a7=T(a7,a6);var a8,a1=[];
try{a8=U().ShowMultipleOpenDialog(a7)}catch(a0){return aO(a6,a0)}if(a8&&a8.length){var a4=a8.split("|"),a2=a4[0];if(a4.length>1){var aZ=a2;for(var a3=1,a5=a4.length;
a3<a5;a3++){a1.push(aZ+"\\"+a4[a3])}}else{a1.push(a2)}}return a1}};function l(){this._handle=B("CertificateStore");if(arguments.length){this.open.apply(this,arguments)
}}function P(aZ,a0){t(aZ,a0,"location");aZ=aZ.toLowerCase();if(aZ==="machine"){return 1}else{if(aZ==="user"){return 2}}return aK(a0,"location")}l.prototype={constructor:l,getName:function(){try{return this._handle.Name
}catch(aZ){return aO("CertificateStore.getName",aZ)}},getLocation:function(){try{var aZ=this._handle.Location;return 1==aZ?"machine":(2==aZ?"user":aQ)}catch(a0){return aO("CertificateStore.getLocation",a0)
}},open:function(a0,a3,a4){var a2="CertificateStore.open",a1=P(a0,a2);t(a3,a2,"name");if(a4===aQ){a4=true}else{if(typeof(a4)!=="boolean"){aK(a2,"readOnly")
}}try{this._handle.Open(a1,a3,a4?2:1)}catch(aZ){aO(a2,aZ)}},close:function(){try{this._handle.Close()}catch(aZ){aO("CertificateStore.close",aZ)}},getItems:function(a2){var a1="CertificateStore.getItems";
a2=O(a2,a1);try{var a0=this._handle.GetCertificates(a2);return j.toArray(a0)}catch(aZ){return aO(a1,aZ)}},selectItem:function(){try{var a0=this._handle.SelectCertificate();
return a0?aU(a0):aQ}catch(aZ){return aO("CertificateStore.selectItem",aZ)}},install:function(aZ){var a2="CertificateStore.install";o(aZ,a2);try{var a1=this._handle.Install(aZ._handle);
return a1?aU(a1):aQ}catch(a0){return aO(a2,a0)}}};aP.CertificateStore=l;aP.Pipeline=function(a9,a6){s(a9,"Pipeline");var a7=[],aZ={},a8=-1,bb=null,bc=null,a3=false,a0,ba=this;
a6=I({close:true},a6);function a5(bf){var bg=aZ.progress;if(bg){try{bg(ba.getCurrentStage(),bc.progress())}catch(be){}}var bd=aZ.changeStage;if(bf&&bd){bd(ba.getCurrentStage())
}}function a1(bd,bf){a5();a8=-1;if(bb){Y.clearInterval(bb);bb=null}try{if(bd){if(aZ.error){aZ.error(bd)}}else{if(aZ.success){aZ.success(bf)}}if(aZ.complete){aZ.complete(bd,bf)
}}catch(be){aF(be)}}function a2(bf,bd){var be=null;if(bd&&bd.input){be=bd.input()}else{if(!bf.isFinal){if(bf.output){be=bf.output()}else{if(!a6.inMemory){be=J.createTemp()
}else{be=e.createStream()}}}}return be}function a4(bf){a8++;a5(true);if(a8===a7.length){a1(null,bf);return}var bh=a7[a8],bg=null;if(bh.output&&bh.input&&bh.output===bh.input&&a8>0){a4(bf);
return}var bd=function(bi,bk){if(a0){v(bf)}a0=true;if(bi){v(bg);a1(bi,null)}else{try{if(af(bg)){bg.seek(0)}}catch(bj){a1(bj,null);return}a4(bk||bg)}};try{bg=a2(bh,a7[a8+1]);
bh.process(bf,bg,bd,bc,a6)}catch(be){if(a0){v(bf)}v(bg);a1(be,null)}}this.run=function(bd){var be="Pipeline.run";p(bd,be,"callbacks");if(typeof(bd)==="object"){aZ=bd
}else{q(bd,be,"callbacks");aZ={complete:bd}}a8=-1;bc=new an();a0=!!a6.close;if(aZ.progress){bb=Y.setInterval(a5,a6.interval||1000)}a4(a9);return this};
this.isRunning=function(){return a8!==-1};this.cancel=function(){if(a8!==-1){bc.setCanceled()}return this};this.getCurrentStage=function(){if(a8===-1||a8===a7.length){return"none"
}return a7[a8].name};this.addStage=function(be){var bd="Pipeline.addStage";if(a8!==-1){aL(bd,"Pipeline is running.")}if(a3){aL(bd,"Pipeline is finalized")
}if(!be.process){aL(bd,"Invalid pipeline stage")}a7.push(be);a3=be.isFinal||false;return this}};function A(aZ){return function(a2,a3,a0){try{a2.copyToAsync(a3,function(a4,a5){if(!a4){a3.seek(0)
}a0(a4,a5)})}catch(a1){aO(aZ,a1)}}}function az(aZ){var a0="pipeline.toFile";t(aZ,a0,"fileName");this.input=this.output=function(){return J.create(aZ,true)
};this.process=A(a0)}function ay(){var aZ="pipeline.toBinaryStream";this.input=this.output=function(){return e.createStream()};this.process=A(aZ)}function aq(){var aZ="Pipeline.crc32";
this.isFinal=true;this.process=function(a2,a3,a0,a4){try{M().GetCrc32StreamAsync(a2._handle,function(a5,a6){w(aZ,a0,a6,a5>>>0)},a4._handle)}catch(a1){aO(aZ,a1)
}}}function av(){var aZ="Pipeline.md5";this.isFinal=true;this.process=function(a2,a3,a0,a4){try{M().GetMd5StreamAsync(a2._handle,function(a6,a5){var a7=a5?aQ:aT(a6);
w(aZ,a0,a5,a7)},a4._handle)}catch(a1){aO(aZ,a1)}}}function aw(){var aZ="Pipeline.sha256";this.isFinal=true;this.process=function(a2,a3,a0,a4){try{M().GetSHA256StreamAsync(a2._handle,function(a6,a5){var a7=a5?aQ:aT(a6);
w(aZ,a0,a5,a7)},a4._handle)}catch(a1){aO(aZ,a1)}}}function au(){var aZ="Pipeline.gzip";this.process=function(a2,a3,a0,a4){try{Q().GZipStreamAsync(a2._handle,a3._handle,function(a6,a5){w(aZ,a0,a5)
},a4._handle)}catch(a1){aO(aZ,a1)}}}function aA(){var aZ="Pipeline.ungzip";this.process=function(a2,a3,a0,a4){try{Q().GUnzipStreamAsync(a2._handle,a3._handle,function(a6,a5){w(aZ,a0,a5)
},a4._handle)}catch(a1){aO(aZ,a1)}}}function aE(){var aZ="Pipeline.zip";this.process=function(a2,a3,a0,a4){try{Q().PKZipStreamAsync(a2._handle,a3._handle,function(a6,a5){w(aZ,a0,a5)
},a4._handle)}catch(a1){aO(aZ,a1)}}}function aB(){var aZ="Pipeline.unzip";this.process=function(a3,a4,a0,a5){var a2=0;try{Q().PKUnzipNStreamAsync(a3._handle,a4._handle,function(a7,a6){w(aZ,a0,a6)
},a2,a5._handle)}catch(a1){aO(aZ,a1)}}}function V(aZ){return(aZ.cryptoProvider||aP.Crypto)._getHandle()}function at(aZ){var a0="Pipeline.encrypt";if(aZ===null||aZ===aQ){aK(a0,"certificates")
}this.process=function(a5,a7,a1,a8,a6){var a2=N(aZ,a0),a3=V(a6);try{a3.EncryptStreamAsync(a5._handle,a7._handle,a2,function(ba,a9){w(a0,a1,a9)},a8._handle)
}catch(a4){aO(a0,a4)}}}function ar(){var aZ="Pipeline.decrypt";this.process=function(a3,a5,a0,a6,a4){var a1=V(a4);try{a1.DecryptStreamAsync(a3._handle,a5._handle,function(a8,a7){w(aZ,a0,a7)
},a6._handle)}catch(a2){aO(aZ,a2)}}}function ax(a0,aZ){var a1="Pipeline.sign";o(a0,a1);if(ad(aZ)){n(aZ,a1,"addCertChain")}else{aZ=false}this.process=function(a6,a8,a2,a9,a7){var a4=V(a7),a3=h(a0,a1)._handle;
try{var ba=function(bc,bb){w(a1,a2,bb)};if(aZ){a4.SignStreamAsync(a6._handle,a8._handle,a3,false,ba,a9._handle,aZ)}else{a4.SignStreamAsync(a6._handle,a8._handle,a3,false,ba,a9._handle)
}}catch(a5){aO(a1,a5)}}}function ap(a0,aZ){var a1="Pipeline.attachedSign";o(a0,a1);if(ad(aZ)){n(aZ,a1,"addCertChain")}else{aZ=false}this.process=function(a6,a8,a2,a9,a7){var a4=V(a7),a3=h(a0,a1)._handle;
try{var ba=function(bc,bb){w(a1,a2,bb)};if(aZ){a4.SignStreamAsync(a6._handle,a8._handle,a3,true,ba,a9._handle,aZ)}else{a4.SignStreamAsync(a6._handle,a8._handle,a3,true,ba,a9._handle)
}}catch(a5){aO(a1,a5)}}}function aD(a1,aZ){var a0="Pipeline.verify";m(a1,a0,"signature");this.isFinal=true;this.process=function(a6,a8,a2,a9,a7){var a4=V(a7),a3=null;
if(aZ){a3=N(aZ,a0)}try{a4.VerifyStreamSignatureAsync(a1._handle,a6._handle,a3,function(bc,bb){var ba=bb?aQ:j.toArray(bc);w(a0,a2,bb,ba)},a9._handle)}catch(a5){aO(a0,a5)
}}}function aC(aZ){var a0="Pipeline.verifyAttached";this.isFinal=true;this.process=function(a5,a7,a1,a8,a6){var a3=V(a6),a2=null;if(aZ){a2=N(aZ,a0)}try{a3.VerifyStreamAttachedSignatureAsync(a5._handle,a2,function(bb,ba){var a9=ba?aQ:j.toArray(bb);
w(a0,a1,ba,a9)},a8._handle)}catch(a4){aO(a0,a4)}}}(function(){var a2={toFile:az,toBinaryStream:ay,crc32:aq,md5:av,sha256:aw,gzip:au,ungzip:aA,zip:aE,unzip:aB,encrypt:at,decrypt:ar,sign:ax,attachedSign:ap,verifySignature:aD,verifyAttachedSignature:aC};
var a0=Array.prototype.slice;for(var aZ in a2){var a1=a2[aZ];a1.prototype.name=aZ;aP.Pipeline.prototype[aZ]=(function(a3){return function(){var a4=y(a3,a0.call(arguments));
return this.addStage(a4)}}(a1))}}());aP.isBinary=aa;aP.isCertificate=ac;aP.isBinaryStream=ab;aP.isFile=ae;aP.isStream=af}(this));window.SkbKontur.Help.Scripts.Windows=function(B,l,a8,bN){var Y=window.SkbKontur.Help,s=Y.Core,C=Y.Diagnosis,I=Y.Err,N=Y.Fix,P=Y.foreach,bc=Y.Promise,al=Y.isDate,ar=Y.isUTCDate,bA=Y.strToDate,bE=Y.Test,bI=Y.trim,Z=s.HKCU,aa=s.HKLM,aV=s.log,i=s.browser,ak=i.ax,j=s.buildPath,n=s.$checkFolderPermission,o=s.checkInstalledUpdate,q=s.$compareEnvValues,r=s.compareVersion,v=s.createNPAXObject,K=s.$expandEnvStrings,M=s.File,O=s.Folder,Q=s.getDisplays,R=s.getFreeSpace,S=s.getProcesses,T=s.getService,U=s.$getUserSID,W=s.hasProcessFeature,aj=s.isAccessDeniedError,am=s.isFileNotFoundError,aI=s.kdBuild,aK=s.kdWMISelect,be=s.$readAll,bf=s.regCurVer,bg=s.regCurVerNT,bi=s.$regReadNumber,bj=s.$regReadString,bn=s.$regWriteString,bm=s.$regWriteExpandString,bs=s.$setEnvironment,bx=s.startService,bG=s.trackEvent,bV=s.vars,A=bV.diadocLocale,D=bV.diagnostics,E=bV.distrPath,H=bV.egaisLocale,J=bV.evrikaLocale,aX=bV.microsoftLinkRoot,bb=bV.productVersions,bq=bV.rutokenLocale,br=bV.sberLocale,bH=C.translateFix,c="Actions/",b=bH(c+"install"),d=bH(c+"reinstall"),e=bH(c+"update"),bJ=true,L=false,a2=null,a1="notfound",ad=["%","IEPATH","%"].join(""),aU,b0;
a8=a8?a8.Windows:a2;var ap=s.isSystem(),aq=L,bo=bV.rights,bp=bV.rightsResult,bX=bV.winName,bY=bV.winVer,bu=bV.winSpStatus,bd=bV.ram,bZ=bV.winVerResult,aA=(501==bY),aB=(bY>=501),av=(503==bY),at=(bY>=600),aw=(bY>=601),ax=(bY>=700),az=(bY>=800),ay=(bY>=810),au=(bY>=1010),bt=bV.winSP,h=bV.arch,aC=(h==64),aO=bV.lastboottime,bM=bV.uac,t=bV.country,p=bV.codepage,aT=bV.locale,aN=bV.language,ae=bV.indomain;
var g={value:"err",status:2},aS={value:"err",status:2},ab="err",ac=-1,bD="err",bC=2,bB="",a0,k={value:"err",status:2},ba="err",bh=bf+"Explorer\\",bk=bh+"Shell Folders\\",bl=bh+"User Shell Folders\\",a=L;
function V(){if(ap||aq){return j(["%SYSTEM","ROOT%"].join(""),"TEMP")}var b7=j(at?"AppData\\Local":"Local Settings","Temp");return j(["%USER","PROFILE%"].join(""),b7)
}var X=0,b1="err",b2,u=a2,z=L,bv=bJ,bw=bJ,aY="err",bW="not",G="not",a7=!bV.copyCertLocale&&!bV.checkLocale,aW="",y,a3="err",af,ah="not",ag=L,ai=2,ao=(1049==aN),b3,b4=0,b5,b6=0,aL="",aM=0,aZ=aA&&a8&&a8.Kb2802968,by,bz=0,a4,a5=0,aD,aE=0,a9=!a8||a8.UpdateSearch,bS=a2,bQ=a2,bO=a2,bT,bR,bP,aR,aQ,aP,w,x=a2,bK,bL=a2,a6=!a8||a8.DateZone,bF,bU,aF,aJ,aG,aH="none",f=bV.fileVersions&&bV.fileVersions[bq?"aktivdiag2_admin.exe":"konturdiag2_admin.exe"]||s.kdActualVersion,F=bV.dpArray||"none";
function an(b7){return bc.fork(b7==="\\\\",bJ,function(){return v(["Scripting","FileSystemObject"],bJ).truth(function(b8){return b8.callAsync("GetDrive",[b7]).then(function(b9){return b9.getAsync("DriveType")
}).then(function(b9){return 3===b9}).lastly(b8.free)},bc.thrown("fso is null"))})}function m(b8,cd,b7,b9){var cb=("Local AppData"===cd),ca=("Cache"===cd),cc={value:b8,status:b9?2:1};
if(!b8||!b8.length||("err"===b8)||(b7&&b7===b8)){if(cb){cc.status=2}return bc.resolve(cc)}if(ap||aq){cc.status=-1;return bc.resolve(cc)}return bc.all(bj(Z,bk,cd,L).caught(a2),bj(Z,bl,cd,L).caught(a2)).spread(function(ce,cf){return bc.all(q(cf,b8),q(ce,b8)).spread(function(ch,cg){if(!ch){if(cb){cc.status=2
}cc.comment=cf?"usershelldiff":"usershell";return cc}if(!cg){cc.comment=ce?(ca?"shellcache":"shelldiff"):"shell";return cc}return an(b8.substr(0,2)).caught(a2).fork(function(ci){return ci
},function(){cc.status=2;cc.comment="drivetype"},function(){var ci=L;if(bD){var cj=bD.lastIndexOf("\\")+1;ci=bD.substr(cj).toLowerCase()==="low"}return n(b8,ci).then(function(){cc.status=0
}).caught(function(ck){cc.status=2;if(aj(ck)){cc.comment="denied"}else{aV.debug("Error in CheckEnv",ck);cc.comment=a1}})}).anyway(cc)})})}return bc.when(function(){return s.getTools(["installer","kd","locator","wmi"]).spread(function(b7,b8,b9,ca){aU=b9;
aF=b8;af=b7;b0=ca})}).then(function(){return U().then(function(b7){bU=b7||"err"})}).then(function(){if(!bU||("err"===bU)){return a2}return bi(aa,bg+"ProfileList\\"+bU+"\\","State",aC).then(function(b7){if(!ap&&(b7&256)&&s.isUser()){aV.error("Учетная запись имеет флаг администратора, хотя таковым не является")
}if(b7&128){aV.debug("Учетная запись гостя");aq=bJ}if(b7&2048){aV.debug("Временная учетная запись пользователя");aq=bJ}if(b7&32768){aV.debug("Учетная запись пользователя скоро будет удалена");
aq=bJ}}).caught(function(b7){aV.debug("Ошибка определения параметров учетной записи",b7)})}).then(function(){if(aU){var b7=(810==bY)&&bE("user","i")(aU.$UserName||"");
ba=aU.$PFiles86;bD=aU.$Temp;return bc.all(m(aU.$AppData,"AppData","%APPDATA%",b7),m(aU.$LocalAppData,"Local AppData","%LOCALAPPDATA%",b7),m(aU.$Cache,"Cache",a2,L),K(ad),R(aU.$SystemDrive)).spread(function(b8,b9,ca,cb,cc){g=b8;
aS=b9;ab=cb;k=ca;bV.hddSize=X=cc}).then(function(){var b8=aU.$IEPATH86;if(ab&&ab.length&&("err"!==ab)&&ad!==ab){return q(ab,b8).then(function(b9){ac=b9?0:1
})}return a2})}return a2}).then(function(){bC=(aq||(bD&&bD.length&&("err"!==bD)))?-1:2;if(aq||(-1!=bC)){return a2}var b7=bD.substr(0,2);return an(b7).truth(function(){bC=1;
bB="drivetype";return bJ},L,L).lie(function(){return bc.when(function(){return("%TEMP%"!==bD)&&("&#x25;TEMP&#x25;"!==bD)&&O(bD).exists()}).truth(function(){return n(bD).then(function(){bC=0
})},bc.thrown("Path not found: "+bD,2)).caught(function(){bC=2;if(X<=0||X>=2000){a0=V();return K(a0).then(function(b8){return O(b8).create().then(function(){return n(b8)
}).then(function(){bC=1})}).caught()}return a2})})}).then(function(){if(bC!==0){return a2}var b7=j(bD,"HelpKontur");return O(b7).exists().truth(function(){return n(b7).then(function(){a=bJ
}).caught(Y.$call(aV.error,"Нет доступа к папке "+b7))},function(){aV.debug("Папка "+b7+" не существует и будет создана автоматически");a=bJ}).caught(function(b8){aV.error("Ошибка при проверкe папки "+b7,b8)
})}).then(function(){return T("Winmgmt").caught(a2).then(function(b7){if(b7&&b7.forDeletion){b1="deletion";b2=2;return a2}if(b7&&!b7.running){b1="none";
b2=1;return a2}if(ak){b1=b0?(bV.badWmi?"bad":"ok"):"none";b2=("ok"===b1)?0:1}else{if(aF){return aK("root\\cimv2",["SELECT * FROM Win32_Opera","tingSystem WHERE Primary = TRUE"].join(""),["Name"],bJ).caught(function(b8){aV.error("Ошибка WMI при запросе OS",b8);
return a2}).then(function(b8){b1=(b8&&b8.Name)?"ok":"bad";b2=("ok"===b1)?0:1})}else{b2=-1}}return a2})}).then(function(){var b7="HARDWARE\\DESCRIPTION\\System\\CentralProcessor\\0\\";
return bc.all(bj(aa,b7,"ProcessorNameString",L),bj(aa,b7,"Identifier",L)).spread(function(b9,b8){u=bI(b9)+" ("+bI(b8)+")"},function(b8){aV.debug("Ошибка получения информации о процессоре",b8)
})}).then(function(){aY=[];return Q().then(function(b8){aY=b8;var b7=window.screen;if(!aY||!aY.length){if(b7&&b7.width){aY.push({Width:b7.width,Height:b7.height,BitsPerPixel:b7.colorDepth,RefreshRate:""})
}else{aY="err"}}else{if((1==aY.length)&&b7){if(b7.width){aY[0].Width=b7.width}if(b7.height){aY[0].Height=b7.height}var b9=aY[0].BitsPerPixel;if(b7.colorDepth&&(!b9||!b9.length||"err"===b9)){aY[0].BitsPerPixel=b7.colorDepth
}}}}).caught(function(b7){aV.debug("Ошибка получения сведений о мониторах",b7)})}).then(function(){bW=[];function b7(b8){bW.push({Name:b8.Description,Ram:b8.AdapterRAM<0?"overflow":Math.floor(b8.AdapterRAM/1024),DriverVersion:b8.DriverVersion})
}return bc.fork(ak,function(){s.wmiGetResultLite("SELECT AdapterRAM, Description, DriverVersion FROM Win32_VideoController",b7)},function(){return aK("root\\cimv2","SELECT * FROM Win32_VideoController",["Description","AdapterRAM","DriverVersion"]).caught(function(b8){aV.error("Ошибка WMI при запросе VideoController",b8);
return[]}).then(function(b8){P(b8,b7)})}).then(function(){if(!bW.length){bW="not"}})}).then(function(){return bc.fork(ap||aq,96,function(){return bi(s.HKCU,"Control Panel\\Desktop\\WindowMetrics\\","AppliedDPI",L)
}).caught(96).then(function(b7){G=b7})}).then(function(){return bc.fork(a7,function(){if(!aU||!aF){return bc.thrown("kd or locator is null")}function b8(b9,cb){var ca=b9.split("\r\n"+cb+"=");
if(ca&&(ca.length>1)&&ca[1]){return ca[1].split("\r\n")[0]}return a2}var b7=0;return S(a2,((aI>=207)&&aF)?a2:"explorer.*").each(function(cb){if(cb.wmi){throw I("wmi mode - env is null",1)
}if(cb.env){var ca=b8(cb.env,"USERPROFILE");if(ca&&(aU.$UserProfile===ca)){var b9=b8(cb.env,"CLIENTNAME"),cc=(cb.name||"").toLowerCase(),cd=cb.startTime;
if((!cd&&b9&&("explorer.exe"===cc))||(cd&&cd>b7)){aW=b9||"";b7=cd||0}if(!cd){return bc.$break()}}}return a2})}).caught(function(){var b7="%CLIENTNAME%";
return K(b7).then(function(b8){aW=b8;if(b7===aW){aW=""}})}).anyway(function(){bV.logonType=aW})}).then(function(){var b7=bV.clientTime,b8=bV.serverTime;
if(b7<b8-86400000){y=2}else{if(bV.clientTimeError||bV.serverTimeError){y=1}else{y=(Math.abs(b7-b8)>600000)?1:0}}}).then(function(){var b7=j(aU.$SysNative,"oeminfo.ini");
function b8(b9){return be(b7,b9).then(function(ca){if((ca.charAt(0)==="ю"&&ca.charAt(1)==="я")||(ca.charAt(0)==="я"&&ca.charAt(1)==="ю")){throw I("it's unicode")
}var cd=[],cf=new RegExp("\\[(OEMSpecific|Support\\s*Information)\\]","i"),ce=new RegExp("Manufacturer\\s*=\\s*?([^\\r\\n]*)","i").exec(ca);if(ce&&ce.length>1){var cb=(ce[1]||"").replace(new RegExp("Model\\s*=.*","i"),"");
cb=bI(cb);if(cb){cd.push(cb)}}ce=new RegExp("Model\\s*=\\s*?([^\\r\\n]*)","i").exec(ca);if(ce&&ce.length>1){var cc=(ce[1]||"").replace(cf,"");cc=bI(cc.replace(new RegExp("SupportURL\\s*=.*","i"),""));
if(cc){cd.push(cc)}}ce=new RegExp("SupportURL\\s*=\\s*?([^\\r\\n]*)","i").exec(ca);if(ce&&ce.length>1){var cg=(ce[1]||"").replace(cf,"");cg=bI(cg);if(cg){cd.push(cg)
}}ce=new RegExp("Контактная информация:\\s*?([^\\r\\n]*)","i").exec(ca);if(ce&&ce.length>1){ce[1]=bI(ce[1]);if(ce[1]){cd.push(ce[1])}}return cd.join(" ")
}).caught(function(ca){aV.debug("Ошибка чтения файла oeminfo.ini, кодировка "+b9,ca);return L})}return M(b7).exists().truth(function(){return b8(1251).lie(function(){return b8(1200)
}).lie(function(){aV.debug("В файле oeminfo.ini не найдена запись о модели.");return L})}).lie(function(){var cb="RegisteredOwner",ca="RegisteredOrganization",b9={"XP GAME 2008|RUSSIA":"Game Edition 2008","XP GAME 2009|RUSSIA":"Game Edition 2009"};
return bc.all(bj(aa,bg,cb,aC),bj(aa,bg,ca,aC)).spread(function(cd,cc){var ce=cd+"|"+cc;if(b9[ce]){a3=b9[ce]}}).caught(function(){var cc=bf+"OEMInformation\\";
return bj(aa,cc,"Model",aC)})}).caught(a2).anyway(function(b9){a3=b9||("not"+(h||""))})}).then(function(){return bc.fork(af,function(){bV.installerIsFunctioning=bJ;
return af.getAsync("Version").then(function(b7){ah=b7;return af.getAsync("Products")}).then(function(b7){return b7.getAsync("Count").then(function(b8){ag=b8>=0
})}).caught()},function(){return M(j(aU.$System32,"msi.dll")).get("ev").truth(function(b7,b8){ah=b8})}).then(function(){if("not"!==ah){var b7=bb.WindowsInstaller;
if(r(b7,ah)){ai=0}else{return bj(aa,bf+"Uninstall\\KB942288-v3\\","DisplayVersion",L).then(function(){ah=b7;ai=0},function(){ai=1})}}return a2})}).then(function(){var b7=aU.$System32;
return bc.all(M(j(b7,"wuapi.dll")).get("ev").then(function(b8,b9){if(b8){b3=b9||"err";b4=("err"===b3)?1:0}else{b3=bY?(at?"unused":a1):"err";b4=at?0:2}}),M(j(b7,"wuaueng.dll")).get("ev").then(function(b8,b9){if(b8){b5=b9||"err";
b6=("err"===b5)?1:0}else{b5=bY?(at?"unused":a1):"err";b6=at?0:2}}),M(j(b7,"kernel32.dll")).get("ev").then(function(b8,b9){if(b8){aL=b9||"err";aM=("err"==aL)?1:0
}else{aL=a1;aM=2}}),bc.fork(aZ,function(){return M(j(b7,"stdole2.tlb")).get("ev").then(function(b8,b9){if(b8){by=b9||"err";bz=("err"==by)?1:0}else{by=a1;
bz=2}})}),bc.fork(aZ,function(){return M(j(b7,"oleaut32.dll")).get("ev").then(function(b8,b9){if(b8){a4=b9||"err";a5=("err"==a4)?1:0}else{a4=a1;a5=2}})
}),bc.fork(aZ,function(){return o("KB2802968").then(function(b8){aE=b8?0:2;aD=b8?"yes":(ao?"noRus":"no")})}))}).then(function(){var ca=bf+"WindowsUpdate\\Auto Update\\Results\\",b7=ca+"Detect\\",b9=ca+"Install\\",b8=ca+"Download\\";
function cc(){return bc.fork(a9,function(){return v(["Microsoft","Update","AutoUpdate"],bJ).then(function(cd){return cd.getAsync("Results").truth(function(ce){return bc.all(ce.getAsync("LastSearchSuccessDate").caught(a2),ce.getAsync("LastInstallationSuccessDate").caught(a2)).spread(function(cg,cf){bS=(bN===cg)?"":cg;
bQ=(bN===cf)?"":cf}).anyway(ce.free)}).anyway(cd.free)}).caught(function(cd){aV.debug("Ошибка создания объекта AutoUpdate",cd)})})}function cb(cd,ce){return bi(aa,ce,"LastError",aC).then(function(cf){cf=Number(cf);
if(cf){aV.debug("Последняя ошибка Windows Update - "+cd,I("",cf));return cf}return a2}).caught()}return bc.fork(au,cc,function(){return bc.all(cb("поиск обновлений",b7),cb("загрузка обновлений",b8),cb("установка обновлений",b9)).spread(function(cd,ce,cf){aR=cd?s.intToHex(cd):a2;
aQ=cf?s.intToHex(cf):a2;aP=ce?s.intToHex(ce):a2;return bc.all(bj(aa,b7,"LastSuccessTime",aC).caught(function(cg){return am(cg)?bN:a2}),bj(aa,b9,"LastSuccessTime",aC).caught(function(cg){return am(cg)?bN:a2
}),bj(aa,b8,"LastSuccessTime",aC).caught(function(cg){return am(cg)?bN:a2})).spread(function(ci,ch,cg){bS=(bN===ci)?"":ci;bO=(bN===cg)?"":cg;bQ=(bN===ch)?"":ch
})}).caught(function(cd){aV.debug("Ошибка определения времени поиска обновлений, пробуем ActiveX",cd);return cc()})}).then(function(){function cd(ch){if(""===ch){return{value:"never",status:-1}
}if(!ar(ch)&&(!al(ch)||isNaN(ch))){return{value:a1,status:1}}ch=bA(ch);if(isNaN(ch)||isNaN(ch.getTime())){return{value:a1,status:1}}if(ch.getFullYear()<=2007){return{value:"never",status:-1}
}return{value:ch.getTime(),status:0}}var cf=cd(bQ),cg=cd(bS),ce=cd(bO);bQ=cf.value;bR=!aQ?cf.status:1;bS=cg.value;bT=!aR?cg.status:1;bO=ce.value;bP=!aP?ce.status:1
})}).then(function(){return bc.when(function(){return T("CryptSvc").truth(function(b8){x=b8.forDeletion;if(x){return{value:"deletion",status:2}}if(b8.disabled){return{value:"disabled",status:2}
}if(!b8.running){return{value:"stop",status:2}}var b7=b8.account;return{value:b7,status:0}},{value:a1,status:1}).caught({value:"err",status:1}).then(function(b7){w=b7
})}).then(function(){return bc.fork(at,function(){return T("TrustedInstaller").truth(function(b7){bL=b7.forDeletion;if(bL){return{value:"deletion",status:2}
}if(b7.disabled){return{value:"disabled",status:2}}else{return{value:b7.running?(b7.account||"run"):"ready",status:0}}},{value:a1,status:1}).caught({value:"err",status:1})
},{value:"unused",status:0}).then(function(b7){bK=b7;bK.checkNeeded=at})}).then(function(){if(!a6){return{value:"err",status:2}}if(!aB){return{value:"old",status:1}
}function b7(){var b8=132186623;return bi(aa,bg+"Time Zones\\","TZVersion",L).then(function(b9){if(b9==b8&&at){var ca=aU.$System;return M(j(ca,"tzres.dll")).get("ev").then(function(cb,ch){if(cb&&ch){var cc="10.0.14393.187",cf="6.3.9600.16384",ce="6.2.9200.20583",cd="6.1.7601.23593",ci="6.0.6002.19675",cg=au?cc:(ay?cf:(az?ce:(ax?cd:ci)));
if(r(cg,ch)){return{value:"yes",status:0}}}return bc.thrown()}).caught({value:"tzres",status:2})}else{if(b9<b8){return{value:"no",status:2}}else{return{value:"yes",status:0}
}}}).caught(function(b9){aV.debug("Ошибка чтения TzVersion из реестра",b9);return o(["KB4012864"]).truth({value:"yes",status:0}).lie(bc.reject()).caught({value:"no",status:2})
})}return b7().caught({value:"err",status:2})}).then(function(b7){bF=b7})}).then(function(){return bc.fork(aF,function(){return bc.all(W(6),W(10)).spread(function(b8,b7){bv=b8;
bw=b7;z=bJ;if(!bv){bG("Processor","NoSSE1")}else{if(!bw){bG("Processor","NoSSE2")}}}).caught()}).then(function(){bV.noSse1=!bv;bV.noSse2=!bw})}).then(function(){function b8(cd,ce){return M(j(cd?ba:g.value,ce+"\\")+"uninstall.exe").get("fv")
}function b7(cd){return bc.all(b8(cd,"SkbKontur"),b8(cd,"Aktiv Co")).spread(function(ch,ce){var cg;if(ch&&ch.exist){if(ce&&ce.exist){cg=r(ch.version,ce.version)?ce:ch
}else{cg=ch}}else{cg=ce}var cf=cg&&cg.exist;return{Type:cd?"admin":"user",Version:cf&&cg.version||"",Status:cf?"unused":"none",Result:(!!cg.version&&r(f,cg.version))?-1:1}
})}var cb=aF?aF.version:aI,cc=aF===L,ca=aF?"used":(cc?"access":"err"),b9={access:2,err:2};return bc.all(b7(L),b7(bJ)).spread(function(ce,cd){aG=cd;aH=[aG,ce];
if(aG.Version==cb&&ce.Version==cb||(cc&&ce.Version&&aG.Version)){(i.firefox?aG:ce).Status=ca;(i.firefox?aG:ce).Result=aJ=b9[ca]||0}else{if(aG.Version==cb||(cc&&aG.Version)){aG.Status=ca;
aG.Result=aJ=b9[ca]||0;ce.Result=-1}else{if(ce.Version==cb||(cc&&ce.Version)){ce.Status=ca;ce.Result=aJ=b9[ca]||0}else{if(aF!=a2){aJ=b9[ca]||1;aH.push({Type:"not",Version:cb,Status:ca,Result:aJ})
}}}}})}).then(function(){B.setValueEx("Windows",["Rights",bo,"WinVersion",bX,"SP",bt,"OEMInfo",a3,"Arch",h+(h?" бита":"")]);if(u&&u.length){B.setValue("Windows/CPU",u.replace(new RegExp("\\s\\s+","g")," "),-1)
}if(z){B.setValue("Windows/SSE1",bv?"yes":"no",bv?0:2);B.setValue("Windows/SSE2",bw?"yes":"no",bw?0:2)}B.setValueEx("Windows",["RAM",bd,"HDD",X,"Date",{time:bV.clientTime,zone:Math.floor(-bV.clientDate.getTimezoneOffset()/60)},"LastBootTime",aO]);
if(a6){B.setValue("Windows/DateZone",bF.value)}B.setValueEx("Windows",["UAC",bM,"Language",aN,"Country",t,"CodePage",p,"Locale",aT,"InDomain",ae,"SID",bU,"AppData",g.value,"LocalAppData",aS.value,"IEPath",ab,"CacheFolder",k.value,"TempVar",bD]);
if(a7){var ct=(aW&&aW.length&&"Console"!==aW)?1:0;B.setValue("Windows/LogonType",aW,ct)}B.setValue("Windows/VideoCards",bW,-1);B.setValueEx("Windows",["Monitors",aY,"DPI",G,"InstallerVersion",ah]);
if(bK.checkNeeded){B.setValue("Windows/TrustedInstaller",bK.value)}B.setValueEx("Windows",["CryptSvc",w.value,"Kernel32",aL,"WUApiDLL",b3,"WUAUEngDLL",b5]);
if(aZ){B.setValueEx("Windows",["stdole2TLB",by,"oleaut32DLL",a4,"KB2802968",aD])}if(a9||(bS&&"never"!==bS)||(bQ&&"never"!==bQ)||(bO&&"never"!==bO)){B.setValue("Windows/UpdateSearchDate",!aR?bS:aR,bT);
if(!au){B.setValue("Windows/UpdateDownloadDate",!aP?bO:aP,bP)}B.setValue("Windows/UpdateInstallDate",!aQ?bQ:aQ,bR)}B.setValue("Windows/WMI",b1,b2);var ce=s.hasUac(),ck=s.isUser();
if(a8&&a8.FixLocale){D.addFix(new N("Windows.FixLocale",{message:bH("Windows/FixLocale"),order:77,script:1,needadmin:1,needreboot:1,priority:1,fix:function(cT){var cU="SYSTEM\\CurrentControlSet\\Control\\Nls\\";
return bc.all(bn(aa,cU+"Language","Default","0419",false).then(bJ,L),bn(aa,cU+"Locale","(Default)","00000419",false).then(bJ,L),bn(aa,cU+"CodePage","ACP","1251",false).then(bJ,L)).spread(function(cW,cX,cV){return(cW&&cX&&cV)?bJ:bc.thrown()
}).caught(function(){return s.runUniversalFix("FixNonUnicodeProgramsLanguage",bJ).then(function(cV){return(cV&&cV.code===0)?bJ:bc.thrown()})}).caught(function(cV){aV.error("Не удалось настроить язык программ, не поддерживающих Юникод",cV);
return L}).then(cT)},test:function(){if(ap||(ck&&!ce)){return L}return(aT!=="0419"&&aT!==419)||(t!=="7"&&t!==7)||(p!=="1251"&&p!==1251)}}))}B.setValue("Windows/KonturDiag",aH);
B.setValue("Windows/DiagPlugin",F);var co=(bq?"Актив.Diag":"Контур.Diag")+" для всех пользователей",cm=(bq?"AktivDiag2_admin.exe":"KonturDiag2_admin.exe"),cn=E+(bq?"AD/":"KD/")+cm;
D.addFix(new N("Windows.KonturDiag",{message:((aG&&aG.Version)?"Обновление":"Установка")+" "+co,caption:co,filename:cm,url:cn,foreign:s.rootUrl+cn,args:"/S",priority:1,order:85,needadmin:1,needrestart:1,test:function(cT){cT.setMessage("Windows/KonturDiag",aJ);
P(aH,function(cV,cU){cT.setMessage("Windows/KonturDiag/"+cU,cV.Result)});return !aG.Version||!r(f,aG.Version)}}));var cO={wivXP:"WindowsXP-KB942288-v3-x86.exe",wiv2003:"WindowsServer2003-KB942288-v4-x86.exe",wivX64:"WindowsServer2003-KB942288-v4-x64.exe"},cM=(aA&&!aC)?"wivXP":((bY>=502&&bY<=503)?(aC?"wivX64":"wiv2003"):a2),cN=cM&&cO[cM],cP=aX+"2/6/1/261fca42-22c0-4f91-9451-0e0f2e08356d/",cQ=bH("Windows/InstallerVersion");
D.addFix(new N("Windows.InstallerVersion",{message:b+" "+cQ,caption:cQ,filename:cN,args:"/passive /norestart",foreign:(cP&&cN)?(cP+cN):a2,priority:1,order:100,needadmin:1,needreboot:1,test:function(cU){var cV=L,cT="";
if(ag){if(cN&&(1==ai)){cV=bJ;cT=cM}}else{bV.installerIsFunctioning=L;ai=2;cT="repair"}cU.setMessage("Windows/InstallerVersion",(br&&(1==ai))?2:ai,cT);return cV
}}));var cS="windowsupdateagent30-x86.exe",cR=bH("Windows/WUApiDLL");D.addFix(new N("Windows.WUApiDLL",{message:e+" "+cR,caption:cR,filename:cS,args:"/quiet /norestart",foreign:"http://download.windowsupdate.com/windowsupdate/redist/standalone/7.4.7600.226/"+cS,order:120,needadmin:1,needreboot:1,test:function(cT){if(!at){var cU=bE("err|not|notfound|unused","i");
if(!cU(b3)&&!r(bb.WUApi,b3)){if("err"!==b5&&(cU(b5)||!r(bb.WUApi,b5))){b6=1;cT.setMessage("Windows/WUApiDLL",b4);cT.setMessage("Windows/WUAUEngDLL",b6,"upd");
return b6}}}cT.setMessage("Windows/WUApiDLL",b4);cT.setMessage("Windows/WUAUEngDLL",b6);return 0}}));var cp="WindowsServer2003.WindowsXP-KB2758857-x64-ENU.exe",cq="WindowsServer2003.WindowsXP-KB2758857-x64-RUS.exe",cs=aA?"5.1.2600.5512":"5.2.3790.3959",cr=a2;
switch(bY){case 501:cr=(bt>=3)?(ao?"WindowsXP-KB2758857-x86-RUS.exe":"WindowsXP-KB2758857-x86-ENU.exe"):a2;break;case 502:cr=(bt>=2)?(ao?cq:cp):a2;break;
case 503:if(bt>=2){if(ao){cr=aC?cq:"WindowsServer2003-KB2758857-x86-RUS.exe"}else{cr=aC?cp:"WindowsServer2003-KB2758857-x86-ENU.exe"}}break;default:break
}D.addFix(new N("Windows.Kernel32",{message:b+" обновления KB2758857 (kernel32.dll)",caption:bH("Windows/Kernel32"),filename:cr,args:"/passive /norestart",order:150,priority:1,needadmin:1,needreboot:1,test:function(cU){var cT="";
if(aL&&aL.length&&("err"!==aL)&&(a1!==aL)){if(!r(cs,aL)){if(cr){cT=aA?"upd-xp":"upd-2003";aM=2}else{cT=aA?"sp-xp":"sp-2003";aM=1}}}cU.setMessage("Windows/Kernel32",aM,cT);
return !!(cr&&aM)}}));if(aZ){var cl=(ao?"WindowsXP-KB2802968-x86-RUS.exe":"WindowsXP-KB2802968-x86-ENU.exe");D.addFix(new N("Windows.KB2802968",{message:b+" обновления KB2802968",caption:bH("Windows/KB2802968"),filename:cl,args:"/passive /norestart",order:153,needadmin:1,needreboot:1,test:function(cT){var cW="",cX="5.1.2600.5512",cU="",cV="5.1.2600.6341";
if(by&&by.length&&("err"!==by)&&(a1!==by)){if(!r(cX,by)){cW=(0===aE)?"reinst-tlb":"inst-tlb";bz=2}}if(a4&&a4.length&&("err"!==a4)&&(a1!==a4)){if(!r(cV,a4)){cU=(0===aE)?"reinst-ole":"inst-ole";
a5=2}}cT.setMessage("Windows/stdole2TLB",bz,cW);cT.setMessage("Windows/oleaut32DLL",a5,cU);if(0===aE&&(0!==bz||0!==a5)){aD=(ao?"incorrectRus":"incorrect");
aE=2;this.message=d+" обновления KB2802968"}cT.setValue("Windows/KB2802968",aD,aE);return(0!==aE)}}))}D.addFix(new N("Windows.CryptSvc",{message:bH("Windows/CryptSvc"),script:1,priority:1,needadmin:1,order:155,fix:function(cT){return bx("CryptSvc",{}).then(cT)
},test:function(cU){var cV=w.status===2,cT=(cV&&!x)?"fix-crypt":"";cU.setMessage("Windows/CryptSvc",w.status,cT);return cV}}));D.addFix(new N("Windows.TrustedInstaller",{message:bH("Windows/TrustedInstaller"),script:1,priority:0,needadmin:1,order:160,fix:function(cT){return bx("TrustedInstaller",{manual:1}).then(cT)
},test:function(cU){if(!bK.checkNeeded){return 0}var cV=(2===bK.status),cT=(cV&&!bL)?"fix-trust":"";cU.setMessage("Windows/TrustedInstaller",bK.status,cT);
return cV}}));if(a6){D.addFix(new N("Windows.DateZone",{message:b+" обновления часовых поясов",caption:bH("Windows/DateZone"),filename:ao?"UpdateTimeZones_Rus.exe":"UpdateTimeZones_Enu.exe",args:"/S",priority:bV.needInstallDateZone?1:0,order:170,needadmin:1,test:function(cT){cT.setMessage("Windows/DateZone",bF.status);
return"no"===bF.value||"tzres"===bF.value}}))}var cw=1000;D.addFix(new N("Windows.FixTemp",{message:bH("Windows/FixTemp"),script:1,priority:1,order:10,needadmin:(ap||aq)?1:0,needreboot:1,fix:function(cU){var cT=this;
bc.timeout(10).then(function(){var cV=cT.targetTemp||V();return bc.all(bs("TEMP",cV,(ap||aq)?a2:{}),bs("TMP",cV,(ap||aq)?a2:{})).spread(function(cW){cU(cW&&cW.process)
})})},test:function(cU){var cT=this;if(!aq&&bD&&bD.length&&("err"!==bD)){if(bC&&"drivetype"!==bB){cw=2000;bB="noright";if(bC==1){cT.targetTemp=a0;bB="noright-fix"
}else{if(bC==2){if(X>0&&X<2000){bB="noright-2gb"}else{bB="noright-adm"}}}}if((0===bC)&&("\\"===bD.charAt(bD.length-1))){cT.targetTemp=bD.substr(0,bD.length-1);
cT.priority=0;bC=1;bB="slash-fix"}}bC=(bC===0?(a?bC:2):bC);cU.setMessage("Windows/TempVar",bC,bB);return !aq&&(1==bC)}}));D.addFix(new N("Windows.FixAppData",{message:bH("Windows/FixAppData"),script:1,priority:1,order:11,needadmin:0,needreboot:1,fix:function(cT){return bc.timeout(10).then(function(){var cW=function(cZ,c0){var c2=[(c0?"%USERPROFILE%":aU.$UserProfile),"Application Data","Local Settings","AppData","Roaming","Local","Microsoft","Windows","INetCache","Temporary Internet Files"],c1="";
P(cZ,function(c3){c1=j(c1,c2[c3])});return c1},cU,cX,cY;if(at){cU=[0,3,4];cX=[0,3,5];cY=[0,3,5,6,7,az?8:9]}else{cU=[0,1];cX=[0,2,1];cY=[0,2,9]}function cV(cZ){return function(c0){aV.debug("Ошибка настройки "+cZ,c0);
return L}}return bc.all(bn(Z,bk,"AppData",cW(cU,L),L).then(bJ,cV("ShellFolders/AppData")),bn(Z,bk,"Local AppData",cW(cX,L),L).then(bJ,cV("ShellFolders/Local AppData")),bn(Z,bk,"Cache",cW(cY,L),L).then(bJ,cV("ShellFolders/Cache")),bm(Z,bl,"AppData",cW(cU,bJ),L).then(bJ,cV("UserShellFolders/AppData")),bm(Z,bl,"Local AppData",cW(cX,bJ),L).then(bJ,cV("UserShellFolders/Local AppData")),bm(Z,bl,"Cache",cW(cY,bJ),L).then(bJ,cV("UserShellFolders/Cache")),bs("APPDATA",cW(cU,L),{}),bs("LOCALAPPDATA",cW(cX,L),{})).spread(function(cZ,c4,c2,c0,c5,c3,c1,c6){return cT(cZ&&c4&&c0&&c5&&c2&&c3&&c1&&c1.process&&c6&&c6.process)
})})},test:function(cX){var cU="Windows/AppData",cT=g.comment,cZ="Windows/LocalAppData",cY=aS.comment,cW="Windows/CacheFolder",cV=k.comment,c1=(1==g.status||a1===cT),c3=(1==aS.status||"usershell"===cY||"usershelldiff"===cY||a1===cY),c2=(1===k.status||"drivetype"===cV||"usershell"===cV||"usershelldiff"===cV||a1===cV),c0=!ap&&!aq&&(c1||c3||c2);
if(c1&&cT){cT+=(c0?"fix":"")}if(c3&&cY){cY+=(c0?"fix":"")}if(c2&&cV){cV+=(c0?"fix":"")}cX.setMessage(cW,k.status,cV);cX.setMessage(cU,g.status,cT);cX.setMessage(cZ,aS.status,cY);
return c0}}));function cj(cT){return("undefined"==typeof(cT))||(""===cT)}B.setMessage("Windows/Rights",(aq||cj(bp))?2:bp,aq?"temp":"");var cK=bV.winBuild,cL="",cJ=90;
if(!aB){cL="winold"}else{if((bY>1011)||(1011==bY&&Number(cK||"14393")<14393)||(1010==bY&&Number(cK||"10240")<10240)){cL="winbeta"}else{if(!aw){if(bV.ram>=2048-cJ){bZ=2;
cL=at?"winupdatevista":(av?"winupdate2003":"winupdatexp")}else{bZ=1;cL=at?"winramvista":(av?"winram2003":"winramxp")}}}}B.setMessage("Windows/WinVersion",cj(bZ)?2:bZ,cL);
if(!bt){bt=0}if(!a3){a3=""}var cH={"700_0_32":"win7x32","700_0_64":"win7x64","701_0_64":"win2008x64"},b7=bV.arch,cG=cH[bY+"_"+bt+"_"+b7]||"";B.setMessage("Windows/SP",bu,cG);
var b8=["AlexSoft|all\\-best\\.pro|Beslam|BEST\\s*XP|Black\\-Dark|BootMan 2008|Chip Windows|CWER","DimasAtl|DM\\s*Torrent|DonbassSoft|DreamLair|^Enterprise (SP1 )?v\\.\\d+\\.\\d+|eXPanded","Feniks","Game\\w?\\s*Edition|GarixBOSSS|Gold RC|Golver","hobbit|^Home Premium (SP1 )?v\\.\\d+\\.\\d+","[\\s_]IDimm |Infiniti Edition","KDFX Reborn|KottoSOFT|Krokoz|KrotySOFT","LastXP|LonerD|LWGAME","Matros|MDVD Edition|meDGora|Microsoft Windows. XP Copyright. 2008|Minutka15| MoN Edition|MoverSoft|MultiDVD","NeleGal|NHT\\-TEAM|NiwradSoft|OGOMOR|OSzone|OVGorskiy","PHILka|Piter\\s*Pen|^Professional (SP1 )?v\\.\\d+\\.\\d+|prokaz*a","Romeo19|RTM Black Edtion|Ru\\-admin|RudSOFT|Rushen","SamLab|SE7EN|Ser\\-51|slider9|StableOS|StaforceTEAM|StyleXP|System USB\\-Flash","Tabulorasa|TimON|TopHits|Twilight\\s*Angel","^Ultimate (SP1 )?v\\.\\d+\\.\\d+|Unattended XP SP| USDE|Ural\\s*SOFT","Warxammer|Windows XP Alternative|Windows XP STANDARD Edition|WinSoft|WinStyle|Win\\-Torrent|WorldSOFT","XaKeR|X\\@nder|XTreme|X\\-Team|X\\-Wind","Yagd|YelloSOFT|Zver|Матысик|Сборка апрель 2012"].join("|").replace(new RegExp("\\s+","g"),"\\s+"),cy=("not"===a3.substr(0,3))?0:(new RegExp("(err|"+b8+")","i").test(a3)?2:-1),cx=(2==cy&&"err"!==a3)?"pirate":"";
B.setMessage("Windows/OEMInfo",cy,cx);B.setMessage("Windows/Arch",(32==b7||64==b7)?0:1);var cc=1024,cC={"1000":2048};var ca=(cC[Math.floor(bY/100)*100]||cc)*(Math.floor(Number(b7)/32)||1),cI=H?2048:0,cB=Math.max(ca,cI),cD=!bd?1:((cB&&(bd>0)&&(bd<(cB-cJ)))?((A||J||H)?2:1):0),cA="ram-"+(cB>>10)+"gb",cz=(cB>cI)?cA:(H?"ram-egais":cA),cg=(0===X)?-1:((X<200)?2:((X<cw)?1:0)),cf=(cg>0)?((cw>=2000)?"hdd2gb":"hdd1gb"):"",cb=["dateok","datewarn","dateerr"];
B.setMessage("Windows/RAM",(0===bd)?-1:((bd<(cc-cJ))?2:cD),cD?cz:"");B.setMessage("Windows/HDD",cg,cf);B.setMessage("Windows/Date",y?2:0,cb[y]||cb[0]);
B.setMessage("Windows/LastBootTime",(aO&&"wmi"!==aO)?-1:1);B.setMessage("Windows/UAC",("not"===bM||"silent"===bM||"consent"===bM||cj(bM))?2:(("err"===bM)?1:0));
var cF=aq?2:(bU&&bU.length&&(0===bU.indexOf("S-1-5-21")))?0:1,cd={9:1,1031:1,1033:1,1049:1,1058:1,1059:1,2055:1,2057:1,2073:1,3081:1,4103:1,4105:1,5127:1,5129:1,6153:1,7177:1};
B.setMessage("Windows/Language",cj(aN)?2:(aN&&cd[aN])?0:1);B.setMessage("Windows/Country",cj(t)?2:(1==t||7==t)?0:1);B.setMessage("Windows/CodePage",cj(p)?2:(1251==p)?0:1);
B.setMessage("Windows/Locale",cj(aT)?2:("0409"==aT||"0419"==aT)?0:1);B.setMessage("Windows/InDomain",!ae?2:("err"!==ae)?0:1);B.setMessage("Windows/SID",cF,aq?"temp":"");
B.setMessage("Windows/IEPath",ac);var cv=2;if(aY&&(aY instanceof Array)&&aY.length){for(var ch=0,ci=aY.length;ch<ci;++ch){var cu=aY[ch];cu.Status=2;if("err"!==cu.Width&&cu.Width>=800){cu.Status=1;
if(cu.Width>=1024){if("err"!==cu.Height&&cu.Height>=600){var b9=cu.BitsPerPixel,cE=cu.RefreshRate;cu.Status=(b9&&!(new RegExp("^(16|24|32)").test(b9)))?1:0;
if(cE&&("err"!==cE)&&(cE<59)){cu.Status=1}}}}if(cv>cu.Status){cv=cu.Status}}}B.setMessage("Windows/Monitors",cv,("err"!==aY)?"warn":"");if(aY&&(aY instanceof Array)&&aY.length){P(aY,function(cU,cT){B.setMessage("Windows/Monitors/"+cT,cU.Status)
})}B.setMessage("Windows/DPI",G?(new RegExp("^(96|120)").test(G)?0:-1):1);return bJ})};if(!window.SkbKontur){window.SkbKontur={}}if(!window.SkbKontur.Help){window.SkbKontur.Help={}
}window.SkbKontur.Help.Scripts.CryptoPro=function(by,w,d6){var co=window.SkbKontur.Help,M=co.contains,bz=co.Diagnosis,bF=co.Err,bJ=co.exists,cv=co.isArray,bP=co.find,bQ=co.Fix,bU=co.foreach,cy=co.isDate,cB=co.isNullOrEmptyOrBad,dD=co.objectKeys,ej=co.Promise,e0=co.Scripts,fj=co.Test,fo=co.trim,O=co.Core,cp=O.HKCR,cq=O.HKCU,cr=O.HKLM,cw=O.browser.ax,q=O.buildPath,I=O.compareDate,J=O.compareVersion,Q=O.createNPAXObject,br=O.debugKD,bI=O.execute,bN=O.File,bO=O.fileExist,bT=O.folderExist,bV=O.formatDate,b2=O.getArray,b5=O.getDaysString,b8=O.getInfoFromCspLog,b9=O.getKonturDiag,ca=O.getLicenseInfo,b7=O.getFileByCLSID,ch=O.getProductVersion,cd=O.getProductInfoReg,ce=O.getProductInstallDate,cf=O.getProductInstallPath,cg=O.getProductName,cj=O.getService,cn=O.hasUac,cu=O.isAccessDeniedError,cA=O.isFileNotFoundError,cC=O.isSystem,cD=O.isUser,cQ=O.isWinServer,dn=O.needAdmin,ec=O.parseError,eq=O.$readAll,eA=O.regHKCR,eB=O.regHKCU,eC=O.regHKLM,ev=O.regDeleteKey,ew=O.regDeleteValue,ey=O.regEnumValues,ex=O.$regEnumKeys,eE=O.regReadByType,eG=O.$regReadNumber,eH=O.regReadQWord,eI=O.$regReadString,eF=O.$regReadMultiString,eP=O.$regWriteNumber,eQ=O.regWriteQWord,eR=O.$regWriteString,eO=O.$regWriteMultiString,ez=O.regGetAccess,eK=O.regSetAccess,eL=O.regSetOwner,eS=O.reverseGuid,eT=O.rootUrl,eW=O.run,bD=O.download,eX=O.runUniversalFix,ff=O.startService,fk=O.timeTicksToDays,fm=bz.translateAssay,di=O.log,fw=O.vars,g=fw.arch,bA=fw.diagnostics,bC=fw.distrPath,H=fw.codepage,h=fw.atolLocale,C=fw.centerInformLocale,U=fw.cryptoproLocale,aG=fw.cspLocale,bG=fw.etprfLocale,bH=fw.evrikaLocale,bW=fw.ftsLocale,ct=fw.infoTrustLocale,cX=fw.ktbLocale,dG=fw.ofdLocale,eb=fw.parcLocale,ef=fw.practicLocale,ep=fw.rarLocale,eY=fw.rutokenLocale,eZ=fw.sberLocale,e5=fw.sertumLocale,fd=fw.shtrihLocale,fi=fw.tanderLocale,fl=fw.tomlineLocale,fs=fw.ucLocale,fx=fw.vikiLocale,dz=fw.needUpdateCSPLicense,dB=fw.noCSPOffSigLicense,eg=fw.productMasks,eh=fw.productVersions,bq=co.CSPVersionDetect,Z=eh.CSP36R1,aa=eh.CSP36R2,ab=eh.CSP36R3,bo=eh.CSPupdateR3,ac=eh.CSP36R4,ae=eh.CSP39,ag=eh.CSP39R2,ai=eh.CSP40,aj=eh.CSP40R2,e7=fw.serverTime,e6=fw.serverDate,fE=fw.winVer,fD=fw.winSP;
var dC=null,fp=true,bM=false,p=777,dA=new Error(),eM=O.regSoftware,eD=eM+"Microsoft\\",eN="Wow6432Node\\",R=eM+"Crypto Pro\\",T=R+"Cryptography\\",S=T+"CurrentVersion\\",A=S+"KeyCarriers\\",bx=S+"KeyDevices\\",ea=S+"Parameters\\",em=S+"Random\\",fc=R+"Settings\\",fv=fc+"Users\\",cW,cY=fw.licenseCSP36Guid,cZ=fw.licenseCSP39Guid,c0=fw.licenseCSP40Guid,c1=fw.licenseCSP50Guid,fh=["SYSTEM\\Current","ControlSet\\Control\\"].join(""),P=fh+"Session Manager\\CProPatches\\",fe=new RegExp("\\\\","g"),cL=(fE<=500),cS=(501==fE),cE=(fE==600),cF=(fE>=600),cM=(700==fE),cJ=(701==fE),cN=(fE>=700),cP=(fE>=800),cO=(fE>=810),fC=Number(fw.winBuild||"10240"),cG=(1010==fE),cH=(cG&&fC>=14959),cI=(cG&&fC>=15063),cR=(fE>=1010&&fC>=16299),cK=(fE>=1011),cT=(64==g),fn=bz.translateFix,b="Actions/",a=fn(b+"install"),d=fn(b+"update"),c=fn(b+"remove"),r,dh,fu,D=d6?d6.Certificates:dC;
d6=d6?d6.CryptoPro:dC;var d2=!d6||d6.CSPVersion,bp="",aH="",W=bM,X=bM,Y=bM,ad=bM,ah=bM,ak=bM,dy,dx,dv,dw,du,af=bM,ax="",az=bM,aJ=bM,aI="",dk=bM,aw=-1,fA="",ds=[2148074248,-2146893048];
function E(fG){fw.cspVersion=fG;aH=fw.cspMajor=(fG&&(fG.length>=3))?fG.substr(0,3):dC;W=fw.csp20=("2.0"===aH);X=fw.csp30=("3.0"===aH);Y=fw.csp36=("3.6"===aH);
ad=fw.csp39=("3.9"===aH);ah=fw.csp40=("4.0"===aH);ak=fw.csp50=("5.0"===aH)}function eu(fH){var fG=ad&&J(bp,ae);if("40"===fH){dy=((bp!=ai)&&!cM&&!cJ)||(bp==ai&&(cG||cK));
dx=!dy;dv=bM;dw=bM;du=bM}else{if("39"===fH){dy=bM;dx=bM;dv=!az||cP||(bp!=ae);dw=!dv&&(!af||ad);du=!dv&&!dw}else{if("36"===fH){dy=bM;dx=bM;dv=bM;dw=bM;du=bM
}else{dy=!fw.noSse2&&((ah&&(!cM&&!cJ&&(bp!=ai)||cG||cK))||(!cM&&((cG||(!cE&&(!az||!ah)&&!cQ()))||(fi&&!cJ))));dx=!fw.noSse2&&!dy&&(fi||ah||cM);dv=!dy&&!dx&&(cG||cK||!az||(ad&&!fG)||(cP&&!af));
dw=!dy&&!dx&&!dv&&(!af||ad);du=!dy&&!dx&&!dv&&!dw}}}}fw.cspVersion=dC;var dU=!d6||d6.CSPLicense,aA="no",aB=0,f=dC,c8="ProductID",i="3636",j="3939",k="4040",bt=fw.defaultCSPSerial36=i+"740030EMPWPC6617NT3DY",bu=fw.defaultCSPSerial39=j+"0Z0037EA3YGGRQEDE6LPZ",bv=fw.defaultCSPSerial40=k+"EG0037EK8R3C6K4UHCXQG",bw=fw.defaultCSPSerial50="5050KP003002VB57EPR09NCZH",ei=window.profileName,l="000001",m=[i+"GP"+l+"314C67C2TNL9L",i+"XX0000691QWUKVHPCBEGQ",i+"EL"+l+"PXHF9BCH2ZG3T",i+"67"+l+"GX0QAK9UL5BWX",j+"YW"+l+"23FTTCWZQNU9U",j+"2C"+l+"2DL6K90D8NUH1",j+"YD00000AQY8W636NW57G3",j+"XA"+l+"7KZDMUKVYLBZ6",i+"P8"+l+"38MLUV5RCFH7C",i+"GF"+l+"2TDP0B6XE95YH",i+"RN"+l+"HWBY6T7K6HEB4",i+"CE"+l+"W5PE7A12XG4GP",k+"W0"+l+"VENMB7VT49ML3",k+"YL00000KF1PC6BCD5CGR6",k+"V000000AF3X5A4AVNN2XW",k+"YQ000002Q6TNFYX924Z86"],cx=fj("^("+m.join("|")+")$","i"),cs=cw?-2200000000000:0,dc=eM+"Microsoft\\Windows\\CurrentVersion\\Installer\\UserData\\S-1-5-18\\Products\\",db="\\InstallProperties\\",c2="{368F645E-3059-4DE5-B6D7-BCFE55A8032D}",c3="{EFAFF4D1-B76E-4C0C-9B7F-0BDF00CD5AFC}",c4="{F2F88A77-F7E6-4C9E-9C67-CB1855C62B45}",c5="{A48FEAF7-122F-4D98-852E-12C0A3E60449}",c6="{8CFC80FA-6524-437E-854A-0AF1790FE280}",c7="{F8DCE222-4388-468D-A174-97669AA8C3FF}",c9="{85CE021C-3982-446B-91D0-47CCFFE1BE4D}",da="{FEB8699B-98F0-4520-8253-95CD621B99BC}",dd="{BE3CE2FE-08AB-4711-93C2-26DFE2BD7273}",de="{188F4791-B9A8-4DBF-8D55-68042F74E9FC}",df={EFS:"EFS",OFFSIG:"Office Signature",NET:".NET",NETSDK:".NET SDK",PDF:"PDF",Rutoken:"Рутокен CSP",UEC:"УЭК",FKC:"ФКН",OCSP:"OCSP 1.0",OCSP2:"OCSP 2.0",TSP:"TSP 1.0",TSP2:"TSP 2.0",RP:"RP 1.0",RP2:"RP 2.0"};
function b6(){return ak?bw:(ah?bv:(Y?bt:bu))}function cz(fG){return fG===df.OCSP||fG===df.OCSP2||fG===df.TSP||fG===df.TSP2||fG===df.RP||fG===df.RP2}function es(fG,fH){return eI(cr,cb(fG,fH),c8,cz(fG)?bM:cT).truth(function(fI){return fI.toUpperCase()
},dC)}function fF(fH,fG){return eR(cr,cb(fG),c8,fH.toUpperCase(),cT)}function dj(){return b7("CPCSPLicense.CPCSPLicense").then(function(fG){if(!fG||!fG.length){return b7("CPCSPLicence.CPCSPLicence")
}return fG}).then(function(fG){if(!fG||!fG.length){throw dA}return fG}).then(function(fG){return bN(fG).get("ev").truth(function(fJ,fH){var fI="COM-объект проверки лицензии КриптоПро найден по пути: "+fG+" (версия файла: "+fH+")";
if(J("1.3.0",fH)&&!J("1.3.760",fH)){di.debug(fI+", и он не работает, потому что кривая версия (1.3.XXX меньше 1.3.760).")}else{di.debug(fI+", но он почему-то не функционирует.")
}},function(){di.debug("Отсутствует COM-объект проверки лицензии КриптоПро по пути: "+fG)}).then(function(){var fJ=dh.$PFiles86,fH="cplicmgmt.dll",fI=[q(fJ,"Common Files\\Crypto Pro\\Shared\\"+fH),q(fJ,"Crypto Pro\\CSP\\"+fH),q(fJ,"Crypto Pro\\CSP\\cspmgmt.dll")];
return ej.each(fI,function(fK){return bN(fK).get("ev").then(function(fL,fM){if((fG!=fK)&&fL){di.debug("Нашли файл COM-объекта проверки лицензии КриптоПро по пути: "+fK+" (версия файла: "+fM+")");
return ej.$break()}return dC})})})}).caught()}function b4(fI){var fG=(fI&&fI.length>5)?fI.substr(0,5):"XXXXX",fH=(fI&&fI.length>11)?fI.substr(fI.length-5):"XXXXX";
return fG+"-*****-XXXXX-*****-"+fH}function e8(fG,fH){if(fw.csp36||fw.csp39||fw.csp40||fw.csp50){Y=fw.csp36;ad=fw.csp39;ah=fw.csp40;ak=fw.csp50;af=(ad||ah||ak)
}return e9(fG,fH,bM)}function b1(){return ej.resolve(f).lie(function(){f=S+"AppPath\\";return eI(cr,f+"accord.dll\\","",bM).caught(function(fG){F(fG);f=R+"App Paths\\";
return eI(cr,f+"cpcrypt.dll\\","",bM).caught(function(){f=dC})}).then(function(){return f})})}function cm(fJ){if(!fJ){return ej.thrown("options is null in getVersionAndLicense")
}var fL=fJ.productMask,fH=fJ.licType,fI=fJ.onGetVersion,fG=fJ.ignoreExpire,fN=fJ.warnExpire,fK=fH||"CSP",fM={lic:"no",licresult:2};if(fL){fM.ver=dC;fM.version="err";
fM.verresult=2}return ej.fork(!fL,fp,function(){return ch(fL).then(function(fO){fM.ver=fO;if(fI){fI(fO)}fM.version=fO||"not";fM.verresult=fO?0:(fJ.require?1:-1);
return fO},function(fO){di.debug("Ошибка определения версии КриптоПро "+fK,fO)})}).truth(function(){return ca({getExpireDate:function(){return b3(fH)},isInfinite:function(fO){return fO<=cs
},ignoreExpire:fG,warnExpire:fN}).then(function(fO){fM.lic=fO.diagValue;fM.licresult=fO.diagStatus})},function(){fM.lic="nocheck";fM.licresult=-1}).caught(function(fP){var fO=cA(fP);
fM.lic=fO?"not":"err";fM.licresult=(fG||(fO&&fN))?-1:1;di.debug("Ошибка определения лицензии КриптоПро "+fK,fP)}).then(fM)}function ci(fH,fG){var fI={licType:fH};
fI[fG?"ignoreExpire":"warnExpire"]=fp;return cm(fI)}var bK,bL;function fa(fG,fH){if(fH){bL=fw.expireOffSigLicenseDays=fG}else{bK=fw.expireCSPLicenseDays=fG
}}fa(365,bM);fa(365,fp);var ay=co.CSPInstallDir=function(){var fG;return cf(eg.CSP).then(function(fH){fG=fH;return bT(fG)}).lie(function(){return cf(eg.CSP,true).then(function(fH){fG=fH;
return bT(fG)})}).lie(function(){fG=O.buildPath(dh.$PFiles86,"Crypto Pro\\CSP\\");return bT(fG)}).lie(function(){var fH=[fw.licenseCSP36Guid,fw.licenseCSP39Guid,fw.licenseCSP40Guid];
return ej.each(fH,function(fI){return cd(O.HKLM,fI,"InstallLocation",true).then(function(fJ){return bT(fJ)}).truth(function(fJ,fK){fG=fK.path;return ej.$break()
}).caught()})}).then(function(){return fG})};co.runCryptoProPKI=function(){var fH=q(dh.$System32,"mmc.exe"),fG=q(dh.$ComPFiles,"CRYPTO PRO\\SHARED\\PKIMGMT.RU.MSC");
ej.all(bO(fH),bO(fG)).spread(function(fJ,fI){if(!fJ||!fI){return bM}return eW(fH,{args:'"'+fG+'"',show:fp,wsWait:bM}).waitRun().caught(function(){return eX("RunCSPLicensePKI",dC)
}).then(fp)}).caught(function(fI){di.debug("Ошибка входа в оснастку КриптоПро PKI (путь до MMC: "+fH+" , путь до CSPPki: "+fG+")",fI)}).lie(function(){di.fatal('Ошибка запуска оснастки КриптоПро PKI.\nПопробуйте зайти туда вручную через Панель управления => КриптоПро CSP, затем нажать на ссылку "КриптоПро PKI"')
});return bM};var aD=bM,aC=-1,aE=2,aF="LicErrorLevel";var aT=bM,dq=!(U||eY||eZ||fi||fw.etprfLocale||fw.ktbLocale),aS="err",aW=2,aY="warning_time_gen_2001",aZ="warning_time_sign_2001",aV=1.3177555200036e+17,aU=1.31775552003391e+17,aX=1.31907744e+17;
var dN=(d6&&d6.CadesCOM)||(!d6&&(h||C||bW||dG||ep||e5||fd||fs||fx)),t,u="err",s=2,v="err";var dW=d6&&d6.CSPPdf,a3,a7="err",a6=2,a4="no",a5=2,ed=bM,ee=bM,e=bM;
var d4=(d6&&d6.CSPOffSign)||(!d6&&ei&&(new RegExp("^uc$","i").test(ei))),a0,a2="err",a1=2,dH="no",dI=0,dJ=bM,dK=bM,dm=dC,dr=bM,fg="Лицензия успешно введена. ",dg=fg+"Срок действия - до ",ft=fg+"Срок действия не ограничен.";
function fb(fG,fH){return e9(fG,fH,fp)}function cc(fG){if(!fG){return ak?c1:(ah?c0:(Y?cY:cZ))}switch(fG){case df.EFS:return c2;case df.FKC:return c3;case df.NET:return c4;
case df.NETSDK:return c5;case df.OFFSIG:return dJ?c6:c7;case df.PDF:return ed?c9:da;case df.Rutoken:return dd;case df.UEC:return de;case df.OCSP:return R+"OCSPAPI";
case df.OCSP2:return R+"OCSPAPI\\2.0";case df.TSP:return R+"TSPAPI";case df.TSP2:return R+"TSPAPI\\2.0";case df.RP:return R+"RP";case df.RP2:return R+"RP\\2.0";
default:break}throw bF("Unknown licType = "+fG+" in getProductGuidByType",1)}function cb(fG,fH){var fI=dC;if(fG){if(cz(fG)){return cc(fG)}else{if(fG===df.OFFSIG){fI=(dJ||("1.0"===fH))?c6:c7
}else{fI=cc(fG)}}}else{if(("5.0"===fH)||(ak&&!fH)){fI=c1}else{if(("4.0"===fH)||(ah&&!fH)){fI=c0}else{if(("3.9"===fH)||(ad&&!fH)){fI=cZ}else{if(("3.6"===fH)||(Y&&!fH)){fI=cY
}}}}}if(fI){return dc+eS(fI)+db}throw bF("Can't read CSP license for (needVer = "+fH+")",1)}function e9(fG,fL,fH){fL=(fL||"").toUpperCase();fG.licenseresult="Ошибка ввода лицензии. Попробуйте еще раз.";
var fK="",fJ=dC,fI=fH?df.OFFSIG:dC,fM=(fL.length>4)&&fL.substr(2,2)||"";return ej.when(function(){if(fH){if((dJ&&("10"!==fM))||(dK&&("20"!==fM))){var fO={"10":"1.0","20":"2.0"}[fM];
if(fO){fG.licenseresult="Введена неподходящая лицензия. Переустановите КриптоПро Office Signature на версию "+fO+" или введите другую лицензию."}di.debug(fG.licenseresult);
return ej.result(bM)}}else{if("30"===fM){fG.licenseresult="Ввод лицензии КриптоПро CSP версии 3.0, сертификация ФСБ которой истекла 31 декабря 2012 года, не поддерживается.";
di.debug(fG.licenseresult);return ej.result(bM)}var fN=b6();if(((ah&&fN!==fL)||(ak&&fN!==fL&&bv!==fL))&&cQ()){fG.licenseresult="Ошибка ввода лицензии. Попробуйте еще раз. В соответствии с лицензионной политикой КриптоПро CSP, на серверных операционных системах необходимо вводить серверную лицензию."
}if((ak&&("40"!==fM&&"50"!==fM))||(ah&&("40"!==fM))||(ad&&("39"!==fM))||(Y&&("36"!==fM))){var fP=ak?"5.0":(ah?"4.0":(ad?"3.9":(Y?"3.6":"")));if(fP){fG.licenseresult="Введена неподходящая лицензия. Укажите серийный номер для КриптоПро CSP "+fP
}di.debug(fG.licenseresult);return ej.result(bM)}if(cx(fL)){fG.licenseresult="Введенная лицензия заблокирована.";di.debug("Серийный номер: "+b4(fL));di.debug(fG.licenseresult);
return ej.result(bM)}}return ej.all(function(){return es(fI)},function(){return b3(fI)}).spread(function(fR,fQ){fK=fR;fJ=fQ}).caught()}).then(function(){return fF(fL,fI).then(function(){return es(fI)
}).then(function(fN){if(fN!==fL){throw bF("Введенный серийный номер не сохранился в реестре",345)}})}).caught(function(fN){fN=ec(fN);return r.$getFreePath().then(function(fQ){var fP=fH?"SetOffSigLicense":"SetCSPLicense",fO=fP+' "'+fL+'" "'+fQ+'" "'+e7+'"';
return eX(fO,fp).then(function(fS){var fT=bM,fR=q(fQ,"diagCSPLicenseResult.log");return bO(fR).truth(function(fU,fV){return eq(fR,1251).then(function(fX){var fW=fX.split(new RegExp("\\r?\\n","g"));
if(fW&&fW.length>1){fG.licenseresult=(fW[1]||"").replace(" неограничен."," не ограничен.");di.debug("Прочитали файл с результатом ввода лицензии");if(fW[0].indexOf("OK")>=0){fT=fp;
fa(365,fH)}}}).anyway(function(){return fV.remove().caught()})},function(){if(!fS||fS.code){fG.licenseresult="Для продления лицензии необходимы права Администратора."
}else{di.debug("Не удалось прочитать файл с результатом ввода лицензии: "+fR)}}).then(function(){return ej.result(fT)})})}).caught(function(fO){fO=ec(fO);
try{fO.innerError=fN}catch(fP){}var fQ="Сбой проверки лицензии.";di.debug(fQ,fO);fG.licenseresult=fQ+' Установите лицензию вручную через <a href="#" onclick="window.SkbKontur.Help.runCryptoProPKI(); return false">КриптоПро PKI</a>.';
return ej.result(fp)})}).then(function(){return b3(fI).then(function(fO){var fN=fO.getTime()-e7;if(fO.getTime()<=cs){fG.licenseresult=ft;fa(365,fH);return ej.result(fp)
}else{if(fN<=0){fG.licenseresult="Введенная лицензия истекла "+bV(fO);throw dA}else{if(fJ&&!isNaN(fJ)&&fJ.getTime()>=fO.getTime()){fG.licenseresult="Лицензия, которая была введена ранее (сроком действия - до "+bV(fJ);
fG.licenseresult+="), такая же или актуальнее введенной в текущий момент (сроком действия - до "+bV(fO)+").";throw dA}else{fG.licenseresult=dg+bV(fO);fa(fk(fN),fH);
return ej.result(fp)}}}})}).caught(function(fN){fN=ec(fN);return ej.fork(fK&&fK.length,function(){var fO="КриптоПро "+(df[fI]||"CSP");return fF(fK,fI).then(function(){di.info("Успешно откатили назад лицензию "+fO)
},function(fQ){fQ=ec(fQ);try{fQ.innerError=fN}catch(fP){}di.debug("Ошибка отката лицензии",fQ);di.info("Не удалось откатить назад лицензию "+fO)})}).then(function(){return ej.result(bM)
})}).caughtReturn()}function b3(fI,fG){var fK=cc(fI),fL="Лицензия успешно получена с помощью COM-объекта CSP",fJ=dC,fH=dC;function fM(fN){if(fJ){di.debug("Ошибка определения лицензии КриптоПро",fJ)
}throw fN}return es(fI).then(function(fO){if(!fO){throw bF("License is null",2)}if(fO.length<25){throw bF("License.length = "+fO.length+" < 25",2)}if(!fI){var fN=ak?"50":(ah?"40":(ad?"39":(Y?"36":"No"))),fP=fO.substr(2,2);
if(fN!=fP){di.debug("Лицензия в реестре ("+fP+") не совпадает с версией КриптоПро CSP "+fN)}O.trackEvent("FoundCSP"+fN,"Lic"+fP)}}).caught(function(fP){if(!cA(fP)){return dC
}if(!fG){dj();if(!cD()&&!cn()){di.debug("Не найден номер КриптоПро "+(df[fI]||"CSP")+" в реестре. Записываем стандартный.",fP);var fO=b6(),fN=(function(){switch(fI){case df.EFS:return"EF10M1003000LR1W6QEB94ZW3";
case df.FKC:return"36360E003009F6K5A706LNLVH";case df.NET:return"HH10C-30030-00MHU-7ECNZ-4DNPE";case df.NETSDK:throw bF("NETSDK is unknown",1);case df.OFFSIG:return dJ?"0510ME003000PQUAK8P3EP2MR":"0520VD00300063Y7EQNV339UN";
case df.PDF:return ed?"PD14LQ003000ZDNPQWG3F8ZKY":"PD202L003000VXLW7657C3WEN";case df.Rutoken:return"36360R003009NWLW8LY5LT45Q";case df.UEC:return"36360U003001C97HQ92Y1EY1K";
case df.OCSP:return"0A1000001000CU4C6KZFW61MF";case df.OCSP2:return"0A202U003000ECWRRLMFUU2WK";case df.TSP:return"TA1000001000A7KC6HVLGT83Z";case df.TSP2:return"TA200G003000ECWRRLNEBTDVV";
case df.RP:return"RP1000001000M42W84Z4CQ43X";case df.RP2:return"RP2015003000Q18W66Y0N4NHF";default:return fO}})();return fF(fN,fI).then(function(){return b3(fI,fp)
},function(fQ){fJ=fP;fM(fQ)})}}return fM(fP)}).then(function(){var fN=fI||af;return Q(["CPCSPLicense","CPCSPLicense"],fp).then(function(fO){return fO.callAsync("GetExpireDate",[fK]).then(function(fP){fH=new Date(fP);
if(!fI){di.debug(fL+(ak?" 5.0":(ah?" 4.0":(Y?"+ЭЦП 3.6 R3/R4":" 3.9"))+" c GUID"))}},function(fP){fP=ec(fP);if(fN){throw fP}fJ=fP;return fO.callAsync("GetExpireDate").then(function(fQ){fH=new Date(fQ);
if(!fI){di.debug(fL+" 3.9/4.0 без GUID")}})}).lastly(fO.free)}).caught(function(fO){fO=ec(fO);return Q(["CPCSPLicence","CPCSPLicence"],fp).then(function(fP){return ej.when(function(){if(fN){throw fO
}return fP.callAsync("GetExpireDate").then(function(fQ){fH=new Date(fQ);if(!fI){di.debug(fL+" 3.6 R1/R2 без GUID")}})}).caught(function(fQ){fQ=ec(fQ);if(!fI){fJ=fQ
}return fP.callAsync("GetExpireDate",[fK]).then(function(fR){fH=new Date(fR);if(!fI){di.debug(fL+(ak?" 5.0":(ah?" 4.0":(Y?" 3.6":" 3.9"))+" c GUID"))}})
}).lastly(fP.free)}).caught(function(){try{fH=O.getKTObject("Crypto").getCryptoProLicense(fK);if(fH===undefined){throw bF()}}catch(fP){fH=b9().getCryptoProExpireDate(fK)*1000
}fH=new Date(fH);if(+fH){fH=+fH+fH.getTimezoneOffset()*60000}else{fH=-2209179600000}fH=new Date(fH)}).caught(function(){var fQ=bF("Ошибка определения лицензии КриптоПро",p);
try{var fP=b9()||O.getKTObject("Crypto");if(fP===null){fQ=fO}}catch(fR){fQ=fO}fM(fQ)})})}).then(function(){return fH})}var ba=bM,V=[],bg,eJ=0;var dV=d6&&d6.CSPNet,aK,aR="err",aN=2,aO,aQ="err",aP=2,aL="no",aM=2;
var dS=d6&&d6.CSPEfs,al,ap="err",ao=2,am="no",an=2;var d1=d6&&d6.CSPUec,bj,bn="err",bm=2,bk="no",bl=2;var dT=d6&&d6.CSPFkc,aq,av="err",au=2,ar="no",at=2;
var dZ=d6&&d6.CSPRutoken,bb,bf="err",be=2,bc="no",bd=2;var d3=d6&&d6.OCSPTSP,d5=fw.needCheckRP||aG||U,bE={lic:"not",licresult:-1},dE=bE,dF=bE,fq=bE,fr=bE,eU=bE,eV=bE;
var dX=!d6||d6.CSPRandom,en=[],eo=1,bS=bM,bX=983103,et=131072,er=131097;function F(fG){var fH=cu(fG);bS=bS||fH;return fH}var dY=!d6||d6.CSPReaders,a8=[],a9=1;
var dR=!d6||d6.CSPCarriers,z=[],B=1,bs="CryptoPro/CSPCarriers",x={},y={};fw.defaultTokenFolders=[7,15,9];function cl(fG){return fw.defaultTokenFolders[fG]||4
}function ck(fL){var fG=[],fJ=[10,10,1][fL],fK=["0","0","F"][fL];for(var fH=fJ,fI=fJ+cl(fL);fH<fI;++fH){fG.push((fH<16?fK:"")+fH.toString(16).toUpperCase()+"00")
}return fG.join("\\")}function bR(fN){var fL=["Rutoken","RutokenLite","ESMARTToken"][fN],fM=["Default","Default","64"][fN],fK=A+fL+"\\"+fM+"\\",fJ="Folders",fH=cl(fN),fG=ck(fN),fI=bM;
return eI(cr,fK,fJ,bM).then(function(fO){if(!fO||!fO.length){throw dA}fO=fO.split(fe).length;if(fO<fH){throw dA}di.debug("Уже было увеличено до "+fO);fI=fp
}).caught(function(){if(cn()||cD()){throw bF("UAC or User",5)}return eR(cr,fK,fJ,fG,bM).then(function(){return eI(cr,fK,fJ,bM)}).then(function(fO){fO=fO.split(fe).length;
di.info("Увеличено до "+fO);fI=(fO==fH)})}).caught(function(fQ){var fO=fQ,fP="Не удалось увеличить до "+fH;di.info("Альтернативный режим увеличения кол-ва контейнеров...");
return eX("FixCarrierToken "+fN+" "+fH,fp).then(function(fR){fI=fR&&!fR.code;if(!fI){di.debug(fP,fO);di.info(fP)}}).caught(function(fR){di.debug(fP,fO);
di.debug(fP,fR);di.info(fP)})}).then(function(){return fI})}var cV=bM,cU=1,dl=" ${MSIARGS}",d9=!d6||d6.SecurityProviders,e3="none",e4=0,d8=!d6||d6.SecurityPackages,d7=d8&&(cO&&!cI),e1="none",e2=0,dL="none",dM=-1,o=bM,dp=bM,n=bM,dt=bM,dP=!d6||d6.CryptoProPackages,bZ=2,bY=[],b0=[],dQ=!d6||d6.CryptoProPackages,ek=dC,el=0,fB="",fz="",fy=eD+"Cryptography\\OID\\EncodingType 1\\CryptMsgDllImportKeyTrans\\1.2.643.2.2.19",L=bM,K=bM,N=eD+"Cryptography\\OID\\EncodingType 0\\CryptDllFindOIDInfo\\1.2.643.2.1.3.2.1!1",dO=(d6&&d6.SupLegCS)||(!d6&&fs),bB,G="tls_client_disable_legacy_cipher_suites";
var d0=!d6||d6.CSPTest,bh="csp",bi=-1;return ej.all(O.$getLocator(),O.$getCache(),O.$getUserSID()).spread(function(fH,fG,fI){dh=fH;r=fG;fu=fI;cW=fv+fu+"\\KeyDevices\\"
}).then(function(){function fH(fI,fJ){return(fI.Name||"").toLowerCase().localeCompare((fJ.Name||"").toLowerCase())}function fG(fK,fJ){var fL=[],fM,fI;return ej.all(ay,b1).spread(function(fN){fI=fN;
return ex(cr,fK,bM)}).each(function(fQ){if(fQ.length<2){return dC}var fS=fK+fQ+"\\",fP={Name:fQ,DLL:""},fN=bM,fR=[],fO="";return ex(cr,fS,bM).each(function(fT){if("Default"===fT){fN=fp;
if(!fJ){return eG(cr,fS+fT+"\\","Level",bM).then(function(fU){fO=fU},function(fU){di.debug("Ошибка чтения параметра Level для ДСЧ "+fQ,fU)})}}else{if(fT&&(fT.length>2)&&("PNP"===fT.substr(0,3).toUpperCase())){fR.push("все")
}else{fT=(fT||"").replace(fQ,"");if("_"===fT.substr(0,1)){fT=fT.substr(1)}if(fT.length){fR.push(fT+((1==fT.length)?":":""))}}}return dC}).anyway(function(){var fU=dC,fT=dC;
return eI(cr,fS,"DLL",bM).then(function(fV){fU=fV;fT=q(fI,fU)||"";return ej.fork(f,function(){return eI(cr,f+fU+"\\","",bM)},dC).then(function(fW){fP.DLL=fW||"";
return ej.when(function(){return fW&&fW.length&&bO(fW)}).truth(function(){fP.DLL=(fT.toLowerCase()==fW.toLowerCase())?fU:fW},ej.thrown(dA))})}).caught(function(){return ej.when(function(){return fU&&fT&&bO(fT)
}).truth(function(){fP.DLL=fU})}).then(function(){return ej.fork(fJ,function(){fP.Readers=fR;return eG(cr,fS,"Group",bM).then(function(fV){fP.Group=(1==fV)?1:0
}).caught()},function(){fP.Level=fO}).then(function(){if(fN||(fJ&&fR.length)||("FAT12"===fQ)||("PCSC"===fQ)){fL.push(fP)}})})}).caught(function(fT){F(fT);
di.debug("Ошибка получения информации (путь: "+fK+fQ+")",fT)})}).then(function(){if(fL.length){fL=fL.sort(fJ?fH:function(fN,fO){var fP=(fN&&fN.Level||999)-(fO&&fO.Level||999);
return fP||fH(fN,fO)});fM=0}else{fL=("not"===bp)?"csp":"none";fM=("not"===bp)?-1:2}}).caught(function(fN){fM=2;di.debug("Ошибка перечисления считывателей или ДСЧ",fN);
fL=F(fN)?"deny":"err"}).then(function(){return[fL,fM]})}return ej.fork(d2||dU,function(){return ej.when(bq).then(function(){bp=fw.cspVersion;ax=fw.cspInstallDate;
dk=fw.manyCryptoProDetected;E(bp)}).then(function(){var fI=eg.ViPNetCSP;return ce(fI).truth(function(fJ){fz=fJ;return ej.all(cg(fI),ch(fI)).spread(function(fK,fL){fA=fK;
fB=fL}).fork(bp&&ax,function(){return eG(cr,P,"Force",bM).then(function(fK){aw=(1==fK)?1:0},function(fK){di.debug("Ошибка определения ключа форсирования КриптоПро",fK)
})})})}).caught(function(fI){di.debug("Ошибка определения информации о ViPNet CSP",fI)}).then(function(){fw.cspModeSelect=(aG||U||eY||eZ||fi||ct||ef||eb||fl||C);
az=!cB(bp);if(az){af=(ad||ah||ak);cV=(X||Y||af);aD=d2&&af;ba=(Y||af)&&(dR||dY||dX)}if(d2&&dq){if(az){aT=ak||(ah&&J(ai,bp))||(ad&&J("3.9.8423",bp))}else{eu();
aT=dy||dx||dv}}})}).fork(dU,function(){return ej.when(function(){if(!az){aA="no";aB=-1}else{if(!bp){di.error("Конфликт данных о версии КриптоПро (ver: "+bp+")");
throw dA}else{if(W&&cw){var fJ=function(){return Q(["Cpconfig","cpcspInfo"],fp).then(function(fK){return fK.getAsync("ExpiresIn").then(function(fL){aA=fL;
if(0===aA){aA="expire";aB=2}else{if(!aA){throw bF("csplicense is null",1)}else{if(-1==aA){aA="inf";aB=0}else{return ca({getExpireDate:function(){var fN=e6.getFullYear(),fM=e6.getMonth();
return new Date(fN,fM,e6.getDate()+aA+1)},isInfinite:function(fM){return fM<=cs}}).then(function(fM){aA=fM.diagValue;aB=fM.diagStatus})}}}return dC}).caught(function(){aA=fK.LicenseDescription
})})};return fJ().caught(function(){return ay().truth(function(fK){fK=q(fK,"cpconfig.cpl");return bO(fK)}).truth(function(fK,fL){var fM=q(dh.$System32,"regsvr32.exe");
return eW(fM,{args:'/s "'+fL.path+'"',wsWait:fp}).waitExit()},ej.thrown(dA)).then(fJ)})}else{if(Y||af){var fI=dC;return es(dC).then(function(fK){if(!fK||!fK.length){throw dA
}if(!cx(fK)){fI=fK;throw dA}aA="badinf";di.debug("Заблокированный серийный номер: "+b4(fK));aB=1;fw.foundBadCspLicense=1;return dC}).caught(function(){return ca({getExpireDate:function(){return b3(dC)
},isInfinite:function(fK){return fK<=cs}}).then(function(fK){aA=fK.diagValue;aB=fK.diagStatus;return dC})}).then(function(){var fU="SKBKontur\\",fK=!cD()&&!cn(),fT=fK?cr:cq,fS=fK?eC:eB,fM=eM+fU,fL="CSPLicense"+(ak?"50":(ah?"40":(ad?"39":(Y?"36":"")))),fO=b6(),fR=eM+((cr==fT&&cT)?eN:"")+fU,fP=fS+fR+fL,fN=new Date(aA),fQ=!fI||(fO===fI);
if(isNaN(fN)){fN=new Date();fN.setTime(aA)}if(!isNaN(fN)){if(e7&&(fN.getTime()<=e7)){fQ=fp}}return eI(fT,fM,fL,bM).caught(function(fV){if(!cA(fV)){di.debug("Ошибка чтения текущей лицензии КриптоПро CSP для копирования",fV)
}return dC}).then(function(fV){var fW=bM;if(!fV){if(fQ){return dC}fV=fI}else{fV=fV.toUpperCase();if(fV.indexOf(fO)>=0){fV=fV.replace(fO,"");fW=fp}if(fI&&fQ&&fV.indexOf(fI)>=0){fV=fV.replace(fI,"");
fW=fp}fV=fV.replace(new RegExp("(^;|;;|;$)","g"),"");if(!fQ&&(fV.indexOf(fI)<0)){fV+=";"+fI;fW=bM}else{if(!fW){if(!fQ){di.debug("Лицензия КриптоПро CSP уже была скопирована в ветку "+fP)
}return dC}}}return eR(fT,fM,fL,fV,bM).then(function(){if(!fW){di.debug("Лицензия КриптоПро CSP успешно скопирована в ветку "+fP)}},function(fX){di.debug("Ошибка копирования лицензии КриптоПро CSP в ветку "+fP,fX)
})}).caught()})}else{if(!az){aA="nocheck";aB=-1}else{aA="unimpl";aB=1}}}}}return dC}).caught(function(fI){aA=(cw||!bp)?"err":"plugins";aB=1;di.debug("Ошибка определения лицензии КриптоПро (ver: "+bp+")",fI)
})}).fork(function(){return aD},function(){return eG(cr,fc+"KeyDevices\\",aF,bM).then(function(fI){aC=fI},function(fI){if(cA(fI)){aC=0}else{di.error("Ошибка чтения параметра реестра "+aF+" в ветке КриптоПро",fI)
}}).then(function(){if((6==aC)||(0===aC&&("badinf"===aA||"inf"===aA))){aE=0}else{aE=1}})}).fork(function(){return aT},function(){var fI=ak||(ah&&!J(bp,aj))||(ad&&!J(bp,ag));
return ej.all(eH(cr,ea,aY,bM),eH(cr,ea,aZ,bM),fI?eH(cr,cW,aY,bM).caught(dC):dC,fI?eH(cr,cW,aZ,bM).caught(dC):dC).spread(function(fL,fM,fJ,fK){fL=fJ||fL;
fM=fK||fM;var fN=fL;if(fL>=aV&&fL<=aX){fN=fM}aS=fN.toString(16);aW=(fN>=aV&&fN<=aX)?0:1}).caught(function(fJ){if(cu(fJ)){aS="deny";aW=1}else{if(cA(fJ)){aS="not";
aW=1}else{di.error("Ошибка определения скрытия окон ГОСТ-2001",fJ);aS="unknown";aW=2}}})}).fork(dN,function(){return ch(eg.CadesCOM).then(function(fI){t=fI;
u=t||(fw.noSse2?"sse2":"not");s=t?0:(fw.noSse2?2:1)}).caught(function(fI){di.debug("Ошибка определения версии КриптоПро CADESCOM",fI)}).then(function(){return ej.fork(cC(),"system",function(){return eF(cq,R+"CAdESplugin\\","TrustedSites",bM)
}).then(function(fI){v=fI}).caught()})}).fork(d4,function(){return cm({productMask:eg.CSP_OffSign,onGetVersion:function(fJ){var fI=fJ&&(fJ.length>=3)&&fJ.substr(0,2)||"";
dJ=("1."===fI);dK=("2."===fI)},licType:df.OFFSIG,require:!U}).then(function(fM){a0=fM.ver;a2=fM.version;a1=fM.verresult;dH=fM.lic;dI=fM.licresult;var fK=eD+"Office\\",fL={"16.0":"2016","15.0":"2013","14.0":"2010","12.0":"2007","11.0":"2003"},fJ=["Common","Word","Excel","Access","PowerPoint"],fI=bM;
return ej.each(fL,function(fN){return ej.each(fJ,function(fO){var fP=fK+fN+"\\"+fO+"\\InstallRoot\\";return eI(cr,fP,"Path",cT).then(function(fQ){if(!fQ||!fQ.length){throw dA
}fI=cT;return fQ}).caught(function(){return cT?eI(cr,fP,"Path",bM):""}).truth(function(fT){var fR=("Common"===fO?"Office":fO),fS=fL[fN],fQ="Найден "+fR+" "+fS+" ("+fN+")";
return(fI?ej.resolve(fp):bT(fT)).truth(function(){di.debug(fQ+' в папке "'+fT+'"');dm="Microsoft "+fR+" "+fS;dr=("2016"===fS);return ej.$break(ej.$break())
},function(){di.debug(fQ+', но папка "'+fT+'" не существует')})}).caught()})})})}).then(function(){return ej.fork(ba,function(){var fP=Y&&J(bp,aa),fL=eM+"Crypto Pro",fM=R+"Settings",fO=fc+"Users",fN=fv+fu,fS=1,fQ="S-1-1-0",fT={systemFull:{required:bX,name:"system",sid:"S-1-5-18"},administratorsFull:{required:bX,name:"administrators",sid:"S-1-5-32-544"},usersRead:{required:er,name:"users",sid:"S-1-5-32-545"},userRead:{required:er,name:"user",sid:fu},userFull:{required:bX,name:"user",sid:fu},everyOneQuery:{required:fS,name:"everyone",sid:fQ},everyOneRead:{required:er,name:"everyone",sid:fQ}},fJ=[fT.systemFull,fT.administratorsFull],fR=fJ.concat([fT.usersRead,fT.userRead]),fU=[fT.systemFull,fT.userFull];
bg=[{path:fL,required:fp,rights:fR},{path:fM,required:fp,rights:fP?fJ.concat([fT.everyOneRead]):fR},{path:fM+"\\KeyDevices",required:bM,rights:fJ.concat([fT.everyOneQuery])},{path:fM+"\\Keys",required:bM,rights:fJ},{path:fO,required:fp,rights:fJ.concat([fT.everyOneRead])},{path:fN,required:fp,rights:fU},{path:fN+"\\KeyDevices",required:bM,rights:fU},{path:fN+"\\Keys",required:bM,rights:fU},{path:fN+"\\Random",required:bM,rights:fU}];
function fI(fV,fX){var fW=co.find(fV,function(fZ){return fZ&&(fZ.sid===fX.sid)});if(fW){var fY=fX.required;return(fY==(fY&(fW.allow&~fW.deny)))}return dC
}function fK(fV,fY,fX,fZ){try{bU(fY,function(f0){fZ[f0.name]=fp;var f1=fI(fV,f0);if(!f1){if(fQ!==f0.sid){var f2={sid:fQ,required:f0.required};f1=fI(fV,f2);
if(f1){fZ.everyone=fp;fZ[f0.name]=-1}}if(!f1){fZ[f0.name]=bM;if(!("user"===f0.name&&fX.indexOf("\\"+fu)<0)){fZ.status=2}}}})}catch(fW){di.error("Ошибка определения прав для КриптоПро CSP (путь: "+fX+")",fW);
fZ.status=2}return fZ}return ej.when(function(){if(!b9()){throw bF("Not KD",1)}return bg}).map(function(fV){var fW={path:fV.path,status:0,required:fV.required,everyone:-1,administrators:-1,system:-1,users:-1,user:-1};
return ez(cr,fV.path,bM).then(function(fX){return fK(b2(fX),fV.rights,fV.path,fW)}).caught(function(fY){var fX=cu(fY),fZ=cA(fY);fW.status=(fV.required&&fX)?1:((fX||fZ)?-1:0);
bU(fV.rights,function(f0){fW[f0.name]=1});di.debug("Ошибка получения прав на "+fV.path+" ",fY);return fW}).then(function(fX){fX.path=fX.path.replace(fu,"{%USER_SID%}");
eJ=(eJ<fX.status)?fX.status:eJ;return fX})}).then(function(fV){V=fV}).caught(function(fV){if(b9()){di.debug("Ошибка проверки прав КриптоПро CSP",fV)}else{V=eY?"ad":"kd";
eJ=-1}})})}).fork(dV,function(){return cm({productMask:eg.CSP_NET,licType:df.NET}).then(function(fI){aK=fI.ver;aR=aK||(az?"not":"csp");aN=fI.verresult;
aL=fI.lic;aM=fI.licresult;return ch(eg.CSP_NETSDK).then(function(fJ){aO=fJ;aQ=aO||(az?(aK?"not":"net"):"csp");aP=aO?0:-1},function(fJ){di.debug("Ошибка определения версии КриптоПро .NET SDK",fJ)
})})}).fork(dW,function(){return cm({productMask:eg.CSP_PDF,onGetVersion:function(fJ){var fI=fJ&&(fJ.length>=3)&&fJ.substr(0,2)||"";ed=("1."===fI);ee=("2."===fI)
},licType:df.PDF,require:!U}).then(function(fK){a3=fK.ver;a7=a3||(cL?"win2k":((W||X)?"csp36":"not"));a6=fK.verresult;if(a3){a6=0}else{if(cL||W||X){a6=2
}}a4=fK.lic;a5=fK.licresult;var fI=["Acrobat Reader","Adobe Acrobat"],fJ=["8.0","9.0","10.0","11.0","Beta","2015","DC"];return ej.each(fI,function(fL){return ej.each(fJ,function(fN){var fM=eM+"Adobe\\"+fL+"\\"+fN+"\\InstallPath\\";
return eI(cr,fM,"",bM).then(function(fO){return fO&&bT(fO)}).truth(function(){e=fp;return ej.$break(ej.$break(fp))}).caught()})},bM).lie(function(){a7="adobe";
a6=-1})})}).fork(dS,function(){return cm({productMask:eg.CSP_EFS,licType:df.EFS}).then(function(fI){al=fI.ver;ap=fI.version;ao=fI.verresult;am=fI.lic;an=fI.licresult
})}).fork(d1,function(){return cm({productMask:eg.CSP_UEC,licType:df.UEC}).then(function(fI){bj=fI.ver;bn=fI.version;bm=fI.verresult;bk=fI.lic;bl=fI.licresult
})}).fork(dT,function(){return cm({productMask:eg.CSP_FKC,licType:df.FKC}).then(function(fI){aq=fI.ver;av=fI.version;au=fI.verresult;ar=fI.lic;at=fI.licresult
})}).fork(dZ,function(){return cm({productMask:eg.CSP_RT,licType:df.Rutoken}).then(function(fI){bb=fI.ver;bf=fI.version;be=fI.verresult;bc=fI.lic;bd=fI.licresult
})}).fork(d3,function(){return ej.serial(ci(df.OCSP),ci(df.OCSP2),ci(df.TSP),ci(df.TSP2)).spread(function(fI,fJ,fK,fL){dE=fI;dF=fJ;fq=fK;fr=fL})}).fork(d5,function(){return ej.serial(ci(df.RP,fp),ci(df.RP2,fp)).spread(function(fI,fJ){eU=fI;
eV=fJ})}).fork(dX,function(){if("not"===bp){en="csp";eo=-1}else{return fG(em,bM).then(function(fI){en=fI[0];eo=fI[1]})}return dC}).fork(dY,function(){if("not"===bp){a8="csp";
a9=-1}else{return fG(bx,fp).then(function(fI){a8=fI[0];a9=fI[1];return ay()}).then(function(fI){if(!a8||!(a8 instanceof Array)||!a8.length){return dC}return ej.each(a8,function(fK){var fJ=fK.DLL;
return fJ?ej.all(bO(fJ),bO(fI+fJ)).spread(function(fM,fL){if(fM||fL){fK.dllExist=fp}}):dC})})}return dC}).fork(dR,function(){function fI(fJ){var fK=A+fJ+"\\";
return ex(cr,fK,bM).each(function(fM){var fN=dC,fO=fK+fM+"\\",fL=-1;return eI(cr,fO,"Name",bM).then(function(fP){fN=fP}).caught().then(function(){var fP=(fN||fJ)+("Default"===fM?"":", "+fM);
fN=("ESMARTTokenGOST"===fJ)?fP:(fN||fP);return eI(cr,fO,"Folders",bM).then(function(fQ){fL=fQ.split(fe).length})}).anyway(function(){fN=fm(bs,fN);z.push({Name:fN,MaxFolders:((fL>=0)?fL:"")})
})}).caught(function(fL){F(fL);di.error("Ошибка перечисления носителей "+fJ,fL)})}return ex(cr,A,bM).caught(function(fJ){if(!cA(fJ)){di.error("Ошибка перечисления Носителей ("+A+")",fJ)
}return[]}).each(function(fJ){if(fJ&&(fJ.length>1)){if(W){return ex(cr,A+fJ,bM).each(function(fK){if(fK&&(fK.length>1)){return fI(fJ+"\\"+fK)}return dC
}).caught()}else{return fI(fJ)}}return dC}).then(function(){if(!z||!z.length){z=("not"===bp)?"csp":"none";B=1;return}z=z.sort(fH);bU(z,function(fK,fJ){var fL=(fK&&fK.Name||"-").toLowerCase(),fN=({rutoken:1,rutokenlite:2,"esmart token 64k":3}[fL]||0)-1;
if(fN>=0){var fM=(2==fN)?"esmart":((1==fN)?"lite":"rutoken");y[fM]=fK.MaxFolders;x[fM]=bs+"/"+fJ+"/MaxFolders"}});B=(y.lite||y.rutoken)?0:1}).caught(function(fJ){di.debug("Ошибка анализа Носителей",fJ);
z=F(fJ)?"deny":"err";B=2})}).then(function(){return ej.fork(cV,function(){var fM="Provider\\",fN=eD+"Cryptography\\Defaults\\"+fM,fI=S+fM+"Crypto-Pro %s KC2 CSP\\",fK=S+fM+"Crypto-Pro %s KC3 CSP\\",fJ=fN+"Crypto-Pro GOST R 34.10-2001 KC2 CSP\\",fL=fN+"Crypto-Pro GOST R 34.10-2001 KC3 CSP\\";
return eG(cr,S,"KCLevel",bM).caught(0).then(function(fO){if(fO&&fO>=1&&fO<=3){return fO}return eG(cr,fI,"Type",cT).truth(2,0,fO).then(function(fP){if(2==fP){return fP
}return eG(cr,fK,"Type",cT).truth(3,0,fP).then(function(fQ){if(3==fQ){return fQ}return eG(cr,fJ,"Type",cT).truth(2,0,fQ).then(function(fR){if(2==fR){return fR
}return eG(cr,fL,"Type",cT).truth(3,0,fR)})})})}).then(function(fO){cU=fO||1})})}).fork(d9,function(){return eI(cr,fh+["Security","Providers\\"].join(""),"SecurityProviders",bM).then(function(fI){e3=fI.split(new RegExp(",?\\s","g"));
e4=(X&&(cU<2))?(fj("(^|\\s)cpssp\\.dll(\\s|$)","i")(fI)?0:2):-1}).caught(function(fI){e3="err";e4=1;di.error("Ошибка чтения SecurityProviders для КриптоПро",fI)
})}).fork(d8,function(){var fO="Security Packages",fP=["SYSTEM\\Contr","olSet001\\Control\\"].join(""),fL={cpssl:0,schannel:0,sspp:0},fJ={cpssl:0,schannel:0},fI=bM,fN=bM,fK=bM;
e1=[];function fM(fQ){return eF(cr,fh+fQ,fO,bM).tap(function(fR){if(!fR||!fR.length){throw dA}}).caught(function(){return eF(cr,fP+fQ,fO,bM)})}return O.getSecurityPackages().tap(function(){d7=bM
}).caught(function(){return ej.fork(d7,function(){dL=[];return fM("Lsa\\OSConfig\\").each(function(fR,fQ){dL[fQ]={Name:fR};fR=fo(fR).toLowerCase();fJ[fR]=(fJ[fR]||0)+1;
if(fJ[fR]>1){fK=fp}}).then(function(){if(dL.length){dM=fK?2:0}else{dL="none";dM=1}}).caught(function(fR){var fQ=cu(fR);dL=fQ?"deny":(cA(fR)?"notfound":"err");
dM=fQ?2:1;di.error("Ошибка чтения SecurityPackages из "+fh+"Lsa\\OSConfig для КриптоПро",fR)})}).then(function(){return fM("Lsa\\")})}).each(function(fR,fQ){e1[fQ]={Name:fR};
fR=fo(fR).toLowerCase();if(!cv(dL)&&('""'===fR)){fI=fp}fL[fR]=(fL[fR]||0)+1;if(fL[fR]>1){fN=fp}}).then(function(){var fR=(X&&(cU<2)),fS=(Y&&(cU<2)),fT=fS&&(ac===bp),fQ=(fS&&!fT)||(X&&(cU>1)),fV=ah&&J(aj,bp),fU=ad||(ah&&!fV),fW=(fL.cpssl>0)||(fJ.cpssl>0),fY=(fL.schannel>0),fX=fI||fY||(fJ.schannel>0);
dp=!fW&&(fQ||fT);n=fY&&fQ;dt=(!fX&&!az)||(!fX&&fR)||(!fX&&fU)||(!fX&&!fW&&fV);o=(fL.sspp>0)&&(fS||ad);if(e1.length){e2=(fN||dp||n||dt||o)?2:0}else{e1=dp?"nocpssl":(dt?"noschannel":"none");
e2=2}}).caught(function(fR){var fQ=cu(fR);e1=fQ?"deny":(cA(fR)?"notfound":"err");e2=fQ?2:1;di.error("Ошибка чтения SecurityPackages из "+fh+"Lsa для КриптоПро",fR)
})}).fork(dP,function(){var fR=fh+"Cryptography\\",fP=fR+"Configuration\\Local\\",fO=fP+"Default\\",fQ=fP+"SSL\\",fJ="Crypto-Pro Primitive Provider",fT=fR+"Providers\\"+fJ+"\\UM\\",fM=["GOST R 34.11-94"],fL=["GOST R 34.10-2001"],fI=Y&&J(bp,aa),fS="TLS_GOST_R_3410_01_WITH_28147_CNT_IMIT",fN=fI?[fS,"TLS_GOST_R_3410_94_WITH_28147_CNT_IMIT","TLS_GOST_R_3410_WITH_28147_LEGACY"]:[fS,"TLS_GOSTR341001_WITH_28147_CNT_IMIT"],fK=[{Type:"UM",Path:fT,Key:"00000002",Critical:0,Expected:fM},{Type:"UM",Path:fT,Key:"00000005",Critical:1,Expected:fL,MinVer:ab,MaxVer:ac},{Type:"UM",Path:fT,Key:"00010002",Critical:1,Expected:fN},{Type:"Local",Path:fO,Key:"00000002",Critical:0,Expected:fM,Provider:fJ,MinVer:ab},{Type:"SSL",Path:fQ,Key:"00010002",Critical:1,Expected:fN,Provider:fJ}];
return ej.fork(cF,function(){return ej.each(fK,function(fU){var fV=fU.Path+fU.Key+"\\";if(fU.MinVer&&!J(fU.MinVer,bp)){fU.Critical=0}if(fU.MaxVer&&!J(bp,fU.MaxVer)){fU.Critical=0
}return eF(cr,fV,"Functions",bM).caught(dC).then(function(fW){if(!fW||!fW.length){fW=[fU.Critical?"none":"unused"]}if(fU.Provider){var fX=[];return ej.each(fU.Expected,function(fY){return eF(cr,fV+fY+"\\","Providers",bM).then(function(fZ){fX=fX.concat(fZ)
}).caught()}).then(function(){return[fW,fX]})}return[fW,dC]}).spread(function(fZ,f0){if(!f0||!f0.length){f0=[fU.Provider?"none":"unused"]}bY.push({Type:fU.Type,Key:fU.Key,Functions:fZ,Providers:f0});
var fX=("unused"===fZ[0])||bJ(fU.Expected,function(f1){return M(fZ,f1)}),fY=("unused"===f0[0])||M(f0,fU.Provider),fW=fX&&fY;b0.push(fW);if(!fW){bZ=1}})
}).caught(function(fU){di.error("Ошибка чтения CryptoProPackages из CurrentControlSet для КриптоПро CSP",fU)})},function(){bZ=0})}).fork(dQ,function(){return ej.fork(cR,function(){return cj("SCardSvc").truth(function(fI){return fI.running
},bM,bM).truth(fp,function(){ek="scard";el=-1;return dC})},fp).truth(function(){var fI=O.getKTObject(),fK=dC;try{fK=fI?(fI.getPluginInfo()||{}).version:dC
}catch(fJ){}if(!fK){ek="nokt";el=1;return dC}return ej.resolve(fI.Crypto.getProvidersInfos()).map(function(fL){return{ID:fL.type,Name:fL.name}}).then(function(fL){if(fL.length){ek=fL;
el=0;return}ek="none";el=1})}).caught(function(fI){di.error("Ошибка сбора криптопровайдеров",fI);ek="err";el=2})}).fork(d2,function(){return ej.fork(Y||af,function(){return eI(cr,fy+"\\","Dll",bM).caught(dC).then(function(fI){L=fI&&(fI.toLowerCase().indexOf("itccsp")>=0)
})}).then(function(){return ej.all(ey(cr,N+"\\",bM).caught(dC),(cT?ey(cr,N+"\\",fp).caught(dC):dC)).spread(function(fI,fJ){if(fI!==dC||fJ!==dC){K=fp}})
})}).fork(dO,function(){return eG(cr,ea,G,bM).caught(bM).then(function(fI){bB=!!fI})})}).then(function(){function gr(gw){if(gw&&(gw.length>9)){return co.strToDate(gw)
}return gw}var gj=fw.profilesWithLicInside=fj("(^|=|\\/)(agent|archive|atol|bank|copycert|csp\\-license|crypto|diadoc|eias|er|fed|flash|fms|fst|fts|hotel|kb|kba|kbb|ke|kekep|kelite|ke1c|ke1c2|ke1c3|kemb|keweb|ofd|onlinereg|pnv|rar|rar16|rosreestr|rpn|s\\-crypto|sertum|shtrih|smart|test|ub|uc|viki|zakupki)(\\&|$)","i");
function gl(gw,gx){return Q(["WindowsInstaller","Installer"],fp).then(function(gy){return ej.serial(function(){return gy.getAsync("UILevel")},function(){return gy.setAsync("UILevel",[5])
},function(){return gy.callAsync("CollectUserInfo",[gw])}).spread(function(gz){gy.set("UILevel",[gz]);return fp},bM).lastly(function(){gy.free();gy=dC})
}).caught(function(gy){br("comDispatch*",gy);if(cw){return O.runTestEquipment("LicenseInstaller",{guid:gw,license:gx}).then(function(gz){return gz&&(gz.code===0)&&gz.result
})}return bM})}if(d2||dU){var fV=("not"===bp)?(cK?"win2016":(cH?"win10new":(cG?"win10":bp))):bp,fP=gr(ax);by.setValue("CryptoPro/CSPVersion",fV);if(cV){by.setValue("CryptoPro/CSPKCLevel",cU,(1==cU)?0:((2==cU||3==cU)?1:-1))
}by.setValue("CryptoPro/CSPInstallDate",cy(fP)?fP.getTime():fP);var f1="",fN=ax?0:1;if(ax){if(O.vars.lastboottime<=fP.getTime()){O.vars.CSPInstallNeedReboot=fp
}else{if(fz&&Y&&(I(ax,fz)>=0)&&(0===aw)){f1="vipnet";fN=1}}}by.setMessage("CryptoPro/CSPInstallDate",fN,f1);if(dU){by.setValue("CryptoPro/CSPLicense",aA)
}if(aD){by.setValue("CryptoPro/CSPLicLevel",aC)}if(aT&&af){by.setValue("CryptoPro/CSPNewGost",aS)}if(d2){var f0=1,fZ="",fG=!fi&&(cE||cQ()),fW="3.9R2",fX="4.0",fY="4.0R2",go,gd=(!az||ah||ak)?"|siteUrl":"|gost2012";
if(fG){go=fW+"|siteUrl"}else{if(cM||cJ){go=fX+gd}else{go=fY+gd}}if(bp&&bp.length&&("not"!==bp)&&("sse2"!==bp)){if(ak){f0=2;fZ="notCert|needReinst|"+go}else{if(fi&&az&&!J((cM||cJ)?ai:aj,bp)){f0=ah?1:2;
fZ="needUpd|"+go}else{if((cG||cK)&&((!ah&&!ak&&!J(ag,bp))||(ah&&!J(aj,bp)))){f0=(ai!==bp)?2:1;fZ="notSup|needUpd|"+((cK&&!ah&&!ak)?(fW+"|siteUrl"):(fY+gd))
}else{if(ah&&(aj===bp)&&(cM||cJ)){f0=2;fZ="notSup|needReinst|"+((cM||fi)?fX:fW);aJ=fp;aI="4.0 R2"}else{if(ah&&!J(bp,ai)&&!J(aj,bp)){f0=2;fZ="notCert|"+((cM||cJ)?("needReinst|"+fX):("needUpd|"+fY))+gd;
aJ=(cM||cJ);aI="4.0 R2 Beta"}else{if(ah&&!J(ai,bp)){f0=2;fZ="notCert|needUpd|"+((cM||cJ)?fX:fY)+gd}else{if(ad&&!J(bp,ae)&&!J(ag,bp)){f0=2;fZ="notCert|needUpd|"+go
}else{if(Y||ad){if(ac===bp&&cO){f0=2;fZ="notSup|needUpd|"+go}else{if(ab===bp){f0=2;fZ="err36R3|needUpd|"+go}else{if(aa===bp){f0=2;fZ="err36R2|needUpd|"+go
}else{if(cO&&!J(ac,bp)){f0=2;fZ="notCert|needUpd|"+go}else{if(J(ac,bp)){if(ad&&!J(ae,bp)){f0=2;fZ="notCert|needUpd|"+go}else{f0=0}}else{if(J(bo,bp)){f0=2;
fZ=(cP?"notSup":"notCert")+"|needUpd|"+go}else{f0=2;fZ="needUpd|"+go.replace("|siteUrl","|keUrl")}}}}}}}else{if(W||X){if(cF){f0=2;fZ="notSup|needUpd|"+go
}else{f0=2;fZ=(W?"err20":"err30")+"|needUpd|"+go}}else{f0=cB(bp)?-1:0}}}}}}}}}if(fw.noSse2&&ah){f0=2;fZ="sse2|needReinst|"+fW+"|siteUrl"}}if(!fZ||!fZ.length){if(dk){fZ="manycsp";
if(0===f0){f0=-1}}else{if(U&&(fE<503)&&af){fZ="expire";f0=Math.max(f0,1)}}}by.setMessage("CryptoPro/CSPVersion",f0,fZ)}if(aD){bA.addFix(new bQ("CryptoPro.CSPLicLevel",{message:fn("CryptoPro/CSPLicLevel"),script:1,priority:1,order:480,needadmin:1,dependency:["CryptoPro.CSP3X"],fix:function(gw){var gx=fc+"KeyDevices\\";
return eG(cr,gx,aF,bM).then(function(gy){return gy==6?ej.result(fp):dC}).anyway(function(){if(cn()||cD()){throw bF("UAC or User",5)}return eP(cr,gx,aF,6,bM).then(function(){return eG(cr,gx,aF,bM)
}).then(function(gy){if(6==gy){return fp}throw bF("Ошибка прописывания "+aF+" - значение осталось равным "+gy,31337)})}).caught(function(gy){di.debug("Альтернативный режим, потому что ошибка",gy);
return eX("FixCspLicErrorLevel",fp)}).caughtReturn().then(gw)},test:function(gx){var gw="";if(1==aE){gw="fix"}gx.setMessage("CryptoPro/CSPLicLevel",aE,gw);
return(1==aE)?1:0}}))}bA.addFix(new bQ("CryptoPro.CSPNewGost",{message:fn("CryptoPro/CSPNewGost"),script:1,priority:1,order:490,needadmin:1,dependency:["CryptoPro.CSP3X"],fix:function(gx){var gw=this;
function gy(gB,gA,gz){return eH(gB,gA,gz,bM).then(function(){return ew(gB,gA,gz,bM)}).then(function(){var gD=(cr==gB)?eC:eA,gC=(cW===gA)?"KeyDevices":"Parameters";
di.debug("Успешно удалили старое значение "+gz+" из ветки реестра "+gD+gC)}).caught()}return gy(cr,ea,aY).then(function(){return gy(cr,ea,aZ)}).fork(!cF||cn()||cD(),ej.thrown("WinXP or UAC or User",5)).then(function(){return eQ(cr,ea,aY,aU,bM)
}).then(function(){return eQ(cr,ea,aZ,aU,bM)}).timeout(300).then(function(){return ej.all(eH(cr,ea,aY,bM),eH(cr,ea,aZ,bM)).spread(function(gz,gA){if(gz<aV||gz>aX){throw bF("Ошибка прописывания "+aY+" - значение осталось "+gz,31337)
}if(gA<aV||gA>aX){throw bF("Ошибка прописывания "+aZ+" - значение осталось "+gA,31337)}di.debug("Успешно записали и проверили "+aY+" и "+aZ);return fp})
}).caught(function(gz){di.debug("Альтернативный режим, потому что ошибка",gz);return eX('FixNewGostDate "'+fu+'"',fp)}).caughtReturn().then(function(gz){if(!gz||gz.code){return gz
}gw.applicable=0;gw.run=gw.fix=gw.apply=function(gB){return gB?gB(fp):fp};var gA="VirtualStore\\MACHINE\\"+(cT?ea.replace(eM,eM+eN):ea);return gy(cr,cW,aY).then(function(){return gy(cr,cW,aZ)
}).then(function(){return gy(cp,gA,aY)}).then(function(){return gy(cp,gA,aZ)}).then(gz)}).then(gx)},available:!!aT,test:function(gx){var gy=aT&&(1==aW)&&("|deny|err|unknown|".indexOf("|"+aS+"|")<0),gw=gy?"fix":"";
if(aT&&af){gx.setMessage("CryptoPro/CSPNewGost",aW,gw)}return gy}}));if(dU){var gc=31,gb=89,gq=bM,f9=bM,f7=!J(bp,ab),f6=!J(bp,aa),f5=!J(bp,Z);if(W&&(aA!=Number(aA))){try{aA=new Date(aA).getTime();
fa(fk(aA-e7),bM)}catch(fO){di.debug("Ошибка преобразования срока лицензии CSP 2.0 в число",fO)}}if("inf"===aA){fa(998,bM)}else{if(aA==Number(aA)){var fM=new Date(aA);
fa(fk(aA-e7),bM);f9=(fM.getDate()==e6.getDate())||(0===fM.getHours());if((bK<=gc)||(dz&&(bK<gb))){gq=fp}}}var f8=(!ei||!ei.length||gj(ei)),fR=ak?"5.0":(ah?"4.0":(Y?("3.6"+(f7?" R4":(f6?" R3":(f5?" R2":"")))):"3.9")),fQ="Продление лицензии КриптоПро CSP "+fR;
fQ+=((bK>=0&&bK<gb)?(" ("+b5(bK,f9)+")"):"");bA.addFix(new bQ("CryptoPro.CSPLicense",{message:fQ,script:1,order:2840,needadmin:cC()?1:0,dependency:["CryptoPro.CSP3X"],excludes:["CryptoPro.CSP3XUpdate"],priority:0,license:"cspxx-39xxx-40xxx-xxxxx-xxxxx",checklicense:function(gx,gw){return e8(this,gx).then(gw)
},fix:function(gz,gx){var gw=this;if(fw.dontShowLicensePrompt){gw.license=dC}gw.runFromComment=gx&&gx.runFromComment;if(dn()&&fw.installerIsFunctioning){di.info("Ожидание ввода лицензии КриптоПро CSP...");
gw.license=dC;var gy=ak?c1:(ah?c0:(Y?cY:cZ));return gl(gy,gx&&gx.license).then(function(gA){gw.serial=dC;return ej.fork(gA,function(){return ca({getExpireDate:function(){b3(dC)
},isInfinite:function(gB){return gB<=cs}})},ej.thrown()).then(function(gB){aA=gB.diagValue;aB=gB.diagStatus;if("inf"===aA){gA=fp;gw.licenseresult=ft}else{gA=(fk(aA-e7)>bK);
gw.licenseresult=dg+bV(new Date(aA))}bA.getFixer().callEvent("onLicense",gA)}).caught(function(gB){di.debug("Ошибка CollectUserInfo",gB)}).then(function(){return gA
})}).then(gz)}return ej.when(gz,fp)},test:function(gz){var gw="",gx=(Y||af),gy=fw.hasPrivateCertsWithLicense;if(gx&&gq){if(!gy&&e0.Certificates&&(!D||D.MyCertsTree)){if(f8&&(aB>0)){aB=-1
}gw="wait"}else{if(1==gy){if(aB>0){aB=-1}gw="inside"}else{aB=(f8||(bK>0))?1:2;gw=f8?"enter":"fix"}}}gz.setMessage("CryptoPro/CSPLicense",aB,gw);return !f8&&gx&&(1!=gy)&&(bK<gb)
}}))}}if(dO){if(az){by.setValue("CryptoPro/SupLegCS",bB?"no":"yes")}bA.addFix(new bQ("CryptoPro.SupLegCS",{message:fn("CryptoPro/SupLegCS"),priority:0,needadmin:1,script:1,dependency:["CryptoPro.CSP3X"],needreboot:1,order:500,fix:function(gw){return ej.fork(cn()||cD(),function(){return eX("EnableLegacyCipherSuites",fp)
},function(){return eP(cr,ea,G,0,bM).then(fp,function(gx){di.error("Ошибка включения старых шифров КриптоПро CSP",gx);return bM})}).then(gw)},test:function(gx){var gw=(az&&bB)?"fix":"";
gx.setMessage("CryptoPro/SupLegCS",bB?1:0,gw);return !az||bB}}))}if(dN){by.setValue("CryptoPro/CadesCOM",u);by.setValue("CryptoPro/CadesSites",v||"not");
var fI=fn("CryptoPro/CadesCOM");bA.addFix(new bQ("CryptoPro.CadesCOM",{message:(t?d:a)+" "+fI,caption:fI,filename:"cadesplugin.exe",args:'-silent -norestart -cadesargs "/quiet /norestart /l*vx \\"${LOGFILE}\\" APPCONFLICT=IGNORE MSIRESTARTMANAGERCONTROL=Disable"',priority:(!d6&&dG)?0:1,order:1530,needadmin:1,tags:[bQ.Tags.MSI],checksign:1,needrestart:1,dependency:["Windows.InstallerVersion","Windows.FixTemp"],fix:function(gx){var gw=this;
return gw.apply(function(gB){try{var gA=bA.getFixer(),gy=gA?gA.getFix("Certificates.Capicom"):dC;gA.resetProgress(gy||gw);if(gy){gy.applicable=1;return gy.run(function(gC){gA.callEvent("onProgress",gy,gC);
if(gC&&!gC.code){gy.applicable=0;gy.run=gy.fix=gy.apply=function(gD){return gD?gD(fp):fp}}return gx(gB)})}}catch(gz){}return gx(gB)})},test:function(gx){var gw="";
if(1==s){s=2;if(fE<501){gw="winold"}else{if(cS&&(fD<3)){gw="winxp"}else{if(502==fE&&fD<2){gw="winxp64"}else{if(503==fE&&fD<2){gw="win2003"}else{if(600==fE&&fD<2){gw="vista"
}else{if(601==fE&&fD<2){gw="win2008"}else{s=1}}}}}}}else{if(t&&!J(eh.CadesCOMMin,t)){s=1;gw="upd"}}gx.setMessage("CryptoPro/CadesCOM",s,gw);return(1==s)
}}));var fL="https://www.cryptopro.ru",ge=["http://lkfl.nalog.ru","https://lkfl.nalog.ru","http://lkip.nalog.ru","https://lkip.nalog.ru","http://lkipgost.nalog.ru","https://lkipgost.nalog.ru","http://lkul.nalog.ru","https://lkul.nalog.ru","http://markirovka.nalog.ru","https://markirovka.nalog.ru"],gm=["http://sberbank-ast.ru","https://sberbank-ast.ru","http://login.sberbank-ast.ru","https://login.sberbank-ast.ru","http://utp.sberbank-ast.ru","https://utp.sberbank-ast.ru"],fJ={},gf=[];
if(dG||h||fd||fx){gf=gf.concat(ge)}else{if(U){gf=gf.concat(["http://cpca.cryptopro.ru","http://q.cryptopro.ru","http://vpnca.cryptopro.ru","https://cpca.cryptopro.ru","https://q.cryptopro.ru","https://vpnca.cryptopro.ru",fL])
}else{if(aG||eY){gf=gf.concat(["http://cpca.cryptopro.ru","https://cpca.cryptopro.ru",fL])}else{if(ep){gf=gf.concat(["https://service.alcolicenziat.ru",fL,"https://service.fsrar.ru","https://alko.kontur.ru","https://sverka.kontur.ru"]).concat(ge)
}else{if(eZ){gf=gf.concat(gm)}else{gf=gf.concat(["http://ausib.ru","http://www.b2b-avia.ru","http://www.b2b-center.ru","http://www.b2b-energo.ru","http://www.b2b-npk.ru","http://www.b2b-rusnano.ru","http://etp.bashzakaz.ru","https://portal4.cbr.ru",fL,"http://edata.customs.ru","http://edata2.customs.ru","https://edata.customs.ru","https://edata2.customs.ru","http://elpass.ru","https://elpass.ru","http://eltorg.org","http://estp.ru","https://estp.ru","http://www.fabrikant.ru","https://www.fabrikant.ru","https://portal.fedsfm.ru","https://lk.fssprus.ru","http://lk.fssprus.ru","http://www.gazneftetorg.ru","https://www.gazneftetorg.ru","https://etpgaz.gazprombank.ru","http://markirovka.goznak.ru","https://markirovka.goznak.ru","https://etp.gpb.ru","http://lot-online.ru","https://login.mos.ru","https://pgu.mos.ru"]).concat(ge).concat(["http://www.oborontorg.ru","https://www.oborontorg.ru","http://agro.otc.ru","https://agro.otc.ru","http://rts223.otc.ru","https://rts223.otc.ru","http://tender.otc.ru","https://tender.otc.ru","http://otc-tender.ru","http://www.picon.ru","https://www.picon.ru","http://pp1468.ru","https://pp1468.ru","https://178fz.roseltorg.ru","https://atom.roseltorg.ru","https://atom2.roseltorg.ru","https://com.roseltorg.ru","https://docs.roseltorg.ru","https://etp.roseltorg.ru","https://fsk.roseltorg.ru","https://opk.roseltorg.ru","https://rt.roseltorg.ru","https://rushydro.roseltorg.ru","https://russianpost.roseltorg.ru","https://vtb.roseltorg.ru","https://www.roseltorg.ru","https://rosreestr.ru","http://rts-tender.ru","https://app.rts-tender.ru","https://app-gost.rts-tender.ru","http://home.rts-tender.ru","https://home.rts-tender.ru","https://supplier-web.rts-tender.ru"]).concat(gm).concat(["https://etp.setonline.ru","http://www.sstorg.ru","https://www.sstorg.ru","http://zakupki.ugmk.com","https://zakupki.ugmk.com","http://www.vestnik-gosreg.ru","http://yamaltechenergo.ru:8888"])
}}}}}bA.addFix(new bQ("CryptoPro.CadesSites",{message:fn("CryptoPro/CadesSites"),script:1,priority:(!d6&&dG)?0:1,needadmin:0,order:1535,fix:function(gw){var gx=[];
bU(fJ,function(gy){gx.push(gy)});if(!gx.length){gx=gf}gx=gx.sort();return eO(cq,R+"CAdESplugin\\","TrustedSites",gx,bM).then(function(){return eF(cq,R+"CAdESplugin\\","TrustedSites",bM)
}).then(function(gy){var gA=gx.join(", "),gz=gy.join(", ");if(gA!=gz){throw bF("Список добавленных узлов отличается:\nхотели: "+gA+"\nполучили: "+gz,345)
}}).then(fp,function(gy){di.error("Ошибка записи списка надежных узлов КриптоПро ЭЦП",gy);return bM}).then(gw)},test:function(gx){if(cC()){gx.setMessage("CryptoPro/CadesSites",1);
return 0}if(v&&(v instanceof Array)&&v.length){fJ={};bU(v,function(gz){gz=fo(gz).toLowerCase();if("/"==gz.charAt(gz.length-1)){gz=gz.substr(0,gz.length-1)
}fJ[gz]=fp});var gy=bM;bU(gf,function(gz){if(!fJ[gz]){fJ[gz]=fp;gy=fp}});if(!gy){gx.setMessage("CryptoPro/CadesSites",0);return 0}}var gw=("err"!==v)?"fix":"";
gx.setMessage("CryptoPro/CadesSites",1,gw);return 1}}))}if(d4){by.setValue("CryptoPro/CSPOffSign",a2);by.setValue("CryptoPro/CSPOffSigLic",dH);var f2=bM,gh=fn("CryptoPro/CSPOffSign/2.0"),gg="CryptoProOfficeSignature20.exe",f4="Серийный номер лицензии можно найти на бланке с заголовком\\n«Лицензия на право использования программного продукта «КриптоПро Office Signature»";
bA.addFix(new bQ("CryptoPro.CSPOffSign"+(a0?"Update":""),{message:(a0?d:a)+" "+gh,caption:gh,filename:gg,args:'-silent -noreboot -args "/quiet /norestart /l*vx \\"${LOGFILE}\\"'+dl+'"',priority:0,order:1540,needadmin:1,needreboot:1,tags:[bQ.Tags.MSI],dependency:["Windows.InstallerVersion","CryptoPro.CSP3X","Windows.FixTemp"],excludes:(a0?["CryptoPro.CSPOffSigLic"]:[]),license:dB?dC:"cspof-fsigx-xxxxx-xxxxx-xxxxx",licensehint:dB?dC:f4,checklicense:dB?dC:function(gx,gw){return fb(this,gx).then(gw)
},fix:function(gy,gx){var gw=this;f2=fp;if(a0){gw.license=dC}gw.runFromComment=gx&&gx.runFromComment;if((1!=a1)&&("not"!==a2)){return gy(fp)}return gw.apply(function(gz){if(gz&&!gz.code&&dJ&&(gg===gw.filename)){dJ=bM;
dK=fp}return gy(gz)})},test:function(gz){var gw=this,gD=eh.CSP_Ofs10,gE=eh.CSP_Ofs20,gB=dJ&&!J(gD,a0),gC=dK&&!J(gE,a0),gx=dC;if(dr&&dJ){a1=1;gx="upd20|"+dm
}else{if(gC){a1=1;gx="fix20"}else{if(gB){a1=1;gh=fn("CryptoPro/CSPOffSign/1.0");gw.message=d+" "+gh;gw.caption=gh;var gy=gw.filename="CryptoProOfficeSignature10.exe";
gw.foreign=fw.distrPath+gy;gw.url=O.rootUrl+gw.foreign;gw.size=fw.productSizes[gy.toLowerCase()]||0;gx="fix10"}}}var gA=(1==a1)||("not"===a2);if(gA&&(!gx||!gx.length)){if(dm){gx="upd|"+dm
}else{gx="needoffice"}}gz.setMessage("CryptoPro/CSPOffSign",a1,gA?gx:dC);return(gA&&dm)?1:0}}));bA.addFix(new bQ("CryptoPro.CSPOffSigLic",{message:fn("CryptoPro/CSPOffSigLic"),script:1,order:1550,priority:(!dB&&(dI>1))?1:0,needadmin:1,dependency:["CryptoPro.CSPOffSign"],excludes:["CryptoPro.CSPOffSignUpdate"],license:"cspxx-offxx-sigxx-xxxxx-xxxxx",licensehint:dB?dC:f4,available:!dB,checklicense:function(gx,gw){return fb(this,gx).then(gw)
},setlicense:function(){return fb(this)},fix:function(gy,gx){var gw=this;if(f2){gw.license=dC}if(dn()&&fw.installerIsFunctioning){di.info("Ожидание ввода лицензии КриптоПро Office Signature...");
gw.license=dC;return gl(dJ?c6:c7,gx&&gx.license).then(function(gz){gw.serial=dC;return ej.when(function(){if(!gz){throw bF("runLicenseInstaller fails",1)
}return ca({getExpireDate:function(){return b3(df.OFFSIG)},isInfinite:function(gA){return gA<=cs}}).then(function(gA){dH=gA.diagValue;dI=gA.diagStatus;
if("inf"===dH){gw.licenseresult=ft;return fp}else{gw.licenseresult=dg+bV(new Date(dH));return(fk(dH-e7)>bL)}})}).caught(function(gA){di.debug("Ошибка CollectUserInfo",gA);
return gz}).then(gy)})}return ej.when(gy,fp)},test:function(gw){var gx=(dI>0)&&("err"!==dH);gw.setMessage("CryptoPro/CSPOffSigLic",dI,gx?"enter":"");return dB?0:gx
}}))}if(dV){by.setValue("CryptoPro/CSPNet",aR);by.setValue("CryptoPro/CSPNetSdk",aQ,aP);by.setValue("CryptoPro/CSPNetLic",aL,aM);var fS=fn("CryptoPro/CSPNet"),ga=" -lang "+((!H||1251==H)?"rus":"eng");
bA.addFix(new bQ("CryptoPro.CSPNet",{message:(aK?d:a)+" "+fS,caption:fS,filename:"cpNETSetup.exe",args:"-y -gm2 -! -nodlg -silent"+ga+' -noreboot -args "/quiet /norestart /l*vx \\"${LOGFILE}\\"'+dl+'"',priority:0,order:2015,needadmin:1,tags:[bQ.Tags.MSI],needrestart:Y?1:0,checksign:1,dependency:["Windows.InstallerVersion","CryptoPro.CSP3X","KonturExtern.NetFramework","Windows.FixTemp"],test:function(gx){var gw="";
if((2!=aN)&&aK&&!J(eh.CSP_NET,aK)){aN=1;gw="upd"}gx.setMessage("CryptoPro/CSPNet",aN,gw);return((1==aN)||("not"===aR))}}))}if(dW){by.setValue("CryptoPro/CSPPdf",a7);
by.setValue("CryptoPro/CSPPdfLic",a4,a5);var fT=fn("CryptoPro/CSPPdf");bA.addFix(new bQ("CryptoPro.CSPPdf",{message:(a3?d:a)+" "+fT,caption:fT,filename:"cppdfSetup.exe",args:'-y -gm2 -! -nodlg -silent -noreboot -args "/quiet /norestart /l*vx \\"${LOGFILE}\\"'+dl+'"',foreign:fw.cspPDFLink,priority:0,order:2020,needadmin:1,checksign:1,tags:[bQ.Tags.MSI],dependency:["Windows.InstallerVersion","CryptoPro.CSP3X","Windows.FixTemp"].concat(e?[]:["Adobe.AdobeReaderVersion"]),fix:function(gw){return this.apply(function(gx){if(gx&&!gx.code&&ed){ed=bM;
ee=fp}return gw(gx)})},test:function(gx){var gw="";if((2!=a6)&&a3&&!J(eh.CSP_PDF,a3)){a6=1;gw="upd"}gx.setMessage("CryptoPro/CSPPdf",a6,gw);return(1==a6)||("not"===a7)||("adobe"===a7)
}}))}if(dS){by.setValue("CryptoPro/CSPEfs",ap,ao);by.setValue("CryptoPro/CSPEfsLic",am,an)}if(d1){by.setValue("CryptoPro/CSPUec",bn,bm);by.setValue("CryptoPro/CSPUecLic",bk,bl)
}if(dT){by.setValue("CryptoPro/CSPFkc",av,au);by.setValue("CryptoPro/CSPFkcLic",ar,at)}if(dZ){by.setValue("CryptoPro/CSPRutoken",bf,be);by.setValue("CryptoPro/CSPRutokenLic",bc,bd)
}if(d3){by.setValue("CryptoPro/OCSPClient10",dE.lic,dE.licresult);by.setValue("CryptoPro/OCSPClient20",dF.lic,dF.licresult);by.setValue("CryptoPro/TSPClient10",fq.lic,fq.licresult);
by.setValue("CryptoPro/TSPClient20",fr.lic,fr.licresult)}if(d5){by.setValue("CryptoPro/RPLic10",eU.lic,eU.licresult);by.setValue("CryptoPro/RPLic20",eV.lic,eV.licresult)
}if(dY){by.setValue("CryptoPro/CSPReaders",a8);var fU={FAT12:["fat12.dll",X?"Дискеты":"Съемные диски"],PCSC:["pcsc.dll","Смарт-карты"],Registry:["reg.dll","Реестр"]};
bA.addFix(new bQ("CryptoPro.CSPReaders",{message:fn("CryptoPro/CSPReaders"),script:1,order:650,priority:1,needadmin:1,dependency:["CryptoPro.CSP3X"],fix:function(gw){return ej.when(function(){if(cn()||cD()){throw bF("UAC or User",5)
}var gx=bM;return ej.all(ay,b1).spread(function(gy){if(!gy||!(a8 instanceof Array)||!a8.length){di.error("Ошибка запуска настройки считывателей КриптоПро, путь в реестре: "+f+", путь до КриптоПро: "+gy+", кол-во считывателей: "+(a8&&a8.length||"NULL"));
return gx}gx=fp;return ej.each(fU,function(gB,gz){var gA=gz&&gz[0],gC="";return ej.when(function(){if(!f){throw dA}gC=f+gA+"\\";return eI(cr,gC,"",bM).then(function(gD){return gD&&bO(gD)
}).lie(ej.thrown())}).caught(function(){var gD=q(gy,gA);return ej.when(function(){return f&&bO(gD)}).truth(function(){return eR(cr,gC,"",gD,bM)}).caught(function(gE){di.error("Ошибка прописывания пути DLL для считывателя "+gB+", путь в реестре: "+(f+gA+"\\")+", путь DLL: "+gD,gE);
gx=bM})}).then(function(){gC=bx+gB+"\\";return eI(cr,gC,"DLL",bM).then(function(gD){if(gA.toLowerCase()!==(gD||"").toLowerCase()){throw dA}})}).caught(function(gD){gD=ec(gD);
return eR(cr,gC,"DLL",gA,bM).caught(function(gE){gE=ec(gE);try{gE.innerError=gD}catch(gF){}di.error("Ошибка прописывания DLL для считывателя "+gB+", путь в реестре: "+(gC+"DLL")+", путь DLL: "+gA,gE);
gx=bM})}).then(function(){var gD=("FAT12"===gB||"PCSC"===gB)?("PNP "+gB+"\\"):"",gE=gz[1];gC+=gD+"Default\\";return eR(cr,gC,"Name",gE,bM).caught(function(gF){di.error("Ошибка прописывания имени считывателя "+gB+", путь в реестре: "+gC+", имя: "+gE,gF);
gx=bM})})}).then(function(){return gx})})}).caught(function(gx){di.debug("Альтернативный способ исправления, т.к. произошла ошибка",gx);return eX("FixCSPReaders",fp)
}).then(gw)},test:function(gA){var gy="CryptoPro/CSPReaders",gz="";if(a8 instanceof Array){var gB=[],gx=0;bU(a8,function(gI){var gC=gI.Readers,gE=gI.DLL,gK=0,gJ=gI.Name,gD=fU[gJ],gF=gD&&gD[0]||"",gH=("PCSC"===gJ||"FAT12"===gJ);
if(gF){++gx}if(!gI.dllExist){gz="dllmiss";gK=2}else{if(gF&&(gE.toLowerCase()!==gF.toLowerCase())){gz="dlldiff";gK=2}else{if(!gC||!gC.length){if(gH){gz="dllfail";
gK=2}}else{var gL=gH&&(Y||af);if(gL||!gI.Group){var gG=gL?1:0;bU(gC,function(gM){if("все"===gM){gG=gL?0:1;return bM}return dC});if(gG){gK=Math.max(gK,gG);
if(gL){gz="dllnogroup"}else{gz="dllerr"}}}}}}if(a9<gK){a9=gK}gB.push(gK)});if((a9<1)&&(gx<dD(fU).length)){gz="dllpart";a9=2}var gw=(a9>0)?(gz||"fix"):"";
gA.setMessage(gy,a9,gw);bU(gB,function(gD,gC){gA.setMessage(gy+"/"+gC,gD)})}else{gz=(a9>0)?"fix":"";gA.setMessage(gy,a9,gz)}return(a9>0)}}))}if(dR){by.setValue(bs,z);
var gs="Увеличение макс. кол-ва контейнеров на ",gt=[{fixName:"CSPCarriers",tokenName:"Рутокенах",key:"rutoken"},{fixName:"CSPCarriersLite",tokenName:"Рутокенах Лайт",key:"lite"},{fixName:"CSPCarriersESmart",tokenName:"ESMART",key:"esmart"}];
bU(gt,function(gw,gy){var gx=gs+gw.tokenName,gz=gw.key;bA.addFix(new bQ("CryptoPro."+gw.fixName,{message:gx,script:1,priority:0,needadmin:1,dependency:["CryptoPro.CSP3X"],order:800+(gy*10),fix:function(gA){return bR(gy).then(gA)
},test:function(gC){var gA=this,gD=cl(gy),gB=y[gz];gA.caption=gA.message=gx+" до "+gD;if(gy<1){gC.setMessage(bs,B)}if(gB&&(gB>0)&&(gB<gD)){gC.setMessage(x[gz],1,"fix"+gz+gD);
return 1}return 0}}))})}if(dX){by.setValue("CryptoPro/CSPRandom",en);var fH="bio.dll",gk=1000;bA.addFix(new bQ("CryptoPro.CSPRandom",{message:fn("CryptoPro/CSPRandom"),script:1,priority:1,needadmin:1,dependency:["CryptoPro.CSP3X"],order:660,fix:function(gB){var gA="Level для Bio\\Default",gx=em+"Bio\\",gz="Default\\",gw=gx+gz,gC=Math.max(1,gk);
function gy(){return eG(cr,gw,"Level",bM).then(function(gD){return(gD>0&&gD<=gC)})}return gy().truth(function(){di.debug("Значение "+gA+" уже равно минимальному");
return ej.result(fp)}).anyway(function(){if(cn()||cD()){throw bF("UAC or User",5)}return eR(cr,gx,"","",bM).then(function(){return eI(cr,gx,"DLL",bM).then(function(gD){if(!gD||!gD.length||(gD.toLowerCase().indexOf(fH)<0)){return eR(cr,gx,"DLL",fH,bM)
}return dC})}).then(function(){return ej.all(eR(cr,gw,"","",bM),eP(cr,gw,"Level",1,bM))}).then(function(){return gy().lie(ej.thrown("CSPRandom Fix OK, but check failed"))
}).then(function(){if(gC<2){return ej.each(en,function(gD){var gF=gD.Name,gE=gD.Level,gG=em+gF+"\\"+gz;if(gF&&gF.length&&("bio"!==gF.toLowerCase())){if(gE>0){return eP(cr,gG,"Level",gE+1,bM)
}}return dC})}return dC}).then(fp)}).caught(function(gD){di.debug("Альтернативный способ исправления "+gA+", т.к. произошла ошибка",gD);return eX("FixCSPRandom",fp).then(function(gE){if(!gE||gE.code){di.debug("Ошибка исправления "+gA+" на 1");
return bM}return gy().lie(function(){di.debug("Попытались исправить, но значение "+gA+" не изменилось");return bM})})}).caughtReturn().then(gB)},test:function(gz){var gA=(0===eo)&&(en instanceof Array)&&en.length,gw=(gA||"none"===en)?"add":"",gy=bM;
if(gA){eo=1;var gx=dC;bU(en,function(gC){var gF=gC.Name,gD=gC.DLL,gE=gC.Level;if(gE&&(gE<gk)){gk=gE}if(gF&&gF.length&&("bio"===gF.toLowerCase())){gy=fp;
gw="fix";if(gD&&gD.length&&gD.toLowerCase().indexOf(fH)>=0){gw="enable";gx=gE}return bM}return dC});if(gk==gx){eo=0;gw=""}else{if(gx){gw="first"}}}var gB=(1==eo);
if((cU==2)||(cU==3)){gw="";if("none"===en){eo=1}else{if(gy){eo=1;gw="notcertified"}else{eo=0}}gB=bM}gz.setMessage("CryptoPro/CSPRandom",eo,gw);return gB?1:0
}}))}if(dR||dY||dX){by.setValue("CryptoPro/RegSettings",V.length?V:"none")}if(d9){by.setValue("CryptoPro/SecurityProviders",e3,e4)}if(d8){var gn="CryptoPro/SecurityPackages",gi="CryptoPro/SecPackOSConfig",gp=function(gx,gw){if(gx instanceof Array){bU(gx,function(gz,gy){var gA=fo(gz.Name).toLowerCase(),gB=-1;
if(o&&("sspp"===gA)){gB=2}else{if("schannel"===gA){gB=(!gw&&n)?2:0}else{if("cpssl"===gA){gB=az?0:2}else{if(""===gA){gB=1}}}}if(gB>=0){by.setMessage((gw?gi:gn)+"/"+gy,gB)
}})}};by.setValue(gn,e1,e2);gp(e1,bM);if(d7){by.setValue(gi,dL,dM);gp(dL,fp)}}if(dP){by.setValue("CryptoPro/CryptoProPackages",bZ?bY:"unused",(1==bZ)?1:0);
if(bZ){bU(b0,function(gw,gx){by.setMessage("CryptoPro/CryptoProPackages/"+gx,gw?0:1)})}}if(dQ){by.setValue("CryptoPro/CryptoProviders",ek,el)}bA.addFix(new bQ("CryptoPro.RegSettings",{message:fn("CryptoPro/RegSettings"),order:440,script:1,needadmin:1,priority:1,dependency:["Windows.KonturDiag"],fix:function(gx){var gy=dC;
function gw(gC,gD){var gB=dC,gA={};return ez(cr,gC,bM).then(function(gE){return ej.each(b2(gE),function(gF){gA[gF.sid]=gF.allow&~gF.deny})}).anyway(function(){return ej.each(gD,function(gF){var gE=gF.sid;
if((gE!==fu)||(gC.indexOf(fu)>=0)){return eK(cr,gC,gE,gF.required|(gA[gE]||0),bM).caught(function(gG){if(!gB){gB=ec(gG);gB.innerError=bF('regSetAccess(HKLM, "'+gC+'", "'+gE+'", '+gF.required+" | "+(gA[gE]||0)+")")
}})}return dC})}).then(function(){return eL(cr,gC,"S-1-5-32-544",bM).caught(function(gE){gE=ec(gE);return eE(cr,gC,"",bM).caught(function(){if(!gB){gB=gE;
gB.innerError=bF('regSetOwner(HKLM, "'+gC+'")')}})})}).then(function(){return ez(cr,gC,bM).then(function(gE){return ej.each(b2(gE),function(gF){if(gF.deny){var gG=et|gF.allow;
return eK(cr,gC,gF.sid,gG,bM).then(function(){gA[gF.sid]=gG}).caught()}return dC})}).caught(function(){var gE=["S-1-5-32-545","S-1-1-0","S-1-5-32-544","S-1-5-32-545",fu];
gB=null;return ej.each(gE,function(gH){var gF=bP(gD,function(gI){return gI&&(gH===gI.sid)}),gG=et|(gA[gH]||0)|(gF&&gF.required||0);return eK(cr,gC,gH,gG,bM).caught(function(gI){if(!gB){gB=ec(gI);
gB.innerError=bF('regSetAccess(HKLM, "'+gC+'", "'+gH+'", '+gG+")")}})})})}).then(function(){if(gB){throw gB}})}function gz(gA){return gw(gA.path,gA.rights).caught(function(gB){if((dC!==gy)&&!cA(gB)){di.error("Ошибка исправления прав на КриптоПро",gB);
gy=bM}})}return ej.each(bg,gz).then(function(){gy=fp;if(cn()||cD()){return eX('FixCryptoProRegSettings "'+fu+'"',fp)}return ej.each(bg,gz).then(function(){return gy
})}).then(gx)},test:function(){var gw=(eJ>0);by.setMessage("CryptoPro/RegSettings",eJ,gw?"fix-csp":"");return gw?1:0}}));function f3(gw,gx){return ej.serial(eL(cr,gw,"S-1-5-32-544",gx),function(){return eK(cr,gw,"S-1-5-32-544",bX,gx)
},function(){return eK(cr,gw,"S-1-5-18",bX,gx)},function(){return eK(cr,gw,"S-1-5-32-545",er,gx)}).then(function(){return ex(cr,gw,gx).each(function(gy){return f3(gw+gy+"\\",gx).lie(ej.$break())
})}).then(fp,function(gy){if(!gx&&(64==g)){gw=gw.replace(eM,eM+eN)}di.debug("Не удалось поправить права ветки реестра "+gw,gy);return bM})}bA.addFix(new bQ("CryptoPro.RegCryptography",{message:fn("CryptoPro/RegCryptography"),order:430,script:1,needadmin:1,priority:1,dependency:["Windows.KonturDiag"],fix:function(gw){return ej.when(function(){if(cD()||cn()||!b9()){throw dA
}return f3(T,bM).truth(function(){return 64!=g||f3(T,fp)}).truth(fp,ej.thrown())}).caught(function(){return bD(eT+bC,"cpfixit.exe",bC).truth(function(gB){var gz=bN(gB),gA=q(gz.folder,"cpfixit.log"),gx=dh.$Cmd,gy='/C "chcp 866 | "'+gB+'" -rights >"'+gA+'""';
di.debug('Запуск процесса "'+gx+'" '+gy);return eW(gx,{args:gy,wait:fp,admin:cD()||cn()}).waitExit().then(function(gC){return 0===gC.exitCode()},function(gC){di.debug("Ошибка запуска cpfixit.exe",gC);
return bM}).anyway(function(gC){return gz.remove().anyway(gC)})},bM)}).then(gw)},test:function(){return bS}}));function gu(gw){function gx(gA,gy,gz){return ev(gA,gy,gz).then(fp).caught(function(gB){return ej.fork(cA(gB),dC,function(){var gC=(cT&&!gz)?gy.replace(eM,eM+eN):gy;
di.debug("Ошибка удаления ветки реестра HKLM\\"+gC,gB);return ej.thrown(gB)})})}return ej.when(function(){return gx(cr,gw,bM)}).fork(cT,function(){return gx(cr,gw,fp)
})}if(d2){var gv="CryptoPro/VipNetCSPConflict";by.setValue(gv,L?"bad":"ok");bA.addFix(new bQ("CryptoPro.VipNetCSPConflict",{message:fn(gv),script:1,priority:1,dependency:["CryptoPro.CSP3X"],order:495,needadmin:1,needrestart:1,fix:function(gw){return ej.when(function(){if(cn()||cD()){throw bF("UAC or User",5)
}return ej.serial(eP(cr,P,"Force",1,bM).caught(),gu(fy),function(){return ff("CryptSvc",{restart:fp})})}).caught(function(gx){di.debug("Альтернативный вариант",gx);
return eX("FixVipNetCSPConflict",fp)}).then(gw)},test:function(gw){gw.setMessage(gv,L?2:0,L?"fix":"");return L?1:0}}));var fK="CryptoPro/ContinentApConflict";
by.setValue(fK,!K?"ok":az?"bad":"maybebad");bA.addFix(new bQ("CryptoPro.ContinentApConflict",{message:fn(fK),script:1,priority:(az?1:0),order:460,needadmin:1,needrestart:1,fix:function(gw){return ej.when(function(){if(cn()||cD()){throw bF("UAC or User",5)
}return ej.serial(gu(N),function(){return ff("CryptSvc",{restart:fp})})}).caught(function(gx){di.debug("Альтернативный вариант",gx);return eX("ContinentApConflict",fp)
}).then(gw)},test:function(gx){var gw=(K&&az)?"fix":"",gy=!K?0:az?2:1;gx.setMessage(fK,gy,gw);return K?1:0}}))}}).then(function(){var f6=O.uninstallAllByMask,fT=fw.cspModeSelect,f2=fT&&!az,f0=fw.needUpdateCSPVersion,f3=fw.productSizes,f4=fw.profilesWithLicInside,fM="CSP36R4Setup.exe",fN="CSP39Setup.exe",fP="CSP39SetupUpdate.exe",fO="CSP39R2Setup.exe",fQ="CSP40Setup.exe",fR="CSP40R2Setup.exe",fZ=" LICERRORLEVEL=6",fG="1CA7BE437239EFE8DEBCC10A3EA58A6B634241AAFFF071835D36F9137432517D",fH="BFBB247C118B744C1D1CF29CF399F0E7F97759A42B5859B1926D29DE139DD3E2",fJ="36734341E686920A9F60F511518B91F0E42DF33835332158409C4B998D03B724",fI="59D4D78684996C84CD1CC3FE77805EA6E319C98B6D1EE578310A09E4A77E85DE",fK="4DE411F63BEF8635EB12E0E91EBC7EB9799FE0637134F16278824F2744B51AF8",fL="86A2828B818135102723A88E97891CF919981CBAB035A12207C98A1ED36AD357",f1="onLicense",fY=(!ei||!ei.length||!f4||f4(ei)),fX=(aa==bp),fV=function(f7){if("string"==typeof(f7)){return document?document.getElementById(f7):null
}return f7};eu();var fU=(dy?"4.0R2":(dx?"4.0":(dv?"3.9R2":"3.9"))),fS=fn("CryptoPro/CSPVersion/"+(f2?"nover":fU));function f5(f7,f9,f8,ga){var gb=function(gs){if(bM===gs){return
}if(dC===gs){if(f9){f9.style.display="none"}if(fT&&!f7.serial){f7.license=dC}}var gi=bA.getFixer();gi.removeEventListener(f1,gb);if(ga){f7.checklicense=ga;
ga=dC;var gj=f7.filename,gq=(fR===gj),gr=(fQ===gj),go=(fO===gj),gp=(fN===gj)||(fP===gj),gn=(cL||cS)&&(gp||go||gr||gq),gm=!cN&&(gr||gq),gl=cO&&!(gp||go||gr||gq),gk=(cG||cK)&&!(go||gq);
if(gn||gm||gl||gk){var gc=fV("diag-fix-cm-continue"),gd=fV("diag-fix-cm-abort"),ge=fV("diag-fix-cm-confirm"),gh=fV("diag-fix-custommessage-"+gi.getFixId(f7.name)),gt=gk?"10 и 2016":(gl?"8.1 и 2012 R2":(gn?"XP":"XP/2003/Vista/2008")),gf=gq?"4.0 R2":(gr?"4.0":(go?"3.9 R2":(gp?"3.9":"3.6 R4"))),gg=function(){gc.disabled=false
};gd.checked=false;gd.onchange=gg;gd.onclick=gg;ge.checked=false;ge.onchange=gg;ge.onclick=gg;gc.disabled=true;gc.onclick=function(){gh.style.display="none";
gi.resetProgress(f7);f8(ge.checked)};fV("diag-fix-cm-cspver").innerHTML=gf;fV("diag-fix-cm-cspver2").innerHTML=gf;fV("diag-fix-cm-winver").innerHTML=gt;
gh.style.display="";di.info("Ожидание выбора пользователя...");return}}gi.resetProgress(f7);f8(fp)};return gb}function fW(){var f7="<b>ВНИМАНИЕ:</b><br/>\n";
f7+="В&nbsp;соответствии&nbsp;с&nbsp;";f7+='<a rel="nofollow noopener noreferrer" target="_blank" href="http://www.cryptopro.ru/products/csp/compare">эксплуатационной&nbsp;документацией</a><br/>';
f7+='сертифицированное СКЗИ КриптоПро CSP версии <span id="diag-fix-cm-cspver">3.9</span><br/>';f7+='не предназначено для функционирования в среде Windows <span id="diag-fix-cm-winver">XP</span>.<br/>';
f7+="<b>Выберите вариант:</b><br/>";f7+='<input type="radio" name="diag-fix-cm-select" id="diag-fix-cm-confirm" value="1" />';f7+='<label for="diag-fix-cm-confirm">';
f7+='Всё равно установить КриптоПро CSP версии <span id="diag-fix-cm-cspver2">3.9</span></label><br/>';f7+='<input type="radio" name="diag-fix-cm-select" id="diag-fix-cm-abort" value="0" />';
f7+='<label for="diag-fix-cm-abort">';f7+="Отложить установку КриптоПро CSP</label><br/>";f7+='<input type="button" id="diag-fix-cm-continue" value="Подтвердить выбор" disabled="disabled" />';
return f7}bA.addFix(new bQ("CryptoPro.CSP4XDelete",{message:c+" "+fn("CryptoPro/CSPVersion/nover")+" "+aI,order:450,priority:1,needadmin:1,needreboot:1,reinstallReboot:1,script:1,test:function(){return aJ
},fix:function(f7){return O.uninstall(c0,this.needadmin).truth(function(){if(co.View&&co.View.updateInstallOptions){co.View.updateInstallOptions({autorunAfterReboot:1})
}return fp}).then(f7)},excludesGenerator:function(){var f7=this;function gi(gl,gm,gk){var gj=co.filter(gm,function(gn){return !bJ(gl,function(go){return gk(gn,go)
})});return gl.concat(gj)}function gh(){var gj=arguments.length,gn=[];if(gj>2){var gl=arguments[gj-1];for(var gm=0;gm<gj-1;++gm){var gk=arguments[gm];if(cv(gk)&&gk.length){gn=gi(gn,gk,gl)
}}}return gn}function ge(gj,gk){return gj===gk}function gg(gj){var gk=[];bU(gj,function(gl){gk.push(gl.name)});return gk}var gf=bA.getFixer(),gb=gg(gf.getAffectedFixes("CryptoPro.CSP3X")),gc=gg(gf.getAffectedFixes("CryptoPro.CSP3XUpdate")),gd=gg(gf.getAffectedFixes("CryptoPro.CSPLicense")),f9=gf.getFix("CryptoPro.CSP3X")||gf.getFix("CryptoPro.CSP3XUpdate"),ga=f9&&f9.excludes||[],f8=gh(gb,gc,ga,gd,ge);
if(f8&&f8.length){bU(f8,function(gk){var gj=gf.getFix(gk);if(gj&&cv(gj.excludes)&&gj.excludes.length){gj.excludes=gh(gj.excludes,[f7.name],ge)}else{gj.excludes=[f7.name]
}});if(cv(f7.excludes)&&f7.excludes.length){f7.excludes=gh(f7.excludes,f8,ge)}else{f7.excludes=f8}}return null}}));bA.addFix(new bQ("CryptoPro.CSP3X"+(az?"Update":""),{message:(az?d:a)+" "+fS,caption:fS,filename:dy?fR:(dx?fQ:(dv?fO:(dw?fP:fN))),order:470,priority:(fw.kbaLocale||fw.kbbLocale||(az&&fw.archiveLocale)||(az&&(bK>60)&&fT))?0:1,needadmin:1,needreboot:1,tags:[bQ.Tags.MSI],checksign:dy?fL:(dx?fK:(dv?fI:(dw?fJ:fH))),dependency:["Windows.InstallerVersion","Windows.FixTemp","Certificates.Capicom","CryptoPro.RegSettings","CryptoPro.RegCryptography","CryptoPro.ContinentApConflict"],excludes:az?["CryptoPro.CSPLicense"]:[],license:fY?null:"cspxx-39xxx-39r2x-40xxx-xxxxx",licenselater:f2?1:0,checklicense:fY?null:function(f8,f7){return e8(this,f8).then(f7)
},custommessage:!f2?null:fW(),prefix:!f2?null:function(f9,f8){var f7=this,ga=fV("diag-fix-lic-"+f7.license);if(!ga){f8(true);return}ga.style.display="";
di.info("Ожидание ввода серийного номера КриптоПро CSP...");var gb=f7.checklicense;f7.checklicense=function(gf,gd){var ge=bM;if(gf&&(gf.length>3)){var gc=gf.substr(2,2);
if(cx(gf)){f7.licenseresult="Введенная лицензия заблокирована.";di.debug("Серийный номер: "+b4(gf));di.debug(f7.licenseresult)}else{if("40"===gc){if(fw.noSse2){f7.licenseresult='Введен серийный номер для КриптоПро CSP 4.0. Процессор вашего компьютера не совместим c этой программой. Введите серийный номер для другой версии КриптоПро CSP или нажмите "Ввести позже"';
di.debug("Серийный номер: "+b4(gf));di.debug(f7.licenseresult)}else{eu(gc);if(dy){E(aj);f7.filename=fR;f7.checksign=fL}else{E(ai);f7.filename=fQ;f7.checksign=fK
}f7.foreign=bC+f7.filename;f7.size=f3[f7.filename.toLowerCase()]||0;f7.url=O.rootUrl+f7.foreign;f7.serial=gf;ge=dC}}else{if("39"===gc){eu(gc);if(dv){E(ag);
f7.filename=fO;f7.checksign=fI}else{E(ae);f7.filename=dw?fP:fN;f7.checksign=dw?fJ:fH}f7.foreign=bC+f7.filename;f7.size=f3[f7.filename.toLowerCase()]||0;
f7.url=O.rootUrl+f7.foreign;f7.serial=gf;ge=dC}else{if("36"===gc){if(cO){f7.licenseresult="Установка КриптоПро CSP версии 3.6 на Windows 8.1 и выше не поддерживается."
}else{eu(gc);E(ac);f7.filename=fM;f7.checksign=fG;f7.foreign=bC+f7.filename;f7.size=f3[f7.filename.toLowerCase()]||0;f7.url=O.rootUrl+f7.foreign;f7.serial=gf;
ge=dC}}else{if("30"===gc){f7.licenseresult="Установка несертифицированной версии КриптоПро CSP 3.0 не поддерживается."}else{f7.licenseresult="Введен некорректный серийный номер."
}}}}}}return gd?gd(ge):ge};bA.getFixer().addEventListener(f1,f5(f7,ga,f8,gb))},fix:function(f9){var f7=this;var f8=fV("diag-fix-status-"+bA.getFixer().getFixId(f7.name));
if(f8){f8.className="diag-fix-status-progress"}return ej.when(function(){return eI(cr,S,"WLProductID",bM).then(function(ga){if(ga&&!fj("^W[LS]\\w{3}(\\-?\\w{5}){4}","i")(ga)){return" WLPIDKEY=WS109H001000ZDKC6TBV9QZYF"
}return""},"")}).then(function(ga){if(fw.foundBadCspLicense||((dy||dx)&&cQ())){return["",ga]}return es(dC,(dy||dx)?"4.0":((dv||dw||du)?"3.9":"3.6")).then(function(gc){var gb=(dy||dx)?"40":((dv||dw||du)?"39":"36");
if(gc&&(25==gc.length)&&(bt!==gc)&&(bu!==gc)&&(bv!==gc)&&!fj("0{20,}")(gc)&&(gb===gc.substr(2,2))){return" PIDKEY="+gc}return""},"").then(function(gb){return[gb,ga]
})}).spread(function(gf,gi){if(az){f7.license=dC}var gg="Загрузка и установка "+f7.caption+"...",ge=" -lang "+((!H||1251==H)?"rus":"eng"),gd=(dy||dx||dv||dw),ga="-y -gm2 -!";
ga+=(ak||ah||gd)?" -nodlg":"";ga+=(gd||!du)?" -silent":"";ga+=(az?"":(ge+" -kc kc1"));ga+=(gd||du)?" -noreboot":"";ga+=' -args "/quiet /norestart /l*vx \\"${LOGFILE}\\"';
ga+=" REGREGISTRY=1 VIPNETFOUND=1"+gf+gi;ga+=(gd||du)?fZ:"";ga+=dl+'"';f7.args=ga;di.info(gg);function gc(gm){if(!gm||!dq||("deny"===aS)||!(dy||dx||dv)){return f9(gm)
}var gk=bA.getFixer(),gl="CryptoPro.CSPNewGost",gj=gk.getFix(gl);if(!gj){di.debug('Не нашли фикс "'+gl+'" для его применения после установки CSP');return f9(gm)
}if(gj.applicable){return f9(gm)}di.debug('Применяем фикс "'+gl+'" после установки CSP');gj.applicable=1;return gj.run(function(gn){if(gn&&!gn.code){gj.applicable=0;
gj.run=gj.fix=gj.apply=function(go){return go?go(fp):fp}}return f9(gm)})}function gb(){return ch(eg.CSP,fp).caught(function(gj){di.error("Ошибка проверки версии КриптоПро CSP",gj);
return dC}).then(function(gj){if(gj&&!J(gj,bp)){return fp}di.debug("Ошибка проверки успешности установки/обновления КриптоПро CSP, версия до: "+bp+", после: "+gj);
return bM}).then(gc)}function gh(gm){if(!gm||gm.code){return f9(gm)}E(dy?aj:(dx?ai:(dv?ag:((dw||du)?ae:ac))));if(fY){try{var gl=new Date(b3(dC)).getTime();
if(gl<=-2200000000000){f7.license=dC}else{var go=fk(gl-e7);if(go>=58){f7.license=dC}}}catch(gj){di.debug("Не удалось проверить лицензию КриптоПро CSP после установки",gj)
}}fw.dontShowLicensePrompt=fp;if(ak||ah||ad||gd||du){var gk=bA.getFixer(),gn=gk.getFix("Rutoken.RutokenSupport");if(!gn){return gb()}if(gn.applicable){di.debug('Отключение установки "Модуля поддержки Рутокен", т.к. он не нужен для КриптоПро CSP 3.9 и выше')
}gn.applicable=0;gn.run=gn.fix=gn.apply=function(gp){return gp?gp(fp):fp}}return gb()}return f6(eg.RutokenSupport,f7.needadmin).then(function(){return f7.apply(gh)
})})},test:function(ga){if(!bp||("err"===bp)||aJ){return 0}var gb="CryptoPro/CSPVersion",f8=fw.foundBadOtherCSP,f9=fX&&cS,f7=this;if(f8){ga.setMessage(gb,2,"othercsp|"+f8);
di.debug("Найден(ы) установленны(е) "+f8+", отключили установку КриптоПро CSP");return 0}if("not"===bp||"sse2"===bp){if(fw.foundCspCont20){ga.setMessage(gb,1,"oldconts")
}return 1}if(fw.foundCspCont20&&!dy&&!dx&&!dv&&(!Y||f9)){if(fX){ga.setMessage(gb,0,"old36r2")}else{ga.setMessage(gb,1,"oldconts")}return 0}if(fw.foundBadCspLicense&&(ak||ah||(ad&&!dy&&!dx))){di.debug("Обновление КриптоПро CSP 3.9 и 4.0 с нелегальной лицензией запрещено");
return 0}if(ak){return 0}if(ah){if(J(aj,bp)){return 0}if(!dy&&J(ai,bp)){return 0}}if(ad&&!dx&&!dy){if(J(ag,bp)){return 0}if(!dv&&J(ae,bp)){return 0}}if(Y&&!J(bo,bp)){di.debug("Версия КриптоПро CSP "+bp+" ниже "+bo+", поддерживающей обновление");
return 0}if(!W&&!X&&!Y&&!af){di.debug("Версия КриптоПро CSP "+bp+" не поддерживает обновление до новой версии");return 0}if((W||X)&&!cF&&!f0){di.debug("Найдена КриптоПро CSP 2.0/3.0 на Windows XP/2003 - включаем необязательность");
f7.priority=0}else{if(bK>=998){if((ad&&(dw||dv))||(ah&&(dx||dy))){di.debug("Найдена КриптоПро CSP с неограниченной лицензией, но перехода на другую версию не происходит - не включаем необязательность")
}else{di.debug("Найдена КриптоПро CSP с неограниченной лицензией - включаем необязательность");f7.priority=0}}}if(dU&&!W&&!X&&!f7.prefix&&(bK<=0)&&!fY&&f7.license){f7.licenselater=1;
f7.prefix=function(gc,gd){var ge=document.getElementById("diag-fix-lic-"+f7.license);if(!ge){gd(fp);return}ge.style.display="";di.info("Ожидание ввода серийного номера КриптоПро CSP...");
bA.getFixer().addEventListener(f1,f5(f7,ge,gd,dC))}}return 1}}))}).then(function(){return ej.fork(d0&&az,function(){bh="err";bi=2;var fK=dC,fH="-noerrorwait -tlsc -server ",fL=" -port 443 -v -file /",fG="auth.kontur.ru",fJ="cpca.cryptopro.ru",fN="kopf.kontur.ru",fI="Веб-сервер Центра Регистрации УЦ КРИПТО-ПРО",fM="Kontur.Otchet PF",fO=eZ?["sberbank-ast.ru",fJ]:((h||aG||U||eY||fd||fi||fx)?["cryptopro.ru",fJ]:[fG,bH?"evrika.kontur.ru":fN]);
if(J(aa,bp)){fL=" -nosave"+fL}return ay().truth(function(fP){return q(fP,"csptest.exe")}).then(function(fP){fK=fP;return bO(fK)}).lie(function(){if(W){bh="csp20";
bi=1}else{bh="notfound";bi=2}return ej.result(fp)}).fork(dk,function(){bh="manycsp";bi=2;return ej.result(fp)}).then(function(){bh=[];bi=[];return fO}).each(function(fX,fU){var fR=new Date().getTime(),fV=(fX==fJ)?" -nocheck":"",fP=fH+fX+fV+fL,fW={testName:"CryptoPro",chcp:1251};
function fQ(f6){if(dC===f6){return ej.timeout(10,ej.next(bM))}var f0=new Date().getTime()-fR,f5=b8(f6,(fJ==fX)?fI:fX,(fN==fX)?fM:null),f1=f5.ErrorNumber,f4=f5.SkipError,f3=(0===f1)||(f1>=200&&f1<=599),f2=f3&&f5.isHandshake&&f5.isCN&&f5.isIssuer&&f5.isValidFrom&&f5.isValidTo;
bh[fU]={Server:fX,Status:f4?"skip":(f2?"success":"fail"),Reply:f5.ReplyStatus||"",Time:f0,Data:fo(f6)};if(f5.isCN&&!f5.isIssuer){fw.cspTestFoundFakeIssuer=1
}bi[fU]=f4?-1:(f2?0:2);if((f4||!f3)&&fw.CSPInstallNeedReboot){if(M(ds,f1)){by.setMessage("CryptoPro/CSPInstallDate",2,"reboot")}}return ej.timeout(10,ej.next(fp))
}function fY(){return bI(fK,fP,fW).then(fQ)}var fS="https://"+fX+":443/",fZ=5000,fT=0;return ej.promisify(function(f1,f0){b9().testServerConnection(fS,fT,fZ,O.createCallback(function(f4){try{var f2=f4.certificateInfo||{};
f1(f4.errorCode,f4.serverIP,f4.headers||"",{subject:f2.subject,validFrom:f2.validFrom,validTo:f2.validTo,issuer:f2.issuer})}catch(f3){br("callback in testServerConnection('"+fS+"', "+fT+", "+fZ+")",f3);
f0(f3)}}),0)}).then(function(f7,f9,f8,f0){var f2=[];f2.push("Handshake was successful");f2.push(" ");f2.push("Server certificate:");f2.push("Subject: "+(f0.subject||"unknown"));
var gb=f0.validFrom,gc=f0.validTo,f3,f5,f4,f6;if(gb&&gc){f3=new Date(gb*1000);f3.setMinutes(f3.getMinutes()+f3.getTimezoneOffset());f5=bV(f3);f4=new Date(gc*1000);
f4.setMinutes(f4.getMinutes()+f4.getTimezoneOffset());f6=bV(f4);f2.push("Valid  : "+f5+" - "+f6+" (UTC)")}f2.push("Issuer : "+(f0.issuer||"unknown"));f2.push("Server IP: "+(f9||"unknown"));
f2.push(" ");f2.push("HTTP request: GET / HTTP/1.1");f2.push("Host: "+fX);f2.push("Connection: close");f2.push(" ");var ga=f8&&(f8.length>12)&&Number(f8.substr(9,3));
if(ga&&ga>=200&&ga!=400&&ga<=405){ga=0}f2.push("Reply status: "+f8);var f1=ga||f7||(("undefined"===typeof(ga))?555:0);f2.push("[ErrorCode: "+O.intToHex(f1)+"]");
return fQ(f2.join("\r\n"))}).caught(function(f0){br("testServerConnection('"+fS+"', "+fT+", "+fZ+", callback)",f0);return fY()})}).caughtReturn()},fp)}).then(function(fJ){if(d0){var fI="CryptoPro/CSPTest";
by.setValue(fI,bh);var fH=-1,fG="";if(fw.cspTestFoundFakeIssuer){fH=2;fG="gost"}if(bi instanceof Array){bU(bi,function(fK){fH=Math.max(fH,fK)});by.setMessage(fI,fH,fG);
bU(bi,function(fK,fL){by.setMessage(fI+"/"+fL+"/Server",fK)})}else{by.setMessage(fI,(-1==fH)?bi:fH,fG)}}return fJ})};if(!window.SkbKontur){window.SkbKontur={}
}if(!window.SkbKontur.Help){window.SkbKontur.Help={}}window.SkbKontur.Help.Scripts.Rutoken=function(L,m,bm){var aw=window.SkbKontur.Help,v=aw.contains,x=aw.Core,M=aw.Diagnosis,P=aw.Err,U=aw.extend,X=aw.filter,Y=aw.find,aa=aw.Fix,ac=aw.foreach,aA=aw.isArray,bw=aw.Promise,bA=aw.reduce,c9=aw.Test,dd=aw.trim,ax=x.HKLM,ay=x.HKU,aW=x.log,j=x.buildPath,r=x.compareDate,s=x.compareVersion,w=M.convertToPrintableDate,T=x.$expandEnvStrings,S=x.execute,W=x.File,Z=x.findDevices,ab=x.Folder,ad=x.getArray,ae=x.getCertificateInfo,af=x.getCertificateName,ag=x.getCertificateOrg,ah=x.getFileByCLSID,ai=x.getKonturDiag,ak=x.getProductGUID,am=x.getProductName,an=x.getProductVersion,al=x.getProductInstallInfo,aj=x.getProductAllVersions,ao=x.getService,ap=x.getTimeline,aq=x.hasCertificateLicense,au=x.hasUac,az=x.$install,aB=x.isFileNotFoundError,aC=x.isSystem,aD=x.isUser,a1=x.needLocalSession,bt=x.parseError,bz=x.redirectInstallSourceToLocalPackage,bD=x.regDeleteKey,bE=x.regDeleteValue,bF=x.$regEnumKeys,bG=x.regEnumValues,bJ=x.regReadByType,bK=x.$regReadMultiString,bL=x.$regReadNumber,bM=x.$regReadString,bP=x.$regWriteMultiString,bQ=x.$regWriteNumber,bR=x.$regWriteString,bH=x.regGetAccess,bN=x.regSetAccess,bO=x.regSetOwner,bY=x.runUniversalFix,cJ=x.showErrorInfo,cV=x.startService,y=x.createAndStartService,dk=x.vars,f=dk.arch,N=dk.diagnostics,aZ=dk.needInstallESmartDriver,bu=dk.productMasks,bv=dk.productVersions,cc=dk.rutokenSupExe32,cd=dk.rutokenSupExe64,du=dk.winVer,dn=dk.winBuild,g=dk.atolLocale,B=dk.cryptoproLocale,O=dk.egaisLocale,a6=dk.ofdLocale,by=dk.rarLocale,b4=dk.rutokenLocale,ci=dk.sberLocale,cK=dk.shtrihLocale,c7=dk.tanderLocale,dl=dk.vikiLocale,db=M.translateAssay,dc=M.translateFix,b="Actions/",a=dc(b+"install"),c=dc(b+"update");
var a5=null,de=true,V=false,aV,c5,cF,aM=(64===f),aH=(du<=500),aL=(502==du),aG=(503==du),aE=(du>=600),aI=(du>=700),aJ=(du>=800),aF=(du>=1010),aK=aF&&(Number(dn||"0")>=16299),J="err",C,D,E,G,H,I,F;
bm=bm?bm.Rutoken:a5;var bl=!bm||bm.RutokenVersion,cf="err",ch=1,bW=c9("^(err|not|old|sse|win2k)","i"),b1;var cg=function(){var dv=a5;return aj(bu.RutokenDriver).then(function(dD){if(dD&&dD.length&&dD[0]&&dD[0].Name){var dw=c9("Removal Tool","i"),dC=[];
ac(dD,function(dE){if(!dw(dE.Name)){dC.push(dE)}});dD=dC}if(dD&&dD.length){dv=dD[0].Version;var dz=dD[0].InstallDate;for(var dx=1,dy=dD.length;dx<dy;++dx){var dB=dD[dx].Version,dA=dD[dx].InstallDate;
if(dz&&dA&&(r(dz,dA)>=0)){dv=dB;dz=dA}else{if((!dz||!dA||dz==dA)&&s(dv,dB)){dv=dB;dz=dA}}}}cf=dv||(dk.noSse2?"sse2":"not");ch=dv?0:1}).caught(function(dw){aW.debug("Ошибка определения версии драйверов Рутокен",dw)
}).then(function(){if("not"===cf){if(du<=500){cf="win2k"}else{cf+=(f||"")}}b1=(cf&&cf.length&&!bW(cf))})};dk.connectedRutokenCount=0;var bj=!bm||bm.RutokenSupport,cW="err",c1=1,ce;
var bh=dk.needInstallRutokenPlugin,b6,b7="err",b5=2;var a9=(!bm&&aZ)||(bm&&bm.ESmartVersion),R="err",Q=2;var bc=de,a2=dk.allProfile||O||a6||c7||(bm&&bm.JaCartaVersion),aO,aP="err",aN=2;
var bd=dk.needInstallJCWebClient,aR,aS="err",aQ=2;var bk=!bm||bm.RutokenSupportFile,ar=("function"==typeof(aw.CSPInstallDir)),bX=a5,cX="",cY=2,cZ="",c0=2;
var bo=!bm||bm.SmartCardsService,cS="err",cT=2,cN=a5,cU=0,dm=de,cG="SCardSvr",cm=cG+".dll",cq=cG+".exe",bZ=(1049==dk.language),co="Smart-cards",cE="Смарт-карты",cl=bZ?cE:(aE?co:"Smart Card"),cD="Управляет доступом к устройствам чтения смарт-карт. Если эта служба остановлена, этот компьютер не сможет считывать смарт-карты. Если эта служба отключена, любые службы, которые явно зависят от нее, не могут быть запущены.",cn="Manages access to smart cards read by this computer. If this service is stopped, this computer will be unable to read smart cards. If this service is disabled, any services that explicitly depend on it will fail to start.",ck=bZ?cD:cn,aU=(aE&&!aI)?"LocalService":"LocalServiceAndNoImpersonation";
var br=bo||by||O||c7||(bm&&bm.WinDF),dp="err",dr=2,dq=a5;var a8=!bm||bm.CertPropSvc,bI="SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\",cH=bI+"Winlogon\\Notify\\ScCertProp\\",n="err",p=2,o=a5;
var bi=!bm||bm.RutokenReadersCount,b8="err",ca=1,b9="",cb=0,av=V,aT=4,k=0,l=[],h={},aX=9,bB="SOFTWARE\\Microsoft\\Cryptography\\Calais",bC=bB+"\\Readers";
var bs=!bm||bm.WinSCard,ds="err",dt=1;var bf=!bm||bm.RutokenDevices,bq=!bm||bm.USBHubs,df="err",dg=1,dh="err",di=1,u={},t=V,c6="SYSTEM\\CurrentControlSet\\",c2=c6+"Control\\",c3=c6+"Enum\\",c4=c6+"Services\\";
dk.connectedRutokenLiteCount=0;var be=!bm||bm.RtCOMLite,bS=["rtCOMLite","rtContext"],bV="err",bU=2,bT;var ba=bm&&bm.IBank2KeyDrivers,dj;var cO=[],cP=2;
var cQ=[],cR=2,a0,aY;var z="err",A="";var cw="{50DD5230-BA8A-11D1-BF5D-0000F805F530}",cy=c2+"Class\\"+cw+"\\",cz=c2+"CoDeviceInstallers\\",cA="UpperFilters",cp=a5,cj="err",cC=[],cI="scfilter",cr=[],cB=aI?[cI]:[],cv=[],cx=V,cs=V,ct=V,cu=V,a4={dwdg:de,iwdmdv:de},i={smcrdaddon:de};
var bg=!bm||bm.RutokenInfo,b2,b3=1,bx=bw.reject();var a3=a5,at=V;var c8=((window.SkbKontur||{}).Toolbox||{}).Crypto,e=!(g||B||b4||ci||cK||c7||dl),bp=e&&c8&&(!bm||bm.ToolboxTokens);
var bn=!bm||bm.SCardCheck,cL,cM=1;var bb=bm&&bm.InstallFromTokens,a7="onPrompt",da=a5,q=V;function K(){var dv=dk.cspVersion;return bw.fork(!dv||dv.length<3||"|err|not|sse|".indexOf("|"+dv.substr(0,3)+"|")>=0,aw.CSPVersionDetect).then(function(){J=dk.cspVersion;
var dw=dk.cspMajor=(J&&(J.length>=3))?J.substr(0,3):a5;C=dk.csp20=("2.0"===dw);D=dk.csp30=("3.0"===dw);E=dk.csp36=("3.6"===dw);G=dk.csp39=("3.9"===dw);
H=dk.csp40=("4.0"===dw);I=dk.csp50=("5.0"===dw);F=(E||G||H||I)})}var b0=function(dI){var dC=x.getCookies,dB=1251,dF={testName:"RutokenCont",chcp:dB,charset:dB};
var dH={unknown:-1,ok:0,noRights:1,oldCsp:2,noCsptest:3,noDriver:4};var dv=this,dA=dH.unknown,dy=null,dz="",dx={},dw={};function dD(){if(dI){try{dx=dC();
dw={};var dM=dx?dx.RutokenCont:a5;if(dM&&dM.length){var dN=dM.split(new RegExp(",","g"));for(var dK=0,dL=dN.length;dK<dL;++dK){dw[dN[dK]]=de}}}catch(dJ){aW.error("Ошибка разбора кук",dJ)
}}}function dG(){if(dI){var dL=[];for(var dK in dw){dL.push(dK)}if(dL.length){var dJ=escape(dL.join(","));var dM=new Date();dM.setDate(dM.getDate()+1);
document.cookie="RutokenCont="+dJ+"; path=/; expires="+dM.toUTCString()+"; secure"}}}dv.CookieInstalled=function(){for(var dJ in dw){if(dw[dJ]){return de
}}return V};dv.Check=function(){return bw.when(K).then(function(){if(!E&&!G&&!H&&!I){dA=dH.oldCsp;return bw.result(V)}return aw.CSPInstallDir().then(function(dJ){dJ=j(dJ,"csptest.exe");
return W(dJ).exists().lie(function(){dA=dH.noCsptest;return bw.result(V)})})}).then(function(){function dJ(){return !cf||cf.length<3||"|err|not|sse|".indexOf("|"+cf.substr(0,3)+"|")>=0
}return bw.fork(dJ(),function(){return cg().then(function(){if(dJ()){dA=dH.noDriver;return bw.result(V)}return a5})}).then(function(){dA=dH.ok;return de
})}).caughtReturn()};dv.GetError=function(){switch(dA){case 1:return"Недостаточно прав для выполнения действий";case 2:return"Требуется КриптоПро CSP 3.9 и выше";
case 3:return"Найден КриптоПро CSP, но не найдена утилита csptest.exe";case 4:return"Требуются Драйверы Рутокен";default:break}return dz};dv.Enum=function(){var dJ=c9("esmart|etoken|jacarta|rutoken|FAT12","i");
function dK(dP){dy=[];if(a5!==dP&&dP.length){dD();var dO=dP.split(new RegExp("\\r?\\n"));for(var dL=0,dM=dO.length;dL<dM;++dL){var dN=dO[dL];if("Skip: "===dN.substr(0,6)&&dJ(dN)){var dQ=dN.substr(6);
if(!dw[dQ]){dy.push(dQ)}}}}else{dz="Пустой выходной поток при перечислении контейнеров"}return dy}return bw.when(function(){if(dA===dH.unknown){return dv.Check()
}return a5}).then(function(){if(dA!==dH.ok){return[]}dF.searchArg=a5;return aw.CSPInstallDir().then(function(dM){dM=j(dM,"csptest.exe");var dL="-noerrorwait -absorb -certs -pattern "+String(+new Date());
return S(dM,dL,dF).then(dK)})})};dv.EnumReaders=function(){function dJ(dM){function dK(dQ){var dP=dQ.split(/\r?\n/),dR=[],dO=c9("Len\\s+Byte\\s+NickName","i"),dS=c9("(0x[0-9a-f]+\\s+){2}","i"),dN=0;
while(dN<dP.length&&!dO(dP[dN])){++dN}dN+=2;while(dN+2<dP.length&&dS(dP[dN])){dR.push(aw.trim(dP[dN+2]));dN+=3}return dR}var dL=c9("esmart|etoken|jacarta|rutoken","i");
return X(dK(dM),function(dN){return dL(dN)})}return bw.when(function(){if(dA===dH.unknown){return dv.Check()}return a5}).then(function(){if(dA!==dH.ok){return[]
}dF.searchArg=a5;return aw.CSPInstallDir().then(function(dM){var dL=j(dM,"csptest.exe"),dK="-enum -info -type PP_ENUMREADERS -flags 32";return S(dL,dK,dF)
}).then(dJ)})};function dE(dJ){function dK(dN){var dL=a5;if(a5!==dN&&dN.length){var dM=new RegExp("\\[ErrorCode: (\\w+)\\]","i").exec(dN);if(dM&&dM.length>1){dL=dM[1]
}}if("0x00000000"===dL){dw[dJ]=de;aW.debug("Контейнер Рутокена "+dJ+" был успешно установлен.");return de}dz='Ошибка установки сертификата из контейнера "'+dJ+'", код ошибки: '+dL;
aW.debug(dz+", вывод КриптоПро:\r\n"+dN);return V}dF.searchArg=dJ;return aw.CSPInstallDir().then(function(dM){var dN=j(dM,"csptest.exe"),dL='-noerrorwait -property -cinstall -cont "'+dJ+'"';
return S(dN,dL,dF)}).then(dK)}dv.Install=function(dJ){return bw.fork(a5===dy,function(){dv.Enum()}).then(function(){var dK=0;for(var dL=dy.length;dK<dL;
++dK){if(dJ===dy[dK]){break}}if(dK>=dy.length){dz='Контейнер с именем "'+dJ+'" не найден';return V}return dE(dJ).then(dG)})};dv.InstallAll=function(dJ){return bw.fork(a5===dy,function(){dv.Enum()
}).then(function(){var dK=de;if(!dy||!dy.length){return dK}return bw.each(dy,function(dL){return dE(dL).then(function(dM){if(!dM){dK=V}if(dJ){dJ(dM);return bw.timeout(50)
}return a5})}).then(dG).then(function(){return dK})})}};function d(dv,dw){if(!dk.rutokenFlashID){dk.rutokenFlashID={}}if(!dk.rutokenFlashID[dw]){dk.rutokenFlashID[dw]={}
}dk.rutokenFlashID[dw][dv]=de}return bw.when(K).then(function(){return bw.fork(bl,cg).fork(bj,function(){return an(dk.productMasks.RutokenSupport).truth(function(dv){cW=dv;
c1=0},function(){cW=C?"old":"not";c1=1},function(dv){aW.debug("Ошибка определения версии модуля поддержки Рутокен",dv)}).then(function(){if((500==du)&&("not"===cW)){cW="win2k"
}if("old"===cW||"not"===cW){cW+=(f||"")}ce=(cW&&cW.length&&!bW(cW))})}).fork(a9,function(){return an(bu.ESmartDriver).truth(function(dv){R=dv;Q=0},function(){R="not";
Q=1},function(dv){aW.debug("Ошибка определения версии драйверов eSmart",dv)})}).fork(bc,function(){return an(bu.JCUnifiedClient).truth(function(dv){aO=dv;
aP=dv;aN=0},function(){aO=a5;aP="not"+(f||"");aN=1},function(dv){aW.debug("Ошибка определения версии JaCarta Unified Client",dv)}).then(function(){if(aO){return a5
}return am("JC\\-(GOST|Pro)?Client").caught(a5).truth(function(dv){dv=String(dv||"").toLowerCase();aO=a5;aN=2;if(dv.indexOf("gost")>=0){aP="jcgostbad"}else{if(dv.indexOf("pro")>=0){aP="jcprobad"
}else{aP="jcbad"}}})})}).fork(bd,function(){return an(bu.JCWebClient).truth(function(dv){aR=dv;aS=dv;aQ=0},function(){aR=a5;aS="not";aQ=1},function(dv){aW.debug("Ошибка определения версии JC-WebClient",dv)
})}).fork(bh,function(){return an(bu.RutokenPlugin).truth(function(dv){b6=dv;b7=dv;b5=0},function(){b6=a5;b7="not";b5=1},function(dv){aW.debug("Ошибка определения версии Рутокен Плагин",dv)
})}).fork(ar&&bk,function(){bX=(H||I)?bv.RutokenSupportFile40:bv.RutokenSupportFile;if(!cW){cY=c0=1}else{if(C){cX=cZ="csp20";cY=c0=-1}else{var dx="SOFTWARE\\Crypto Pro\\",dw=dx+"Cryptography\\CurrentVersion\\",dv=F?"AppPath\\":"App Paths\\",dz="KeyCarriers\\RutokenLite\\",dy="";
return bM(ax,dx+dz,"DLL",V).then(function(dA){dy=dA;if(!dy||!dy.length){throw new Error()}}).caught(function(dA){return bM(ax,dw+dz,"DLL",V).then(function(dB){dy=dB;
if(!dy||!dy.length){throw dA}})}).then(function(){return bM(ax,dx+dv+dy+"\\","",V).then(function(dA){cX=dA;if(!cX||!cX.length){throw new Error()}}).caught(function(){return bM(ax,dw+dv+dy+"\\","",V).then(function(dA){cX=dA;
if(!cX||!cX.length){throw new Error()}})}).caught(function(dA){return aw.CSPInstallDir().then(function(dB){var dC=j(dB,dy);return W(dC).exists().truth(function(){cX=dC
},bw.thrown(dA))})})}).then(function(){return W(cX).get("ev").truth(function(dA,dB){cY=0;cZ=dB;c0=s(bX,cZ)?0:2;if(F&&(0===c0)){if("|not|not32|not64|".indexOf("|"+cW+"|")>=0){cW="notneed"
}c1=0}},function(){cY=-1;cZ="notfound";c0=2},function(){cZ="err";c0=-1})}).caught(function(){cX=cZ="nolite";cY=c0=1})}}return a5}).then(function(){if(!(br||aN===0)){return a5
}if(!aE){dp="unused";dr=-1;return de}return ao("wudfsvc").truth(function(dv){dq=dv.forDeletion;var dw=dv.running;dp=dq?"deletion":(dw?(dv.account||"run"):"stop");
dr=dq?2:(dw?0:1)},function(){dp=aK?"unused":"not";dr=aK?-1:1}).caught(function(dv){aW.error('Ошибка при определении состояния службы "Windows Driver Foundation"',dv);
if(aK){dp="unused";dr=-1}})}).then(x.getLocator).then(function(dv){aV=dv;c5=aV.$SysNative;var dw=("not"===dp||"unused"===dp),dy=j(aV.$Windows,"System32"),dx=j(dy,"svchost.exe")+" -k "+aU;
cF={name:cG,binpath:aE?dx:j(dy,cq),depend:aJ?(dw?a5:"wudfsvc"):"PlugPlay",description:aE?("@"+j(dy,cm+",-5")):ck,displayName:aE?("@"+j(dy,cm+",-1")):cl,errorControl:aE?1:0,group:"SmartCardGroup",obj:"NT AUTHORITY\\LocalService",type:"share"};
if(aE){cF.requiredPrivileges="SeCreateGlobalPrivilege,SeChangeNotifyPrivilege"+(aI?"":",SeImpersonatePrivilege");cF.serviceDll=j(dy,cm);cF.serviceProcedure="CalaisMain";
cF.serviceSidType=1}}).fork(bo,function(){var dv=c4+cG+"\\";return bw.when(function(){var dw=[j(c5,"SCardDlg.dll"),j(c5,aE?cm:cq)];if(!aM||!(aL||aG)){dw.push(j(c5,"drivers\\smclib.sys"))
}if(aE){dw=[j(c5,"certprop.dll")].concat(dw);var dx="S-1-5-18\\Control Panel\\International\\",dy=c2+"MUI\\UILanguages";return bw.all(bM(ay,dx,"LocaleName",V),bF(ax,dy,V).caught(a5)).spread(function(dz,dA){if(dA&&dA.length&&!v(dA,dz)){dz=v(dA,"ru-RU")?"ru-RU":(v(dA,"en-US")?"en-US":dA[0])
}if(dz){dw=dw.concat([j(c5,dz+"\\certprop.dll.mui"),j(c5,dz+"\\SCardDlg.dll.mui"),j(c5,dz+"\\SCardSvr.dll.mui")])}}).anyway(function(){cP=-1;return dw})
}cP=-1;return dw}).each(function(dw){var dx={Path:dw.replace(new RegExp("\\\\SysNative\\\\","gi"),"\\System32\\")};return W(dw).get("esvd").truth(function(dz,dA,dB,dy){dx.Size=dA||0;
dx.Version=dB||"";dx.DateCreated=dy.dateCreated||"";if(!dx.Version){cP=Math.max(cP,dx.Size?1:2)}},function(){cP=2}).then(function(){cO.push(dx)})}).then(function(){var dE=bZ?"Смарт-карта":co,dC={"Смарт-карта":dE,"Смарт-карты":dE,"Smart Card":dE,"Smart card":dE,"Smart-Cards":dE,"Smart-cards":dE},dx=!!ai();
var dD={DependOnService:cF.depend?cF.depend.split(new RegExp(",","g")):[],Description:cF.description,DisplayName:cF.displayName,ErrorControl:cF.errorControl,Group:cF.group,ImagePath:cF.binpath,ObjectName:cF.obj,Type:32};
if(aE){dD.RequiredPrivileges=cF.requiredPrivileges.split(new RegExp(",","g"));dD.ServiceSidType=cF.serviceSidType;dD.Parameters={ServiceDll:cF.serviceDll,ServiceDllUnloadOnStop:1,ServiceMain:cF.serviceProcedure};
dC["@"+cF.serviceDll+",-1"]=dE;dC["@"+cF.serviceDll+",-5"]=ck}function dz(dF,dG){return String(dF).toLowerCase()===String(dG).toLowerCase()}function dA(dH,dG,dF){return bw.fork(dx,function(){return bJ(ax,dH,dG,V)
},function(){if(aA(dF)){return bK(ax,dH,dG,V)}if("string"==typeof(dF)){return bM(ax,dH,dG,V)}return bL(ax,dH,dG,V)}).then(function(dI){if(aA(dF)){if(!aA(dI)||(dI.length!=dF.length)){return[V,dI]
}for(var dJ=0,dK=dF.length;dJ<dK;++dJ){if(!dz(dI[dJ],dF[dJ])){return[V,dI]}}return[de,dI]}return bw.fork("string"==typeof(dI),function(){return T(dI)},dI).then(function(dL){return[dz(dC[dL]||dL,dC[dF]||dF),dL]
})}).caught([(a5===dF||aA(dF)&&!dF.length),a5])}function dw(dH,dG,dF){return dA(dH,dG,dF).spread(function(dJ,dI){if(!dJ){cQ.push({Name:dG,Actual:(dI instanceof Array)?dI.join(", "):dI,Expected:(dF instanceof Array)?dF.join(", "):dF});
cR=2}})}var dB=[],dy=a5;cR=0;return bw.each(dD,function(dF,dG){if((a5!==dG)&&!aA(dG)&&("object"==typeof(dG))){return bw.each(dG,function(dH,dI){return dw(dv+dF+"\\",dH,dI)
})}return dw(dv,dF,dG)}).fork(aF,function(){return bK(ax,bI+"SvcHost\\","LocalServiceNetworkRestricted",aM).then(function(dF){dB=dF;dy=v(dB,"TimeBrokerSvc")
}).caught()}).fork(aE,function(){return bK(ax,bI+"SvcHost\\",aU,aM).then(function(dG){var dI=(dy?[]:["TimeBroker"]).concat(["SSDPSRV","upnphost",cG,"QWAVE","fdrespub","wcncsvc","SensrSvc","BthHFSrv"]),dH=v(dG,cG,de);
dm=de;if(aF){ac(dI,function(dJ){if(!v(dG,dJ,de)){dm=V;return V}return a5})}if(!dH||!dm){var dF=dB.length?dI:dG.concat([cG]);cQ.push({Name:aU,Actual:dG.join(", "),Expected:dF.join(", ")});
cR=2}}).caught()})}).then(function(){return bJ(ax,dv,"WOW64",V).then(function(dw){cU=dw;if(cU){cQ.push({Name:"WOW64",Actual:(cU instanceof Array)?cU.join(", "):cU,Expected:0});
cR=2}}).caught()}).then(function(){return ao(cG).truth(function(dw){cN=dw.forDeletion;var dx=dw.running;cS=cN?"deletion":(dx?(dw.account||"run"):"stop");
cT=cN?2:(dx&&!cU?0:1)},function(){cU=0;aW.debug('Не найдена служба "'+cE+'"');cS="not";cT=1},function(dw){aW.error('Ошибка при определении состояния службы "'+cE+'"',dw)
})})}).fork(a8,function(){if(aH){n="unimpl";p=-1}else{if(aE){return ao("CertPropSvc").truth(function(dw){o=dw.forDeletion;var dv=dw.running;n=o?"deletion":(dv?(dw.account||"run"):"stop");
p=o?2:(dv?0:1)},function(){aW.debug('Не найдена служба "Распространение сертификатов"');n="not"}).caught()}else{return bL(ax,cH,"Enabled",aM).then(function(dv){n=(a5===dv)?"err":(1===dv?"enable":"disable");
p=(a5===dv)?2:(1===dv?0:1)}).caught(function(dv){aW.error("Ошибка чтения параметра реестра службы распространения сертификатов",dv)})}}return a5}).fork(bi,function(){function dv(dA){if(dA.length){var dy=dA.lastIndexOf(" ");
if(dy>-1){var dz=dA.substr(0,dy),dw=Number(dA.substr(dy+1)),dx=dz.toLowerCase().indexOf("aktiv co. rutoken")>=0;return{name:dA,idx:dw,isRutokenS:dx}}}return false
}return bF(ax,bC,aM).then(function(dw){k=dw.length;return dw}).map(function(dx){dx=dd(dx);var dw=dv(dx);if(dw){l.push(dw);h[dx.toLowerCase()]=(0===dw.idx)?V:a5;
if(dw.isRutokenS){cb++;if(0===dw.idx){av=de}}}return dx}).caught(function(dw){aW.debug("Ошибка перечисления виртуальных считывателей",dw);return[]}).then(function(dw){ca=-1;
if(k>0){b8=dw;if(k>aX){ca=1;b9="ten"}if(b1){if(av){if(h["aktiv co. rutoken 1"]===a5){ac(l,function(dB){var dx=dB.idx;if(dB.isRutokenS&&dx<aT){var dz=dB.idx+1;
var dA="aktiv co. rutoken "+dz;var dy=dx<aT&&h[dA]!==a5;if(dy){aT=dx}}})}else{aT=0}if(aT!==4&&cb>aT+1){ca=2;b9+="break"}else{if(cb>5){ca=2;b9+="six"}}}else{aT=-1;
ca=2;b9+="zero"}}else{aT=-1;if(cb>0){b9+="driver"}}}else{b8="none"}})}).fork(bs,function(){if(aM&&!aE){ds="win64";dt=-1}else{ds=[];dt=-1;var dw=-1,dv=-1,dx="",dA=-1,dz=-1,dB="",dy=V,dD=[c5,j(c5,"dllcache")],dC=["winscard.dll","_winscard.dll","winscard32.dll","_winscard32.dll"];
return bw.each(dD,function(dE,dF){return ab(dE).exists().truth(function(){return bw.each(dC,function(dH,dI){var dG=j(dE,dH);return W(dG).get("esvd").truth(function(dL,dO,dP,dJ){var dM=dO||0,dN=dP||"",dK=dJ.dateCreated||-1;
if(0===dI){if(0===dF){dw=dM;dv=dK;dx=dN}else{if(1==dF){dA=dM;dz=dK;dB=dN}}}else{dy=de}ds.push({Path:dG.replace(new RegExp("\\\\SysNative\\\\","gi"),"\\System32\\"),Size:dM,Version:dN,DateCreated:dK})
})})})}).then(function(){var dF={"5.0.2195.6609":new Date(2004,8,2),"5.1.2600.2180":new Date(2006,2,3),"5.1.2600.5512":new Date(2008,3,16),"5.2.3790.0":new Date(2003,4,13),"5.2.3790.3959":new Date(2007,1,19),"6.0.6000.16386":new Date(2006,10,3),"6.0.6001.18000":new Date(2008,0,22),"6.0.6002.18005":new Date(2009,3,12),"6.1.7600.16385":new Date(2009,6,15),"6.1.7601.17514":new Date(2010,10,22)},dE=function(){return(dx&&(dv>0)&&dF[dx]&&(dF[dx].getTime()>=dv))
};if(!ds||!ds.length){ds="not";dt=2}else{if(dw<=0){dt=2}else{if(dy){dt=dE()?1:2}else{if(dA<=0){dt=dE()?0:-1}else{if((dw!=dA)||(dx!=dB)){dt=2}else{if(Math.abs(dv-dz)>(12*60*60*1000)){dt=2
}else{if((dw>0)&&(dv>0)&&(""!==dx)){dt=dE()?0:-1}else{dt=1}}}}}}}})}return a5}).fork(bf||bq,function(){var dC={},dy={},dD={},dE=V;function dA(dI,dH){var dG=dI+"\\"+dH+"\\",dF=new RegExp("^([^&]&[^&]+&[^&])","i");
return bF(ax,c3+dG,V).each(function(dJ){var dK=dF.exec(dJ)||"";if(dK instanceof Array){dK=dK[0]}if(dK){if(!dC[dK]){dC[dK]=[]}dC[dK].push(dG+dJ.toUpperCase())
}}).caught(function(dJ){if(!aB(dJ)){aW.debug("Ошибка получения информации о подключенных USB-устройствах "+dG,dJ)}})}function dz(dF){return bF(ax,c3+dF+"\\",V).each(function(dG){return dA(dF,dG)
}).caught(function(dG){if(!aB(dG)){aW.debug("Ошибка получения информации о подключенных USB-устройствах "+dF,dG)}})}function dx(dF){return bL(ax,dF,"ConfigFlags",V).truth(function(dG){return(0!==(Number(dG)&64))
}).caught(V)}function dv(dF){return bM(ax,dF,"Driver",V).truth(function(dG){return dG.length>0}).caught(V)}function dw(dF){return bL(ax,dF+"Control\\","DisableCount",V).then(function(dG){return !dG||(0===Number(dG))
}).caught(de)}function dB(dF){return bM(ax,dF,"Service",V).lie("").caught(a5)}return bw.all(dz("FLUSB"),dz("IUSB3"),dz("NUSB3"),dz("USBSTOR")).anyway(function(){function dF(dH,dI){if(dC[dH]){var dG=dC[dH];
return bw.each(dG,function(dJ){dy[dJ]=dI;dE=de;return bM(ax,c3+dJ+"\\","ParentIdPrefix",V).then(function(dK){return dF(dK,dI)}).caught()})}return a5}return bw.when(function(){var dG=c3+"PCI\\";
return bF(ax,dG,V).each(function(dI){var dH=dG+dI+"\\";return bF(ax,dH,V).each(function(dJ){return bM(ax,dH+dJ+"\\","ParentIdPrefix",V).then(function(dK){return dF(dK,dI)
}).caught()})})}).caught(function(dG){aW.debug("Ошибка получения информации о подключенных PCI-устройствах",dG)})}).anyway(function(){return Z({services:["scfilter","USBCCID","usbccgp","rtUSB","USBSTOR"].concat(!b4?["AES64TOK"]:[]).concat((B||b4)?["rtMagistra"]:[])}).then(function(dF){t=t||dF.found;
u=U(u,dF.devices)},function(dF){aW.debug("Не удалось получить информацию о подключенных токенах",dF)})}).then(function(){var dF=c3+"USB\\",dG;if(b4){dG={VID_0A89:"Rutoken","VID_0A89&PID_0003":"0A89_0003","VID_0A89&PID_0004":"Rutoken","VID_0A89&PID_0012":"0A89_0012","VID_0A89&PID_0020":"Rutoken S","VID_0A89&PID_0025":"Rutoken Lite","VID_0A89&PID_0030":"0A89_0030","VID_0A89&PID_0060":"0A89_0060"}
}else{dG={VID_0529:"eToken","VID_072F&PID_90DE":"072F_90DE",VID_0A89:"Rutoken","VID_0A89&PID_0004":"Rutoken","VID_0A89&PID_0012":"0A89_0012","VID_0A89&PID_0020":"Rutoken S","VID_0A89&PID_0025":"Rutoken Lite","VID_0A89&PID_0025&MI_00":"Rutoken Lite Flash","VID_0A89&PID_0025&MI_01":"Rutoken Lite Flash","VID_0A89&PID_0030":"0A89_0030","VID_24DC&PID_0101":"24DC_0101","VID_24DC&PID_0102":"24DC_0102","VID_24DC&PID_100F":"24DC_100F"}
}df=[];return bF(ax,dF,V).each(function(dI){dI=(dI||"").toUpperCase();if(dI.length<8){return a5}var dJ=dG[dI];if(!dJ){if(0===dI.indexOf("VID_")){dJ=dG[dI.substr(0,8)]
}if(!dJ){return a5}}var dH=dF+dI+"\\";return bF(ax,dH,V).each(function(dK){var dL=dH+dK+"\\";return bw.all(dw(dL),dv(dL),dx(dL),dB(dL)).spread(function(dN,dM,dO,dP){return{ID:dK,Type:dJ,Connected:a5,Enabled:dN,Driver:dM,Ignore:dO,Service:dP}
}).then(function(dN){if(t){var dO="USB\\"+dI+"\\"+dK.toUpperCase(),dM=dN.Connected=!!u[dO];if(!dM&&!dN.Driver){dN.Connected=a5}}df.push(dN);if(dN.Connected&&("usbccgp"===(dN.Service||"").toLowerCase())){d(dN.ID,"device");
return bM(ax,dH+dK,"ContainerID",V).then(function(dP){return bG(ax,c2+"DeviceContainers\\"+dP+"\\BaseContainers\\"+dP,V)}).then(function(dP){dD[dK]=dP})
}return a5})}).caught(function(dK){if(!aB(dK)){aW.debug("Ошибка перечисления USB-устройств "+dI+" в реестре",dK)}})}).caught(function(dH){aW.debug("Ошибка перечисления USB-устройств в реестре",dH)
})}).then(function(){if(t){return bw.each(u,function(dJ,dF){if("USBSTOR"==dJ){var dG=c3+dF+"\\",dI=dF.split(new RegExp("\\\\+","g")),dH=(dI.length>1)?(dI[1]+(dI.length>2?(" "+dI[2]):"")):a5;
if(dH){return bw.all(dw(dG),dv(dG),dx(dG),dB(dG)).spread(function(dL,dK,dM,dN){df.push({Connected:de,ID:dH,Type:"Flash",Enabled:dL,Driver:dK,Ignore:dM,Service:dN})
})}}return a5})}return a5}).then(function(){function dG(dJ,dI){return(dJ.indexOf(dI.replace("VID_0A89&PID_0025&MI_00 ","").toLowerCase())!==-1)}if(df.length){var dH=df;
var dF=[];ac(dD,function(dJ,dI){ac(dI,function(dK){var dL=Y(dH,function(dM){return dK.indexOf(dM.ID)!==-1||dG(dK,dM.ID)});if(dL){dF.push(dL)}dH=X(dH,function(dM){return dK.indexOf(dM.ID)===-1&&!dG(dK,dM.ID)
})});dH.push(bA(dF,function(dL,dK){return{ID:dJ,Type:"Rutoken Lite Flash",Connected:!dL.Connected?dL.Connected:dK.Connected,Enabled:!dL.Enabled?dL.Enabled:dK.Enabled,Driver:!dL.Driver?dL.Driver:dK.Driver,Ignore:!dL.Ignore?dL.Ignore:dK.Ignore,Service:(dL.Service+((dK.Service&&(dL.Service.indexOf(dK.Service)===-1))?(" "+dK.Service):""))}
}))});df=dH}else{df="none";dg=-1}}).then(function(){function dH(dK){return bM(ax,dK,"DeviceDesc",V).then(function(dM){var dL=dd(dM).split(";");return(dL.length>1)&&dL[1]||a5
}).caught(a5)}var dJ=V,dI=a5;function dF(dM,dL){var dK=dM+"\\"+dL+"\\";return bF(ax,c3+dK,V).each(function(dN){dJ=de;var dP=dK+dN.toUpperCase(),dO=c3+dK+dN+"\\";
return dH(dO).lie(dP).then(function(dQ){var dR="";if(dE&&dy[dP]&&de!==dy[dP]){dR=dy[dP]}dh.push({Class:dP,ID:dR,Name:dQ})})}).caught(function(dN){if(!aB(dN)){dI=bt(dN);
aW.debug("Не удалось получить информацию о USB-хабах "+dK,dI)}})}function dG(dK){return bF(ax,c3+dK+"\\",V).each(function(dL){return dF(dK,dL)}).caught(function(dL){if(!aB(dL)){dI=bt(dL);
aW.debug("Не удалось получить информацию о USB-хабах "+dK,dI)}})}dh=[];return bw.all(dF("FLUSB","ROOT_HUB_FL30"),dG("IUSB3"),dG("NUSB3"),dF("USB","ROOT_HUB30")).anyway(function(){if(dJ){di=0;
if(!dh.length){dh=aH?"unimpl":"none";di=-1}}else{dh=dI?"err":"none";di=dI?1:-1}})})}).fork(be,function(){return ah(bS.join(".")).then(function(dv){return W(dv).get("ev").truth(function(dw,dx){bV=dx||"yes";
bU=("yes"==bV)?1:0},function(){bV="notfound";bU=1})}).caught(function(){bV="not";bU=1})}).fork(bp,function(){return ah(["KonturToolbox2","About"].join(".")).then(function(dv){return W(dv).get("ev")
}).then(function(dv,dA){var dz=dv&&dA,dy=x.isMSHTA(),dx=dz&&s(bv.KonturToolboxMin2,dz),dw=dz&&s(bv.KonturToolboxHta2,dz);at=(dw||(dx&&!dy))}).caught()}).fork(ba,function(){return al({sufficientVersion:bv.IBank2KeyDriver,getVersion:function(){return an(bu.IBank2KeyDriver)
}}).then(function(dv){dj=dv})}).fork(bo,function(){return bK(ax,cy,cA,V).then(function(dv){cr=dv;if(aA(cr)){ac(cr,function(dw,dx){cr[dx]=dd(dw).toLowerCase()
})}}).caught(function(dv){cr=[];if(aB(dv)){if(cB.length){ct=de}}else{cp=bt(dv);aW.error("Ошибка проверки UpperFilters для смарт-карт",cp)}}).then(function(){var dv={},dw=[].concat(cr);
if(dw.length){ac(cB,function(dx){if(!v(dw,dx)){dw.unshift(dx);ct=de}})}else{if(cB.length){dw=[].concat(cB);ct=de}}cv=[];return bw.each(dw,function(dx){if(!dx){return a5
}if(dv[dx]){cu=de;return a5}if(i[dx]){cu=de;return a5}dv[dx]=de;var dy=v(cB,dx);return bM(ax,c4+dx+"\\","ImagePath",V).lie(V,function(){cv.push(dx);return de
}).caught(function(){if(dy){cs=de;ct=V}if(dy||(cI!==dx)){aW.error("В UpperFilters для смарт-карт найден "+dx+", для которого отсутствует служба")}return V
}).lie(function(){if(!dy&&v(cr,dx)){cu=de}})}).then(function(){cx=!!(ct||cu)||(cr.length!==cv.length)})}).then(function(){return bK(ax,cz,cw,V).caught(function(dv){if(!aB(dv)){aW.error("Ошибка проверки CoDeviceInstallers для смарт-карт",dv)
}}).tap(function(dv){if(!dv){cj="none"}else{if(!dv.length){cj="empty"}else{cj=dv}}})}).then(function(){var dv=983103,dw={users:{"S-1-5-18":{required:31,prefered:dv,actual:a5,enough:a5},"S-1-5-19":{required:31,prefered:dv,actual:a5,enough:a5},"S-1-5-32-544":{required:31,prefered:dv,actual:a5,enough:a5},"S-1-5-32-545":{required:25,prefered:131097,actual:a5,enough:a5}},result:[],enough:V,error:a5,type:0};
return bw.when(function(){if(!ai()){throw P("not KD",1)}var dx;return bH(ax,bC,aM).then(function(dy){dx=ad(dy);dw.type=1}).caught(function(dy){if(!aB(dy)){throw dy
}return bH(ax,bB,aM).then(function(dz){dx=ad(dz);dw.type=2})}).then(function(){dw.enough=de;ac(dw.users,function(dz,dA){var dy=aw.find(dx,function(dB){return dB&&(dB.sid===dz)
});if(dy){dA.actual=dy.allow&(~dy.deny);dA.enough=(0===(dA.required&(~dA.actual)))}if(!dA.enough){dw.enough=V}dw.result.push({SID:dz,Rights:dA.actual||0})
})})}).caught(function(dx){if(ai()){aW.error("Ошибка определения прав на ветку Calais\\Readers",dx);dw.error=bt(dx)}else{dw.error=b4?"ad":"kd"}}).then(function(){z=dw
})})})}).then(function(){var dD=" ${MSIARGS}";if(bl){L.setValue("Rutoken/RutokenVersion",cf);var dF=bv.RutokenDriver,dC=aM?"rtDrivers.x64.msi":"rtDrivers.msi",dE=(b4||O)?dF:bv.RutokenDriverMin;
N.addFix(new aa("Rutoken.RutokenVersion",{message:(b1?c:a)+" драйверов Рутокен",caption:dc("Rutoken/RutokenVersion"),filename:"rtDrivers.exe",args:'/install /quiet /norestart /log \\"${LOGFILE}\\" RTCPDESKTOPSHORTCUT=0 ECPMINIDRV=1'+dD,priority:1,needadmin:1,needlocalsession:aE?0:1,needreboot:0,order:520,checksign:1,tags:[aa.Tags.MSI],dependency:["Windows.InstallerVersion","Rutoken.SmartCardsService"].concat(cb>0?["Rutoken.RutokenReaders"]:[]),needejecttokens:function(dG){return dG&&(0!==dk.connectedRutokenCount)
},fix:function(dH){var dG=this;return ak(bu.RutokenDriver,de).then(function(dI){return bz(a5,dI,dC)}).then(function(dK,dJ){dk.connectedRutokenCount=0;try{aW.info("Определение подключенных Рутокенов...");
if(aA(df)){ac(df,function(dL){if(dL.Connected&&("Rutoken"===dL.Type)){++dk.connectedRutokenCount}})}}catch(dI){}if(0!==dk.connectedRutokenCount){dG.needreboot=1
}N.getFixer().resetProgress(dG);return dG.apply(function(dL){return bw.when(function(){if(dL&&!dL.code&&dJ&&dJ.length){var dM=dJ;if("\\"===dM.charAt(dM.length-1)){dM=dM.substr(0,dM.length-1)
}return ab(dM).remove().caught(function(dN){aW.debug("Ошибка удаления временной папки после установки драйверов Рутокен",dN)})}return a5}).then(function(){return dH(dL)
})})})},test:function(dH){var dG="";if(!aH&&!dk.noSse2&&b1&&!s(dF,cf)){if(s(dE,cf)){this.priority=0}ch=1;dG="upd"}dH.setMessage("Rutoken/RutokenVersion",ch,dG);
return(aH||dk.noSse2)?0:ch}}))}if(bh){L.setValue("Rutoken/RutokenPlugin",b7);N.addFix(new aa("Rutoken.RutokenPlugin",{message:(b6?c:a)+" плагина Рутокен для nalog.ru",caption:dc("Rutoken/RutokenPlugin"),filename:"RutokenPlugin.msi",args:'/quiet /l*vx "${LOGFILE}"',priority:0,needadmin:1,needrestart:1,tags:[aa.Tags.MSI],order:535,dependency:["Windows.InstallerVersion","Rutoken.SmartCardsService"],fix:function(dH){var dG=this;
return ak(bu.RutokenPlugin,de).then(function(dI){return bz(a5,dI,dG.filename)}).then(function(dJ,dI){N.getFixer().resetProgress(dG);return dG.apply(function(dK){return bw.when(function(){if(dK&&!dK.code&&dI&&dI.length){var dL=dI;
if("\\"===dL.charAt(dL.length-1)){dL=dL.substr(0,dL.length-1)}return ab(dL).remove().caught(function(dM){aW.debug("Ошибка удаления временной папки после установки Плагина Рутокен",dM)
})}return a5}).then(function(){return dH(dK)})})})},test:function(dH){var dG="";if((b5<2)&&b6&&!s(bv.RutokenPlugin,b6)){b5=1;dG="upd"}dH.setMessage("Rutoken/RutokenPlugin",b5,dG);
return(1===b5)}}))}if(a9){L.setValue("Rutoken/ESmartVersion",R);N.addFix(new aa("Rutoken.ESmartVersion",{message:a+" драйверов для токенов eSmart",caption:dc("Rutoken/ESmartVersion"),filename:aM?"ESMART_Token_USB_64K_PCSC_Driver_x64.msi":"ESMART_Token_USB_64K_PCSC_Driver.msi",args:"/quiet",priority:0,needadmin:1,tags:[aa.Tags.MSI],order:510,dependency:["Windows.InstallerVersion","Rutoken.SmartCardsService"],test:function(dG){dG.setMessage("Rutoken/ESmartVersion",Q);
return 1===Q}}))}if((bc&&aN===0)||a2){L.setValue("Rutoken/JCUnifiedClient",aP);var dB=aM?"JaCartaUnifiedClient_x64.msi":"JaCartaUnifiedClient_x86.msi",dA="2.9.0",dy=ak(bu.VCRedist2005),dz="INSTALL_SECURLOGON=0"+(dy?" INSTALL_MSVC80_CRT=0":"");
N.addFix(new aa("Rutoken.JCUnifiedClient",{message:(aO?c:a)+" единого клиента JaCarta "+dA,caption:dc("Rutoken/JCUnifiedClient"),filename:dB,args:'/quiet /l*vx "${LOGFILE}" '+dz,priority:1,needadmin:1,tags:[aa.Tags.MSI],needreboot:1,order:840,dependency:["Windows.InstallerVersion","Rutoken.SmartCardsService"],fix:function(dH){var dG=this;
return ak(bu.ETokenSCOM).truth(function(dI){return x.uninstall(dI,dG.needadmin)}).then(function(){return ak(bu.JCUnifiedClient,de)}).then(function(dI){return bz(a5,dI,dB)
}).then(function(dJ,dI){N.getFixer().resetProgress(dG);return dG.apply(function(dK){return bw.when(function(){if(dK&&!dK.code&&dI&&dI.length){var dL=dI;
if("\\"===dL.charAt(dL.length-1)){dL=dL.substr(0,dL.length-1)}return ab(dL).remove().caught(function(dM){aW.debug("Ошибка удаления временной папки после установки Единого клиента JaCarta",dM)
})}return a5}).then(function(){return dH(dK)})})})},test:function(dH){var dG="";if((aN<2)&&aO&&!s(bv.JCUnifiedClientMin,aO)){aN=1;dG="upd"}dH.setMessage("Rutoken/JCUnifiedClient",aN,dG);
return(1===aN)}}))}if(bd){L.setValue("Rutoken/JCWebClient",aS);N.addFix(new aa("Rutoken.JCWebClient",{message:(aR?c:a)+" плагина JaCarta для nalog.ru",caption:dc("Rutoken/JCWebClient"),filename:"JC-WebClient.msi",args:'/quiet /l*vx "${LOGFILE}"',priority:0,needadmin:1,needrestart:1,tags:[aa.Tags.MSI],order:538,dependency:["Windows.InstallerVersion","Rutoken.SmartCardsService"],fix:function(dH){var dG=this;
return ak(bu.JCWebClient,de).then(function(dI){return bz(a5,dI,dG.filename)}).then(function(dJ,dI){N.getFixer().resetProgress(dG);return dG.apply(function(dK){return bw.fork(dK&&!dK.code&&dI&&dI.length,function(){var dL=dI;
if("\\"===dL.charAt(dL.length-1)){dL=dL.substr(0,dL.length-1)}return ab(dL).remove().caught(function(dM){aW.debug("Ошибка удаления временной папки после установки JC-WebClient",dM)
})}).then(function(){return dH(dK)})})})},test:function(dH){var dG="";if((aQ<2)&&aR&&!s(bv.JCWebClientMin,aR)){aQ=1;dG="upd"}dH.setMessage("Rutoken/JCWebClient",aQ,dG);
return(1===aQ)}}))}if(ba){L.setValue("Rutoken/IBank2KeyDriversVersion",dj.diagVersionValue);N.addFix(new aa("Rutoken.IBank2KeyDrivers",{message:(dj.isInstalled?c:a)+" драйверов для USB-токенов iBank2",caption:dc("Rutoken/IBank2KeyDrivers"),filename:aM?dk.iBank2KeyDriver64:dk.iBank2KeyDriver32,args:'/S /V"/quiet /norestart /l*vx \\"${LOGFILE}\\" USBTOKENNUM=1'+dD+'"',priority:dj.isNotInstalled?1:0,needadmin:1,order:515,dependency:["Windows.InstallerVersion"],test:function(dH){var dI=dj.isInstalled?(dj.isSufficient?0:1):2,dG=(dj.isInstalled&&!dj.isSufficient)?"upd":"";
dH.setMessage("Rutoken/IBank2KeyDriversVersion",dI,dG);return dj.isNotSufficient}}))}if(bo){L.setValue("Rutoken/SmartCardsService",cS);L.setValue("Rutoken/SmartCardsFiles",cO,cP);
L.setValue("Rutoken/SmartCardsReg",cQ.length?cQ:"ok",cR);A=(2===z.type)?"Rutoken/CalaisRights":"Rutoken/CalaisReadersRights";a0=("not"===cS);aY=(cR>0)&&(!cU||cQ.length>1);
var dv=z.error;L.setValue(A,("ad"===dv||"kd"===dv)?dv:(dv?"err":(z.result.length?z.result:"none")));L.setValue("Rutoken/Scfilter",cp?"err":(cr.length?cr:"none"));
L.setValue("Rutoken/CoDeviceInstallers",cj);var dw={501:"FixDLLXP.exe",503:"FixDLL2003.exe",600:"FixDLLVista.exe",601:"FixDLLVista.exe",700:"FixDLL7.exe",701:"FixDLL7.exe"},dx=du&&dw[du];
N.addFix(new aa("Rutoken.SmartCardFiles",{message:dc("Rutoken/SmartCardFiles"),filename:dx,args:"/S",needadmin:1,order:385,priority:1,test:function(){return dx&&(cP>0)
}}));N.addFix(new aa("Rutoken.SmartCardsService",{message:dc("Rutoken/SmartCardsService/"+(a0?"install":(aY?"fix":(cU?"restart":"run")))),script:1,priority:1,needadmin:1,needlocalsession:aE?0:1,needreboot:(cU||!dm)?1:0,order:400,dependency:["Rutoken.SmartCardFiles"].concat(aJ?["Rutoken.WindowsDriverFoundation"]:[]),fix:function(dH){var dG=this;
return bw.when(function(){if(a0||aY){return y(cF)}else{if(cU){return bY('SvcRemoveWow64 "'+cG+'"',de).then(function(dI){if(dI){if(!dI.code){dG.needreboot=2;
return de}aW.error("SvcRemoveWow64 error",dI)}return V}).caught(function(){return cV(cG,{restart:de})})}else{return cV(cG)}}}).then(dH)},test:function(dH){var dG="";
if(!cN&&(1===cT)&&!a1()){dG=cU?"rest-scard":"run-scard"}if(a0){dG="inst-scard"}dH.setMessage("Rutoken/SmartCardsService",cT,dG);if(aY&&(!dG||!dG.length)){dH.setMessage("Rutoken/SmartCardsReg",cR,"fix")
}return(a0||aY||(1===cT))}}));N.addFix(new aa("Rutoken.CalaisReadersRights",{message:dc(A),script:1,priority:1,needadmin:1,order:410,dependency:["Windows.KonturDiag"],fix:function(dH){if(au()||aD()){return bY("FixCalaisReadersRights",de).then(dH)
}function dG(dI){return bw.each(z.users,function(dK,dL){var dJ=dL.prefered|(dL.actual||0);return bN(ax,dI,dK,dJ,aM)}).then(function(){return bO(ax,dI,"S-1-5-32-544",aM)
})}return dG(bB).caught(function(dI){aW.error("Ошибка исправления прав на Cryptography\\Calais",dI);return bw.result(V)}).then(function(){if(2!==z.type){return dG(bC).caught(function(dI){aW.error("Ошибка исправления прав на Calais\\Readers",dI);
return bw.result(V)})}return a5}).then(de).caughtReturn().then(dH)},test:function(dI){var dJ=("ad"===z.error||"kd"===z.error),dG=!dJ&&!z.enough,dH=dG?"fix-calais":"";
dI.setMessage(A,dJ?1:(z.enough?0:2),dH);if(z.result.length){ac(z.result,function(dL,dK){dI.setMessage(A+"/"+dK,z.users[dL.SID].enough?0:2)})}return dG}}));
N.addFix(new aa("Rutoken.Scfilter",{message:dc("Rutoken/Scfilter"),script:1,priority:1,needadmin:1,order:415,fix:function(dG){return bw.fork(au()||aD(),bw.thrown("User or UAC",5),function(){return bw.fork(cv.length,function(){return bP(ax,cy,cA,cv,V)
},function(){return bE(ax,cy,cA,V)}).then(de,function(dH){aW.error("Ошибка исправления scfilter",dH);return V})}).caught(function(dH){aW.debug("Альтернативный режим настройки по причине",dH);
var dI=cv.length?cv.join(";"):"[]";return bY('FixScfilter "'+dI+'"',de)}).then(dG)},test:function(dI){var dH={},dG=cs?"req-cmt":"";if(!cp&&cx){if(ct){dG=cu?"fix":"fix-add"
}else{if(cu){dG="fix-del"}}}dI.setMessage("Rutoken/Scfilter",(cx||cp||cs)?2:0,dG);ac(cr,function(dJ,dL){dJ=dJ.toLowerCase();var dK=2;if(!dH[dJ]){var dM=v(cv,dJ);
if(i[dJ]){dK=2}else{if(a4[dJ]){dK=dM?1:2}else{if(dM){dK=v(cB,dJ)?0:-1}}}dH[dJ]=de}dI.setMessage("Rutoken/Scfilter/"+dL,dK)});return !cp&&cx}}));N.addFix(new aa("Rutoken.CoDeviceInstallers",{message:dc("Rutoken/CoDeviceInstallers"),script:1,priority:1,needadmin:1,needreboot:1,order:417,fix:function(dG){if(au()||aD()){var dH=cC.length?cC.join("{;;;}"):"[]";
return bY('FixCoDeviceInstallers "'+dH+'"',de).then(dG)}return bw.fork(cC.length,function(){return bP(ax,cz,cw,cC,V)},function(){return bE(ax,cz,cw,V)}).then(de,function(dI){aW.error("Ошибка исправления CoDeviceInstallers",dI);
return V}).then(dG)},test:function(dH){var dL=-1,dG="",dK={},dI=c9(["SmcrdAddOnCoInst\\.dll,SmartCardAddOnCoInstaller","SmcrdAddOnCoInstAmd64\\.dll,SmartCardAddOnCoInstaller"].join("|"),"i");
if(aA(cj)){cC=[];ac(cj,function(dM,dN){if(dI(dM)){dL=2;dK[dN]=2}else{cC.push(dM)}});if(2==dL){dG="fix"}}else{if("empty"===cj){dL=1}else{if("none"===cj){dL=0
}}}dH.setMessage("Rutoken/CoDeviceInstallers",dL,dG);for(var dJ in dK){dH.setMessage("Rutoken/CoDeviceInstallers/"+dJ,dK[dJ]||-1)}return(dL>0)}}))}if(br||aN===0){L.setValue("Rutoken/WindowsDriverFoundation",dp);
N.addFix(new aa("Rutoken.WindowsDriverFoundation",{message:dc("Rutoken/WindowsDriverFoundation"),script:1,priority:1,needadmin:1,order:390,fix:function(dG){return cV("wudfsvc").truth(function(){return bw.timeout(1000).anyway(x.call(ao,"wudfsvc")).then(function(dI){var dH=V;
if(!dI){aW.error("Cлужба wudfsvc не найдена")}else{if(!dI.running){aW.error("Cлужба wudfsvc не запущена")}else{dH=de}}return dH})},V).caught(function(dH){aW.error("Ошибка при запуске wudfsvc",dH);
return V}).then(dG)},test:function(dH){var dI=("stop"===dp),dG=(dI&&!dq)?"run-wudf":"";dH.setMessage("Rutoken/WindowsDriverFoundation",dr,dG);return dI
}}))}if(a8){L.setValue("Rutoken/CertPropSvc",n);N.addFix(new aa("Rutoken.CertPropSvc",{message:dc("Rutoken/CertPropSvc/"+(aE?"service":"function")),script:1,priority:1,needadmin:1,order:420,fix:function(dG){if(aE){return cV("CertPropSvc").then(dG)
}var dH={Enabled:1};return bw.each(dH,function(dI,dJ){if(Number(dJ)==dJ){return bQ(ax,cH,dI,dJ,aM)}return bR(ax,cH,dI,dJ,aM)}).then(de,function(dI){aW.error('Ошибка изменения настроек службы "Распространения сертификатов"',dI);
return V}).then(dG)},test:function(dH){var dI=(!aH&&1==p),dG=(dI&&!o)?(aE?"run-cprop":"fix-cprop"):"";dH.setMessage("Rutoken/CertPropSvc",p,dG);return dI
}}))}if(ar){if(bj){L.setValue("Rutoken/RutokenSupport",cW)}if(bk){L.setValueEx("Rutoken",["RutokenSupportFile",cX,"RutokenSupportFileVer",cZ])}}if(bs){L.setValue("Rutoken/WinSCard",ds)
}if(be){L.setValue("Rutoken/RtCOMLite",bV);bT=!c9("err|not(found)?","i")(bV);N.addFix(new aa("Rutoken.RtCOMLite",{message:(bT?c:a)+" компонента диагностики Рутокен",caption:dc("Rutoken/RtCOMLite"),filename:"rtCOMLite.exe",args:"/S",priority:(aD()&&!au())?0:1,needadmin:1,needrestart:bT?1:0,order:640,test:function(dH){var dG="";
if(bT&&!s(bv.RtCOMLite,bV)){bU=1;dG="upd"}dH.setMessage("Rutoken/RtCOMLite",bU,dG);return(1===bU)}}))}if(bg){L.setValue("Rutoken/RutokenInfo","err")}if(bp&&at){if(F){L.setValue("Rutoken/NonTokens","timeout",-1)
}L.setValue("Rutoken/ToolboxTokens","timeout",-1)}if(bj){N.addFix(new aa("Rutoken.RutokenSupport",{message:(ce?c:a)+" модуля поддержки Рутокен для КриптоПро",caption:dc("Rutoken/RutokenSupport"),filename:aM?cd:cc,args:'/S /V"/quiet /norestart /l*vx \\"${LOGFILE}\\" REINSTALLMODE=emus'+dD+'"',priority:1,needadmin:1,needlocalsession:aE?0:1,needreboot:(ce||F)?1:0,order:610,tags:[aa.Tags.MSI],checksign:1,dependency:["Windows.InstallerVersion","CryptoPro.CSP3X"],fix:function(dI){var dG=this;
function dH(){if(dG.reinstall){dG.args='/S /V"/quiet /norestart /l*vx \\"${LOGFILE}\\" REINSTALL=ALL REINSTALLMODE=vamus'+dD+'"'}return dG.apply(function(dL){if(dL&&!dL.code){var dK=N.getFixer(),dM=dK?dK.getFix("CryptoPro.CSPCarriersLite"):a5;
if(dM){dM.applicable=1;return dM.run(function(dN){if(dN&&!dN.code){dM.applicable=0;dM.run=dM.fix=dM.apply=function(dO){return dO?dO(de):de}}return dI(dN)
})}}return dI(dL)})}if(D){var dJ="SOFTWARE\\Crypto Pro\\Cryptography\\CurrentVersion\\KeyDevices\\PCSC\\";return bM(ax,dJ,"DLL",V).then(function(dK){return W(dK).exists().truth(dH,bw.thrown())
}).caught(function(){var dK=dk.distrPath+"pcsc.msp";return az(x.rootUrl+dK,{needAdmin:dG.needadmin,altUrl:dK,expanded:de}).then(function(dL){if(dL&&!dL.code){var dM=db("CryptoPro/CSPReaders/Name","PCSC",{defaultValue:cE});
return bR(ax,dJ+"PNP PCSC\\Default\\","Name",dM,V).anyway(dH)}return dI(dL)})})}return dH()},test:function(dI){var dG=this,dJ="Rutoken/RutokenSupport",dN=(500<du)&&(du<900),dL=G&&!s(bv.CSP39R2,J),dM=H&&!s(bv.CSP40,J),dK=D||E||dL||dM;
if(dN&&dK){var dH=(2===c1)?"notcsp36r4":"";if(ce&&(0!==c0)){if(s(bv.RutokenSupport,cW)){if(2!==cY){dG.message="Переустановка модуля поддержки Рутокен для КриптоПро";
dG.reinstall=c1=1;dH="reinst"}}else{c1=2;dH="upd";dI.setMessage(dJ,c1,dH);return c1}}dI.setMessage(dJ,c1,dH);return(1===c1)||(1===cY&&(""===cX||"nolite"===cX))
}dI.setMessage(dJ,c1);return 0}}))}}).then(function(){return bw.fork(bg||bn,function(){var dz=(cP>0)||(cR>0)||a0||aY;b2=dz?"scard":(b1?"err":"driver");
cL=dz?"scard":(b1?"err":"driver");if(dz){b3=-1;L.setValue("Rutoken/RutokenInfo",b2,b3);cM=-1;return}var dE=function(dH){var dG=N.getFixer(),dF=dG.getFix(dH);
if(dF){dF.priority=1;dG.prepareFix(dF)}else{aW.error("Не найден фикс "+dH+" для его сброса")}};var dw=function(dJ){var dF=ad(dJ),dG=[];for(var dI=dF.length-1;
dI>=0;--dI){if(dF[dI]<16){dG.push("0")}dG.push(dF[dI].toString(16).toUpperCase())}var dH=dG.join("");if(dH&&(0===dH.indexOf("00000000"))){dH=dH.substr(8)
}return dH};var dC=[],dD=[],dv=V;var dx=function(dF){dC.push("["+ap()+"] "+dF)};var dy=function(dF){dD.push("["+ap()+"] "+dF)};var dB=a5,dA=a5;bx=bw.when(function(){dx("Создаем новый COM объект");
return x.createNPAXObject(bS,de)}).then(function(dF){dB=dF;dx("Подключаемся к службе");return dF.callAsync("Acquire",[],30000)}).then(function(){if(aA(b8)){dD=[];
cL={};cM=0;var dF=V,dG=dk.scardCheckStatuses||{};return bw.each(b8,function(dJ){dJ=dJ||"";var dI=dJ.toLowerCase(),dH=(dI.indexOf("aktiv")>=0)&&(dI.indexOf("sc")<0)&&(dI.indexOf("sd")<0);
if(dH){dy("Открываем считыватель "+dJ);return dB.callAsync("OpenReader",[dJ,2,5000]).then(function(dK){dy("Закрываем считыватель "+dJ);return dB.callAsync("CloseReader",[dK,0]).then(function(){cL[dJ]="0"
})}).caught(function(dM){dM=bt(dM);var dL=cJ(dM),dK=dM&&dM.number||-1;dy("Ошибка проверки считывателя: "+dL);cL[dJ]=dG[dK]?dK:dL;if(-2146435026!=dK&&-2146435060!=dK&&2148532236!=dK&&2148532270!=dK){dF=de;
cM=2}})}return a5}).then(function(){if(dF){var dH=["Ошибка проверки считывателей Рутокенов через COM, последние действия:"];aW.debug(dH.concat(dC).concat(dD).join("\r\n"))
}dD=[]})}return a5}).then(function(){dx("Получаем список устройств");return dB.callAsync("EnumReaders").then(ad)}).then(function(dF){dA=dF;dx("Получили список устройств - кол-во: "+(dA?dA.length:"null"));
if(dA&&dA.length){b2=[];dv=V;return bw.each(dA,function(dL,dH){var dG=dH+1,dK={Name:dL,ID:"err"},dI=V,dM=V,dJ;dx("Обращаемся к Рутокену №"+dG);if(dL&&dL.length){dD=[];
dy("Открываем Рутокен №"+dG+", имя: "+dL);return dB.callAsync("OpenReader",[dL,2,5000]).then(function(dN){dJ=dN;dI=de;dy("Начинаем транзакцию Рутокена №"+dG);
return dJ.callAsync("BeginTransaction").then(function(){dM=de;dy("Транзакция начата для Рутокена №"+dG);return bw.all(dJ.get("ID"),dJ.get("ModelName"),dJ.get("MemorySize"),dJ.get("FreeMemory")).spread(function(dP,dR,dU,dQ){dK.Memory={};
var dS=dK.ID=dw(dP),dT=dK.Model=dR||"empty",dV=dK.Memory.Total=dU,dO=dK.Memory.Free=dQ;if((dL+"|"+dT).toLowerCase().indexOf("rutoken lite")>=0){d(x.hexToDec(dS),"token")
}if(dO>dV){dv=de}else{if(dk.defaultTokenFolders){if(c9("Rutoken\\s+(S\\s+)?64K","i")(dT)){dk.defaultTokenFolders[0]=Math.max(dk.defaultTokenFolders[0],15);
dE("CryptoPro.CSPCarriers")}else{if(c9("Rutoken\\s+(S\\s+)?128K","i")(dT)){dk.defaultTokenFolders[0]=Math.max(dk.defaultTokenFolders[0],31);dE("CryptoPro.CSPCarriers")
}else{if(c9("Rutoken\\s+lite\\s+128K","i")(dT)){dk.defaultTokenFolders[1]=Math.max(dk.defaultTokenFolders[1],31);dE("CryptoPro.CSPCarriersLite")}}}}}})
})}).then(function(){dK.PinCodeTries=-1;return dJ.callAsync("GetRetryCounter",[2]).then(function(dN){dN=dK.PinCodeTries=Number(dN);dy("На Рутокене №"+dG+" осталось "+dN+" попыток ввода пин-кода")
}).caught(function(dP){var dO=V;if(dP){dP=bt(dP);var dN=dP.description;if((-2129565309==dP.number)||(2165401987==dP.number)||(dN&&dN.toLowerCase().indexOf("pin is block")>=0)){dy("На Рутокене №"+dG+" закончились попытки ввода пин-кода");
dK.PinCodeTries=0;dO=de}}if(!dO){dv=de;dy("Ошибка проверки кол-ва попыток ввода пин-кода: "+cJ(dP))}})}).then(function(){return dJ.callAsync("IsPINDefault",[2]).truth("1","0","").then(function(dN){dK.UserPinDefault=dN
})}).then(function(){return dJ.getAsync("Version").then(function(dN){dN=dK.Version=dN.split(":")[0];M.addCustomTokenIcon(dN,dL,dK.ID);return dN}).caught(function(dN){dy("Ошибка получения версии прошивки Рутокена: "+cJ(dN));
return""}).then(function(dP){if(x.isUCProfiles()){try{var dO=dP.split(new RegExp("\\.","g"));dK.Certified=(Number(dO[dO.length-1])>0)?1:0}catch(dN){}}})
}).then(function(){return dJ.getAsync("TokenOperability").caught(-2).then(function(dN){dK.Operability=Number(dN)})}).then(function(){return dJ.getAsync("Label").then(function(dN){dK.Label=dN||"nolabel"
},function(dN){dy("Ошибка получения метки Рутокена: "+cJ(dN))})}).then(function(){b2.push(dK);dy("Завершаем транзакцию Рутокена №"+dG);return dJ.callAsync("EndTransaction").then(function(){dM=V;
dy("Закрываем Рутокен №"+dG);return dB.callAsync("CloseReader",[dJ,0])}).then(function(){dI=V;dy("Закрыли Рутокен №"+dG)})}).caught(function(dN){dN=bt(dN);
return bw.fork(dM,function(){return dJ.callAsync("EndTransaction").caught()}).fork(dI,function(){return dB.callAsync("CloseReader",[dJ,0]).caught()}).then(function(){if(!b2.length||(b2[b2.length-1].Name!=dL)){dv=true;
b2.push(dK)}aW.debug("Ошибка обращения к Рутокену через COM (№"+dG+", имя: "+dL+"), последние действия:\r\n"+dD.join("\r\n"),dN)})}).then(function(){dC=dC.concat(dD);
dD=[]})}else{dx("Пустое имя у Рутокена №"+dG)}return a5}).then(function(){b3=dv?2:0})}else{b2="none";b3=-1}return a5}).lastly(function(){return dB.callAsync("Free").anyway(dB.free)
}).then(function(){if(dv){throw new Error("Найден плохой токен")}if(dA&&dA.length&&(!b2||!aA(b2)||!b2.length)){throw new Error("Обнаружены подключенные Рутокены, но ни к одному из них не удалось обратиться")
}}).caught(function(dF){dF=bt(dF);if(bT){if(dD.length){dC=dC.concat(dD);dD=[]}aW.debug("Ошибка работы с рутокенами через COM, последние действия:\r\n"+dC.join("\r\n"),dF)
}else{b2="needcom";b3=-1;cL="needcom";cM=-1}})}).fork(bp&&at,function(){var dv=function(dw,dz){if(dw||!dz||!aA(dz)){aW.error("Ошибка получения информации о токенах: "+(dz||"неизвестно"));
return}var dx=[],dE=[],dC=dz;for(var dA=0,dB=dC.length;dA<dB;++dA){var dy=dC[dA];if(dy.media){dx.push({Name:dy.name,Nick:dy.nickname,Type:dy.type,Serial:dy.media})
}else{if(dy.model){var dD={Slot:dy.slot,ID:dy.serialNumber,Manufacturer:dy.manufacturer,Model:dy.model,TotalMemory:dy.totalMemory,FreeMemory:(4294967295==dy.freeMemory)?-1:dy.freeMemory};
if(dy.maxContainerCount){dD.MaxCont=dy.maxContainerCount}if("undefined"!=typeof(dy.certified)){dD.Certified=dy.certified?1:0}dE.push(dD)}}}if(F){a3=dx.length?dx:"none"
}da=dE.length?dE:"none"};return bw.promisify(function(dx,dw){c8.getTokensInfosAsync(dx);window.setTimeout(function(){dw(new Error("TIMEOUT"))},30000)}).caught(function(dw){return bw.args(de,cJ(dw,de))
}).then(dv)}).fork(bb,function(){var dv=new b0(V);return dv.Check().truth(function(){return dv.Enum().then(function(dw){if(dw&&aA(dw)&&dw.length){return 1
}return bw.when(dv.CookieInstalled).truth(0,1)})},V).then(function(dw){q=dw})})}).then(function(){var dx={};function dz(dE){var dC=0,dF=0,dD=[];return bw.when(function(){var dJ=x.getKTObject("Crypto"),dI=dJ.getCertificates({storeLocation:"user",storeName:"my"}),dS=dk.serverTime;
for(var dM=0,dN=dI.length;dM<dN;++dM){var dG=dI[dM],dK=dG.getValidFrom(),dL=dG.getValidTo();if((dK<=dS)&&(dS<=dL)){var dT=dG.getHash().toHexString().toUpperCase(),dH=aq(dG);
++dC;if(dH){++dF}if(!dE&&!dx[dT]){var dO=ae(dG.getSubject(),V),dP=ae(dG.getIssuer(),V);dD.push(["Имя: "+af(dO),"Орг.: "+ag(dO),"Издатель: "+af(dP),"Действ. до: "+w(dL,de,V),"Серийный номер: "+String(dG.SerialNumber).toUpperCase(),"Отпечаток: "+dT,"Лицензия: "+(dH?"есть":"нет")].join(", "))
}dx[dT]=de}}if(dD.length){dD=dD.sort(function(dU,dV){return(dU||"").toLowerCase().localeCompare((dV||"").toLowerCase())});for(var dQ=0,dR=dD.length;dQ<dR;
++dQ){dD[dQ]=(dQ+1)+". "+dD[dQ]}}}).anyway(function(){return{total:dC,lic:dF,certs:dD}})}N.addFix(new aa("Rutoken.InstallFromTokens",{message:dc("Rutoken/InstallFromTokens"),script:1,priority:1,needadmin:aC()?1:0,order:3000,prefix:function(dE,dG){var dC=this,dF="",dI=0,dD=0,dH=0;
dC.wait=de;dC.callback=dG;return dz(de).then(function(dJ){dC.oldCertsCount=dJ.total;dC.oldCertsLicCount=dJ.lic;dE.callEvent(a7,dC,V);function dK(){if(!dC.wait){return a5
}var dM=new b0(V),dL;return dM.Check().lie(function(){return bw.result(V)}).then(function(){return dM.EnumReaders()}).then(function(dN){return(dN&&dN.length)?bw.result(de):a5
}).then(function(){dL="";if(aA(df)&&df.length){var dS=V,dT=de;for(var dQ=0,dR=df.length;dQ<dR;++dQ){var dN=df[dQ],dO=dN.Type,dP=dN.Connected&&dN.Enabled&&dO;
if(O){dP=dP&&("24DC_0101"===dO)}else{if(!dk.centerInformLocale){dP=dP&&("Flash"!==dO)}}if(dP){dS=de;if(!dN.Driver){dT=V}dL+=dN.Id+"#"}}if(dS){dI=0;if(dF!==dL){dH=0;
dF=dL}if(dT){dD=0;if(dH<15){dE.callEvent(a7,dC,"read")}}else{++dD;dE.callEvent(a7,dC,(dD>=15)?"driverwait":"driver")}return bw.timeout(50).then(function(){return dM.Enum()
}).then(function(dU){if(((dU instanceof Array)&&dU.length)||dM.CookieInstalled()){dE.callEvent(a7,dC,de);dC.rtConts=dU;return bw.timeout(50).then(function(){return bw.result(de)
})}++dH;if(15===dH){dE.callEvent(a7,dC,a5)}return bw.timeout(2000).then(dK).then(bw.result)})}}return a5}).then(function(){++dI;if(15===dI){dE.callEvent(a7,dC,"wait")
}if(dF!==dL){dI=0;dH=0;dD=0;dF=dL;dE.callEvent(a7,dC,V)}return bw.timeout(2000).then(dK)})}return dK()}).caughtReturn(dG)},cancel:function(){var dC=this;
if(dC.wait&&dC.callback){dC.wait=V;dC.callback(V)}else{aW.error("Ранний вызов метода cancel() объекта "+dC.name)}},fix:function(dD){var dE=new b0(V),dC=this;
dC.result={Total:0,Good:0,New:0,License:0,LicenseNew:0};return dE.Check().truth(function(){return dC.rtConts||dE.Enum()},V).truth(function(dG){var dF=dG&&(dG instanceof Array)&&dG.length;
if(!dF){return de}return dE.InstallAll(function(dH){dC.result.Total+=1;if(dH){dC.result.Good+=1}N.getFixer().callEvent(a7,dC,["install",dG.length,dC.result.Total])
}).then(function(dH){return dz(V).then(function(dI){dC.result.New=dI.total-(dC.oldCertsCount?dC.oldCertsCount:0);dC.result.License=dI.lic;dC.result.LicenseNew=dC.result.License-(dC.oldCertsLicCount?dC.oldCertsLicCount:0);
dC.result.Certs=dI.certs;dC.rtConts=a5;return dH})})}).then(dD)},test:function(){if(bb){return q||!J||("not"===J)||F}return 0}}));if(bf){L.setValue("Rutoken/RutokenDevices",df)
}if(bq){L.setValue("Rutoken/USBHubs",dh)}if(bi){var dA=((b1||t)&&("none"===b8))?2:ca;L.setValue("Rutoken/RutokenReaders",b8,dA,b9)}if(bn){L.setValue("Rutoken/SCardCheck",cL)
}if(da){L.setValue("Rutoken/ToolboxTokens",da,-1)}if(a3){L.setValue("Rutoken/NonTokens",a3,-1)}if(bf){N.addFix(new aa("Rutoken.RutokenDevices",{message:dc("Rutoken/RutokenDevices"),filename:"RutokenFix.exe",args:"/S",priority:1,needadmin:1,needlocalsession:1,order:630,test:function(dK){dk.connectedRutokenCount=0;
dk.connectedRutokenLiteCount=0;var dC=dk.conflictJaCartaRutoken,dH=(dC>=3)?2:(dC?1:0);if(aA(df)){var dT=0,dS=[],dQ=V,dP=V,dD=0,dE=0;for(var dI=0,dJ=df.length;
dI<dJ;++dI){var dF=df[dI],dG=dF.Type,dR=0,dL=("Rutoken"===dG||"Rutoken S"===dG),dM=("Rutoken Lite"===dG);if(dF.Connected){if(dM){++dE}else{if(dL){++dD}}}else{if(a5===dF.Connected){if(dM){dP=de
}else{if(dL){dQ=de}}}}if(!dF.Driver){dR=(dF.Connected&&(dF.Ignore||dM))?2:1;dT=Math.max(dR,dT)}dS.push(dR)}if((dD>0||dE>0)&&("none"==b2)){b2="invisible";
b3=1;if(bg){L.setValue("Rutoken/RutokenInfo",b2,b3)}}if(0===dD&&dQ){dD=-1}if(0===dE&&dP){dE=-1}dk.connectedRutokenCount=dD;dk.connectedRutokenLiteCount=dE;
dK.setMessage("Rutoken/RutokenDevices",dH?Math.max(dH,dT):dT);for(var dN=0,dO=dS.length;dN<dO;++dN){dK.setMessage("Rutoken/RutokenDevices/"+dN,dS[dN])}return(2===dT)
}dK.setMessage("Rutoken/RutokenDevices",dH||dg);return 0}}))}if(ar&&bk){L.setMessage("Rutoken/RutokenSupportFile",cY);var dB="";if(0===cY&&2===c0){dB="Должна быть версия "+bX+" или новее."
}L.setMessage("Rutoken/RutokenSupportFileVer",c0,dB)}if(bs){L.setMessage("Rutoken/WinSCard",(0===cM)?0:dt)}if(bg){L.setMessage("Rutoken/RutokenInfo",b3);
if(aA(b2)&&b2.length){ac(b2,function(dD,dC){if(dD.PinCodeTries<=0){L.setMessage("Rutoken/RutokenInfo/"+dC,2)}})}}if(bq){var dw=[];if(aA(dh)){var dv=c9("asmedia|texas|D_HUB","i");
ac(dh,function(dD,dF){var dE=dD.Name,dC=dD.Class;if((dE&&dv(dE))||(dC&&dv(dC))){dw.push(dF);di=2}})}var dy=(2==di)?"badusb":"";L.setMessage("Rutoken/USBHubs",di,dy);
if(dw.length){ac(dw,function(dC){L.setMessage("Rutoken/USBHubs/"+dC,2)})}}}).then(function(){return bx.then(function(){if(bg){L.setValue("Rutoken/RutokenInfo",b2)
}if(bn){L.setValue("Rutoken/SCardCheck",cL,cM)}}).caught().fork(bi,function(){var dw={};var dy={};var dx=V;if((k>aX)||!b1){if("object"==typeof(cL)){for(var dz in cL){if("0"===cL[dz]){dw[dz]=de
}}}if(da&&aA(da)&&da.length){ac(da,function(dA){if(dA&&dA.Slot){dw[dA.Slot]=de}})}if(b2&&aA(b2)&&b2.length){ac(b2,function(dA){if(dA&&dA.Name){dw[dA.Name]=de
}})}ac(l,function(dA){if(dw[dA.name]){h[dA.name.toLowerCase()]=V}});if(l.length){l=l.sort(function(dA,dD){var dC=(dA.name||"").toLowerCase(),dF=(dD.name||"").toLowerCase(),dH=dA.isRutokenS,dI=dD.isRutokenS,dB=dA.idx,dE=dD.idx;
if(!dH){dB+=1}if(!dI){dE+=1}var dG=dE-dB;if(dG){return dG}return(dH&&dI)?0:(dH?1:(dI?-1:dF.localeCompare(dC)))});var dv=k-aX;ac(l,function(dB){var dA=dB.idx;
if(dB.isRutokenS&&dA>aT){h[dB.name.toLowerCase()]=de;dv--;dx=de}});ac(l,function(dB){var dA=dB.name.toLowerCase();if(dv>0&&a5===h[dA]){h[dA]=de;dv--;dx=de
}});if(dx){ca=2;L.setMessage("Rutoken/RutokenReaders",ca,b9);ac(b8,function(dB,dA){if(h[dB.toLowerCase()]){L.setMessage("Rutoken/RutokenReaders/"+dA,2);
dy[dB]=de}})}}}N.addFix(new aa("Rutoken.RutokenReaders",{message:dc("Rutoken/RutokenReaders"),script:1,priority:1,needadmin:1,needreboot:1,order:418,fix:function(dA){return bw.when(function(){if(au()||aD()){throw P("UAC or User",5)
}var dB=de;return bw.each(dy,function(dC){return bD(ax,bC+"\\"+dC,aM).caught(function(dD){dB=V;aW.debug('Ошибка удаления считывателя "'+dC+'"',dD)})}).then(function(){return dB
})}).caught(function(){var dB=[];ac(dy,function(dC){dB.push(dC)});return bY('DeleteCalaisReaders "'+dB.join(";;;")+'"')}).then(dA)},test:function(){return dx
}}))})}).then(de)};window.SkbKontur.Help.Scripts.KonturExtern=function(v,i,aT){var V=window.SkbKontur.Help,l=V.Core,w=V.Diagnosis,N=V.foreach,a2=V.Promise,bd=V.Test,bn=V.trim,X=l.HKCU,Y=l.HKLM,W=l.HKCR,h=l.call,k=l.compareVersion,p=l.dateToDisplayDate,H=l.File,I=l.findProductPath,M=l.Folder,O=l.formatDate,Q=l.getProcesses,R=l.getProductAllVersions,S=l.getProductInfoReg,T=l.getProductVersion,U=l.hasUac,Z=l.isFileNotFoundError,ad=l.isUser,aB=l.log,aC=l.maxVersion,a3=l.$readAll,a4=l.regClasses,a6=l.regMicrosoft,a9=l.regRoots,ba=l.rootUrl,bb=l.run,a7=l.$regReadNumber,a8=l.$regReadString,bl=l.trackEvent,bp=l.uninstallAllByMask,br=l.vars,f=br.arch,x=br.diagnostics,y=br.distrPath,al=br.ke1cVersion,ay=br.konturToolbox2ObjectKeys,az=br.konturToolbox2ObjectVersions,aD=br.microsoftLinkRoot,aZ=br.productSizes,aY=br.productMasks,a0=br.productVersions,bs=br.winSP,bt=br.winVer,L=V.Fix,bm=w.translateFix;
var aG=null,G=false,bo=true,b="Actions/",a=bm(b+"install"),c=bm(b+"reinstall"),d=bm(b+"update"),ag=(500==bt),ae=(bt>=600),ah=(bt>=700),aj=(bt>=800),ai=(bt>=810),af=(bt>=1010),aa=l.isSystem(),ab=ae||(501==bt&&bs>=3)||((502==bt||503==bt)&&bs>=2),ak=(64==f),aA;
var j=aT?aT.Certificates:aG;aT=aT?aT.KonturExtern:aG;var C=aG;l.findEiasPath=function(){return a2.fork(C&&C.length,C,function(){return I(aY.EIAS,"{C363E80B-33CA-4BE4-9BAB-0D55594E4257}",bo).then(function(bu){return C=bu
})})};var bq={};function P(bu,bv,bx,bw){return a2.all(S(bv,bx,"DisplayName",G),S(bv,bx,"DisplayVersion",G),S(bv,bx,"InstallDate",G),S(bv,bx,"UninstallString",G)).spread(function(bz,bB,by,bA){by=p(by);
bA=bA.replace(new RegExp('^\\"|\\"$',"g"),"");return H(bA).get("ed").then(function(bE,bF){if(bE&&bF.dateCreated){bq[bu]=bA;var bC=new Date(bF.dateCreated);
if(!by||(10!=by.length)||(by==O(bC,bo,G))){by=O(bC,G,G)}else{if(bF.dateOpened){var bD=new Date(bF.dateOpened);if(by==O(bD,bo,G)){by=O(bD,G,G)}}}}if(bz){bw=bw||[];
bw.push({Name:bz,Version:bB,InstallDate:by})}})}).anyway(function(){return bw})}var aO=!aT||aT.KonturToolbox2,aP=!aT||aT.KonturToolbox3,av=aY.KonturToolbox,ar="err",bj=aG,bk=aG,J=-1,K=-1,at=1,au=1,a1=(window.profileName||"ke").toLowerCase(),ax=l.getKT2Version(),ac=("uc"==a1),aE=br.needKT2Pilot,aw=aE?a0.KonturToolboxPilot2:a0.KonturToolbox2,aF=br.needKT3Pilot;
var aU=!aT||aT.Toolbox2Register,bf="err",bg=2,be=G;var aV=!aT||aT.Toolbox3Register,bh="err",bi=2,a5=window.regionId;if(bd("^(ke|kekep|keweb)$","i")(a1)){if(4==a5||22==a5||42==a5||50==a5||54==a5||55==a5||66==a5||72==a5||74==a5||77==a5){br.needInstallAgent=1
}}var aM=!aa&&(aT&&aT.KonturAgent||br.needInstallAgent),e;var aN=aT&&aT.KonturArchive,g;var aR=!aT||aT.NetFramework,A;var aJ=br.allProfile||(aT&&aT.DiadocPrint&&br.needInstallDiadocPrint),r=aG,s="err",q=2;
var aQ=br.allProfile||br.eiasLocale||(aT&&aT.NET40Full&&(!aT.DiadocPrint||aJ)),B,z,bc="/passive /norestart";var aS=aT&&aT.NET40Patch,aW="err",aX=2;var aK=br.eiasLocale||(aT&&aT.EIASVersion),E=aG,F="err",D=2;
var aL=aT&&aT.Kontur1C,ap=aG,aq="err",an="0.0.0",am=-1,ao=2;var aH=aT&&aT.Cryptor,n=aG,o="err",m=2;var aI=aT&&aT.Diadoc1C,u,t;return a2.when(l.getLocator).then(function(bu){aA=bu;
var bw={},bv={};function bz(bF,bE,bD,bC){if(bw[bF][bC]){bw[bF][bC].Actual.push(bD);if(bD!=bE){bw[bF][bC].Expected.push(bE)}}else{return H(bC).get("ev").then(function(bG,bH){bw[bF][bC]={Actual:[bD],Expected:bG?[]:[bE],Version:bG?bH:"notfound"};
return bG||a2.thrown(new Error("File "+bC+" not exist"))})}return a2.resolve()}function bx(bF,bH,bD,bE){var bC="CLSID\\",bI="TypeLib",bG=(bH===W)?"":a4;
return a8(bH,bG+bD+"\\CurVer\\","",G).then(function(bJ){return a8(bH,bG+bD+"\\"+bC,"",G).caught(function(){return a8(bH,bG+bJ+"\\"+bC,"",G)}).then(function(bK){return a8(bH,bG+bC+bK+"\\InprocServer32\\","",G).then(function(bL){return a2.args(bJ,bK,bL)
})})}).then(function(bL,bK,bJ){bE=String(bE);var bN=bD.substr(bD.indexOf(".")+1)+"."+bE,bM=bL.substr(bL.indexOf(".")+1);return bz(bF,bN,bM,bJ).then(function(){return a8(bH,bG+bC+bK+"\\"+bI+"\\","",G)
}).then(function(bO){var bQ={"3.0.0":"0.0"}[bE];if(!bQ){var bR=bE.split(new RegExp("\\.","g"));if(bN.indexOf("Plugin")>=0){bQ=bR[0]+"."+bR[2]}else{if(bE&&k("2.3.0",bE)){bQ=bR[1]+"."+bR[2]
}else{bQ=(bN.indexOf("Toolbox2")>=0?"2.0":"1.0")}}}var bP="\\"+bQ+"\\0\\win32\\";return a8(bH,bG+bI+"\\"+bO+bP,"",G)}).then(function(bO){return bz(bF,bN+"\\"+bI,bM+"\\"+bI,bO)
}).anyway(function(){return k(bE,bL.substr(bD.length+1),"checkComponent")})}).caught(G)}function by(bD,bF,bE,bG){var bC=G;bw[bD]={};return a2.each(bE,function(bI,bH){return bx(bD,bF,bI,bG[bH]).lie(function(){bC=bo
})}).then(function(){bv[bD]=0;N(bw[bD],function(bH,bI){if(bI){++bv[bD]}});return !bC&&(1==bv[bD])})}function bA(bE,bD,bG,bF){var bC=a9[bE]+bD[0];return by(bC,bE,bD,bG).then(function(bI){if(!bI&&(bv[bC]>1)){bI=[];
var bJ=[],bH=G;N(bw[bC],function(bL,bQ){var bM=bQ.Version,bK=bQ.Actual,bN=bQ.Expected,bO={Root:bE,Path:bL,Actual:bK};if(bM){bO.Version=bM}bI.push(bO);if(bN.length){bH=bo;
var bP={};N(bO,function(bR,bS){bP[bR]=bS});bP.Expected=bN;bJ.push(bP)}});return[bH?bJ:bI,2]}return[(bI?"yes":"no")+(bF||""),bI?0:1]})}function bB(bF,bG,bJ,bK,bD,bE,bL){var bC=bD!==aG&&bD!==undefined||bE!==aG&&bE!==undefined;
if(bC&&2==bE){return a2.resolve("bad")}if(2==bG){return a2.resolve((2==bK)?bF.concat(bJ):bF)}if(0!==bG&&2==bK){return a2.resolve(bJ)}if(!bL){return a2.resolve(bF+";"+(2==bK?"bad":bJ)+(bC?(";"+(2==bE?"bad":bD)):""))
}function bI(bM){var bN="";return a2.each(bw[bM],function(bO){return H(bO).get("v").then(function(bP){if(bP&&bP.length){bN=bP;return a2.$break()}return aG
})}).then(function(){return bN},function(bO){aB.debug("Не удалось получить версию библиотеки "+bM,bO);return""})}var bH=ay[0];return a2.all(bI(a9[X]+bH),bI(a9[Y]+bH),bC?bI(a9[W]+bH):aG).spread(function(bN,bO,bP){var bM=[bF+bN,(2==bK?"bad":bJ)+bO];
if(bC){bM.push(bD+bP)}return bM.join(";")})}return a2.fork(aO||aP,function(){return R(av).then(function(bC){return aa?bC:P("Toolbox2CU",X,"ToolboxPlugin",bC)
}).then(function(bC){return P("Toolbox2LM",Y,"ToolboxPlugin",bC)}).then(function(bC){return aa?bC:P("Toolbox3",X,"SkbKontur Plugin",bC)}).then(function(bC){ar=bC||"none"
},function(bC){aB.debug("Ошибка получения версий Контур.Тулбокс",bC)})}).fork(!aa&&(aO||aU||aP||aV),function(){if(ab){var bC="KonturPlugin",bD;return a2.fork(aF,function(){bD=a0.KonturToolboxPilot3;
return bA(X,[bC],[bD],bD)},function(){bD=a0.KonturToolbox3;return bA(X,[bC],[bD]).then(function(bE){if(("yes"!==bE[0])&&(bD!==a0.KonturToolboxMin3)){bD=a0.KonturToolboxMin3;
return bA(X,[bC],[bD])}return bE})}).then(function(bF){var bG=bF[0];bi=bF[1];bh=bG;if("yes"===bG){var bE=bw["HKCU\\"+bC];N(bE,function(bL,bH){var bJ=bH&&bH.Version;
if(bJ&&k(bD,bJ)){bh=bG+bJ;return G}var bI=H(bL);if(bI.folder){var bK=M(bI.folder).name;if(bK){bh=bG+bK;return G}}return aG})}})}else{bh="winold";bi=2}return aG
}).fork(aO||aU,function(){var bC=aE?ax:aG;return a2.all(h(bA,X,ay,az,bC),h(bA,Y,ay,az,bC),h(bA,W,ay,az,bC)).spread(function(bG,bH,bF){var bE=bG[1],bI=bH[1],bD=bF[1];
be=(1==bD&&(1!==bE||1!==bI));bg=(be||2===bE||(0!==bE&&2===bI))?2:((0===bE||0===bI)?0:1);return bB(bG[0],bE,bH[0],bI,bF[0],bD,!aE)}).then(function(bD){bf=bD
})}).fork(aM,function(){return S(X,"SkbKontur Agent","DisplayVersion",G).caught(aG).then(function(bC){e=bC})}).fork(aN,function(){return S(X,"KonturOfflineArchive","DisplayVersion",G).caught(aG).then(function(bC){g=bC
})}).fork(aR,function(){return a7(Y,a6+"NET Framework Setup\\NDP\\v2.0.50727\\","SP",G).then(function(bC){A=Number(bC)},function(){A=af?"win10":(ai?"win81":(aj?"win8":(ah?"win7":(ae?"vista":("not"+(f||""))))))
})}).fork(aQ,function(){if(aj){B="unused";z=0;return aG}return a8(Y,a6+"NET Framework Setup\\NDP\\v4\\Full\\","Version",G).lie(a2.thrown("Empty Version",2),function(bC){B=bC;
z=k("4.0",B)?0:1}).caught(function(){B="not";z=aJ?-1:(aH?2:1)})}).fork(aS,function(){function bC(bE){var bD="PackageName";return a8(Y,a6+"Updates\\"+bE+"\\KB2468871\\",bD,G).lie(a2.thrown("Empty "+bD,2),function(){aW="yes";
aX=0}).caught(function(bF){if(!Z(bF)){aB.debug("Ошибка определения патча .NET 4.0 в ветке "+bE,bF)}aW="no";aX=1;return a2.thrown(bF)})}if(aj||((0===z)&&k("4.5",B))){aW="unused";
aX=0;return aG}return bC("Microsoft .NET Framework 4 Extended").caught(function(){return bC("Microsoft .NET Framework 4 Client Profile").caught()})}).fork(aK,function(){return T(aY.EIAS).then(function(bC){E=bC;
F=E||"not";D=E?0:1},function(bC){aB.debug("Ошибка определения версии ЕИАС Мониторинг",bC)})}).fork(aL,function(){return R(aY.Kontur1C).then(function(bC){ap=bC;
aq=ap||("none"+(al||""));ao=ap?0:1},function(bC){aB.debug("Ошибка определения версии Kontur1C",bC)}).then(function(){if(aq instanceof Array){for(var bC=0,bD=aq.length;
bC<bD;++bC){var bE=aq[bC];if(bE){var bF=bE.Name,bG=bE.Version;if(bG&&bG.length){if(bF&&bF.length&&bF.indexOf(bG)>0){bE.Name=bn(bF.replace(bG,""))}an=aC(an,bG);
if(am<0){am=bC}}}}}})}).fork(aJ,function(){return S(X,"SkbKontur Diadoc.Print.Forms.Addon","DisplayVersion",G).caught(aG).then(function(bC){r=bC;s=r||"not";
q=r?0:2})}).fork(aH,function(){return S(X,"{711ae761-81b3-46b9-bacb-ccd573410948}","DisplayVersion",G).caught(aG).then(function(bC){n=bC;o=n||"not";m=n?0:1
})}).fork(aI,function(){var bC="diadocSupport.txt",bD=l.buildPath(aA.$Temp,bC);return H(bD).get("es").truth(function(bE,bF){if(bF>102400){u="big";t=1}else{return a3(bD,65001).then(function(bG){var bI=bG.split(new RegExp("\\r?\\n","g")),bH=new RegExp(["(\\d{4})","(\\d{2})","(\\d{2})\\s*T\\s*(\\d{2})","(\\d{2})","(\\d{2})"].join("[:\\-\\.]"),"i");
u=[];N(bI,function(bL){var bJ=bL.indexOf(":");if(bJ<=0){return}var bK=bn(bL.substr(0,bJ)),bN=bn(bL.substr(bJ+1));if("ДатаСоздания"==bK){bN=V.strToDate(bN,bo);
var bM=bH.exec(bN);if(bM&&(bM.length>6)){bN=new Date(Number(bM[1]),Number(bM[2])-1,Number(bM[3]),Number(bM[4]),Number(bM[5]),Number(bM[6])).getTime()}}u.push({Key:bK,Value:bN})
});t=-1}).caught(function(bG){u="err";t=1;aB.error("Ошибка чтения файла "+bC,bG)})}return aG})})}).then(function(){var cj=ad()&&!U(),bY=aG;function bS(cl,cr,ck,co,cn,cm){function cq(ct,cs){if(ct!==cl.filename){cl.needadmin=cs?1:0;
cl.filename=ct;cl.foreign=y+ct;cl.url=ba+cl.foreign;cl.size=aZ[ct.toLowerCase()]||0}return cl.apply(cm)}function cp(ct,cs){aB.info("Удаление старой версии программы...");
aB.debug('Запускаем деинсталлятор "'+ct+'" /S');return bb(ct,{args:"/S",show:bo,admin:!!cs}).waitExit().then(function(cv){var cu=cv.exitCode();aB.debug("Продукт удален "+((0===cu)?"успешно.":(" с ошибкой (код: "+(cu||-1)+")")))
},function(cu){aB.error("Ошибка удаления продукта "+ct,cu)}).then(function(){br.diagnostics.getFixer().resetProgress()})}return a2.when(bp,co,G).fork(!cj,h(bp,cn,bo)).fork(cl.uninstallCU,h(cp,cl.uninstallCU,G)).fork(!cj&&cl.uninstallLM,h(cp,cl.uninstallLM,bo)).then(function(){if(!cl.skipUser&&(cj||cl.onlyUpdateUser)){return cq(cr||ck,!!ck)
}return cl.apply(function(cs){if((cs&&!cs.code)||(cl.filename===cr&&!ck)){return cm(cs)}return cq(ck||cr,!!ck)})})}function bB(co){if(("string"==typeof(co))&&(co.indexOf(";")>0)){var cn=co.split(";"),ck=cn[0],cm=cn[1];
if((ck.indexOf("yes")>=0)&&(cm.indexOf("yes")>=0)){var cl=ck.replace("yes","");if(!k(aw,cl)){return !k(cm.replace("yes",""),cl,"checkUserReg")}}}return aG
}function bA(ck){return Q().each(function(cl){if(cl&&cl.name&&ck(cl.name)){return a2.$break(bo)}return aG},G)}function bK(co,cq,cs){function cr(cv){return document.getElementById(cv)
}var ck=G,ct=bd("(^|\\s|\\/|\\\\)"+cs.replace(".","\\.")+'(\\"|\\s|>|<|$)',"i"),cp=x.getFixer().getFixId(co.name),cl="cancel"+cq+"Setup",cn=cr("diag-fix-custommessage-"+cp);
V[cl]=function(){ck=bo;return G};function cm(){var cv=document.createElement("a");cv.href="#";cv.onclick=Function("return SkbKontur.Help."+cl+"()");cv.innerHTML="отмените&nbsp;настройку";
return cv}if(cn){cn.innerHTML="Для продолжения обновления необходимо закрыть программу Контур.Архив.<br/>После этого настройка продолжится автоматически. Или ";
cn.appendChild(cm())}function cu(cv){if(cn){cn.style.display=cv?"":"none"}}return a2.wait(function(){return bA(ct).caught(function(cv){aB.error("Не удалось найти процессы "+cs,cv);
return G}).then(function(cv){if(!cv){cu(G);return bo}if(!ck){cu(bo);return G}cu(G);aB.debug("Пользователь отменил установку "+cq);return bo})},aG,0,999).then(function(cv){return !ck&&cv
})}if(aO||aP){if("none"!==ar){bj="0.0.0";bk="0.0.0";for(var bQ=0,bR=ar.length;bQ<bR;++bQ){var b3=ar[bQ];if(b3){var b4=bn(b3.Name||""),b5=b3.Version;if(b5&&b5.length){if(b4&&b4.length){if((b4.length-b5.length)==b4.indexOf(b5)){b3.Name=bn(b4.replace(b5,""))
}}if(k("3.0",b5,"KT3")){au=0;bk=aC(bk,b5);if(K<0){K=bQ}}else{if(k("2.0",b5,"KT1_and_KT2")){at=0;bj=aC(bj,b5);if(bd("Администратор|Administrator","i")(b4)){bY=bY?aC(bY,b5):b5
}if(J<0){J=bQ}}}}}}}else{ar=ag?"none2k":"none"}v.setValue("KonturExtern/KonturToolbox",ar)}if(aU){v.setValue("KonturExtern/Toolbox2Register",bf)}if(!aa&&(aU||aV)){v.setValue("KonturExtern/Toolbox3Register",bh)
}if(aM){v.setValue("KonturExtern/KonturAgent",e||"not");var bw=e&&e.length,bv=bm("KonturExtern/KonturAgent");x.addFix(new L("KonturExtern.KonturAgent",{message:(bw?d:a)+" "+bv,caption:bv,filename:"Kontur.Agent.Installer.exe",args:"/S",order:1840,needadmin:0,priority:1,tags:[L.Tags.APPDATA],test:function(cm){var ck=bw?0:1,cl="";
if(bw&&!k(a0.KonturAgent,e,"Agent")){ck=1;cl="upd"}cm.setMessage("KonturExtern/KonturAgent",ck,cl);return ck}}))}if(aN){v.setValue("KonturExtern/KonturArchive",g||"not");
var by=g&&g.length,bx=bm("KonturExtern/KonturArchive"),bz={code:1602,message:l.codeToMessages[1602]};x.addFix(new L("KonturExtern.KonturArchive",{message:(by?d:a)+" "+bx,caption:bx,filename:"kontur.archive.exe",args:(by?"/S":"/MIN"),order:1838,needadmin:0,priority:1,tags:[L.Tags.APPDATA],dependency:["CryptoPro.CSP3X","KonturExtern.NET40Full","KonturExtern.NET40Patch"],custommessage:" ",fix:function(cl){var ck=this;
return bK(ck,"KonturArchive","Kontur.Archive.UI.exe").lie(bz,function(){return ck.apply()}).then(cl)},test:function(cm){var ck=by?0:1,cl="";if(by&&!k(a0.KonturArchive,g,"Archive")){ck=1;
cl="upd"}cm.setMessage("KonturExtern/KonturArchive",ck,cl);return ck}}))}if(aR){v.setValue("KonturExtern/NetFramework",A);var bF=af?(ak?"dotNet35_Win10_x64.exe":"dotNet35_Win10.exe"):(ai?(ak?"dotNet35_Win81_x64.exe":"dotNet35_Win81.exe"):(aj?(ak?"dotNet35_Win8_x64.exe":"dotNet35_Win8.exe"):(ah?"dotNet35_Win7.exe":(ae?(ak?"NetFX2.0-KB948609-v6001-x64.msu":"NetFX2.0-KB948609-v6001-x86.msu"):(ak?"NetFx20SP2_x64.exe":"NetFx20SP2_x86.exe"))))),bH=(!aj&&(ae||ak))?"dotnetfx35.exe":aG,bG=(ag||ae)?aG:(ak?br.dotNetLink64:br.dotNetLink32),bE=bm("KonturExtern/NetFramework/"+(af?"win10":(ai?"win81":(aj?"win8":"xp"))));
x.addFix(new L("KonturExtern.NetFramework",{message:(("number"==typeof(A))?d:a)+" "+bE,caption:bE,filename:bF,foreign:bG,args:ah?"/S":(ae?"":bc),localfile:bH,localargs:bc,needadmin:1,order:300,dependency:["Windows.InstallerVersion"],priority:0,needreboot:(!ae||aj)?0:1,test:function(ck){var cm,cl="";
if(("number"==typeof(A))&&(A>=2)){cm=0}else{if(("number"==typeof(A))&&(A>=0)){if(ae){cl="fix35sp1"}else{if(ak){cl="fix20x64"}else{cl="fix20x86"}}cm=1}else{cm=1
}}var cn=V.Scripts;if(!cn.KELite){if(!((br.cryptoproLocale&&!ai)||ac||(j&&j.Lanit))){cl="";cm=-1}}ck.setMessage("KonturExtern/NetFramework",cm,cl);return(1===cm)&&!!(bF&&bF.length)
}}))}if(aQ){v.setValue("KonturExtern/NET40Full",B);var ca=bm("KonturExtern/NET40Full"),cd="dotNetFx40_Full.exe";x.addFix(new L("KonturExtern.NET40Full",{message:a+" "+ca,caption:ca,filename:cd,args:bc,foreign:aD+"1/B/E/1BE39E79-7E39-46A3-96FF-047F95396215/"+cd,localfile:"dotNetFx40_Full_x86_x64.exe",localargs:bc,priority:1,needadmin:1,order:340,dependency:["Windows.InstallerVersion"],test:function(ck){ck.setMessage("KonturExtern/NET40Full",z);
return(!aT||!aT.DiadocPrint||aJ)&&(("not"===B)||(1==z))}}))}if(aS){v.setValue("KonturExtern/NET40Patch",aW);var cb=bm("KonturExtern/NET40Patch",a),cc=ak?"NDP40-KB2468871-v2-x64.exe":"NDP40-KB2468871-v2-x86.exe";
x.addFix(new L("KonturExtern.NET40Patch",{message:cb.message,caption:cb.caption,filename:cc,args:bc,foreign:aD+"2/B/F/2BF4D7D1-E781-4EE0-9E4F-FDD44A2F8934/"+cc,priority:1,needadmin:1,order:341,dependency:["Windows.InstallerVersion","KonturExtern.NET40Full"],test:function(ck){ck.setMessage("KonturExtern/NET40Patch",aX);
return("no"===aW)}}))}if(aK){v.setValue("KonturExtern/EIASVersion",F);var bI="ADDLOCAL=Complete,MainProgramm,MicrosoftOfficeInterop",bJ=bm("KonturExtern/EIASVersion");
x.addFix(new L("KonturExtern.EIASVersion",{message:(E?d:a)+" "+bJ,caption:bJ,filename:"EIAS.Reporting.msi",args:bI+" START_ON_WINDOWS_LAUNCH=${EMPTYSTRING}",priority:1,needadmin:1,order:1970,tags:[L.Tags.MSI],dependency:["Windows.InstallerVersion","KonturExtern.NET40Full","CryptoPro.CSP3X"],test:function(cl){var ck="";
if(E&&!k(a0.EIAS,F)){D=1;ck="upd"}cl.setMessage("KonturExtern/EIASVersion",D,ck);return D}}))}if(aL){v.setValue("KonturExtern/Kontur1C",aq);var bV=aG,bT=aG,bU=bm("KonturExtern/Kontur1C",ap?d:a);
switch(al){case 2:bV="kontur.1c_2.0.msi";bT="kontur.1c_2.0.admin.msi";break;case 3:bV="kontur.1c_3.0.msi";bT="kontur.1c_3.0.admin.msi";break;default:aB.error("Неправильная версия ke1cVersion = "+al);
break}x.addFix(new L("KonturExtern.Kontur1C",{message:bU.message,caption:bU.caption,filename:cj?bV:bT,args:"/quiet",priority:1,needadmin:cj?0:1,tags:[L.Tags.MSI],order:1950,dependency:["Windows.InstallerVersion","KonturExtern.NET40Full"],fix:function(cl){var ck=this;
function cm(){if(!cj){ck.needadmin=0;var cn=ck.filename=bV;ck.url=ba+y+cn;ck.foreign=y+cn;ck.size=aZ[cn.toLowerCase()]||0}return ck.apply(cl)}if(cj){return cm()
}return ck.apply(function(cn){if(cn&&!cn.code){return l.uninstallAllByMask(aY.Kontur1C+"\\s*([\\.\\d]+\\s*)?$",ck.needadmin).then(h(cl,cn))}return cm()
})},test:function(cm){var cl="KonturExtern/Kontur1C",ck=aG;if(ap&&!k(a0.Kontur1C,an)){ao=1;ck="upd"}cm.setMessage(cl,ao);if(ck&&(am>=0)){cm.setMessage(cl+"/"+am+"/Version",ao,ck)
}return ao}}))}if(aJ){v.setValue("KonturExtern/DiadocPrint",s);var bD=bm("KonturExtern/DiadocPrint",r?d:a);x.addFix(new L("KonturExtern.DiadocPrint",{message:bD.message,caption:bD.caption,filename:"kontur.diadoc.addon.exe",args:"/S",priority:1,order:1836,tags:[L.Tags.APPDATA],dependency:["KonturExtern.KonturToolbox3","KonturExtern.NET40Full"],test:function(cl){var ck="";
if(r&&!k(a0.DiadocPrint,r)){q=2;ck="upd"}cl.setMessage("KonturExtern/DiadocPrint",q,ck);return ab?q:0}}))}if(aH){v.setValue("KonturExtern/Cryptor",o);var bC=bm("KonturExtern/Cryptor",n?d:a);
x.addFix(new L("KonturExtern.Cryptor",{message:bC.message,caption:bC.caption,filename:"CryptorInstaller.exe",args:'-q -norestart -log "${LOGFILE}"',priority:1,order:1843,dependency:["Windows.InstallerVersion","KonturExtern.NET40Full"],test:function(cl){var ck="";
if(n&&!k(a0.Cryptor,n)){m=1;ck="upd"}cl.setMessage("KonturExtern/Cryptor",m,ck);return m}}))}if(aI&&u){v.setValue("KonturExtern/Diadoc1C",u,t)}var b6="KonturExtern/KonturToolbox";
if(aO||aU){var cf=aE?"kontur.toolbox2.pilot.exe":"kontur.toolbox2.exe",bu=aE?"kontur.toolbox2.admin.pilot.exe":"kontur.toolbox2.admin.exe",bO=(bj&&("0.0.0"!==bj)),bW=aw.substr(0,5),bX=bO&&bj.substr(0,5)||"",ce=bO?d:a,bZ=(bO&&(bW===bX))?1:0,bL=bO&&k(ax,bj,"KT2MinVer"),bN="2.9.0"!==bX;
at=(bL&&bN)?0:1;bl("FoundKonturToolbox",bO&&bj||"No");if(aU){if((0===at)&&(bg>0)){ce=c}}var b8=v.getMessage("Windows/LocalAppData"),b7=b8&&b8.comment,b9=aa||("usershell"===b7)||("usershelldiff"===b7)||be,b0=bm(b6,ce),ci=function(){return br.getCertificatesKTError&&(!bY||!k(aw,bY))
};x.addFix(new L("KonturExtern.KonturToolbox2",{message:b0.message,caption:b0.caption,filename:b9?bu:cf,args:"/S",priority:1,needadmin:b9?1:0,order:1830,tags:[L.Tags.APPDATA],needrestart:(ae&&bZ),needreboot:(!ae&&bZ),fix:function(cl){var ck=this,co="\\s*2[\\.\\d+]+\\s*$",cn=av+"\\s*"+co,cm=av+"\\s*\\((Administrator|Администратор)\\)"+co;
ck.skipUser=(b9||ci());bl("SetupKonturToolbox","Start");return bS(ck,cf,bu,cn,cm,function(cp){bl("SetupKonturToolbox",(cp&&!cp.code)?"Success":"Failed");
return cl(cp)})},test:function(cm){var ck=this,cn=ci(),cl="";if(cn){ck.needadmin=1;ck.filename=bu;ck.foreign=br.distrPath+bu;ck.url=l.rootUrl+ck.foreign;
ck.size=aZ[bu.toLowerCase()]||0}cm.setMessage(b6,at);if((1==at)&&(J>=0)){cl=aE?"upd2-uc":"upd2";cm.setMessage(b6+"/"+J+"/Version",1,cl)}ck.uninstallCU=bq.Toolbox2CU;
ck.uninstallLM=bq.Toolbox2LM;if(aU){if(0===bg){if(bB(bf)){ck.onlyUpdateUser=1;cl=aE?"upd-uc-user":"upd-user";bg=1}}else{if(bg>0){if(0===at){cl=aE?"reinst-uc":"reinst";
ck.reinstall=1}else{cl=(bO?"upd2":"inst")+(aE?"-uc":"")}}}cm.setMessage("KonturExtern/Toolbox2Register",bg,cl);return ag?0:((1==at||bg>0)?1:cn)}return ag?0:((1==at)?1:cn)
}}))}if(!aa&&(aO||aU||aP||aV)){var bP=(bk&&("0.0.0"!==bk)),ch=aF?"kontur.plugin.pilot.exe":"kontur.plugin.exe",cg=bP?d:a,b1=aF?a0.KonturToolboxPilot3:br.cryptoLocale?a0.KonturToolboxCrypto:br.kembLocale?a0.KonturToolboxKEMB:br.rarLocale?a0.KonturToolboxRAR:a0.KonturToolboxMin3,bM=bP&&k(b1,bk,"KT3Min");
au=bM?0:1;bl("FoundKonturPlugin",bP&&bk||"No");if(aU||aV){if((0===au)&&(bi>0)){cg=c}}var b2=bm("KonturExtern/KonturToolbox3",cg);x.addFix(new L("KonturExtern.KonturToolbox3",{message:b2.message,caption:b2.caption,filename:ch,args:"/S /KT3_ONLY",priority:1,needadmin:0,order:1835,tags:[L.Tags.APPDATA],needrestart:bP?1:0,fix:function(ck){bl("SetupKonturPlugin","Start");
return bS(this,ch,aG,aG,aG,function(cl){bl("SetupKonturPlugin",(cl&&!cl.code)?"Success":"Failed");return ck(cl)})},test:function(cm){var ck=this,cl="";
if(aT&&!aT.KonturToolbox2){cm.setMessage(b6,au)}if((1==au)&&(K>=0)){cl="upd3";cl+=aF?"-pilot":"";cm.setMessage(b6+"/"+K+"/Version",1,cl)}ck.uninstallCU=bq.Toolbox3;
if(aU||aV){if("winold"===bh){cl=""}else{if(bi>0){if(0===au){cl="reinst";ck.reinstall=1}else{cl=(bP?"upd3":"inst")}cl+=aF?"-pilot":""}}cm.setMessage("KonturExtern/Toolbox3Register",bi,cl);
return ab?(1==au||bi>0):0}return ab?(1==au):0}}))}return bo})};window.SkbKontur.Help.Scripts.IE=function(T,v,bO){var dw=window,aL=dw.SkbKontur.Help,N=aL.Core,M=aL.contains,U=aL.Diagnosis,ao=aL.Err,ar=aL.exists,aw=aL.find,ax=aL.Fix,aF=aL.foreach,bb=aL.isNullOrEmpty,bA=aL.objectKeys,bZ=aL.Promise,df=aL.Test,aS=U.ieAdditionalSettingsGetTitle,di=U.Translates,bq=N.log,aM=N.HKCR,aN=N.HKCU,aO=N.HKLM,r=N.browser,s=N.buildPath,B=N.checkInstalledUpdate,E=N.compareVersion,Q=N.cyrillicFirstCompare,at=N.$expandEnvStrings,av=N.File,aD=N.Folder,aE=N.folderExist,aI=N.getService,aK=N.hasUac,a4=N.isFileNotFoundError,bd=N.isUser,cP=N.runUniversalFix,br=N.maxVersion,bt=N.needAdmin,bW=N.parseError,ca=N.regDeleteKey,cb=N.regDeleteValue,ce=N.$regEnumKeys,cf=N.regEnumValues,cq=N.regMassRead,cy=N.$regReadBinary,cz=N.regReadByType,cA=N.$regReadNumber,cB=N.$regReadString,cK=N.$regWriteBinary,cL=N.$regWriteNumber,cM=N.$regWriteString,cC=N.regRoots,cO=N.removeBadChars,c7=N.startService,c2=N.setDefaultBrowser,dg=N.trackEvent,du=N.vars,l=du.arch,m=du.atolLocale,x=du.centerInformLocale,O=du.cryptoproLocale,P=du.cspLocale,V=du.diagnostics,ap=du.etprfLocale,aC=du.flashLocale,bn=du.ktbLocale,bo=du.language,bs=du.microsoftLinkRoot,bC=du.onlyPriorityCompatMode,bY=du.productVersions,aq=du.evrikaLocale,cR=du.rutokenLocale,cW=du.sberLocale,cX=du.sertumLocale,c5=du.shtrihLocale,de=du.tanderLocale,dr=du.ucLocale,dv=du.vikiLocale,dy=du.winVer,dx=du.winSP;
var bw=null,dj=true,au=false,bv=new Error(),cQ=Q(),a6=r.ie,bc=N.isSystem(),bi=(501==dy),bg=(dy>=502),be=(dy>=600),bh=(dy>=700),bf=(dy>=1010),bp,dh=U.translateFix,b="Actions/",a=dh(b+"install"),c=dh(b+"update");
bO=bO?bO.IE:bw;du.proxyAddr=bw;du.proxyAutoConfig=bw;du.proxyEnabled=bw;var bj=(64==l),aT="iexplore.exe",cE=N.regSoftware,cF=cE+"Wow6432Node\\",ct="Policies\\",cr="Microsoft\\",b9="CurrentVersion\\",cG="User Agent\\",cH="5.0\\"+cG,cw="Post Platform\\",ck=cr+"Internet Explorer\\",b6=ck+"BrowserEmulation\\",cc=cE+ck+"DOMStorage",cl=ck+"Main\\",cj=cl+"FeatureControl\\FEATURE_BROWSER_EMULATION\\",cd=cE+ct+cl+"EnterpriseMode\\",cu=ct+b6+"PolicyList\\",cx=ct+b6+"QuirksPolicyList\\",b7=cE+b6+"ClearableListData\\",b3=ck+"AdvancedOptions\\",ch=ck+"Extensions\\",cJ=cr+"Windows\\",b8=cJ+b9,cs=cE+b8+ct+"Ratings\\.Default\\",cg=b8+"Ext\\",ci=cg+"Settings\\",cm=b8+"Internet Settings\\",cD=cE+b8+"Explorer\\Shell Folders\\",cN="ZoneMap\\",cn=cE+cm+cN,cv=cE+ct+cm+cN,co=cE+cm+"Zones\\2\\",bX=cE+ct+cm,dd=cE+cm,p=[cm+cG,cm+cH,cm+cG+cw,cm+cH+cw],o=new RegExp("^\\s*(User[\\-\\s]*agent|Mazilla|Mozilla|Opera|Gecko/|Version$|Platform$)","i");
var bK=!bO||bO.IEVersion,aX="err",aU=bw,bu,a9,ba,a7,a8,a2,a3,dB=2,bk;function D(dC){var dK=N.getKonturDiag(),dL=bp?bp.$UserProfile:"",dJ=bw,w=bw;var dF=function(){return aE(dJ).truth(function(){var dO=dj,dP=((P||O)?"cryptopro":(cR?"rutoken":(cW?"sberbank":(ap?"etprf":(bn?"ktb|kubantorgbank":(x?"atlasnw":(de?"magnit|tander":"kontur"))))))),dQ=df("\\.txt$","i"),dM=df(dP,"i"),dN=be?function(dR){return dQ(dR)&&N.readAll(dR,65001).then(dM).caught(au)
}:df(dP+".*\\.txt$","i");return aD(dJ).files().each(function(dR){return bZ.when(dN(dR)).truth(function(){return av(dR).remove()}).caught(function(){dO=au
})}).then(function(){return dO})},function(){throw ao("Folder not found: "+dJ,2)}).caught(function(dM){bq.error("Ошибка чистки Cookies",dM);return au})
};var dG=function(dM){return aE(dM).truth(function(dN,dO){return dO.folders().each(function(dQ){var dP=aD(dQ);return dP.removeAsync().caught(function(){return dP.remove()
}).caught(function(dR){dR=bW(dR);if(dR&&((-2147024776==dR.number)||(2147942520==dR.number))){bq.debug('Not enough rights to remove folder "'+dQ+'"',dR);
return dj}return dG(dQ)})}).then(function(){return dO.files().each(function(dP){return av(dP).remove().caught()}).then(dj)})},function(){throw ao("Folder not found: "+dM,2)
})};var dE=function(){return bZ.when(function(){if(!w||!w.length){throw ao("cacheFolder is null",3)}return dG(w)}).caught(function(dM){bq.error("Ошибка чистки кэша браузера",dM);
return au})};var dI=function(){return dG(bp.$Temp||at("%TMP%")).caught(function(dM){bq.error("Ошибка чистки %Temp%",dM);return au})};var dH=function(){return dG(bp.$SysTemp).caught(function(dM){dM=bW(dM);
if((bd()||aK())&&dM&&(2147942401==dM.number||-2147024895==dM.number)){return dj}bq.error("Ошибка чистки %SystemTemp%",dM);return au})};var dD=function(){return bZ.all(dI,dH).spread(function(dN,dM){return dN&&dM
})};return bZ.fork(!dC,function(){return dK.getShellFolder(33).caught(function(){if(bc){throw ao("System not supported",1)}return cB(aN,cD,"Cookies",au)
}).caught(function(){var dM=(be?"AppData\\Roaming\\Microsoft\\Windows\\":"")+"Cookies";return s(dL,dM)}).then(function(dM){dJ=dM;return dK.getShellFolder(32).caught(function(){if(bc){throw ao("System not supported",1)
}return cB(aN,cD,"Cache",au)}).caught(function(){var dN="AppData\\Local\\",dO=s(dL,dN+"Microsoft\\Windows\\");return aE(dO).lie(function(){dO=s(dL,"Local Settings\\");
return aE(dO)}).lie(function(){dO=s(dL,dN);return aE(dO)}).truth(function(){var dP="Temporary Internet Files\\";w=s(dO,dP+"Content.IE5\\");return aE(w).lie(function(){return s(dO,dP)
})},bZ.thrown(bv))}).caught(bw)}).then(function(dM){w=dM})}).then(function(){return bZ.all(dC?dj:dF(),dC?dj:dE(),dD())}).spread(function(dN,dM,dO){return dN&&dM&&dO
})}function C(){bp=N.getLocator(dj);du.installing=dj;if(a9&&a2){var dC=bp&&bp.$System32||"",w=2+4+8+256;return N.run(s(dC,"rundll32.exe"),{args:"InetCpl.cpl,ClearMyTracksByProcess "+w,directory:dC,show:dj,wsWait:dj}).waitExit().caught(-1).then(function(dD){return D(0===+dD)
})}return D(au)}var bS=!bO||bO.UserAgent,ds=r.userAgent,aZ;function z(dD,dC,w,dE){return cf(dD,dC,w).each(function(dF){if(dF&&o.test(dF)){if(!dE){return bZ.$break(dj)
}return cb(dD,dC,dF,w).anyway(function(){return cB(dD,dC,dF,w).then(bZ.$break(au))}).caught()}return bw},dE).caught(function(dF){if(!a4(dF)){bq.debug("Ошибка при исправлении или проверке userAgent",dF)
}return au})}function A(dF,dD,dE,w){var dC=dF;return bZ.each(p,function(dG){if(!dF&&dC){return bZ.$break(dj)}return z(dD,dE+dG,w,dF).then(function(dH){dC=dH
})},dC)}function y(){return bZ.fork(!bc,function(){return A(au,aN,cE,au)},au).lie(function(){if(bj){return A(au,aO,cF,au).lie(function(){return A(au,aO,cE,dj)
})}else{return A(au,aO,cE,au)}}).caught(au)}function az(){return bZ.fork(!bc,function(){return A(dj,aN,cE,au)},dj).truth(function(){if(bj){return A(dj,aO,cF,au).truth(function(){return A(dj,aO,cE,dj)
})}else{return A(dj,aO,cE,au)}}).caught(au).lie(function(){return cP("FixBadUserAgent",dj)})}var bH=!bO||bO.Encryption,ak=du.encryption;var bJ=!bO||bO.IEisDefault,a0="",a1=2,aV=bw,aW=bw,c3="\\shell\\open\\",c4=c3+"command\\",c8="http",c9="https",db="shell",da="ProgId",aQ=c8+c4,aR=c9+c4,cp=cE+"RegisteredApplications\\",dt=cE+cJ+"Shell\\Associations\\UrlAssociations\\",cI="\\UserChoice\\",aY=df("IEXPLORE","i");
var bM=!bO||bO.Proxy,b0="",b1=1;var bP=!bO||bO.SyncMode,dc=4;var bG=!bO||bO.DOMStorage,Y=0,W=0,Z=5000000,ae=50000000,ad=1024,aa=[],ac=2,ab="";var bN=!bO||bO.ReadTrustedSites,aP=0,b2="";
var bT=!bO||bO.WriteTrustedSites,dA="",dz=0;var bR=!bO||bO.TrustedSites,dp="",bl=N.getKonturDiag()&&(N.kdBuild>=206);var bF=!bO||bO.CompatMode,H,G={},I=au,F=[65,31,0,0,83,8,173,186],J=[12,0,0,0],K=[1,0,0,0],R=[0,0,92,76,231,251,206,1],bB=255,b5="AllSitesCompatibilityMode",u=new RegExp("(a\\-practic|infotrust|kontur\\-ca|kontur\\-pf|skbkontur)\\.ru$","i"),bm=new RegExp("(atlasnw|dtcom|(^|\\.)kontur|kontur\\-extern|pascal)\\.ru$","i");
function by(w){return[w&bB,(w>>8)&bB]}function bz(w){return[w&bB,(w>>8)&bB,(w>>16)&bB,(w>>24)&bB]}function bx(w,dC){return(w[dC]&bB)|((w[dC+1]&bB)<<8)}function X(dE){var w=[];
for(var dC=0,dD=dE.length;dC<dD;++dC){w=w.concat(by(dE.charCodeAt(dC)))}return w}function t(w,dD,dF){var dG=[];for(var dC=dD,dE=dD+2*dF;dC<dE;dC+=2){dG.push(String.fromCharCode(bx(w,dC)))
}return dG.join("")}function q(w){var dC=J.length,dD=K.length,dE=R.length,dF=F.length+4+4+dD+4,dG=w.length,dI=[];while(dF<dG){dF+=dC+dE+dD;var dH=bx(w,dF);
dF+=2;dI.push(t(w,dF,dH));dF+=2*dH}return dI}function cT(dF,dE,dD,dC,w){return cA(dF,dE+b6,dD,w).truth(1,0).caught(dC)}function S(dE,dD,w,dC){return bZ.all(cT(dE,dD,b5,0,w),cT(dE,dD,"IntranetCompatibilityMode",dC,w),cT(dE,dD,"MSCompatibilityMode",0,w)).spread(function(dF,dG,dH){return{AllCompat:dF,Intranet:dG,MSCompat:dH}
})}function i(dD,dE,dF){if(dF&&dF.length){for(var w=0,dC=dF.length;w<dC;++w){dD[dF[w]]=dE}}}function aH(dC,dE,dD,w){return bZ.all(cf(dE,dD+cu,w).caught(),cf(dE,dD+cx,w).caught()).spread(function(dG,dF){i(dC,dE,dG);
i(dC,dE,dF)})}function L(dI){if(!dI||!dI.length){return bw}var dD=[],dC=[],dG=bz(dI.length);dD=dD.concat(F);dD=dD.concat(dG);dC=dC.concat(K);dC=dC.concat(dG);
for(var dE=0,dF=dI.length;dE<dF;++dE){dC=dC.concat(J);if(R[0]>=255){++R[1];R[0]=0}++R[0];dC=dC.concat(R);dC=dC.concat(K);var dH=dI[dE];dC=dC.concat(by(dH.length));
dC=dC.concat(X(dH))}var w=dD.concat(bz(dC.length+4));w=w.concat(dC);return w}var bI=bO&&bO.EnterpriseMode,an,al="err",am=2,ag="SiteList",ah="https://help.kontur.ru/",ai=ah+"EMSiteList.xml",aj=ah+"EMSiteListWin10.xml";
var bL=!bO||bO.ParentalControl,bU,bV="err";var bE=!bO||bO.Addons,g="none",h=1,j="IE/AdditionalSettings"+(1049==bo?"/":"EN/"),f=di[j]||{};function dq(dD,dC,w,dE,dF){return cz(dD,dC,w,au).then(function(){return dF(dD,dC,w,dE,au)
}).caught(bw)}function ay(dC){var dG=bc?aO:aN,dF=cE+ci,w=!bd()&&!aK(),dE=w&&(aN==dG),dD=w&&bj,dH=dj;return dq(dG,"Popup\\","ManagerON",0,cL).then(function(){return dq(dG,cE+"XTTB00001\\Toolbar\\","blockPopups",0,cL)
}).then(function(){return dq(dG,cE+"torrapps\\toolbar\\Settings\\options\\","104","FALSE",cM)}).fork(dC instanceof Array,function(){return bZ.each(dC,function(dJ){var dI=dF+dJ+"\\",dK=bw;
return bZ.all(cM(dG,dI,"","",au).caught(bw),dE?cM(aO,dI,"","",au).caught(bw):bw,dD?cM(aO,dI,"","",bj).caught(bw):bw).anyway(function(){function dL(dM){dK=dM
}return bZ.all(cL(dG,dI,"Flags",1,au).caught(dL),cM(dG,dI,"Version","*",au).caught(dL),dE?cL(aO,dI,"Flags",1,au).caught(dL):bw,dE?cM(aO,dI,"Version","*",au).caught(dL):bw,dD?cL(aO,dI,"Flags",1,bj).caught(dL):bw,dD?cM(aO,dI,"Version","*",bj).caught(dL):bw)
}).anyway(function(){if(dK){bq.debug("Ошибка отключения надстройки "+dJ,dK);dH=au}})})},function(){bq.error("function fixBadAddons called without array (value: "+dC+")")
}).then(function(){return dH})}function c6(w,dC){var dD=String(w),dE=String(dC);return cQ(f[dD]||dD,f[dE]||dE)}var bQ=!bO||bO.TrustedSettings,dl="err",dn=0,dm=-1,af=new RegExp("\\.","g"),dk=[["CurrentLevel",0],["Flags","67!71"],["1001",0],["1004",0],["1200",0],["1201",0],["1208",0],["1209",0],["120A",0],["120B",0],["1400",0],["1402",0],["1405",0],["1406",0],["1407",0],["1601",0],["1604",0],["1606",0],["1607",0],["1608",0],["1609",0],["160A",0],["1800",0],["1802",0],["1803",0],["1804",0],["1805",0],["1806",0],["1809",3],["1A00",65536],["1A02",0],["1A03",0],["1A04",3],["1A05",1],["1A06",0],["1A10",0],["1E05",196608],["2000",0],["2100",0],["2101",0],["2102",0],["2103",0],["2104",0],["2105",0],["2200",0],["2201",0],["2300",0],["2301",3],["2400",0],["2401",0],["2402",0],["2500",3],["2600",0],["2700",3],["2701",0],["2702",3],["2703",0],["2704",0],["2705",0],["2706",0],["2708",0],["2709",0],["270A",0],["270B",0],["270C",3]];
function aB(){var dG={"1206":0,"1409":3,"1605":0,"1C00":65536,"2001":0,"2004":0,"2007":65536,Flags:67};var w,dC,dE=bc?aO:aN,dF=bc?bj:au;for(var dD in dG){for(w=0,dC=dk.length;
w<dC;++w){if(dD==dk[w][0]){break}}dk[w]=[dD,dG[dD]]}return cM(dE,co,"","",dF).anyway(function(){return dk}).each(function(dI){var dH=dI[0],dJ=dI.length>1?dI[1]:0;
if("1A00"===dH){return bw}if("number"==typeof(dJ)){return cL(dE,co,dH,dJ,dF)}return cM(dE,co,dH,dJ,dF)})}function aA(dH){var dG=dj,dD="Domains\\",dE="EscDomains\\",dJ=aP?aO:aN,dC=bg?[dD,dE]:[dD],dF=bA(dH);
function dI(dO){if(dO&&dO.length){var dN=dO.split(af),dL=dN.length;if(2===dL){return dO}if(dL>=3){var dM=dN[dL-2]+"."+dN[dL-1]+"\\"+dN[0];for(var dK=1;
dK<dL-2;++dK){dM+="."+dN[dK]}return dM}}return""}function w(dM,dK){var dL=dI(dM);if(bb(dL)){return bw}dL+="\\";return bZ.each(dC,function(dN){return cL(dJ,cn+dN+dL,dK,2,au).caught(function(dO){bq.error("Ошибка добавления в надежные узлы ["+((aO==dJ)?"HKLM":"HKCU")+", "+dN+"] "+dK+"://"+dM,dO);
dG=au})})}return bZ.each(dF,function(dK){if(dH[dK] instanceof Array){return bZ.each(dH[dK],function(dL){return w(dL,dK)})}return bw}).then(function(){return dG
})}var a5=N.isMSHTA(),c1=!a5&&("string"==typeof(dw.serverUserAgent)),c0=c1?dw.serverUserAgent:bw,cZ=-1,cY="";var bD=!bO||bO.AdditionalSettings,d="",e=1,n={},b4=cE+b3,k=N.getKonturDiag()?bj:au;
function cU(dE,dD,dC,w){if(dD.toLowerCase().indexOf(cE.toLowerCase())<0){dD=b4+dD+"\\"}return cA(dE,dD,dC,k).caught(w)}function cV(dE,dD,dC,w){if(dD.toLowerCase().indexOf(cE.toLowerCase())<0){dD=b4+dD+"\\"
}return cB(dE,dD,dC,k).caught(w)}function cS(dE,dD,dC,w){if(dD.toLowerCase().indexOf(cE.toLowerCase())<0){dD=b4+dD+"\\"}return cz(dE,dD,dC,k).caught(w)
}function aG(w){if(bw===w){return bw}if(dj===w||1==w||"1"==w){return 1}if(au===w||0===w||"0"==w){return 0}if(!w||("string"!=typeof(w))||!w.length){return w
}w=aL.trim(w.toLowerCase());return("yes"===w||"true"===w)?1:(("no"===w||"false"===w)?0:bw)}function aJ(w){return dy&&{500:"2000",501:"XP",502:w?"XPx64":"XP",503:"Server2003",600:"Vista",601:w?"2008":"Vista",700:"7",701:w?"2008R2":"7",800:"8",801:w?"2012":"8",810:"8.1",811:w?"2012R2":"8.1",1010:"10",1011:w?"2016":"10"}[dy]||bw
}return bZ.when(N.getLocator).then(function(w){bp=w;return bZ.fork(bK||bD,function(){var dC=cE+ck;return cB(aO,dC,"svcVersion",au).lie(bZ.thrown()).caught(function(){return cB(aO,dC,"Version",au).lie(bZ.thrown())
}).caught(function(dD){bq.debug("Ошибка определения версии IE",dD);return"err"}).then(function(dD){aX=dD;return av(s(bp.$IE,aT)).get("v").then(function(dE){aU=dE;
if(dE.split(".")[0]!==aX.split(".")[0]){bq.error("Версии IE различаются - реестр: "+aX+", файл: "+dE)}}).caught()}).then(function(){if("err"===aX&&aU){aX=aU
}else{aX=br(aU,aX)}if(!df("^8\\.")(aX)){try{if(document.all&&document.all.ie8_length){aX="8.0"}}catch(dD){}}bu=(aX&&aX.length&&("err"!==aX));a9=(bu&&E("8.0",aX));
ba=(bu&&E("9.0",aX));a7=(bu&&E("10.0",aX));a8=(bu&&E("11.0",aX));du.ieVersion=aX;a2=aU&&E("8.0",aU);a3=aU&&E("9.0",aU);var dE=bu&&Number(aX.split(".")[0]);
if(dE){dg("IE"+dE,"Win"+(aJ(dj)||"Unknown")+"_SP"+dx)}H=a9&&bF;an=(a7||a8)&&(bI||(!bO&&(m||aC||cW||cX||c5||dr||dv)));bU=a9&&!ba&&bL;return bZ.fork(a9&&!ba&&a2&&!a3,function(){return B("KB2586448-IE8")
})}).then(function(dD){bk=dD})}).fork(bJ,function(){var dC=au,dD=au;return bZ.all(cB(aO,cp,"Internet Explorer",au),cB(aN,dt+c8+cI,da,au),cB(aN,dt+c9+cI,da,au)).spread(function(dE,dG,dH){var dF=dE+"\\UrlAssociations\\";
return bZ.all(cz(aO,dF,c8,au),cz(aO,dF,c9,au)).spread(function(dI,dJ){aV=dI;aW=dJ;dC=(dG==aV);dD=(dH==aW);a0=dC?(dD?db:c8):(dD?c9:"no");a1=(db!==a0)?1:0
})}).caught(function(){return bZ.all(cB(aM,aQ,"",au).then(aY).caught(dC),cB(aM,aR,"",au).then(aY).caught(dD)).spread(function(dE,dF){dC=dE;dD=dF;a0=dC?(dD?db:c8):(dD?c9:"no");
a1=(db!=a0)?1:0})}).caught(function(dE){a0="err";a1=2;bq.debug("Ошибка определения браузера по умолчанию",dE)})}).fork(bM,function(){var dE=bc?aO:aN,dD=cE+cm,dC=dD+"Connections\\";
return bZ.all(cy(dE,dC,"DefaultConnectionSettings",au).caught(0),cA(dE,dD,"ProxyEnable",au).caught(0),cB(dE,dD,"ProxyServer",au).caught(bw),cB(dE,dD,"ProxyOverride",au).caught(bw),cB(dE,dD,"AutoConfigUrl",au).caught(bw)).spread(function(dG,dI,dF,dJ,dH){dG=(dG[8]&8)?1:0;
dI=dI?1:0;du.proxyAutoConfig=dG;du.proxyEnabled=dI;du.proxyAddr=dF;b0={AutoConfig:dG,Enabled:dI,Address:(dF||"none"),Exceptions:(dJ&&dJ.length)?dJ.split(new RegExp(";","g")):"none",AutoConfigUrl:(dH||"none")};
if((0===dI)&&(0===dG)){b1=0}else{b1=((dF&&dF.indexOf("127.0.0.1")>=0)?1:-1)}}).caught(function(dF){b0="not";b1=0;bq.error("Ошибка чтения настроек прокси-сервера IE",dF)
})}).fork(bP,function(){return cA(bc?aO:aN,dd,"SyncMode5",au).then(function(dC){dc=dC;if(!dc&&(0!==dc)){dc=4}},function(){})}).fork(bG,function(){if(bc){aa="system";
ac=-1;return bZ.resolve()}return bZ.fork(!bl,bZ.thrown(),function(){return cq(aN,cc,2,"d",au,{2:dj}).then(function(dC){aF(dC.subkeys,function(dG){var dF=dG.key,dE=aw(dG.values,function(dH){return dH&&(""===dH.name)
});if(dE){var dD=dE.value;if(dD){if("Total"===dF){Y=dD}else{W+=dD;aa.push({Site:dF,Size:dD})}}}})})}).caught(function(){return ce(aN,cc,au).caught(function(dC){if(a4(dC)){return[]
}throw dC}).each(function(dD){var dC=cc+"\\"+dD+"\\";return cz(aN,dC,"",au).caught(0).truth(function(dE){dE=Number(dE);if("Total"===dD){Y=dE}else{W+=dE;
aa.push({Site:dD,Size:dE})}})})}).then(function(){return bZ.all(cA(aO,cc+"\\","DomainLimit",bj).caught(Z),cA(aO,cc+"\\","TotalLimit",bj).caught(ae)).spread(function(dC,dD){Z=dC;
ae=dD})}).then(function(){if(aa.length){aa=aa.sort(function(dC,dD){return(dD&&dD.Size||0)-(dC&&dC.Size||0)});if(aa.length>10){aa=aa.slice(0,10)}aa.push({Site:"Total",Size:Y});
aa.push({Site:"Actual",Size:W});if(aa[0].Size>=Z-ad){ab="Возможно превышение лимита для сайта ("+Z+" байт)"}else{if(W>=(ae-ad)||Y>=(ae-ad)){ab="Возможно превышение суммарного лимита для всех сайтов ("+ae+" байт)"
}else{ac=0}}}else{aa="not";ac=-1}},function(dC){bq.error("Ошибка получения размеров DOMStorage у сайтов",dC);aa="err"})}).fork(bN||bR,function(){if(bc){aP=1;
b2="comp";return bw}return cA(aO,bX,"Security_HKLM_only",au).then(function(dC){aP=Number(dC);b2=(1==aP)?"comp":"user"}).caught(function(){aP=0;b2="user"
})}).fork(bT||bR,function(){return cA(aO,bX,"Security_zones_map_edit",au).then(function(dC){dz=Number(dC);dA=(1==dz)?"deny":"allow"}).caught(function(){dz=0;
dA="allow"})}).fork(bK,function(){return aI("wuauserv").truth(function(dC){if(dC.forDeletion){bq.error("Служба Автоматическое обновление (wuauserv) помечена для удаления")
}else{dB=dC.running?0:1}}).caught()}).fork(bS,function(){return y().then(function(dC){aZ=dC})}).then(function(){return bZ.fork(H,function(){function dD(dI,dK,dJ,dH){return cA(dK,dJ+cj,aT,dH).caught(0).then(function(dL){dI.FeatureBrowser=dL?1:0
})}var dC={},dG=bw,dF={},dE=[];return bZ.all(S(aO,cE+ct,bj,0),bj?S(aO,cF+ct,au,0):{}).spread(function(dH,dI){G={};return bZ.all(dD(dH,aO,cE,bj),bj?dD(dI,aO,cF,au):bw).then([dH,dI])
}).spread(function(dH,dI){return bZ.fork(!bc,function(){return bZ.all(S(aN,cE,au,1),S(aN,cE+ct,au,0),cy(aN,b7,"UserFilter",au).caught(dG)).spread(function(dL,dJ,dK){G=dL;
dC=dJ;dG=dK;return dD(dC,aN,cE,au)}).then(function(){G.CompatSites=(dG&&dG.length)?q(dG):"none"})}).then(function(){aF(dC,function(dJ){G["Pol"+dJ]=dC[dJ]||dH[dJ]||dI[dJ]
});I=dH[b5]||dI[b5];return bZ.serial(bc?bw:aH(dF,aN,cE,au),aH(dF,aO,cE,bj),bj?aH(dF,aO,cF,au):bw).then(function(){aF(dF,function(dJ){if(aO==dF[dJ]&&u.test(dJ)){I=dj
}dE.push(dJ)});if(dE.length){dE=dE.sort(cQ)}}).caught()}).then(function(){G.PolCompatSites=dE.length?dE:"none"})})})}).then(function(){return bZ.fork(an,function(){return bZ.when(function(){return bZ.fork(bc,bZ.thrown("System not supported"),function(){return cB(aN,cd,ag,au).then(function(dC){if(!dC||!dC.length){throw ao("siteList not found",2)
}return dC})}).caught(function(){return cB(aO,cd,ag,bj)}).then(function(dC){if((ai!==dC)&&(aj!==dC)){throw bv}al=(aj===dC)?"EMSiteListWin10":"EMSiteList";
am=0})}).caught(function(){al=a8?0:"unused";am=a8?1:0})})}).then(function(){return bZ.fork(bU,function(){return cA(aO,cs,"Enabled",bj).truth(1,0).then(function(dC){bV=dC;
if(bV&&bt()){bV="needadmin"}}).caught(function(){bV=0})})})}).then(function(){if(bK||bD){T.setValue("IE/IEVersion",aX)}if(bS){T.setValue("IE/UserAgent",ds)
}if(c1){T.setValue("IE/ServerUserAgent",c0)}if(H){T.setValue("IE/CompatMode",G)}if(an){T.setValue("IE/EnterpriseMode",al)}if(bU){T.setValue("IE/ParentalControl",bV)
}if(bH){T.setValue("IE/Encryption",ak,(Number(ak)>=128)?0:1)}if(bJ){T.setValue("IE/IEisDefault",a0)}if(bM){T.setValue("IE/Proxy",b0,b1)}if(bP){T.setValue("IE/SyncMode",dc)
}if(bG){T.setValue("IE/DOMStorage",aa,ac,ab)}if(bN){T.setValue("IE/ReadTrustedSites",b2,("user"===b2)?0:(("err"===b2)?2:1))}if(bT){T.setValue("IE/WriteTrustedSites",dA,("allow"===dA)?0:(("err"===dA)?2:1))
}}).then(function(){var w=0,dC=50,dD=10,dE=function(){return 0===(w%dC)};return bZ.fork(bR,function(){function dF(dN,dL,dO,dM){if(3!=dO){if(!dM[dO]){dM[dO]=[]
}dM[dO].push((dL?(dL+"://"):"")+dN);return dj}return au}function dH(dN,dL,dO,dM){return cf(dN,dL,au).then(function(dP){if(M(dP,"*")){return cA(dN,dL,"*",au).then(function(dQ){dF(dO,bw,dQ,dM)
})}return bZ.each(dP,function(dQ){if(("http"===dQ)||("https"===dQ)||("about"===dQ)){return cA(dN,dL,dQ,au).then(function(dR){dF(dO,dQ,dR,dM)})}return bw
})}).anyway(dM)}function dK(dO,dM,dL){if(bc&&(aN==dO)){return bZ.resolve([])}var dN={};return ce(dO,dM+dL,au).each(function(dQ){var dP=dM+dL+"\\"+dQ+"\\";
++w;return bZ.fork(dE,bZ.timeout(dD)).then(function(){return dH(dO,dP,dQ,dN)}).then(function(){return ce(dO,dP,au).each(function(dS){var dR=dP+dS+"\\";
return dH(dO,dR,dS+"."+dQ,dN)}).caught(function(dR){bq.debug("Ошибка перечисления надежных узлов",dR)})})}).caught(function(dP){if(!a4(dP)){bq.debug("Ошибка перечисления надежных узлов IE ("+cC[String(dO)]+", "+dM+", "+dL+")",dP)
}}).then(dN)}function dG(dO,dM,dN){try{if(!ar(dO,function(dP){var dQ=dP.value;if((3!=dQ)&&("*"===dP.name)){if(!dN[dQ]){dN[dQ]=[]}dN[dQ].push(dM);return dj
}return au})){aF(dO,function(dQ){var dP=dQ.name,dR=dQ.value;if(3!=dR){if(("http"===dP)||("https"===dP)||("about"===dP)){if(!dN[dR]){dN[dR]=[]}dN[dR].push(dP+"://"+dM)
}}return bw})}}catch(dL){}}function dJ(dO,dM,dL){if(bc&&(aN==dO)){return bZ.resolve([])}var dN={};return cq(dO,dM+dL,3,"d",au,{2:dj}).then(function(dP){aF(dP.subkeys,function(dR){dG(dR.values,dR.key,dN);
try{aF(dR.subkeys,function(dS){dG(dS.values,dS.key+"."+dR.key,dN)})}catch(dQ){bq.debug("Ошибка перечисления надежных узлов",dQ)}})}).caught(function(dP){if(!a4(dP)){bq.debug("Ошибка перечисления надежных узлов IE ("+cC[String(dO)]+", "+dM+", "+dL+")",dP)
}}).timeout(dD).then(dN)}var dI=bl?dJ:dK;return bZ.all(ce(aO,cv).caught(bw),ce(aN,cv).caught(bw),function(){return dI(aO,cv,"Domains")},function(){return dI(aN,cv,"Domains")
},function(){return dI(aO,cn,"Domains")},aP?bw:dI(aN,cn,"Domains"),bg?dI(aO,cn,"EscDomains"):bw,(!aP&&bg)?dI(aN,cn,"EscDomains"):bw).spread(function(dR,dN,dT,dS,dP,dL,dQ,dM){dp={};
if(dP&&bA(dP).length){dp.LMDomains=dP}if(dQ&&bA(dQ).length){dp.LMEscDomains=dQ}if(!aP){dp.CUDomains=dL}if(dM&&bA(dM).length){dp.CUEscDomains=dM}if(dT&&bA(dT).length){dp.PolLMDomains=dT
}else{if(dR&&M(dR,"Domains",dj)){dp.PolLMDomains=dj}}if(dS&&bA(dS).length){dp.PolCUDomains=dS}else{if(dN&&M(dN,"Domains",dj)){dp.PolCUDomains=dj}}var dO=dj;
aF(dp,function(dU){var dV=dp[dU];if(dV){for(var dW in dV){if(dV[dW]&&dV[dW].length){dO=au;return au}}}return bw});if(dO){dp="none"}})}).fork(bE,function(){var dH=cE+cg,dG=[],dF={};
return ce(aN,dH+"Stats",au).each(function(dJ){++w;if(dJ.length<3){return dE()?bZ.timeout(dD):bw}var dI="CLSID\\"+dJ+"\\",dK=dI+"InprocServer32\\",dL=cE+ch+dJ+"\\";
return bZ.fork(dE,bZ.timeout(dD)).then(function(){return cB(aM,dK,"",au)}).then(function(dM){if(!dM||!dM.length){throw new Error()}return dM}).caught(function(){return cB(aO,dL,"Exec",au)
}).then(function(dM){if(!dM||!dM.length){throw new Error()}return dM}).caught(bZ.next()).then(function(dM){return cB(aM,dI,"",au).then(cO).then(function(dN){if(!dN||!dN.length){throw new Error()
}return dN}).caught(function(){return cB(aO,dL,"ButtonText",au).then(cO).then(function(dN){if(!dN||!dN.length){throw new Error()}return dN}).caught(function(){return cB(aO,dL,"MenuText",au).then(cO)
}).then(function(dN){if(!dN||!dN.length){throw new Error()}return dN}).caught("")}).then(function(dN){return[dM,dN]})}).spread(function(dM,dN){var dO={Guid:dJ,Name:dN,Path:dM};
if(!dM||((dM.length>=11)&&dM.toLowerCase().indexOf("mscoree.dll")>=0)){return bZ.all(cB(aM,dK,"Assembly",au),!dN?cB(aM,dK,"Class",au):bw,!dM?cB(aM,dK,"RuntimeVersion",au):bw).spread(function(dP,dQ,dR){dO.Assembly=dP;
if(!dN){dO.Name=dQ}if(!dM){dO.Path=".NET Framework "+dR}}).anyway(dO)}return dO}).then(function(dO){dG.push(dO.Name);var dM=dH+"Settings\\"+dJ+"\\",dN=dH+"Stats\\"+dJ+"\\iexplore\\";
dO.Status=dj;return bZ.all(cA(aN,dM,"Flags",au).caught(0),cB(aN,dM,"Version",au).caught(bw),cA(aN,dN,"Type",au).caught(9),cz(aN,dN,"Blocked",au).caught(0),cz(aN,dN,"Count",au).caught(0),ce(aN,dN+"AllowedDomains",au).caught(bw)).spread(function(dT,dV,dU,dQ,dR,dP){if(1==dT||1025==dT){dO.Status=("*"!==dV)
}dO.Type=(dU||0===dU)?dU:9;dO.Blocked=Number(dQ||0);dO.Count=Number(dR||0);if(dP&&dP.length){var dS=[];aF(dP,function(dW){if(dW&&dW.length){if("*"===dW){dS=["*"];
return au}dS.push(dW)}return bw});dO.Sites=dS}else{dO.Sites=""}dF[dO.Name]=dO})})}).then(function(){if(dG.length){dG.sort(c6);g=[];var dJ=bw,dI=bw,dK=bw,dL=new RegExp("Version=([\\d\\.]+)");
return bZ.each(dG,function(dM){var dN=dF[dM],dO;return bZ.when(function(){if(dN.Path&&(dN.Path.indexOf("%")>=0)){return at(dN.Path)}else{return dN.Path
}}).then(function(dP){dO=dP;if(!dO||!dO.length){dO="err"}else{return av(dO).get("ev").truth(function(dQ,dR){dN.Version=dO=dR||"err"},function(){dO="not"
})}return bw}).caught(function(dP){dO="err";bq.debug("Ошибка определения версии надстройки браузера (путь: "+dN.Path+")",dP)}).then(function(){if(dJ&&(dJ==dM)&&(dK==dO)){if(dI.Path==dN.Path){return bw
}}dJ=dM;dI=dN;dK=dO;if(!dN.Version&&dN.Assembly){var dP=dL.exec(dN.Assembly);if(dP&&dP.length>1){dN.Version=dP[1]}}g.push(dN);return bw})}).then(function(){h=-1;
return g})}else{g="none";h=-1;return bw}}).caught(function(dI){g="err";h=2;bq.debug("Ошибка перечисления надстроек IE",dI)})}).timeout(50).fork(bQ,function(){var dH={0:"autologin",65536:"userpass",131072:"intranet",196608:"anonym"},dI={65536:"high",131072:"medium",196608:"low"},dK={0:"custom",65536:"low",66816:"mediumlow",69632:"medium",70912:"mediumhigh",73728:"high"},dJ=["allow","ask","err","deny"];
function dG(dM,dL,dN){return cz((dN?aO:aN),co,dM,au).then(function(dQ){var dO=Number(dQ),dP;if("1A00"==dM){dP=dH[dO];if(!dP){bq.debug("Неизвестное значение переменной "+dM+" в настройках надежной зоны: "+dQ);
return"unknown"}}else{if("1E05"==dM){dP=dI[dO]}else{if(("string"==typeof(dM))&&(dM.indexOf("Level")>=0)){dP=dK[dO]}else{if("Flags"==dM){dP=String(dO)}else{dP=dJ[dO]
}}}}if(dP&&(typeof dL!=="undefined")&&("1A00"!=dM)){dL="!"+String(dL)+"!";if(dL.indexOf("!"+String(dQ)+"!")<0){return"bad"+dP}}return dP||dO})}function dF(dM,dL){return dG(dM,dL,aP).caught(function(){return dG(dM,dL,!aP)
}).caught("err").then(function(dN){dl.push({Name:dM,Value:dN});if("err"==dN){return 2}return("string"!=typeof(dN)||dN.indexOf("bad")<0)?0:1})}return cA(aO,bX,"Security_options_edit",au).truth(1,0).caught(0).then(function(dL){dl=[{Name:"Settings",Value:(aP?"comp":"user")},{Name:"WriteSettings",Value:(dL?"writedeny":"writeallow")}];
dn=0;var dM=0;return bZ.each(dk,function(dQ){var dO=dQ[0],dN=dO?String(dO).substr(0,2):bw,dP=dQ.length>1?dQ[1]:bw;if(!a9&&("25"==dN)){return bZ.$break()
}if(!ba&&("27"==dN)){return bZ.$break()}if(!a7&&("2705"==dO)){return bZ.$break()}if(!a8&&("270C"==dO)){return bZ.$break()}if(("120B"==dO||"2500"==dO)&&!be){return bw
}return dF(dO,dP).then(function(dR){if(dn<dR){dn=dR;if(dm<0){dm=dM}}++dM})})})}).timeout(50).fork(c1,function(){var dG=N.getTridentVer(c0),dF=N.getMSIEVer(dj,c0);
if(!a5&&dG>=4&&dF>=5&&dF<=7.99){cZ=2;cY="Возможно, в Internet Explorer включен режим совместимости, нужно его отключить"}else{if(4==dG&&ba){cZ=1;cY="Возможно, это Internet Explorer 8.0"
}}T.setMessage("IE/ServerUserAgent",cZ,cY)}).timeout(50).fork(bD,function(){var dG=[],dF={};return ce(aO,b4,k).each(function(dI){function dH(dL,dM){var dK=[],dJ={};
return ce(aO,b4+dL,k).then(function(dN){if(!dN||!dN.length){return bZ.result([])}return dN}).each(function(dO){if(!dO||dO.length<2){return bw}var dN=dL+"\\"+dO;
return cV(aO,dN,"Type").lie(bZ.next()).then(function(dP){return bZ.all(dP,cU(aO,dN,"HKeyRoot"),cU(aO,dN,"HKeyRoot2"),cV(aO,dN,"ValueName"),cV(aO,dN,"RegPoliciesPath"),cU(aO,dN,"Mask"))
}).spread(function(dU,dS,dT,dV,dR,dP){if(typeof dS=="number"){dS=4294967295+dS+1}if(typeof dT=="number"){dT=4294967295+dT+1}dR+="\\";var dQ=bw;return bZ.when(function(){if(!dS){throw bv
}return cS(dS,dR,dV,bw).then(aG).then(function(dW){if(bw===dW){throw bv}return dW})}).caught(function(){if(!dT){throw bv}return cS(dT,dR,dV,bw).then(aG).then(function(dW){if(bw===dW){throw bv
}return dW})}).then(function(dW){return dP?Number(dW)&Number(dP):Number(dW)},bw).then(function(dW){dQ=dW;var dX;return cV(aO,dN,"RegPath").then(function(dY){dX=dY+"\\";
if(!dS){throw bv}return cS(dS,dX,dV,bw).then(aG).then(function(dZ){if(bw===dZ){throw bv}return dZ})}).caught(function(){if(!dT){throw bv}return cS(dT,dX,dV,bw).then(aG).then(function(dY){if(bw===dY){throw bv
}return dY})}).then(function(dY){return dP?Number(dY)&Number(dP):Number(dY)},bw)}).anyway(function(dW){return bZ.all(cS(aO,dN,"CheckedValue").then(aG),cS(aO,dN,"DefaultValue").then(aG),cV(aO,dN,"Text")).spread(function(dX,dY,d0){var dZ={Name:dO,Caption:dV,Type:dU,Disabled:au,Value:au,Default:dj,Text:d0};
if(!dM&&("group"===dU)){return dH(dN,dj).then(function(d1){dZ.Value=d1;return dZ})}else{if(bw!==dQ){dZ.Disabled=dj;dW=dQ}if((bw!==dW)&&(""!==dW)){if(dX===dW){dZ.Value=dj
}if(dY!==dW){dZ.Default=au}}else{if(dX===dY){dZ.Value=dj}}}return dZ}).then(function(dY){var dX;if(aS){dX=aS(dY)}else{dX=dY.Text||dY.Caption}dK.push(dX);
dJ[dX]=dY})})}).caught()}).then(function(){var dO=cE+ck+"Settings\\",dQ="checkbox",dN={"Always Use My Colors":{status:2,type:dQ,def:0,root:aN,path:dO},"Always Use My Font Face":{status:2,type:dQ,def:0,root:aN,path:dO},"Always Use My Font Size":{status:2,type:dQ,def:0,root:aN,path:dO}};
var dP;return cV(aO,dL,"Text",dL).then(function(dR){dP=dR;if("Accessibility"==dP||"Специальные возможности"==dP){return bZ.each(dN,function(dT,dS){var dV={Name:dT,Caption:dT,Type:dS.type,Disabled:au},dU=dV.Caption;
return cz(dS.root,dS.path,dT,au).caught(dS.def).then(function(dW){dV.Value=dW;dV.Default=(dS.def==dV.Value);if(aS){dU=aS(dV)}dV.Text=dU;dK.push(dU);dJ[dU]=dV
})})}return bw}).then(function(){dN.DisableCachingOfSSLPages={status:2,type:dQ,def:0,root:aN,path:cE+cm};dN.XMLHTTP={status:2,type:dQ,def:1,root:aN,path:cE+cl};
dN.DOMStorage={status:2,type:dQ,def:1,root:aN,path:cE+cl};if(cZ>0){dN.AutomaticLayoutRecovery={status:1,type:dQ,def:0,root:aN,path:cE+b6}}dK=dK.sort(c6);
aF(dK,function(dR,dT){dK[dT]=dR=dJ[dR];var dS=dR.Caption;if(dN[dS]){n[dS]=dN[dS];n[dS].index=dT;n[dS].category=dP}});if(!dM&&dK.length){dG.push(dP);dF[dP]=dK
}return dK})}).caughtReturn()}return dI.length>=2?dH(dI,au):bw}).then(function(){if(dG.length){dG=dG.sort(c6);aF(dG,function(dH,dI){dG[dI]={Category:dH,Settings:dF[dH]}
});d=dG;e=0}else{d="none";e=1}}).caught(function(dH){bq.debug("Ошибка перечисления дополнительных настроек IE",dH)})}).timeout(50)}).then(function(){var w="AddToTrusted.exe",dC="AddToTrusted_EGAIS.exe",dD="AddToTrusted_Min.exe",dE="AddToTrusted_UC.exe",dO="help.kontur.ru",dP="install.kontur.ru";
function dK(){var ed=dw.profileName,d9=ed?(N.rootUrl+"/"+ed):dw.location.href;var eb={https:["kontur.ru",dO,dP,"kontur-ca.ru","ikub.skbkontur.ru"]};var d8={https:["extern.kontur.ru","kopf.kontur.ru","pf.kontur.ru","pfr.kontur.ru"]};
var eg={"center-inform":{regex:/[=\/]center\-inform/i,sites:{common:dj,https:["7405405.ru","atlasnw.ru","nalog.ru"]}},atol_shtrih_viki:{regex:/[=\/](atol|shtrih|viki)($|[^\-])/i,sites:{nodefault:dj,https:[dO,dP,"nalog.ru"]}},ofd:{regex:/[=\/]ofd/i,sites:{both:["nalog.ru"]}},infotrust:{regex:/[=\/]infotrust/i,sites:{common:dj,https:["infotrust.ru"]}},practic:{regex:/[=\/]practic/i,sites:{common:dj,https:["a-practic.ru"]}},cryptopro:{regex:/[=\/](cryptopro|csp)($|[^\-])/i,att:dD,sites:{nodefault:dj,https:[dO,dP],both:["cryptopro.ru","www.cryptopro.ru"]}},rutoken:{regex:/[=\/]rutoken/i,att:dD,sites:{nodefault:dj,https:[dO,dP],both:["help.rutoken.ru"]}},"sberbank-ast":{regex:/[=\/]sberbank\-ast/i,sites:{nodefault:dj,https:[dO,dP],both:["sberbank-ast.ru","login.sberbank-ast.ru","utp.sberbank-ast.ru"]}},egais_rar:{regex:/[=\/](egais|pap|rar)/i,att:dC,sites:{https:["declarant.mos.ru","econ.lenobl.ru","gosalcogol.tatar.ru","rostsys.ru","service.egais.ru","service.fsrar.ru"]}},etprf:{regex:/[=\/]etprf/i,att:"AddToTrusted_ETPRF.exe",sites:{nodefault:dj,https:[dO,dP,"kontur.ru"],both:["webcust.etprf.ru","webppo.etprf.ru","etprf.ru"]}},kubantorgbank:{regex:/[=\/](bktb|ktb|kubantorgbank)/i,att:"AddToTrusted_KTB.exe",sites:{nodefault:dj,https:[dO,dP,"kontur.ru"],both:["kubantorgbank.ru"]}},tander:{regex:/[=\/](magnit|tander)/i,att:"AddToTrusted_Tander.exe",sites:{both:["ca.magnit.ru"]}},rosreestr:{regex:/([=\/]rosreestr|kontur\.ru\/install\-rosreestr)/i,att:dE,sites:{https:["rosreestr.ru"]}},fts:{regex:/([=\/]fts|kontur\.ru\/install\-fts)/i,att:dE,sites:{both:["edata.customs.ru","edata2.customs.ru"]}},uc_fed_zakupki:{regex:/([=\/](fed|uc|zakupki)|kontur\.ru\/install|zakupki\.kontur\.ru\/site)/i,att:dE,sites:{nodefault:dj,https:[dO,dP,"zakupki.kontur.ru","kontur.ru","aukcioncenter.ru","ausib.ru","b2b-avia.ru","b2b-center.ru","b2b-energo.ru","b2b-npk.ru","b2b-rusnano.ru","best-etp.ru","ekburg.ru","elpass.ru","eltox.ru","eoil.ru","etp-profit.ru","etprf.ru","gisee.ru","gosuslugi.ru","goszakaz.perm.ru","mbki.ru","mosvodokanal.ru","mse.ru","mvpt.rosim.ru","payhd.ru","portal4.cbr.ru","rb2b.ru","regtorg.com","rosneft.ru","rosreestr.ru","selt-online.ru","sibtoptrade.ru","spbex.ru","tpl.admlr.lipetsk.ru","tzselektra.ru","ugzko.ru","zakazrf.ru","zakupki.gazprom.ru"],both:["kontur-ca.ru","a-k-d.ru","ahml.ru","akosta.info","alfalot.ru","arbitr.ru","astgoz.ru","atctrade.ru","auction63.ru","bankrupt.etp-agenda.ru","bankruptcy.selt-online.ru","bashzakaz.ru","bepspb.ru","cdtrf.ru","centerr.ru","d.ati.su","disclosure.ru","disclosure.1prime.ru","disclosure.skrin.ru","e-disclosure.azipi.ru","e-disclosure.ru","eksystems.ru","el-torg.com","electro-torgi.ru","eltorg.org","estp-sro.ru","etp.asgor.su","etp.dveuk.ru","etp-ets.ru","etp.mse.ru","etp-profit.ru","etp.roseltorg.ru","etp.s-vfu.ru","etpu.ru","etrade-capital.ru","fabrikant.ru","fciit.ru","fedresurs.ru","fips.ru","gazneftetorg.ru","gazprombank.ru","gpb.ru","invoice-market.ru","kartoteka.ru","krista.ru","lesegais.ru","lk.fcsm.ru","lks.fcsm.ru","lot-online.ru","lotcenter.ru","m-ets.ru","market.zakupki.mos.ru","meta-invest.ru","mosreg.ru","nalog.ru","nistp.ru","nsso.ru","oek.rsl.ru","oetprf.ru","online.bookchamber.ru","otc.ru","otc-tender.ru","promkonsalt.ru","roseltorg.ru","rts-tender.ru","rus-on.ru","sberbank-ast.ru","seltim.ru","setonline.ru","startrader.ru","stroytorgi.ru","sudrf.ru","supply.severstal.com","tektorg.ru","torg-fin.ru","torgi.admkrsk.ru","torgi.donland.ru","torgi223.ru","torgibankrot.ru","utender.ru","vertrades.ru","vestnik-gosreg.ru","vtc33.ru","zakupki.gov.ru","zakupki21.ru"]}}};
var ea={common:dj};function d7(ei,eh){if(eh){aL.foreach(eh,function(ej){ei.push(ej)})}}function ec(ej,eh){var ei={att:eh||w,http:[],https:[]};if(!ej.nodefault){d7(ei.https,eb.https);
d7(ei.https,eb.both);d7(ei.http,eb.http);d7(ei.http,eb.both)}if(ej.common){d7(ei.https,d8.https);d7(ei.http,d8.http)}if(ej.https){d7(ei.https,ej.https)
}if(ej.http){d7(ei.http,ej.http)}if(ej.both){d7(ei.https,ej.both);d7(ei.http,ej.both)}return ei}for(var ef in eg){var ee=eg[ef];if(ee.regex.test(d9)){return ec(ee.sites,ee.att)
}}return ec(ea)}var d2=bw;function dN(d7){return d7&&(dj===d7||(d7[2]&&d7[2].length))}function dM(d7){return d7&&(dj===d7||d7[0]&&d7[0].length||d7[1]&&d7[1].length||d7[2]&&d7[2].length||d7[4]&&d7[4].length)
}function dL(){function d7(ec,ed){if(ec&&ec.length){aF(ec,function(ee){d2[ee]=ed})}}function d8(ec){if(ec&&(dj!==ec)){d7(ec[2],2);d7(ec[0],10);d7(ec[1],1);
d7(ec[4],4)}}if(!d2){d2={};var ea=aP?bw:dp.PolCUDomains,eb=dp.PolLMDomains,d9=dM(eb)||dM(ea);d8(eb);if(!d9){d8(dp.LMDomains)}d8(ea);if(!aP&&!d9){d8(dp.CUDomains)
}}return d2}function dI(ed,ee){if(!ee||!ee.length){return[]}if(!dp||("string"==typeof(dp))){return ee}var d7=dN(dp.CUDomains),d8=dN(dp.LMDomains),d9=dN(dp.PolCUDomains),ea=dN(dp.PolLMDomains);
if(!d8&&!ea){if(aP||(!d7&&!d9)){return ee}}var ef=dL(),ec=[];function eb(eg){var ej=ef[ed+eg]||ef[eg];if(ej){return(2==ej)}var eh=eg.split(af);while(eh.length>1){eh.shift();
var ei=eh.join(".");ej=ef[ed+ei]||ef[ei];if(ej){return(2==ej)}}return bw}aF(ee,function(eg){if(!eb(eg)){ec.push(eg)}});return ec}var d0=bw,dZ={att:w,http:[],https:[]},dW=au,dY=au;
if(bR){d0=dK();dZ.http=dI("http://",d0.http);dZ.https=dI("https://",d0.https);dW=dZ.http.length||dZ.https.length;dY=dM(dp.PolCUDomains)||dM(dp.PolLMDomains);
T.setValue("IE/TrustedSites",dp)}if(bE){T.setValue("IE/Addons",g)}if(bQ){T.setValue("IE/TrustedSettings",dl)}if(bD){T.setValue("IE/AdditionalSettings",d)
}V.addFix(new ax("IE.TrustedSettings",{message:dh("IE/TrustedSettings"),filename:d0&&d0.att||w,priority:1,order:50,needadmin:(bc||dY)?1:0,needrestart:a6?1:0,fix:function(d8){var d7=this;
return aA(dZ).then(function(d9){if(bc||dY||!d9){dW=dj}return aB().then(function(){return dW?d7.apply(d8):d8(dj)},function(ea){bq.error("Ошибка настройки надежной зоны",ea);
return d7.apply(d8)})})},available:!!(bQ||bR),test:function(eb){if(!bQ&&!bR){return 0}function d8(eg,ed){if(!eg||!eg.length){return""}var ef={},ee=[];aF(eg,function(ei){var eh=ei.split(af);
if(2==eh.length){ef[ei]=dj;ei="*."+ei}else{if(eh.length>2){var ej=eh[eh.length-2]+"."+eh[eh.length-1];if(ef[ej]){return bw}}}ee.push(ed+ei);return bw});
return ee.join(",")}if(bR){var ec;if(dW&&dY){var d9=d8(dZ.http,"http://"),ea=d8(dZ.https,"https://");ec="policies|"+d9+((d9&&ea)?",":"")+ea}else{ec=dW?"fix":""
}eb.setMessage("IE/TrustedSites",("none"===dp)?2:(dW?1:0),ec)}if(bQ){eb.setMessage("IE/TrustedSettings",dn);if(dm>=0){var d7=(0!==dn)?"fix":"";eb.setMessage("IE/TrustedSettings/"+(2+dm)+"/Value",dn,d7)
}}return dW?1:dn}}));var dX=bY.IEDefault,dV="6.0",dU="12.9999";switch(dy){case 500:dX=bY.IE2000;dV="5.0";dU="6.999";break;case 501:case 502:case 503:dX=bY.IEXP;
dV="6.0";dU="8.9999";break;case 600:case 601:dX=bY.IEVista;dV="7.0";dU="9.9999";break;case 700:case 701:dX=bY.IEWin7;dV="8.0";dU="11.9999";break;case 800:case 801:dV="9.0";
dU="10.9999";break;case 810:case 811:dV="10.0";dU="11.9999";break;case 1010:case 1011:dV="11.0";dU="12.9999";break;default:bq.error("Неизвестная версия Windows при анализе версии IE: "+dy);
break}if(bK){V.addFix(new ax("IE.StartWindowsUpdate",{message:dh("IE/StartWindowsUpdate"),script:1,needadmin:1,priority:0,order:110,fix:function(d7){return c7("wuauserv").then(d7)
},test:function(){if(1!=dB){return 0}if(!aX||!aX.length||("err"===aX)){return 1}return !E(dX,aX)}}));var d6=bi&&(3==dx),dQ=(1049==bo),dR=dQ?"IE8-WindowsXP-KB2586448-x86-RUS.exe":"IE8-WindowsXP-KB2586448-x86-ENU.exe",dT=dQ?"F/7/F/F7FDA3C0-4681-4E82-8C23-EBBBC0A53706/":"D/3/C/D3CCE043-9EF3-482A-9A2E-63A3A403AE95/",dS=dh("IE/KB2586448",a);
V.addFix(new ax("IE.KB2586448",{message:dS.message,caption:dS.caption,filename:dR,args:"/quiet /norestart",foreign:bs+dT+dR,needadmin:1,priority:1,needreboot:1,order:2550,test:function(){return(d6&&a9&&!ba&&a2&&!a3&&!bk)?1:0
}}));(function d3(){var eo=aJ(au),en=au;function em(eq,ep){if(en){return}en=dj;if(0===eq){eq=1;if(bu){eq=(E(dV,aX)&&E(aX,dU))?0:2}}T.setMessage("IE/IEVersion",eq,ep)
}if(!eo){return em(0,bw)}var ef=(dx>=2),d9=a8?11:(a7?10:(ba?9:8)),d7=du.fullIEUpdate&&({XP:ef?8:bw,Server2003:ef?8:bw,Vista:ef?9:8,"7":(dx>=1)?11:9})[eo]||d9;
if(!d7){bq.debug("Для Windows "+eo+" SP"+dx+" не обновляем IE");return em(-1,bw)}var el=(function(){var ep=" не поддерживает работу с этой версией интернет-браузера";
if(du.egaisLocale){return{version:11,text:"Контур.Маркет"+ep}}if(aq){return{version:11,text:"Контур.Бухгалтерия"+ep}}if(du.ftsLocale){return{version:10,text:"Контур.Декларант"+ep}
}if(du.kembLocale){return{version:9,text:"Контур.Экстерн (Малый Бизнес)"+ep}}if(du.hotelLocale){return{version:11,text:"Контур.Отель"+ep}}if(du.fmsLocale){return{version:11,text:"Контур.ФМС"+ep}
}if(du.ofdLocale){return{version:11,text:"Контур.ОФД"+ep}}if(du.otchetLocale){return{version:10,text:"Отчет.ру"+ep}}return{version:8,text:""}})();if(el.version>d9){em(2,el.text)
}var d8=bY["IE"+d7],eg=du.onlineregLocale?bY.IE8:d8;if(!bu||!eg||E(eg,aX)){bq.debug("Более новая версия IE уже установлена: "+(eg||"нет")+" <= "+aX);return em(0,bw)
}var ej=du.ram,ek="Для установки новой версии Internet Explorer требуется не менее ",ei=(be?512:128),eh=(bj?200:150);if(du.hddSize<eh){return em(1,ek+eh+" Мбайт на диске")
}if((ej>0)&&(ej<ei-1)){return em(1,ek+ei+" Мбайт оперативной памяти")}function ea(eq){var ep=r.updateInfo[eq][eo];if(!ep){return bw}return ep.file?ep:ep[bj?"x64":"x86"][dQ?"rus":"eng"]
}var ec=ea(d7);if(!ec){if((dy>=501)&&(dy<800)){bq.debug("Нет инсталлятора IE для данной конфигурации системы (requiredIE: "+d7+", winVersionString: "+eo+")")
}return em(0,bw)}var ed=dh("IE/IEVersion/"+((d7>d9+1)?"nover":d7)),eb=ec.file,ee=ec.link;if(eb&&ee){ee=bs+ee+"/"+eb}V.addFix(new ax("IE.IEVersion",{message:c+" "+ed,caption:ed,filename:eb,size:(11==d7)?(bj?58601168:32335056):null,args:"/passive /norestart",foreign:ee,needadmin:1,priority:1,order:2600,needreboot:1,dependency:["Windows.InstallerVersion","IE.StartWindowsUpdate"],fix:function(er){var ep=this,es=a9&&!ba,eq=d7;
if(es){dg("UpdateIE8","Start")}function eu(ev){if(es){dg("UpdateIE8","Start"+eq)}return ep.apply(function(ew){var ex=(ew&&!ew.code);if(es){dg("UpdateIE8",(ex?"Success":"Failed")+eq)
}if(ex){du.ieVersion=eq+".0"}--eq;if(ex||(eq<d9+1)){if(es){dg("UpdateIE8",(ex?"Success":"Failed"))}ev(ew)}else{ec=ea(eq);ee=ec.link;ep.filename=eb=ec.file;
ep.url=du.distrPath+eb;ep.foreign=ee?(bs+ee+"/"+eb):(N.rootUrl+ep.url);ep.size=du.productSizes[eb.toLowerCase()]||0;V.getFixer().resetProgress(ep);dw.setTimeout(function(){eu(ev)
},100)}})}function et(ey){if(!bh){return er(ey)}var ew,ev,ez="wusa.exe",ex="/uninstall /kb:2882822 /quiet /norestart";if(bj){ew=s(bp.$System,"cmd.exe");
ev='/C "'+s(bp.$SysNative,ez)+'" '+ex}else{ew=s(bp.$System,ez);ev=ex}return N.run(ew,{admin:dj,wait:dj,args:ev}).waitExit().then(function(eD){if(!eD){throw aL.Err("Неизвестная ошибка выполнения "+ez)
}var eB=[0,3010,2359299,2359303],eA=eD.exitCode(),eC=M(eB,eA);if(!eC){throw aL.Err(ez+" завершена с ошибкой",eA)}bq.debug("Успешно удалили KB2882822")}).caught(function(eA){bq.debug("Ошибка удаления KB2882822",eA)
}).anyway(function(){er(ey)})}return eu(et)},test:function(){em(a9?1:2,"upd"+d7);return eb?1:0}}));return dj})();if(!V.getFixer().getFix("IE.IEVersion")){var d1=dh("IE/IEVersion/nover");
V.addFix(new ax("IE.IEVersion",{message:c+" "+d1,caption:d1,filename:"filename",needadmin:1,priority:1,order:2600,needreboot:1,dependency:["Windows.InstallerVersion","IE.StartWindowsUpdate"],fix:function(d7){d7(dj)
},test:function(){return au}}))}}V.addFix(new ax("IE.UserAgent",{message:dh("IE/UserAgent"),script:1,priority:1,needadmin:bc?1:0,needrestart:a6?1:0,order:1200,fix:function(d7){return az().then(d7)
},available:!!bS,test:function(d7){if(!bS){return 0}var d8=ds.indexOf("MSIE")!=ds.lastIndexOf("MSIE");d7.setMessage("IE/UserAgent",(aZ||d8)?2:-1,aZ?"fix":"");
return aZ?2:0}}));V.addFix(new ax("IE.CompatMode",{message:dh("IE/CompatMode"),script:1,priority:(a9&&!ba)?1:0,needadmin:(bc||I)?1:0,needrestart:a6?1:0,order:1250,fix:function(d7){var d9=cE+b6,d8=[],ea=dj;
return bZ.when(function(){if(G.AllCompat){return cL(bc?aO:aN,d9,b5,0,au)}return bw}).caught(function(eb){ea=au;bq.error("Не удалось отключить режим совместимости",eb)
}).then(function(){if(G.CompatSites instanceof Array){var ee=G.CompatSites.length;for(var eb=0;eb<ee;++eb){var ed=G.CompatSites[eb];if(!u.test(ed)&&!bm.test(ed)){d8.push(ed)
}}if(ee!=d8.length){if(d8.length){var ec=L(d8);return cK(aN,b7,"UserFilter",ec,au)}else{return cb(aN,b7,"UserFilter",au)}}}return bw}).caught(function(eb){ea=au;
bq.error("Не удалось задать новый список сайтов совместимости",eb)}).then(function(){function eb(ef,ed,ec){var ee=ed+ct+b6;return S(ef,ed+ct,au,0).then(function(eg){if(eg.AllCompat){return cL(ef,ee,b5,0,au)
}return bw}).caught(function(eg){ea=au;bq.error("Не удалось задать новый список сайтов совместимости",eg)}).then(function(){return cA(ef,ed+cj,aT,ec).then(function(eg){if(!eg&&(0!==eg)){throw bv
}return cb(ef,ed+cj,aT,ec)}).caught(function(eg){ea=au;if(!a4(eg)){bq.error("Не удалось отключить режим совместимости по пути "+cC[ef]+ed+cj+aT,eg)}})}).anyway(function(){return aH({},ef,ed,ec).each(function(eg){if(u.test(eg)||bm.test(eg)){return bZ.all(cb(ef,ed+cu,eg,ec),cb(ef,ed+cx,eg,ec))
}return bw}).caught(function(eg){ea=au;bq.error("Не удалось удалить сайты из групповых политик по пути "+cC[ef]+ed+cu+" или "+cC[ef]+ed+cx,eg)})}).then(function(){return ea
})}return bZ.fork(!bc,function(){return eb(aN,cE,au)}).fork(ea,function(){return bZ.when(function(){if(aK()||bd()){throw ao("UAC or User",5)}return bZ.all(eb(aO,cE,bj),bj?eb(aO,cF,au):dj).spread(function(ec,ed){if(!ec||!ed){throw bv
}return dj})}).caught(function(){return cP("FixCompatMode",dj)})},ea).then(d7)})},available:!!H,test:function(ea){if(!H){return 0}var d7=this,eb=G.AllCompat||G.PolAllCompat||G.PolFeatureBrowser,ec={};
if(eb){d7.priority=1}function d8(ef,ee){ec[ee]=0;if(ef&&(ef instanceof Array)){for(var eg=0,eh=ef.length;eg<eh;++eg){var ei=ef[eg];if(u.test(ei)){d7.priority=1;
eb=dj;ec[ee]=2;break}else{if(bm.test(ei)){eb=dj;ec[ee]=1}}}}}d8(G.CompatSites,"user");d8(G.PolCompatSites,"pol");var d9=eb?((P||O||cR||cW||de)?"fixother":"fixkontur"):"",ed="IE/CompatMode";
ea.setMessage(ed,eb?2:0,d9);ea.setMessage(ed+"/AllCompat",G.AllCompat?2:0);ea.setMessage(ed+"/Intranet",0);ea.setMessage(ed+"/MSCompat",0);ea.setMessage(ed+"/CompatSites",ec.user);
ea.setMessage(ed+"/PolAllCompat",G.PolAllCompat?2:0);ea.setMessage(ed+"/PolIntranet",0);ea.setMessage(ed+"/PolMSCompat",0);ea.setMessage(ed+"/PolFeatureBrowser",G.PolFeatureBrowser?2:0);
ea.setMessage(ed+"/PolCompatSites",ec.pol);return(eb&&(!bC||d7.priority))?2:0}}));V.addFix(new ax("IE.ParentalControl",{message:dh("IE/ParentalControl"),script:1,priority:1,needadmin:1,needrestart:a6?1:0,order:60,fix:function(d7){var d8="Enabled";
return bZ.when(function(){if(aK()||bd()){throw ao("UAC or User",5)}return bZ.serial(cL(aO,cs,d8,0,bj),cA(aO,cs,d8,bj)).spread(function(ea,d9){if(0!==d9){throw new Error("Родительский контроль остался включенным ("+d9+")")
}return dj})}).caught(function(){return cP("FixParentalControl").then(function(){return cA(aO,cs,d8,bj).then(function(d9){if(0!==d9){throw new Error("Родительский контроль остался включенным ("+d9+")")
}return dj}).caught(function(d9){bq.error("Не удалось отключить родительский контроль",d9);return au})})}).then(d7)},available:!!bU,test:function(d8){if(!bU){return 0
}var d7=(1==bV)?"fix":"";d8.setMessage("IE/ParentalControl",(0===bV)?0:2,d7);return(1==bV||"needadmin"===bV)?1:0}}));var dJ=dh("IE/EnterpriseMode")+(a8?" 11":"");
V.addFix(new ax("IE.EnterpriseMode",{message:dJ,priority:1,needadmin:1,order:2040,script:1,fix:function(d7){return bZ.all(bc?bw:cB(aN,cd,ag,au).caught(bw),cB(aO,cd,ag,bj).caught(bw)).spread(function(d8,d9){if((ai!==d8)&&(aj!==d8)){if((ai!==d9)&&(aj!==d9)){throw bv
}}}).then(dj,function(){function d8(d9,ea){return bZ.serial(cM(d9,cE+ct+ck,"","",ea),cM(d9,cE+ct+cl,"","",ea),cM(d9,cd,ag,ai,ea))}return bZ.fork(bc,dj,function(){return d8(aN,au)
}).then(function(){return d8(aO,bj).then(dj,bc?bZ.thrown("System need HKLM"):dj)}).caught(function(d9){bq.debug("Ошибка настройки EnterpriseMode для IE11 - включаем альтернативный режим",d9);
return cP("SetEnterpriseMode",dj)})}).then(d7)},available:!!an,test:function(d7){if(!an){return 0}var d8=(1==am);d7.setMessage("IE/EnterpriseMode",am,d8?"fix":"");
return d8}}));V.addFix(new ax("IE.SyncMode",{message:dh("IE/SyncMode"),script:1,priority:1,needadmin:0,needrestart:a6?1:0,order:70,fix:function(d7){return cL(aN,dd,"SyncMode5",4,au).then(dj,au).then(d7)
},available:!!bP,test:function(d7){if(!bP){return 0}var d8=(3==dc||4==dc);d7.setMessage("IE/SyncMode",d8?0:2,d8?"":"fix");return d8?0:2}}));V.addFix(new ax("IE.DOMStorage",{message:dh("IE/DOMStorage"),script:1,priority:1,needadmin:0,needrestart:a6?1:0,order:75,fix:function(d7){var d9="\\Total",d8=dj;
return bZ.when(function(){if(W>(ae-10485760)){throw ao("limit",1)}return cL(aN,cc+d9+"\\","",W,au)}).caught(function(){return ca(aN,cc+d9,au)}).caught(function(ea){ea=bW(ea);
return cL(aN,cc+d9+"\\","",0,au).caught(function(ec){d8=au;ec=bW(ec);try{ec.innerError=ea}catch(eb){}bq.error("Ошибка настройки DOMStorage",ec)})}).then(function(){return d7(d8)
})},available:!!bG,test:function(){return bG?(Y>=(ae-ad)):0}}));V.addFix(new ax("IE.ClearTemp",{message:dh("IE/ClearTemp"),script:1,priority:0,needadmin:bc?1:0,needrestart:a6?1:0,order:2200,fix:function(d7){return bZ.timeout(10).then(C).then(d7)
},available:!!(!bO||bO.ClearTemp),test:function(){return this.available}}));V.addFix(new ax("IE.AdditionalSettings",{message:dh("IE/AdditionalSettings"),script:1,priority:1,needadmin:bc?1:0,needrestart:1,order:20,fix:function(d7){var d8=dj;
return bZ.each(n,function(d9,ea){return cL(ea.root,ea.path,d9,ea.def,au).caught(function(eb){d8=au;bq.error("Ошибка исправления параметра "+d9+" в настройках IE",eb)
}).then(function(){ea.polpath=ea.path.replace(cE,cE+ct);if(ea.polpath!=ea.path){return cA(ea.root,ea.polpath,d9,au).then(function(eb){if(ea.def===eb){throw bv
}return cL(ea.root,ea.polpath,d9,ea.def,au).caught(function(ec){d8=au;bq.error("Ошибка исправления параметра "+d9+" в групповых политиках",ec)})}).caught()
}return bw})}).then(function(){return d7(d8)})},available:!!bD,test:function(eb){if(!bD){return 0}var ed="IE/AdditionalSettings";eb.setMessage(ed,e);if(d&&(d instanceof Array)&&d.length){var d8=function(ei,ej,ek){eb.setMessage(ed+"/"+ej+"/Settings/"+ek,ei,"fix");
return ei};var ee=0;for(var ec in n){var ef=n[ec];for(var d9=0,ea=d.length;d9<ea;++d9){var d7=d[d9];if(ef.category==d7.Category){var eh=ef.index,eg=d7.Settings[eh];
if(eg&&(ef.def!=eg.Value)){ee=Math.max(ee,d8(ef.status||2,d9,eh))}break}}}return ee}return 0}}));var dG=[],dF=[],d4=[],d5=["Kaspersky Protection"],dH=[(N.veryBadPrograms||"Browse2Save"),"a2zLyrics|A5SRCHAS|Active Desktop Mover|AdobeFlashStable|AdvanceElite|Advanced SystemCare Surfing Protection|^ advPlugin $|ALOT Appbar|AlterGeoBHO|AOLTBSearch|APIHelperBHO|AppEnable|Ask Search Assistant|AskBar BHO|Amazon 1Button App|avast\\!? (Online Security|WebRep)|^ AVdowloads $|AVG Safe Search|AVG Web TuneUp","^ Basic Class $","Babylon|BatBrowse|Better[\\- ]*Surf|BhoApp Class|Bing Bar|BlockAndSurf|BonanzaDeals|BonusBerry|Brass Search|Brothersoft API Server|BrowseMark|^ Browser Extensions $|BrowseSmart|BrowseStudio|BuzzSearch","Chrome Active Document|Chrome Frame|^ CinemaPro\\-\\d+\\.\\d+cV\\d+|^ Cinemax $|^ ClearThink $|cleickit|^ ClickCaption $|ClickForSale|Conduit Engine|CouponDownloader|Crawler|Cyti Web","Deal Keeper|DealPly|DefaultTab|delta Helper|Discount Buddy|Discount_Frenzy|DiVapton|DivX Plus Web Player HTML|^ DM Bar|Download Master","EnterDigital|ExplorerWnd Helper|^ ExtentionUI Class $|ExtraShoepper","Fast Search|Faster Light|FindRight|Framed Display|Funmoods Helper","GameCenterDetector Object|^ Ge\\-Force $|Google Gears|^ GpcContainer Class $|Greener Web","HD\\-Quality\\-v\\d|^ Hold Page|^ HomeTab $|HQ\\-Video\\-Pro|HypeNet","ICQ\\d|IDMDwnlMgr|IDMIEHlprObj|ie2\\.BHO|IETabPage Class|^ iExpert $|^ Internet Program $","Lampy Lighty|LinkSwift|Logitech SetPoint|LuckyShopper","MailRuBHO|Mediaa_Play_AIR|Media Buzz|^ Media Saver $|MedPvid\\d+\\.\\d+|Mega Browse|metacrawler Helper|Movies Search App|MyAshampoo API Server|^ MySafeProxy|My Web Search|mwsBar BHO","NetCrawl|newmrasearch","^ Object Browser $","Partner BHO Class|PathMaxx|PennyBee|PortalMore|PriceFountain|PriceMeter Express|PrivDog","QIPBHO|QipLI Class|Quiknowledge","Rambler\\-Ассистент|Rich Media View|RightSurf","SalesMagnet|SaveAs $|SaveByclick|^ SavePass $|^ SaveSense|saver box|Search App by Ask|SearchHook Class|SearchNewTab|SearchSnacks|^ Sense $|SerialTrunc|SimilarSites|Shopper Pro|Shopping App by Ask|Shopping Assistant Plugin|Skymonk|Skype Browser|SmArTCompare|SmarterPower|^ Snap\\.Do(Engine)? $|Solution Real|Special Savings|Splashtop Connect SearchHook|SunriseBrowse|Superfish|SweetPacks","TBSB00561|Techgile|TermTutor|TheSeaPlugin|TimerBHO Class|TinyBHO","Toolbar","^ topdeal $|^ Torrent Search $|Treasure Track|^ True Key $|^ True Key Helper $|Trust Media Viewer|^ TSearch $","UrlSearchHook Class","ValueApps|^ V\\-bates $|VestiBar|^ Video\\s+Player $|VK Downloader","WakoopaBHO|Weatherbar x86 Class|WebAlta|WebBars|^ WebConnect|Webexp Enhanced|^ webget|websaver|Whilokii|WinDealist|WordProser|wxDownload Class","XTTBPos00|Yontoo|Youtube AdBlock|YouTubeVideoDownloader","В.зуальн..? закладки|\\@Mail\\.Ru|Элементы Яндекса|Яндекс\\.Бар"];
V.addFix(new ax("IE.Addons",{message:dh("IE/Addons"),priority:1,order:80,script:1,needadmin:(bc&&!bd())?1:0,needrestart:a6?1:0,fix:function(d7){return ay(dF).then(function(d8){if(d8&&(bd()||!aK())){return dj
}return cP('DisableAddons "'+dF.join(",")+'"',dj)}).then(d7)},available:!!bE,test:function(d9){if(!bE){return 0}dG=[];dF=[];d4=[];var ec=function(ed){return df(ed.join("|").replace(new RegExp("\\s+","g"),"\\s*"),"i")
},eb=ec(d5),ea=ec(dH);if(g instanceof Array){aF(g,function(ed,ee){if(!ed.Status){return}var eg=(ed.Path||"").toLowerCase(),eh=ed.Name||eg,ei=ed.Version,ef=(eh||"").toLowerCase();
if(("shockwave flash object"===ef)||(eg.indexOf("flash.ocx")>=0)){if(!ei||("err"===ei)||!E(bY.FlashPlayerAX,ei)){du.needInstallFlashPlayer=1}}if(eh){if(eb(eh)){d4.push(ee)
}else{if(ea(eh)){dG.push(ee);dF.push(ed.Guid)}}}})}var d8=!!dG.length,d7=d8?2:Math.max(h,d4.length?1:-1);d9.setMessage("IE/Addons",d7);aF(dG,function(ed){d9.setMessage("IE/Addons/"+ed,2,"fix")
});aF(d4,function(ed){d9.setMessage("IE/Addons/"+ed,1)});return d8?2:0}}));V.addFix(new ax("IE.IEisDefault",{message:dh("IE/IEisDefault"),needadmin:0,priority:0,order:2830,script:1,fix:function(d8){var d7=s(bp.$IE86,aT);
return av(d7).exists().truth(function(){d7='"'+d7+'" -nohome';return c2(d7,d7+' "$1"',"IEXPLORE.EXE","htmlfile","shtmlfile",s(bp.$System32,"url.dll,0"),"IExplore",aV,aW)
},bZ.thrown(ao("IE not found",2))).then(dj,function(d9){bq.error("Ошибка настройки браузера по умолчанию",d9);return au}).then(d8)},available:bJ,test:function(d8){if(!bJ){return 0
}var d7="";if(1==a1){if(du.noSetDefaultIE||(du.keAllLocale&&!bh)){a1=-1}else{if(!bf){d7="fix"}}}d8.setMessage("IE/IEisDefault",a1,d7);return("fix"===d7)
}}));return dj})};window.SkbKontur.Help.Scripts.OtherBrowsers=function(F,m,a1){var bI=window,ar=bI.SkbKontur.Help,x=ar.Core,I=ar.Err,ae=ar.Fix,aj=ar.foreach,aw=ar.isArray,aR=ar.map,a7=ar.Promise,bz=ar.Test,bD=ar.trim,aO=x.log,au=x.HKLM,at=x.HKCU,j=x.browser,l=x.buildPath,v=x.compareVersion,D=x.cyrillicFirstCompare,aa=x.File,ab=x.fileExist,ah=x.Folder,ai=x.folderExist,an=x.getProcesses,ao=x.getProductInfoReg,aq=x.hasUac,az=x.isFileNotFoundError,aD=x.isSystem,aE=x.isUser,a9=x.$readAll,bd=x.regDeleteKey,be=x.$regEnumKeys,bi=x.$regReadString,bl=x.removeBadChars,bo=x.run,bp=x.runUniversalFix,bv=x.secureEvalJSON,bw=x.setDefaultBrowser,bB=x.trackEvent,bK=x.$writeAll,bH=x.vars,f=bH.arch,A=bH.cryptoproLocale,B=bH.cspLocale,E=bH.diadocLocale,H=bH.diagnostics,af=bH.flashLocale,ag=bH.fmsLocale,ak=bH.ftsLocale,aJ=bH.keAllLocale,aL=bH.ktbLocale,aU=bH.onlineregLocale,a0=bH.otchetLocale,a6=bH.productVersions,bm=bH.rootPath,bn=bH.rpnLocale,bs=bH.rutokenLocale,bt=bH.sberLocale,bu=bH.schoolLocale,bJ=bH.winVer,G=ar.Diagnosis,bC=G.translateFix,c="Actions/",a=bC(c+"install"),d=bC(c+"reinstall"),e=bC(c+"update"),b=bC(c+"install")+" новой версии";
var J=false,bE=true,aT=null,bc=x.regCurVer,bj=x.regSoftware,bk="Wow6432Node\\",bf=bj+"Mozilla\\",bg=bj+"MozillaPlugins\\",bh=bj+bk+"MozillaPlugins\\",bF=!bH.fedLocale&&x.isUCProfiles(),a8=x.isRARProfiles(),aF=(bJ>=700),aG=(bJ>=800),aH=(64==f),ax=j.chrome,aA=j.firefox,aB=j.opera,aI=j.yabrowser,n=!af&&!aU,aQ=bF||a8||bH.diadocLocale||(aJ&&aF),aP=bF||a8||(aJ&&aF),bG=aE()&&!aq(),bq=D("Name"),br=D("Version"),aN,a2;
var aK=a1?a1.KonturExtern:aT;function al(w){return("string"==typeof(w))?document.getElementById(w):w}var k=[],by="SOFTWARE\\Clients\\StartMenuInternet\\",bx="\\shell\\open\\command\\";
var ap=E||a8||bH.ofdLocale||ag,u,t,s,ay=aT,p,q,r;var aZ,aC,aW,aX,aY;var bL,bN,bO,bP;var av=new RegExp("(Помощник Диагностики|Контур.*Плагин)","i");var Y,ad,ac,z,y=A||B,V,W,X=aT,T=aT,N,O,P,C={},a3=[],Q=new RegExp('user_pref\\s*\\(\\s*\\"plugin\\.load_flash_only\\"\\s*,\\s*([^\\s\\)]+)\\s*\\)',"i"),aM,U=new RegExp('user_pref\\s*\\(\\s*\\"browser\\.privatebrowsing\\.autostart\\"\\s*,\\s*([^\\s\\)]+)\\s*\\)',"i"),a5,Z=aJ||bn,M=aJ,L=new RegExp('user_pref\\s*\\(\\s*\\"browser\\.tabs\\.remote\\.autostart(\\.[^\\"]+)?\\"\\s*,\\s*([^\\s\\)]+)\\s*\\)',"i"),K=aT,S=new RegExp('user_pref\\s*\\(\\s*\\"plugin\\.state\\.([^\\"]+)\\"\\s*,\\s*(\\d)\\s*\\)',"i"),R=bt?["npcades","npkonturdiag","npkonturtoolbox","npdiagplugin","npapikd"]:((A||bs||a8)?["java","npcades","npkonturdiag","npdiagplugin","npapikd","npkonturtoolbox","nppdf"]:["npcades","npcryco","npffax","npifcplugin","npkonturdiag","npdiagplugin","npapikd","npkonturtoolbox","nppdf"]);
if(a0||bu){R.push("flash")}if(aL){R.push("npctrl")}if(ak){R.push("npftssignplugin")}function bb(){return a9(W,1251).then(function(bT){var bS=bT.split(new RegExp("\\r?\\n","g")),w=aT,bV=aT,bW=aT,bR=J,bQ=J;
function bU(){if(bW){if(bR){bW=l(V,bW)}if(bQ){w=bW}else{bV=bW}}bW=aT;bR=J;bQ=J}aj(bS,function(bX){if(bX&&bX.length){if("["==bX.charAt(0)){bU()}else{var bY=bX.toLowerCase();
if(0===bY.indexOf("path=")){bW=bD(bX).substr(5).replace(new RegExp("/","g"),"\\")}else{if(0===bY.indexOf("isrelative=1")){bR=bE}else{if(0===bY.indexOf("default=1")){bQ=bE
}}}}}});bU();X=w||bV}).caught(function(w){aO.debug("Ошибка чтения файла со списком профилей Firefox",w)})}var aS,g=[],h=[],a4=[],i;var o,aV,bM;function ba(w){var bQ=bc+"App Paths\\"+w+"\\";
return a7.all(bi(au,bQ,"",J).caught(aT),bi(at,bQ,"",J).caught(aT)).spread(function(bR,bS){return{admin:bR,user:bS}})}function bA(w,bR,bV,bU,bS){bV=("undefined"!=typeof(bV))?bV:bE;
var bQ="OtherBrowsers/"+w+"Version",bT=J;return bS().caught(aT).then(function(bW){if(bW&&bU&&v(bU,bW)){bT=bE}if(bW||!bV){k.push({diagCategory:bQ,version:bW||"not",status:bT?-1:0,comment:bT?((bR||w)+" версии "+bU+" и выше несовместим с некоторыми программами"):""})
}return bW})}function am(w){var bR=by+w+bx,bQ=by+w+".exe"+bx;return bi(au,bR,"",J).caught(function(){return bi(au,bQ,"",J)}).caught(function(){return bi(at,bR,"",J)
}).caught(function(){return bi(at,bQ,"",J)}).then(function(bS){if(bS&&bS.length){return aa(bS.replace(new RegExp('^\\"|\\"$',"g"),"")).get("ev").truth(function(bT,bU){return bU
},aT)}return aT})}return a7.when(x.getLocator).then(function(w){aN=w;a2=aN?aN.$PFiles86:aT;return a7.when(function(){return bA("Opera",aT,1,aT,function(){return am("Opera").anyway(function(bQ){if(typeof(bQ)=="string"||typeof(bQ)=="number"){return bQ
}else{return x.getProductVersion("^Opera\\s+")}})}).then(function(bQ){bB("FoundOperaPresto",bQ||"No")})}).then(function(){var bQ=a6.OperaStableBad;return bA("OperaStable","Opera",1,"38.0",function(){return am("OperaStable")
}).then(function(bR){aZ=bR;aC=aZ&&!v(bQ,aZ);bB("FoundOperaStable",aZ||"No")})}).then(function(){var bQ=bj+"Yandex\\YandexBrowser\\";return bi(at,bQ,"pv",J).caught(aT).anyway(function(bR){bL=!!bR;
return bA("YandexBrowser","Яндекс.Браузер",1,"16.7",function(){return ao(at,"YandexBrowser","DisplayVersion",J)}).then(function(bS){bB("FoundYaBrowser",bL&&(bS||bR)||"No")
})})}).then(function(){return bA("MailruInternet",aT,1,aT,function(){return ao(at,"Xpom","DisplayVersion",J)}).then(function(bQ){bB("FoundXpom",bQ||"No")
})}).then(function(){return bA("MailruAmigo",aT,1,aT,function(){return ao(at,"Amigo","DisplayVersion",J)}).then(function(bQ){bB("FoundAmigo",bQ||"No")})
}).then(function(){V=l(aN.$AppData,"Mozilla\\Firefox\\");W=l(V,"profiles.ini");function bQ(bR,bS,bT){return bi(au,bf+bR+"\\","CurrentVersion",bT||J).truth(function(bV){var bU=bf+(bS||bR)+"\\"+bV+"\\Main\\";
return bi(au,bU,"PathToExe",bT||J).then(ab).truth(bV)},aT).caught(aT)}return a7.all(bQ("Mozilla Firefox"),bQ("Mozilla Firefox ESR","Mozilla Firefox"),y?bQ("CryptoPro Fox"):aT,aH?bQ("Mozilla Firefox",aT,bE):aT,ba("firefox.exe")).spread(function(bS,bU,bT,bV,bR){if(bU||bV){Y={Common:(bS||"not")};
if(bU){Y.ESR=bU}if(bV){Y.CommonX64=bV}}else{Y=bS||(bH.noSse2?"sse2":"not")}if(bS){if(v(a6.FirefoxBadMin,bS)){aM="new"}else{if(!v("52.0",bS)){aM="old"}}}else{aM="ff"
}z=bT;ad=bS||bU||bV;if(ad){ad=bD(ad.split("(")[0])}if(M&&ad){if(!v("51.0",ad)){K="old"}else{if(v("52.999",ad)){K="new"}else{K="yes"}}}bB("FoundFirefox",bS||"No");
if(bU){bB("FoundFirefoxESR",bU)}if(bV){bB("FoundFirefoxX64",bV)}ac=bR.admin||bR.user||l(a2,"Mozilla Firefox\\firefox.exe")}).then(function(){return ab(W).truth(bb,function(){aM="notfound"
}).then(function(){return ai(X).lie(function(){return ai(l(V,"Profiles")).truth(function(bR,bS){return bS.folders().then(function(bT){if(bT.length){X=bT[0]
}return ai(X).lie(function(){aO.debug("Папка с настройками Firefox не найдена: "+X)})})}).caught(function(bR){aO.debug("Ошибка перечисления папок с настройками Firefox",bR)
})}).truth(function(){T=l(X,"prefs.js");return ab(T).lie(function(){aO.debug("Файл настроек Firefox не найден: "+T)})}).truth(function(){aj(R,function(bR){C[bR]=bE
});return a9(T,1251).then(function(bR){var bS=bR.split(new RegExp("\\r*\\n","g"));aj(bS,function(bT){var bV=S.exec(bT),bU;if(bV&&(bV.length>2)){bU=bV[1];
a3.push({Name:bU,State:Number(bV[2])});if(C[bU]){C[bU]=J}return}bV=Q.exec(bT);if(bV&&(bV.length>1)){aM=bV[1]=="false"?bV[1]:"true";return}bV=U.exec(bT);
if(bV&&(bV.length>1)){a5=bV[1]=="false"?bV[1]:"true";return}if(M&&("yes"===K)){bV=L.exec(bT);if(bV&&(bV.length>2)){bU=bV[1];if(".2"===bU&&"false"===bV[2]){K="no"
}return}}});aj(C,function(bT){if(C[bT]){a3.push({Name:bT,State:1})}});a3=a3.sort(bq);if(!aM){aM="true"}if(!a5){a5="false"}})}).caught(function(bR){aO.debug("Ошибка чтения файла настроек Firefox",bR)
})})})}).then(function(){function bQ(bS,bR){return aa(bS).get("v").truth(function(bT){return a9(bS).then(function(bU){if(!bU||(bU.length<80)){throw I("Empty or small "+bR+" chrome.exe",8)
}return x.decodeBase64((bU.length>2048)?bU.substr(0,2048):bU,bE)}).then(function(bU){var bV="Ошибка определения 64-разрядности "+bR+" Chrome - ",bX=(bU[61]<<8)+bU[60];
if((bX+5)>=bU.length){aO.error(bV+"вышли за границу ("+(bX+5)+" / "+bU.length+")");return aT}if((bU[bX]!=80)||(bU[bX+1]!=69)||bU[bX+2]||bU[bX+3]){return aT
}var bW=bU[bX+4],bY=bU[bX+5];if((bW==76)&&(bY==1)){return J}else{if((bW==100)&&(bY==134)){return bE}}aO.error(bV+"PE-файл с разрядностью: 0x"+bW.toString(16)+", 0x"+bY.toString(16));
return aT}).truth(function(){ay=bE;return bT+" (x64)"},function(bU){if(aT===ay){ay=bU}return bT},function(bU){if(!az(bU)){aO.debug("Ошибка чтения файла "+bR+" chrome.exe",bU)
}return bT})},aT).caught(aT)}return ba("chrome.exe").then(function(bR){s=bR.admin||bR.user||l(a2,"Google\\Chrome\\Application\\chrome.exe");bH.chromePath=s;
return a7.all(bQ(bR.admin,"Admin"),bQ(bR.user,"User")).spread(function(bS,bT){t=aT;if(bS||bT){u={Admin:(bS||"not"),User:(bT||"not")};t=bS||bT;bH.chromeVersion=t
}bB("FoundChrome",t||"No")})})}).then(function(){function bR(bZ,bX){var bY=aa(bZ);return bY.exists().lie(a7.thrown(I("File ("+bY.name+") not found",2))).then(function(){return a9(bZ,65001)
}).then(bv).then(function(b0){var b3=[],b1=[],b2=0;if(b0&&b0.extensions){aj(b0.extensions.settings,function(b5,b4){var b7=b4.manifest;if(!b7||(1!=b4.state&&0!==b4.state)){return
}b3.push({Name:b7.name,Version:b7.version,State:b4.state});var b6=av.test(b7.name),b8=b6?(b4.state?0:1):-1;b1.push(b8);if(b8>0){b2=1}})}if(!b3.length){b3="empty";
b2=-1}return a7.args(b3,b1,b2)}).caught(function(b0){if(!az(b0)){aO.error("Ошибка чтения списка расширений "+bX,b0)}return a7.args("err",aT,2)})}function bU(bY,bX){return bR(l(bY,"Secure Preferences"),bX).tap(function(bZ){if("empty"===bZ||"err"===bZ){throw new Error()
}}).caught(function(){return bR(l(bY,"Preferences"),bX)})}var bS=aN.$LocalAppData,bV="User Data\\Default",bQ=l(bS,"Google\\Chrome\\"+bV),bW=l(bS,"Yandex\\YandexBrowser\\"+bV),bT=l(aN.$AppData,"Opera Software\\Opera Stable");
return a7.all(t&&bU(bQ,"Chrome").spread(function(bZ,bX,bY){p=bZ;r=bX;q=bY})||aT,bL&&bU(bW,"Yandex").spread(function(bZ,bX,bY){bN=bZ;bP=bX;bO=bY})||aT,aZ&&bU(bT,"Opera").spread(function(bZ,bX,bY){aW=bZ;
aY=bX;aX=bY})||aT)}).then(function(){var bR=[];function bS(bU){var bV=bU.split("/");if(bV.length<2){return{name:bU}}var bT=bV[1].split(new RegExp("[,;]version=","i"));
return{name:bT[0],version:bT.length>1?bT[1]:""}}function bQ(bV,bW){var bT=(au==bV),bU=(bT&&aH&&!bW)?bh:bg;return be(bV,bg,bW).each(function(bX){var bY=bg+bX+"\\";
return a7.all(bi(bV,bY,"Path",bW).caught(aT),bi(bV,bY,"ProductName",bW).then(bl).caught(aT),bi(bV,bY,"Version",bW).caught(aT)).spread(function(b0,bZ,b2){var b1=bS(bX);
bZ=bZ||b1.name;b2=b2||b1.version;return a7.fork(!b2&&b0,function(){return aa(b0).get("ev").caught(J).lie(function(){return("ha_plugin"===bZ)&&aa(l(b0,"nphaplugin.dll")).get("ev")
}).truth(function(b3,b4){b2=b4})}).then(function(){bR.push({LM:bW?2:((au==bV)?1:0),Name:bZ,Version:b2||"",Path:b0||"",RegKey:bU+bX+"\\"})})})}).caught(function(bX){if(!az(bX)){aO.debug("Ошибка перечисления плагинов Mozilla (root = "+(bT?"HKLM":"HKCU")+", x64 = "+bW+")",bX)
}})}return a7.all(!aD()?bQ(at,J):[],bQ(au,J),aH?bQ(au,bE):[]).then(function(){if(bR.length>1){bR=bR.sort(function(bT,bU){return bq(bT,bU)||br(bT,bU)||((bT&&bT.LM||0)-(bU&&bU.LM||0))
})}aS=bR.length?bR:"none";aj(aS,function(bU){var bT=x.badPluginsRegex.test(bU.Name);a4.push(bT?2:-1);if(bT){(bU.LM?h:g).push(bU)}});i=g.length||h.length
})}).then(function(){if(!ad){return aT}var bQ=l(X,"extensions.json"),bR=aT;return aa(bQ).exists().lie(function(){N="none";O=-1;return a7.$return()}).then(function(){return a9(bQ,65001)
}).then(bv).then(function(bS){bR=bS.schemaVersion;N=[];P=[];O=0;aj(bS.addons,function(bT){var bV=bT.defaultLocale.name;N.push({Name:bV,Version:bT.version,State:bT.active?1:0});
var bU=av.test(bV),bW=(bU&&!bT.active)?1:0;P.push(bU?bW:-1);if(bW){O=1}});if(!N.length){N="empty";O=-1}}).caught(function(bS){aO.error("Ошибка чтения списка расширений Firefox"+(bR?" (schemaVersion: "+bR+")":""),bS);
N="err";O=2}).caughtReturn()})}).then(function(){function bQ(bR){return ai(l(aN.$LocalAppData,bR))}function w(bR){return bQ(l(bR,"User Data\\Default\\Cache"))
}if(bH.needCleanBrowsersCache){return a7.all(w("Google\\Chrome"),bQ("Opera\\Opera\\cache"),w("Yandex\\YandexBrowser")).spread(function(bR,bS,bT){o=bR;aV=bS;
bM=bT})}return aT}).then(function(){F.setValue("OtherBrowsers/MozillaFirefoxVersion",Y);var bS="OtherBrowsers/GoogleChromeVersion";if(u){F.setValue(bS,u)
}else{if(ap){F.setValue(bS,(bH.noSse2?"sse2":"not"+(aF?"Latest":"49")))}}aj(k,function(cn){F.setValue(cn.diagCategory,cn.version,cn.status,cn.comment)});
function bR(cn){return an().each(function(co){if(co&&co.name&&cn(co.name)){return a7.$break(bE)}return aT},J)}function bZ(){return ab(W).lie(function(){return bo(ac,{args:"-CreateProfile default"}).waitExit(7000)
}).then(bb).then(function(){T=l(X,"prefs.js")},function(cn){aO.error("Не удалось создать файл профилей Firefox",cn)})}function cf(cn,co){if(typeof co=="string"){co='"'+co+'"'
}return'user_pref("'+cn+'", '+co+");"}function ce(cn){return cf("plugin.state."+cn,2)}function b6(){var cn=[];cn.push(cf("app.update.auto",bE));cn.push(cf("app.update.enabled",bE));
if(aF){var co=x.rootUrl+"/update/6/%PRODUCT%/%VERSION%/%BUILD_ID%/%BUILD_TARGET%/%LOCALE%/%CHANNEL%/%OS_VERSION%/%SYSTEM_CAPABILITIES%/%DISTRIBUTION%/%DISTRIBUTION_VERSION%/update.xml";
cn.push(cf("app.update.url",co));cn.push(cf("app.update.url.override",co))}return cn}var b1=J;function cm(cn){return a7.when(function(){return T&&X&&ab(W)
}).lie(bZ).then(function(){var co={};aj(R,function(cp){co[cp]=bE});return ab(T).truth(function(){return a9(T,1251).then(function(cp){var cr=cp.split(new RegExp("\\r*\\n","g"));
if(!cr||!cr.length){return a7.thrown("Empty settings")}var cq=[];aj(cr,function(cs){var cu=S.exec(cs),ct=cu&&(cu.length>2)?cu[1]:aT;if(ct&&co[ct]){cs=ce(ct);
co[ct]=J}cq.push(cs)});return cq}).caught(function(cp){aO.error("Не удалось прочитать старые настройки Firefox",cp);return J})},[]).truth(function(cp){aj(co,function(cq,cr){if(cr){cp.push(ce(cq))
}});cp=cp.concat(b6());cp.push(cf("plugin.load_flash_only",J));cp.push(cf("browser.privatebrowsing.autostart",J));if(cn&&(cn instanceof Array)&&cn.length){aj(cn,function(cq){cp.push(cq)
})}cp.push("");return ah(aa(T).folder).create().then(function(){return bK(T,cp.join("\r\n"),1251).then(bE)}).caught(function(cq){aO.error("Не удалось сохранить новые настройки Mozilla Firefox",cq);
return J})})}).caught(function(co){aO.debug("Ошибка при создании профиля пользователя Firefox",co);return J})}if(y){F.setValue("OtherBrowsers/CPFoxVersion",z||"not")
}if(M){F.setValue("OtherBrowsers/FFAutoStart",K||"ff")}var ca=bz("^(true|notfound)$","i")(aM||"");if(aM!="ff"){var b5=ca?1:(aM=="new"?-1:0);F.setValue("OtherBrowsers/FFFlashOnly",aM,b5)
}if(ad&&a5){var ch=(a5=="true")?1:(a5=="false"?0:-1);F.setValue("OtherBrowsers/FFPrivateBrowsing",a5,ch,(ch>0)&&!aA?"fix":"")}aj(k,function(cn){F.setValue(cn.diagCategory,cn.version,cn.status,cn.comment)
});function b4(cv,cp,cr,co){cr=cr||cp;var cn=J,cx=J,cs="Для продолжения настройки необходимо закрыть все окна интернет-браузера "+cr+".<br/>После этого настройка продолжится автоматически. Или ",cq=bz("(^|\\s|\\/|\\\\)"+co.replace(".","\\.")+'(\\"|\\s|>|<|$)',"i"),cw=H.getFixer().getFixId(cv.name),cu=al("diag-fix-custommessage-"+cw),cy=cv.statusObj;
ar["cancel"+cp+"NPAPI"]=function(){cn=bE;return J};function ct(){var cz=document.createElement("a");cz.href="#";cz.onclick=Function("return window.SkbKontur.Help.cancel"+cp+"NPAPI()");
cz.innerHTML="отмените&nbsp;настройку";return cz}if(cu){cu.innerHTML=cs;cu.appendChild(ct())}return a7.wait(function(){return bR(cq).caught(function(cz){aO.error("Не удалось найти процессы "+co,cz);
return J}).then(function(cA){if(cu){cu.style.display=cA?"":"none"}if(cA){if(cn){if(cu){cu.style.display="none"}aO.debug("Пользователь отменил включение NPAPI/плагинов в "+cr);
return bE}else{if(!cx&&cy){try{var cC="diag-"+cp+"-update-wait";cy.innerHTML='<span id="'+cC+'" style="display: inline-block; color: black"></span>';var cB=al(cC);
cB.innerHTML=cs;cB.appendChild(ct());cx=bE}catch(cz){}}}return J}if(cy){cy.innerHTML="Настройка..."}return bE})},aT,0,999).then(function(cz){return !cn&&cz
})}function b3(cn){return b4(cn,"Firefox","Mozilla Firefox","firefox.exe")}var bQ={code:1602,message:x.codeToMessages[1602]};F.setValue("OtherBrowsers/FirefoxPlugins",a3.length?a3:"not");
H.addFix(new ae("OtherBrowsers.FirefoxPlugins",{message:bC("OtherBrowsers/FirefoxPlugins"),script:1,dependency:["OtherBrowsers.MozillaFirefox","Windows.FixAppData"],needadmin:0,tags:[ae.Tags.APPDATA],priority:(ad||aZ)?1:0,order:2655,custommessage:" ",fix:function(cp,co){var cn=this;
cn.statusObj=co&&co.statusObj;return b3(cn).lie(bQ,function(){return b1?bE:cm()}).then(cp)},test:function(cp){var co=-1,cn={};if(a3.length){co=0;aj(a3,function(cs,cr){if(cs.Name in C){var ct=cs.State,cu=(ct==2)?0:(ct==1)?1:2;
cn[cr]=cu;co=Math.max(co,cu)}})}cp.setMessage("OtherBrowsers/FirefoxPlugins",co);aj(cn,function(cr,cs){cp.setMessage("OtherBrowsers/FirefoxPlugins/"+cr,cs)
});if(ca){co=Math.max(co,1)}if("true"===a5){co=Math.max(co,1)}var cq=(co>0)&&!aA;return(n&&cq)?1:0}}));if(M){H.addFix(new ae("OtherBrowsers.FFAutoStart",{message:bC("OtherBrowsers/FFAutoStart"),script:1,dependency:["OtherBrowsers.MozillaFirefox"],needadmin:0,priority:0,order:2656,custommessage:" ",fix:function(cp,co){var cn=this;
cn.statusObj=co&&co.statusObj;return b3(cn).lie(bQ,function(){b1=J;return cm([cf("browser.tabs.remote.autostart",J),cf("browser.tabs.remote.autostart.2",J)]).truth(function(){b1=bE;
return bE})}).then(cp)},test:function(cn){var co=("yes"===K),cp=co?1:(("no"===K)?0:-1);cn.setMessage("OtherBrowsers/FFAutoStart",cp,(co&&!aA)?"fix":aT);
return co&&!aA}}))}function ck(co,cr,cp,cq,cn){F.setValue("OtherBrowsers/"+co,cr,cq,(1===cq)?cn:"");if((cq===0)||(cq===1)){aj(cp,function(ct,cs){if(ct>=0){F.setMessage("OtherBrowsers/"+co+"/"+cs,ct)
}})}}if(ad){ck("FirefoxExtensions",N,P,O,aA?"ffthisext":"ffthatext")}function cl(){var co='"'+ac+'" -osint -url "%1"',cn=ac+",1";return bw(ac,co,"FIREFOX.EXE","FirefoxHTML","FirefoxHTML",cn,"","FirefoxURL","FirefoxURL")
}var b2=bC("OtherBrowsers/MozillaFirefox",ad?e:a),bY=bC("OtherBrowsers/CPFox",z?e:a);H.addFix(new ae("OtherBrowsers.MozillaFirefox",{message:b2.message,caption:b2.caption,filename:aF?"FirefoxSetup.exe":"FirefoxSetupESR.exe",args:"-ms",needadmin:1,needrestart:aA?1:0,priority:bG?0:(ad?(aP?0:1):(aQ?0:1)),order:2650,tags:[ae.Tags.APPDATA],custommessage:" ",fix:function(cp,co){var cn=this;
cn.statusObj=co&&co.statusObj;return b3(cn).lie(bQ,function(){bB("SetupFirefox","Start");return cn.apply(function(cq){var cr=cq&&!cq.code;bB("SetupFirefox",cr?"Success":"Failed");
return a7.fork(cr,function(){b1=J;return a7.fork(!aG&&!aJ&&!bF,cl).anyway(cm).truth(function(){b1=bE;return bE})}).then(cr)})}).then(cp)},test:function(ct){var cw=a6.FirefoxBadMax,cn=Y.Common||ad,cp=(cn&&("not"!==cn)&&("sse2"!==cn))?cn.split(" ")[0]:aT,cu=cp&&v(a6.FirefoxBadMin,cp),cv=Y.CommonX64,cs=-1,cq=(cv&&Z)?"ffx64":(cu?"ff55":""),cr=J,cz=cp&&!v(a6.Firefox,cp),co=Y.ESR?Y.ESR.split(" ")[0]:null,cy=co&&!v(a6.FirefoxESR,co);
if(!cp&&!Y.ESR){cr=n&&!bH.noSse2}else{if((cp||Y.ESR)&&!bH.noSse2){if(cu&&!v(cw,cp)){cq+=aA?"":"fix";this.message=bC("OtherBrowsers/MozillaFirefox",d).message;
cr=n}else{if(cz||cy){cq=aA?"":(cy?"esr":"")+(cv?"upd64":"upd32");cr=n}else{cs=0}}}}var cx=!aA&&cr;if(cx){cs=this.priority?1:-1}ct.setMessage("OtherBrowsers/MozillaFirefoxVersion",cs,cq);
return cx}}));if(y){H.addFix(new ae("OtherBrowsers.CPFox",{message:bY.message,caption:bY.caption,filename:"cpfox.win32.exe",args:"-ms",needadmin:1,priority:bG?0:(z?1:0),order:2658,tags:[ae.Tags.APPDATA],test:function(cp){var co=0,cn="";
if(!z){co=-1}else{if(!v(a6.CPFoxMin,z.split(" ")[0])){cn="upd";co=1}}cp.setMessage("OtherBrowsers/CPFoxVersion",co,cn);return(0!==co)}}))}if(t){ck("ChromeExtensions",p,r,q,ax?"chromethisext":"chromethatext")
}if(aZ){ck("OperaExtensions",aW,aY,aX,aB?"operathisext":"operathatext")}if(bL){ck("YandexExtensions",bN,bP,bO,aI?"yathisext":"yathatext")}function cc(co,cp){if(x.isMSHTA()){return J
}var cn=aA?N:aB?aW:aI?bN:ax?p:aT;if(!cn){return aT}if("empty"===cn){return bE}if(!aw(cn)){return J}var cq=bE;aj(cn,function(cr){if(co!==cr.Name){return aT
}if(!aA){cq=!cr.State}else{if(cp&&(j.version>=50)&&cr.Version&&!v(cp,cr.Version)){cq=bE}else{cq=J}}return J});return cq}function b8(cr,cq,cn){try{cn=cn||{};
if(j.firefox){var co=bH.rootPath+"DH/";bI.InstallTrigger.install({DH:co+cn.ff},function(ct,cs){aO.debug(ct+" "+cs);if(cs){cq(I(ct,cs))}else{cr(ct)}})}else{if(bI.opr&&bI.opr.addons){bI.opr.addons.installExtension(cn.opera,function(cs){cr(cs)
},function(cs){cq(I(cs))})}else{if(bI.chrome&&bI.chrome.webstore){bI.chrome.webstore.install(cn.chrome,function(cs){cr(cs)},function(cs){cq(I(cs))})}else{if(j.ax||j.np){cr("AX or NP")
}else{throw I("Unsupported browser")}}}}}catch(cp){cq(cp)}}x.browser._installExtension=b8;function b7(cy,cx,cu,cr){var cn=J,cz=J,cG=cy.name.split(".")[1],cI="install"+cG+"Ext",cs="cancel"+cG+"Ext",cA="extension-lb-install-button",ct="extension-lb-close-button",cw=ar.View&&ar.View.extensionWindow,cD=al("extension-lb"),cJ=al("extension-lb-step-2-caption"),cH=null,cE=5,co=0;
ar[cI]=function(){x.browser.installExtension(function(cK){aO.debug("Успешно установили расширение "+cx+": "+cK);cz=bE;ar[cI]=function(){return J}},function(cK){aO.error("Ошибка установки расширения "+cx,cK);
cH=ar.Err(cK.description,cK.number);cn=bE},cu);return J};ar[cs]=function(){cH=bQ;cn=bE;return J};function cp(cL,cK){var cM=al(cL);if(cM){cM.href="#";cM.onclick=ar[cK]
}}var cv={ff55orHigher:{ru:"Нажмите &laquo;Разрешить&raquo; <br/> и &laquo;Добавить&raquo;",en:"Нажмите &laquo;Allow&raquo; <br/> и &laquo;Add&raquo;"},ffBelow55:{ru:"Нажмите &laquo;Разрешить&raquo; <br/> и &laquo;Установить&raquo;",en:"Нажмите &laquo;Allow&raquo; <br/> и &laquo;Install&raquo;"},gc:{ru:"Нажмите &laquo;Установить расширение&raquo;",en:"Нажмите &laquo;Add extension&raquo;"}};
if(cw&&cD){var cq="gc";var cF=window.navigator||{};var cB=cF.language||cF.userLanguage||"ru-RU";var cC="ru";if(cB.indexOf("en")===0){cC="en"}if(aA){if(j.version>=55){cq="ff55orHigher"
}else{cq="ffBelow55"}}cJ.innerHTML=cv[cq][cC];cp(cA,cI);cp(ct,cs);cw(bE)}aO.info("Установка расширения "+cx+"...");return a7.wait(function(){var cK=cz||cn;
if(!cK){cK=ar.checkPluginInstalled(cx).anyway(function(cM){if(cM){cz=cM}else{if(cz&&co>=cE){var cL={code:389,message:"Расширение "+cx+" установлено, но не отвечает."};
aO.debug(x.showErrorInfo(cL,bE));cH=cL;cn=bE}else{co+=1}}return cz||cn})}return cK},aT,5*60*1000,300).then(function(){if(cw){cw(J)}return cr(cz||cH)})}var w=aA?"/ff":(aB?"/opera":(aI?"/yandex":(ax?"/chrome":""))),b0="Помощник диагностики",cg="Контур.Плагин",cb=cc(b0),cd=(!aK||aK.KonturToolbox3||aK.KonturToolbox2)&&cc(cg,"3.1.0");
if(aT!==cb){H.addFix(new ae("OtherBrowsers.DiagExtension",{message:bC("OtherBrowsers/DiagExtension"+w),script:1,priority:1,tags:[ae.Tags.APPDATA],order:2990,custommessage:" ",fix:function(co){var cn={rootPath:bm,chrome:"https://chrome.google.com/webstore/detail/inlmamahcfioibldbpbaechbpeeaelin",ff:"diag.helper@skbkontur.ru.xpi",opera:"adipnhhjfmoehhkepljbifddkobenooa"};
return b7(this,b0,cn,co)},test:function(){return(j.nc&&(bE===cb))}}))}if(aT!==cd){H.addFix(new ae("OtherBrowsers.PluginExtension",{message:bC("OtherBrowsers/PluginExtension"+w),script:1,priority:1,tags:[ae.Tags.APPDATA],order:2995,custommessage:" ",fix:function(co){var cn={rootPath:bm,chrome:"https://chrome.google.com/webstore/detail/hnhppcgejeffnbnioloohhmndpmclaga",ff:(aA&&!j.nc)?"kontur-plugin.xpi":"kontur-plugin-3.1.1.xpi",opera:"nejicfcnfnecdilmajlppdcgbjilgeec"};
return b7(this,cg,cn,co)},test:function(){return(bE===cd)}}))}function cj(){var cp='"'+s+'" -- "%1"',co=s+",0",cn="ChromeHTML";return bw(s,cp,"Google Chrome",cn,cn,co,"",cn,cn)
}var bT=bC("OtherBrowsers/GoogleChrome",(t&&!ay)?(u.Admin==="not"?b:e):a),bU=(ay?" x64":""),b9=ap;H.addFix(new ae("OtherBrowsers.GoogleChrome",{message:bT.message+bU,caption:bT.caption+bU,filename:"ChromeStandaloneSetup"+(aF?"Latest"+(ay?"X64":""):"49")+".exe",args:"/silent /install",needadmin:1,needrestart:j.chrome?1:0,priority:bG?0:(b9?1:0),tags:[ae.Tags.APPDATA],order:2660,available:!!ap,fix:function(cn){bB("SetupGoogleChrome","Start");
return this.apply(function(co){var cp=co&&!co.code;bB("SetupGoogleChrome",cp?"Success":"Failed");return a7.resolve(cp).truth(function(){return a7.fork(!aG&&!aJ&&!bF,cj).caught()
}).then(function(){return cn(co)})})},test:function(cp){var cn=-1,co="";if(t){if(ap&&!v(aF?a6.GoogleChromeLatest:a6.GoogleChrome49,t)){b9=n;co=(u.Admin==="not"?"installNew":"upd")+(aF?(ay?"LatestX64":"Latest"):"49")
}else{b9=J;cn=0}}var cq=ap&&b9&&!bH.noSse2;if(cq){cn=this.priority?1:-1}cp.setMessage(bS,cn,co);return cq}}));F.setValue("OtherBrowsers/MozillaPlugins",aS);
H.addFix(new ae("OtherBrowsers.DisablePlugins",{message:bC("OtherBrowsers/MozillaPlugins"),script:1,order:2690,priority:1,needadmin:(aD()||h.length)?1:0,fix:function(co){function cn(){var cs="/@#$/",cr=aR(h,function(ct){return ct.RegKey
}).join(cs),cq=aR(h,function(ct){return ct.LM}).join(cs);return bp('DisablePlugins "'+cr+'" "'+cq+'"',bE)}var cp=bE;return a7.each(g,function(cq){return bd(at,cq.RegKey,J).caught(function(cr){cp=J;
aO.error("Ошибка удаления плагина "+cq.RegKey,cr)})}).fork(h.length,function(){var cq=bE,cr=[];return a7.fork(aq()||aE(),a7.thrown("UAC or User",5),function(){return h
}).each(function(cs){var ct=cs.RegKey;return bd(au,ct,2==cs.LM).caught(function(cu){aO.error("Ошибка удаления плагина "+ct,cu);cq=J;cr.push(cs)})}).then(function(){if(!cq){h=cr;
throw new Error()}}).caught(cn)}).caught(function(){cp=J}).then(function(){return co(cp)})},test:function(co){var cn=i?"fix":"";co.setMessage("OtherBrowsers/MozillaPlugins",i?2:-1,cn);
aj(a4,function(cq,cp){if(cq>0){co.setMessage("OtherBrowsers/MozillaPlugins/"+cp,cq)}});return(n&&i)?1:0}}));if(bH.needCleanBrowsersCache){var bW=function(cn){return ai(cn).truth(function(co,cp){return cp.folders().each(function(cq){return ah(cq).remove().caught(function(){return bW(cq)
})}).then(function(){return cp.files().each(function(cq){return aa(cq).remove().caught()})})},a7.thrown("Folder not found: "+cn,2))};var ci=function(co,cn){return bW(l(aN.$LocalAppData,co)).then(bE,function(cp){var cq=az(cp);
(cq?aO.info:aO.error)(cn,cp)})};var bV=function(co,cn){return ci(l(co,"User Data\\Default\\Cache"),cn)};var bX=function(){var cn=l(aN.$LocalAppData,"Mozilla\\Firefox\\Profiles\\");
return ai(cn).truth(function(cp,co){return a7.fork(x.kdBuild<206,a7.thrown(),function(){return co.folders().each(function(cq){return ah(l(cq,"cache2")).removeAsync().caught(function(cr){if(cr){aO.debug("folder.removeAsync error",cr,aT,"remAsync")
}return a7.thrown()})}).then(bE)}).caught(function(){return co.folders().each(function(cr){var cq=l(cr,"cache2");return ah(cq).remove().caught(function(){return bW(cq)
})}).then(bE)})},a7.thrown("Folder not found: "+cn,2)).caught(function(co){var cp=az(co);(cp?aO.info:aO.error)("Ошибка чистки временных файлов Mozilla Firefox",co);
return cp})};H.addFix(new ae("OtherBrowsers.MozillaFirefoxCache",{message:bC("OtherBrowsers/MozillaFirefoxCache"),script:bE,priority:0,needadmin:0,order:2651,custommessage:" ",fix:function(cp,co){var cn=this;
cn.statusObj=co&&co.statusObj;return b3(cn).lie(bQ,bX).then(cp)},test:function(){return(!!ad&&!aA)?1:0}}));H.addFix(new ae("OtherBrowsers.GoogleChromeCache",{message:bC("OtherBrowsers/GoogleChromeCache"),script:bE,priority:0,needadmin:0,order:2652,fix:function(cn){return bV("Google\\Chrome","Ошибка чистки временных файлов Google Chrome").then(cn)
},test:function(){return !!t&&o}}));H.addFix(new ae("OtherBrowsers.OperaCache",{message:bC("OtherBrowsers/OperaCache"),script:bE,priority:0,needadmin:0,order:2653,fix:function(cn){return ci("Opera\\Opera\\cache","Ошибка чистки временных файлов Opera").then(cn)
},test:function(){return aZ&&aV}}));H.addFix(new ae("OtherBrowsers.YandexBrowserCache",{message:bC("OtherBrowsers/YandexBrowserCache"),script:bE,priority:0,needadmin:0,order:2654,fix:function(cn){return bV("Yandex\\YandexBrowser","Ошибка чистки временных файлов Яндекс.Браузера").then(cn)
},test:function(){return bL&&bM}}))}return bE})};window.SkbKontur.Help.Scripts.Certificates=function(aw,l,ca){var cS=window,bc=cS.SkbKontur.Help,aj=bc.Core,ax=bc.Diagnosis,aJ=bc.foreach,ai=bc.contains,aS=bc.getCertConfig,ch=bc.Promise,cx=bc.Test,cF=bc.trim,S=aS&&aS()||{},bd=aj.HKCU,be=aj.HKLM,bx=aj.log,cI=aj.vars,k=aj.call,W=aj.certOID,ad=aj.checkOidInRegistry,ah=aj.compareVersion,ak=aj.createNPAXObject,av=aj.cyrillicFirstCompare,aE=aj.escapeString,aV=aj.getCertificateInfo,aU=aj.getCertificateIdentity,aX=aj.getCertificateOrg,aW=aj.getCertificateName,aH=aj.File,aY=aj.getFileByCLSID,aZ=aj.$getOIDsFromCertificate,a0=aj.getProductGUID,a1=aj.getProductInfoReg,a2=aj.getProductVersion,a6=aj.$hasCertificateLicense,bb=aj.hasUac,bj=aj.$isCertificateKEP,bl=aj.isSystem,bo=aj.isUser,bA=aj.maxVersion,ce=aj.parseError,cj=aj.regCertOID,ck=aj.regDeleteKey,cl=aj.$regEnumKeys,cn=aj.$regReadString,cu=aj.run,cN=aj.certViewCA,cO=aj.certViewDisallowed,cP=aj.certViewOther,cQ=aj.certViewPrivate,cR=aj.certViewRoot,h=cI.arch,P=cI.centerInformLocale,X=cI.certsByThumb,af=cI.codepage,an=cI.cryptoproLocale,au=cI.cspVersion,ay=cI.diagnostics,aG=cI.fedLocale,aQ=cI.ftsLocale,bf=cI.ignoreCACerts||{},bg=cI.ignoreRootCerts||{},by=cI.marketLocale,bG=cI.needInstallAgzrtCrypt,bH=cI.needInstallCryptoMoscow,bI=cI.needInstallCSPCOM,bJ=cI.needInstallGosUslugi,bK=cI.needInstallLanit,bL=cI.needInstallLesEgais,cf=cI.productMasks,cg=cI.productVersions,cr=cI.rosreestrLocale,ct=cI.rpnLocale,cv=cI.sertumLocale,cw=cI.tanderLocale,cT=cI.winVer,aI=bc.Fix,cE=ax.translateFix,b="Actions/",a=cE(b+"install"),c=cE(b+"reinstall"),d=cE(b+"update");
var bN=null,cG=true,aF=false,bp=(cT>=600),cH=bo()&&!bb(),ci=aj.isRARProfiles(),bm=("test"===window.profileName),bq=aj.getKTObject();cI.innkpps=[];ca=ca?ca.Certificates:bN;
var bY=!ca||ca.Capicom,O=0,N=3;var cb=!ca||ca.Toolbox,cC=0,cB=3,cD=2,R={},bk={},bi={},aD;try{cC=bq?(bq.getPluginInfo()||{}).version:bN}catch(br){}function ae(w,cU){w=ce(w);
if(N!=2&&w&&(2148139056==w.number||-2146828240==w.number)){N=3}else{if(cB!=2&&bq&&bq.Error&&w instanceof bq.Error){cB=3;bx.debug("Ошибка перечисления сертификатов(by KT) (тип: "+cU+")",w)
}}cD=Math.min(N,cB)}function a8(){return !bc.isNullOrEmptyOrBad(au)}function ab(){if(N===0||cB===0){return bN}var w=[];if(!a8()){w.push("Не установлен КриптоПро CSP")
}if(1==cB){w.push("Версия Контур.Тулбокс устарела")}else{if(2==cB){w.push("Не установлен Контур.Тулбокс")}else{if(3==cB){w.push("Ошибка в работе Контур.Тулбокс")
}}}if(1==N){w.push("Версия CAPICOM устарела")}else{if(2==N){w.push("Не установлен CAPICOM")}else{if(3==N){w.push("Ошибка в работе CAPICOM")}}}return w.length?w.join("; "):bN
}var bM=aj.newCertOID;var bZ=!ca||ca.CertOIDUC,bR="err",bS=2,a5,cm="SOFTWARE\\Microsoft\\Cryptography\\OID\\",bn=(!ca&&cI.ucLocale),bQ=0,bO=[3,0,0,0,0,0,0,0],aK="Формирование запроса о предоставлении",aM="сведений из Единого государственного реестра прав на недвижимое имущество и сделок с ним",aL=aK+" "+aM,aN=aL+" и о предоставлении сведений из государственного кадастра недвижимости",aO=aL+" и о предоставлении государственных услуг в сфере ведения государственного кадастра недвижимости",aP=aK+" сведений из государственного кадастра недвижимости и о предоставлении общедоступных "+aM,bP={"1.2.643.2.23.2":"АС Бюджет","1.2.643.2.23.3":"АС Удаленное рабочее место","1.2.643.3.41.1.3.4":"Передача документов в финансовый орган","1.2.643.3.41.1.3.5":"Обработка документов в финансовом органе","1.2.643.3.7.0.3.1":"Встроенная лицензия КриптоПро CSP","1.2.643.3.7.1":"Информационные системы СКБ Контур","1.2.643.3.7.1.1.1":"Абонент Системы Контур-Экстерн","1.2.643.3.7.3.1":"Автоматизированная Система «Бюджет»","1.2.643.3.7.3.2":"Автоматизированная Система МБКИ","1.2.643.3.7.3.3":"ЕИАС ФСТ России","1.2.643.3.7.3.4.2.1":"Клиент Шлюза Синхронизации ЦБД Портала Доверенных Услуг","1.2.643.3.7.3.4.2.1.1":"Идентификатор Сервиса Портала Доверенных Услуг","1.2.643.3.7.3.5":"Автоматизированная Система «Банк-Клиент» (ОАО «НКО «Городской расчетный центр», г.Курган)","1.2.643.3.7.3.6":"ЭТП «Газпром нефть»","1.2.643.3.7.3.7":"Автоматизированная Информационная Система Госзакупок Липецкой Области","1.2.643.3.7.3.8":"Корпоративная Информационная Система ОАО «Уралгипромез»","1.2.643.3.7.3.9.1":"Участник Торгов в АИС Госзакупок Сахалинской Области","1.2.643.3.7.3.9.2":"Организатор Торгов в АИС Госзакупок Сахалинской Области","1.2.643.3.7.3.10":"Электронная Торговая Площадка «Сбербанк-АСТ»","1.2.643.3.7.3.11":"Электронная Торговая Площадка Владимирской Области","1.2.643.3.7.3.12":"Система ЭДО между ФНС России и Сторонними Организациями","1.2.643.3.7.3.13":"Единая Электронная Торговая Площадка (Росэлторг)","1.2.643.3.7.3.14":"АИС «Госзаказ Кемеровской Области»","1.2.643.3.7.3.15":"Информационная система Диадок","1.2.643.3.7.3.16":"АИИСКУЭ Отправитель макетов 80020","1.2.643.3.7.3.17":"Межотраслевая Торговая Система «Фабрикант»","1.2.643.3.7.3.18":"АИС Госзакупок Республики Марий Эл","1.2.643.3.7.3.19":"АИС Госзакупок Калужской Области","1.2.643.3.7.3.21":"Корпоративный документооборот ПФ Электроэнергетики","1.2.643.3.7.3.22":"Подписывание документов в рамках портала Фонда социального страхования РФ","1.2.643.3.7.3.26":"Закупки по 223-ФЗ на портале государственных закупок Ростовской области «Рефери»","1.2.643.3.7.3.24":"ЭТП «uTender»","1.2.643.3.7.3.25":"ЭТП «uTender»","1.2.643.3.7.4.1":"Подписание документов в рамках корпоративной информационной системы","1.2.643.3.7.4.2":"Подписание документов в рамках КИС органов государственной власти и местного самоуправления","1.2.643.3.7.5.50":"Сертификат ЭЦП класса Расширенный. Подписание документов, порождающих правоотношения субъектов в информационных системах.","1.2.643.3.7.5.51":"Сертификат ЭЦП класса Сертум Лайт (Sertum Light). Подписание документов, порождающих правоотношения субъектов в информационных системах.","1.2.643.3.7.5.60":"Сертификат ЭЦП класса Усиленный. Подписание документов, порождающих правоотношения субъектов в информационных системах.","1.2.643.3.7.5.61":"Сертификат ЭЦП класса Сертум Ликвид (Sertum Liquid). Подписание документов, порождающих правоотношения субъектов в информационных системах.","1.2.643.3.7.5.70":"Сертификат ЭЦП класса Сертум Классик (Sertum Classic). Подписание документов, порождающих правоотношения субъектов в информационных системах.","1.2.643.3.7.5.71":"Сертификат ЭП класса Сертум Классик (B2B)","1.2.643.3.7.6.2":"Подписание документов, порождающих правоотношения субъектов в информационных системах. Второй тип.","1.2.643.3.7.7.1":"Подписание отчётности через Клауд Крипт","1.2.643.3.7.8.1":"Квалифицированный сертификат","1.2.643.3.7.8.2":"Неквалифицированный сертификат","1.2.643.3.7.98":"Проверка Подлинности Сервера СКБ Контур","1.2.643.3.7.99":"Демонстрационный Доступ в Информационную Систему","1.2.643.3.7.102":"Сертификат клиента СГД","1.2.643.3.131.1.1":{Name:"ИНН",ExtraInfo:bO},"1.2.643.3.141.1.1":{Name:"РНС ФСС",ExtraInfo:bO},"1.2.643.3.141.1.2":{Name:"КП ФСС",ExtraInfo:bO},"1.2.643.100.1":{Name:"ОГРН",ExtraInfo:bO,CPExtraInfo:1},"1.2.643.100.3":{Name:"СНИЛС",ExtraInfo:bO,CPExtraInfo:3},"1.2.643.100.5":{Name:"ОГРНИП",ExtraInfo:bO,CPExtraInfo:5},"1.2.643.3.131.1044.0.3.1.1":"Руководитель","1.2.643.3.131.1044.0.3.2.1":"Главный бухгалтер","1.2.643.3.131.1044.0.3.3.1":"Руководитель и главный бухгалтер","1.2.643.3.131.1044.0.3.4.1":"Уполномоченный представитель","1.2.643.3.131.1044.0.3.5.1":"Индивидуальный предприниматель","1.2.643.3.131.1044.0.3.6.1":"Ответственный исполнитель","1.2.643.3.185.1":"Сертификат Sertum.ru","1.2.643.3.241":"ЭТП «ТЭК-ТОРГ»","1.2.643.5.1.24.2.2.6":"Обеспечение шифрования и аутентификации на транспортном уровне веб сервисов Удостоверяющих центров","1.2.643.6.3":"Использование в электронных торговых системах и в программном обеспечении, связанном с обменом электронными документами","1.2.643.6.3.1.1":"Использование на электронных площадках, отобранных для проведения аукционов в электронной форме","1.2.643.6.3.1.2.1":"Юридическое лицо","1.2.643.6.3.1.2.2":"Физическое лицо","1.2.643.6.3.1.2.3":"Индивидуальный предприниматель","1.2.643.6.3.1.3.1":"Участник размещения заказа","1.2.643.6.3.1.4.1":"Администратор организации","1.2.643.6.3.1.4.2":"Уполномоченный специалист","1.2.643.6.3.1.4.3":"Специалист с правом подписи контракта","1.2.643.6.7":"Использование в электронных торговых системах B2B-Center","1.2.643.6.7.210":"Использование в электронных торговых системах B2B-Center и участие в 1 процедуре","1.2.643.6.9.1.2":"Сертификат ключа подписи пользователя ЭТП СЭлТ","1.2.643.6.14":"ЭТП «Центр реализации»","1.2.643.6.15":"ЭТП Фабрикант","1.2.643.6.17.1":"Использование в электронных торговых системах Газпромбанк","1.2.643.6.18.1":"ЭТП Центр дистанционных торгов. Организатор торгов (продавец)","1.2.643.6.18.2":"ЭТП Центр дистанционных торгов. Участник торгов (покупатель)","1.2.643.6.32":"Использование на электронной площадке ООО «АСТ ГОЗ»","1.2.643.6.32.1.1":"Участник","1.2.643.6.32.1.1.1":"Участник. Администратор организации","1.2.643.6.32.1.1.2":"Участник. Уполномоченный специалист","1.2.643.6.32.1.1.3":"Участник. Должностное лицо с правом подписи контракта","1.2.643.6.32.1.2":"Заказчик","1.2.643.6.32.1.2.1":"Заказчик. Администратор организации","1.2.643.6.32.1.2.2":"Заказчик. Уполномоченный специалист","1.2.643.6.32.1.2.3":"Заказчик. Должностное лицо с правом подписи контракта","1.2.643.6.32.1.3":"Уполномоченный орган","1.2.643.6.32.1.3.1":"Уполномоченный орган. Администратор организации","1.2.643.6.32.1.3.2":"Уполномоченный орган. Уполномоченный специалист","1.2.643.6.32.1.3.3":"Уполномоченный орган. Должностное лицо с правом подписи контракта","1.2.643.6.32.1.4":"Специализированная организация","1.2.643.6.32.1.4.1":"Специализированная организация. Администратор организации","1.2.643.6.32.1.4.2":"Специализированная организация. Уполномоченный специалист","1.2.643.6.37.1.1":"Пользователь СЭП: регистрация ЮЛ/ИП, редактирование, делегирование","1.2.643.6.40.1":"Участник, имеющий право на раскрытие информации АО «СКРИН»","1.2.643.6.41.1.1.1":"Участник, имеющий право на раскрытие информации ООО «Интерфакс - ЦРКИ»","1.2.643.6.42.5.5.5":"Участник, имеющий право на раскрытие информации АЭИ «ПРАЙМ-ТАСС»","1.2.643.6.44.1.1.1":"Участник, имеющий право на раскрытие информации АНО «АЗИПИ»","1.2.643.6.45.1.1.1":"Участник, имеющий право на раскрытие информации ЗАО «AK&M»","1.2.643.9.1.1":"Должностное лицо - руководитель","1.2.643.9.1.2":"Должностное лицо - главный бухгалтер","1.2.643.9.1.3":"Уполномоченное должностное лицо с правом подписи руководителя","1.2.643.9.1.4":"Уполномоченное должностное лицо с правом подписи главного бухгалтера","1.2.643.9.1.5":"Уполномоченное должностное лицо с правом подписи специалиста","1.2.643.100.2.1":"Доступ к СМЭВ ЭП-СП","1.2.643.100.2.2":"Доступ к СМЭВ ЭП-ОВ","1.3.6.1.4.1.29919.21":"Сертификат пользователя портала госзакупок Ростовской области «Рефери»"},cs={"1.2.643.3.5.10.2.12":"Участник, имеющий право на включение сведений в Единый федеральный реестр сведений о фактах деятельности юридических лиц","1.2.643.3.7.3.23":"АИС Росреестра","1.2.643.5.1.24.2.1.2":"Формирование документов как результата оказания услуги со стороны органов кадастрового учета","1.2.643.5.1.24.2.1.3":aN,"1.2.643.5.1.24.2.1.3.1":"Формирование кадастровым инженером документов для получения услуг со стороны заявителя","1.2.643.5.1.24.2.2.2":"Формирование документов как результата оказания услуги со стороны органов регистрации прав","1.2.643.5.1.24.2.4":aN,"1.2.643.5.1.24.2.5":aL,"1.2.643.5.1.24.2.6":aN,"1.2.643.5.1.24.2.7":aO,"1.2.643.5.1.24.2.8":aO,"1.2.643.5.1.24.2.9":aN,"1.2.643.5.1.24.2.10":aN,"1.2.643.5.1.24.2.11":aN,"1.2.643.5.1.24.2.12":aN,"1.2.643.5.1.24.2.13":aN,"1.2.643.5.1.24.2.14":aN,"1.2.643.5.1.24.2.15":aO,"1.2.643.5.1.24.2.16":aL,"1.2.643.5.1.24.2.17":aL,"1.2.643.5.1.24.2.18":aL,"1.2.643.5.1.24.2.19":aN,"1.2.643.5.1.24.2.20":aO,"1.2.643.5.1.24.2.26":aK+" сведений из Единого государственного реестра прав о правах наследодателя, обобщенных сведений о правах наследодателя на имеющееся у него объекты недвижимого имущества, копий правоустанавливающих документов, необходимых для совершения нотариального действия","1.2.643.5.1.24.2.27":aL,"1.2.643.5.1.24.2.29":aL,"1.2.643.5.1.24.2.30":aN,"1.2.643.5.1.24.2.32":aN,"1.2.643.5.1.24.2.39":aK+" сведений, внесенных в государственный кадастр недвижимости","1.2.643.5.1.24.2.42":aK+" сведений, внесенных в государственный кадастр недвижимости","1.2.643.5.1.24.2.43":aN,"1.2.643.5.1.24.2.44":aN,"1.2.643.5.1.24.2.45":aN,"1.2.643.5.1.24.2.46":aN,"1.2.643.5.1.24.2.47":aL,"1.2.643.5.1.24.2.48":"Формирование документов содержащих сведения о зданиях, сооружениях, помещениях, об объектах незавершенного строительства, государственный учет которых осуществлен в установленном законодательством Российской Федерации порядке в переходный период","1.2.643.5.1.24.2.49":"Прием запросов и документов на оказание государственных услуг по предоставлению "+aM+" и о предоставлении сведений из государственного кадастра недвижимости, выдача результатов оказания государственных услуг","1.2.643.5.1.24.2.50":aL,"1.2.643.5.1.24.2.51":aL,"1.2.643.5.1.24.2.52":aL,"1.2.643.5.1.24.2.53":aP,"1.2.643.5.1.24.2.54":aP,"1.2.643.5.1.24.2.55":aP,"1.2.643.5.1.24.2.56":"Формирование запроса о предоставлении сведений из Единого государственного реестра прав на недвижимое имущество и сделок с ним"},aR={"1.2.643.3.215.4":"Оформление прибытия/убытия (уведомление таможенного органа о прибытии/убытии на таможенную территорию Таможенного союза воздушных судов и перевозимых ими товаров)","1.2.643.3.215.6":"Представление документов и сведений в таможенный орган при перемещении товаров на склад временного хранения","1.2.643.3.215.7":"Представление отчетов","1.2.643.3.215.8":"Подача декларации на товары таможенным представителем, представление документов и сведений при декларировании товаров; Подача декларации на товары организацией - участником ВЭД, занимающейся таможенным оформлением собственных грузов, представление документов и сведений при декларировании товаров","1.2.643.3.215.9":"ФТС","1.2.643.3.215.11":"Информационное взаимодействие с уполномоченным экономическим оператором","1.2.643.3.215.12":"Лица, с которыми ФТС России заключен соответствующий договор поручительства","1.2.643.3.215.13":"Совершение таможенных операций в отношении товаров, включая транспортные средства, ввозимых (ввезенных) на территории особых экономических зон и вывозимых с территорий особых экономических зон, включая идентификацию"};
var U=" месяц",V=" месяца",bD={1:U,2:V,3:V,4:V,21:U,22:V,23:V,24:V,31:U,32:V,33:V,34:V},bC=ci?36:15;for(var bB=1;bB<=bC;++bB){bP["1.2.643.3.7.0.1."+bB]="Сертификат сроком на "+bB+(bD[bB]||" месяцев")
}function Z(w,cX,cW){var cU=cm+"EncodingType 1\\"+w+"\\",cV=["1.2.643.2.2.19","1.3.643.3.3.19"],cY=0;return ch.each(cV,function(c0){var cZ=cU+c0+"\\";return cn(be,cZ,"Dll",cX).then(function(c1){c1=(c1||"").toLowerCase();
if("_ftcbcr.dll"!==c1&&"_ftcgpk.dll"!==c1){return bN}return ch.fork(cW,function(){return ck(be,cZ,cX).caught(function(c2){bx.error("Не удалось удалить "+c0,c2);
++cY})},function(){++cY})}).caught()}).then(function(){if(!cW){return cY}return cl(be,cU,cX).then(function(cZ){if(cZ&&!cZ.length){return ck(be,cU,cX)}return bN
}).caught()})}function aa(cU){var cV=0,w=["CryptDllConvertPublicKeyInfo","CryptDllEncodePublicKeyAndParameters","CryptDllExportPublicKeyInfoEx","CryptDllImportPublicKeyInfoEx"];
return ch.each(w,function(cW){return Z(cW,aF,cU).then(function(cX){cV+=cX;if(!cU&&(cV>0)){return ch.$break()}if(64!=h){return bN}return Z(cW,cG,cU).then(function(cY){cV+=cY;
return(!cU&&(cV>0))?ch.$break():bN})})}).then(function(){return cV})}var b4=bn||(ca&&ca.Lanit),bt=bN,bs=2;var b3=bn||(ca&&ca.GosUslugi),a4=bN,a3=2;var b1=aG||bn||(ca&&ca.CSPCOM),at=bN,ar=2,ap=bN,aq=2;
var bV=bn||cI.etprfLocale||(ca&&ca.AgzrtCrypt),f=bN,e=2;var b0=bn||(ca&&ca.CryptoMoscow),am=bN,al=2;var b5=bn||(ca&&ca.LesEgais),bv=bN,bu=2;var cc=bn||cI.rpnLocale||(ca&&ca.VCRedist2008),cJ=bN,cK=2;
var cd=bn||(ca&&ca.VCRedist2010),cL=bN,cM=2;var b8=!ca||ca.RootCerts,cp="none";var bW=!ca||ca.CACerts,i="none",co=0;var b6=!ca||ca.MyCertsTree,bE="err",a9=aF,ba=aF,a7=aF;
var b9=!ca||ca.RootCertsTree,cq=bE;var bX=!ca||ca.CACertsTree,j=bE;var b7=!ca||ca.OtherCertsTree,bT=bE;var b2=!ca||ca.DisallowedCertsTree,az=bE;var F=1,E=2,J=4,D=8,G=16,K=32,M=64,C=128,z=256,B=512,y=1024,A=2048,x=4096,u=8192,v=16384,t=32768,I=65536,r=131072,q=262144,s=524288,H=16777216,L=33554432,n=1,m=2,cA={1:"machine",2:"user"},p={1:"My",2:"CA",3:"AddressBook",4:"ROOT",5:"Disallowed"},o=1;
var g=0,bz=5,bw=[2148073480,-2146893816],aB=new RegExp("\\r?\\n","g"),ao=cx("(Crypto|Крипто)[\\s\\-]?(Pro|Про)(\\s|$)","i"),bU=cx("Sertum[\\s\\-]?Pro|Сертум[\\s\\-]?Про|СКБ Контур|SKB Kontur","i"),aA=cx("Aktiv\\-soft|(Crypto|Крипто|Sertum|Сертум)[\\s\\-]?(Pro|Про)|СКБ Контур|SKB Kontur|УЦ УЭК","i"),T={},cy={},cz=new Date().getTime();
if(S){aJ(S,function(cU,w){T[cU]={};for(var cV=0,cW=w.length;cV<cW;++cV){T[cU][w[cV]]=cG}})}function aT(cV,cW,cU,w){return ch.fork(cU,function(){var cY=bq.Crypto;
if(!cY){return ch.thrown("getCertData: reader is null")}var cX=cY.getCertificates({storeLocation:cA[cV],storeName:cW});if(!cX||(typeof cX.length!="number")){return ch.thrown("KT: no certs")
}return ch.each(cX,w)},function(){return ak(["Capicom","Store"],cG).truth(function(cX){return cX.callAsync("Open",[cV,cW]).then(function(){return cX.getAsync("Certificates")
}).truth(function(cY){return cY.getAsync("Count").then(function(cZ){if("number"!=typeof cZ){return ch.thrown("CAPICOM: no certs")}return ch.each(cZ,function(c0,c1){return cY.getAsync("Item",[c1+1]).then(w)
})})}).lastly(function(){return cX.callAsync("Close").caught().then(cX.free)})},ch.thrown("getCertData: reader is null"))})}function Y(){if(aj.vars.CSPInstallNeedReboot){aw.setMessage("CryptoPro/CSPInstallDate",2,"reboot");
if(bc.View){bc.View.progressCallback(ay,"CryptoPro",true,function(){})}}}function ag(w,cU){if(!w){return cU?-1:0}if(!cU){return 1}if(w.validFrom&&cU.validFrom&&Math.abs(cU.validFrom-w.validFrom)>=6*60*60*1000){var cV=w.validFrom-cU.validFrom;
if(Math.abs(cV)>=6*60*60*1000){return cV}}return(w.validTo||0)-(cU.validTo||0)}function bF(w){if(!w||("fail"===w)||(w.indexOf("?")>=0)||0===w.indexOf("FSRAR-RSA-")){return aF
}return(w.indexOf("REGISTRY\\")>=0)||(w.indexOf("\\")<0&&w.indexOf("/")<0)}function aC(c4){R[c4]=aF;bk[c4]=0;bi[c4]=2;var cV="pki.fsrar.ru",c1=(cQ===c4),c2=(cR===c4),cX=(cN===c4),cZ=(cP===c4),cY=(cO===c4),c0=c1||cZ||cY,cW=aj.isUCProfiles(),w=new RegExp("URL=(.+?)($|,\\s)","gi"),c3=new RegExp("/","g"),cU=new RegExp("\\.","g");
return ch.when(function(){if(!X[c4]){X[c4]={}}var de={},dj=cx(["(eiasreportingappserver2",aE(W)+((bM&&bM.length)?"|"+aE(bM):""),"(^|,|\\s)(ИНН|INN|КПП|KPP|СНИЛС|SNILS)=)"].join("|"),"i"),c8=T.ROOT||{},c9=T.ROOTRemove||{},c5=T.CA||{},c6=T.CARemove||{},c7=T.My||{},di=new RegExp("^\\d{10,12}(\\-\\d{9}(\\-\\d{12})?)?$"),dd=10,db={};
function dm(dt,du){try{if(dt&&String(dt).indexOf(cV)>=0){if(du&&(du>=cz)){cI.egaisGoodRsaFound=cG}return cG}}catch(ds){}return aF}function dn(ds){return an?aA(ds):(ds.indexOf("uc skb kontur")>=0)
}function da(ds,du,dv){var dw=du.hash;if(db[dw]){return ch.resolve(bN)}function dt(dx){if(!dx){return bN}var dD=dx.split(c3),dz=(dD.length>1)?(dD[1]||dD[2]):bN,dA=dz?dz.split(cU):[],dB=dA.length,dy=dB&&dA[0]||"",dC=(1==dB)||(4==dB&&("10"===dy||"127"==dy||("192"===dy&&"168"==dA[1])));
if(dC){db[dw]=cG;bx.debug("У сертификата "+du.name+" ("+dw+") локальная ссылка списка отзыва: "+dx)}return dC}return aZ(ds,"2.5.29.31",!dv).truth(function(dx){return ch.fork(dv,function(){var dy=aj.hexToBin(dx),dB=0;
if(dy.length>=4){dB=9;for(var dC=1,dD=dy.length;dC<dD;++dC){if(48==dy[dC]){dB=dC+7;break}}}while(dB<dy.length){var dE=dy[dB],dz=dB+1+dE,dF="";for(var dA=dB+1;
dA<dz;++dA){dF+=String.fromCharCode(dy[dA])}if(dt(dF)){break}dB=((dz>=dy.length)||(48==dy[dz]))?(dz+7):(dz+1)}},function(){return dx.getAsync("EncodedData").then(function(dy){return dy&&dy.getAsync("Value").then(function(dz){return dz&&String(dz).length&&dy.callAsync("Format")
})}).truth(function(dy){var dz;while(!!(dz=w.exec(dy))&&(dz.length>1)){if(dt(dz[1])){break}}})})}).caught(function(dx){bx.debug("Ошибка проверки CRL в сертификате "+du.name+" ("+dw+")",dx)
})}function dl(ds,dt){return ch.fork(bm,cG,function(){return ds.callAsync("IsValid").truth(function(du){return du.getAsync("Result").then(function(dv){return !dv
})},aF).caught(function(du){Y();bx.debug("Ошибка проверки сертификата "+dt.name+" ("+dt.hash+")",du);return aF})})}function dk(ds,dt,du){return da(ds,dt).fork(!bm,function(){return ds.callAsync("IsValid").then(function(dv){return dv.setAsync("CheckFlag",[487])
}).caught(function(dv){bx.debug("Ошибка задания CheckFlag для сертификата "+dt.name+" ("+dt.hash+")",dv)})}).then(function(){return(du&&du<cz)?aF:dl(ds,dt)
})}function dg(ds,dt){return ch.fork(dt,function(){return ds.getHash().toHexString()},function(){return ds.getAsync("Thumbprint")})}function dh(ds,dt){return ch.fork(dt,function(){var dw=(ds.getSubject()||"").toString(),du=aV(dw,cG),dv=aW(du,cG);
return[dw,ds.getValidTo(),ds.getIssuer(),du,dv]},function(){return ch.all(ds.getAsync("SubjectName"),ds.getAsync("ValidToDate"),ds.getAsync("IssuerName")).spread(function(dx,dy,dv){var du=aV(dx,aF),dw=aW(du,aF);
return[dx,Date.parse(dy),dv,du,dw]})})}function df(dt,ds,du){return ch.fork(du,function(){dt.serial=ds.getSerialNumber().toHexString().toUpperCase();var dz=dt.validTo;
dt.validFrom=ds.getValidFrom();try{dt.isValid=(dz&&dz<cz)?aF:(bm||!ds.verify(67109185))}catch(dv){Y();bx.debug("cert.verify",dv,bN,"verify");dt.isValid=bN
}try{dt.publicKeyLen=ds.getPublicKeyLength()}catch(dx){dt.publicKeyLen=bN;if(cC&&a8()&&ah("2.4",cC)){bx.debug("Ошибка KT.getPublicKeyLength, сертификат "+dt.name+" ("+dt.hash+")",dx)
}}dt.content=ds.getContent().toBase64();if(c0){dt.issuer=aV(dt.issName,aF);dt.hasPrivateKey=ds.hasPrivateKey()?1:0;if(dt.hasPrivateKey){var dy;try{dy=ds.getContainerInfo()
}catch(dw){dy={};if(cC&&a8()&&ah("2.5",cC)){bx.debug("Ошибка KT.getPublicKeyLength, сертификат "+dt.name+" ("+dt.hash+")",dw)}}dt.contName=dy.containerName||"fail";
dt.provType=dy.providerType||"fail";dt.provName=cF(dy.providerName||"fail")}return ch.all(bj(ds,aF,dt.info),a6(ds),da(ds,dt,cG)).spread(function(dA,dB){dt.KEP=dA?1:0;
dt.license=dB?1:0})}return bN},function(){var dv=[ds.getAsync("SerialNumber"),ds.getAsync("ValidFromDate"),dk(ds,dt,dt.validTo),ds.callAsync("PublicKey").then(function(dw){return dw.getAsync("Length")
}).caught(bN),ds.callAsync("Export",[0])];if(c0){dt.issuer=aV(dt.issName,cG);dv=dv.concat([bj(ds,cG,dt.info),a6(ds,cG),ds.callAsync("HasPrivateKey").then(function(dw){var dy=[aF,bN,bN,bN],dx=bN,dz=function(dA){dx=dA;
return bN};if(!dw){return dy}return ds.getAsync("PrivateKey").then(function(dA){return ch.all(cG,dA.getAsync("ProviderName").caught(dz),dA.getAsync("ProviderType").caught(dz),dA.getAsync("ContainerName").caught(dz))
}).then(function(dA){if(dx&&a8()){bx.error("Ошибка получения закрытого ключа, сертификат "+dt.name+" ("+dt.hash+")",dx)}return dA}).caught(function(dA){if(a8()){bx.error("Ошибка cert.PrivateKey, сертификат "+dt.name+" ("+dt.hash+")",dA)
}return dy})})])}return ch.all(dv).spread(function(dC,dD,dx,dB,dw,dy,dz,dA){dt.serial=dC.toUpperCase();dt.validFrom=Date.parse(dD);dt.isValid=dx;dt.publicKeyLen=dB;
dt.content=dw;if(c0){dt.KEP=dy?1:0;dt.license=dz?1:0;dt.hasPrivateKey=dA[0]?1:0;dt.provName=cF(dA[1]||"fail");dt.provType=dA[2]||"fail";dt.contName=dA[3]||"fail"
}})})}function dp(dt,ds,dv,du){return dg(ds,du).then(function(dx){dx=dx.toUpperCase();var dy=(c2||cX)?"":("@L"+dt.location),dw=de[dx+dy];if(dw){if(!dw.error){return bN
}dt=dw}else{de[dx+dy]=dt}dt.hash=dx;return dh(ds,du).spread(function(dE,dF,dB,dA,dD){dt.subName=dE;dt.validTo=dF;dt.issName=dB;dt.info=dA;dt.name=dD;dv[dx]={Name:dD||"",ValidTo:dF,Thumbprint:dx};
var dC=dE.toLowerCase(),dz=cZ||c7[dx]||c8[dx]||c5[dx];if(c0&&ci){dz=dz||dm(dB,dF)}dz=dz||(cX&&(c6[dx]||bf[dx]||(dn(dC)&&(dC.indexOf("root")<0))));dz=dz||(c1&&(dj(dE)||((cI.atolLocale||an||cI.rutokenLocale||by||cI.sberLocale||cI.shtrihLocale||cw||cI.vikiLocale)&&(dC.indexOf("do_not_trust")<=0))));
dz=dz||(c2&&(c9[dx]||bg[dx]||dn(dC)));dz=dz||(cY&&dB&&aA(dB));if(!dz){return bN}return df(dt,ds,du).then(function(){var dG=aU(dA,c4);if(c0&&dG&&(dG.length>8)&&("0000"!==dG.substr(0,4))&&di.test(dG)){cI.innkpps.push(dG)
}dt.id=dG||dt.serial;X[c4][dx]=dt.content.replace(aB,"<br/>");dt.parsed=cG})})}).caught(function(dw){dt.error=cG;if(dd>=0){--dd;bx.error("Ошибка получения информации о сертификате("+dt.hash+") "+(du?"(KT)":""),dw,bN,"parseCert")
}})}function dq(du,dv,dt){var ds=du+dv,dw=cy[ds];if(!dw){cy[ds]=dw={}}return aT(du,dv,dt,function(dx){return dp({location:du},dx,dw,dt)})}function dr(du){var ds=0;
function dt(dw,dv){++ds;return dq(dw,du,dv).caught(function(dx){--ds;ae(dx,c4)}).timeout(50)}return ch.serial(k(dt,n,cG),k(dt,m,cG),k(dt,n),k(dt,m)).then(function(){if(!ds){throw new Error()
}})}var dc=p[c4];return dr(dc).caught(function(ds){if(c4!=cP){return ch.thrown(ds)}return ak(["Capicom","Store"],cG).then(function(dt){return dt.callAsync("Open",[m,dc,o]).then(function(){return dt.callAsync("Close")
}).anyway(function(){return dt.callAsync("Open",[n,dc,o])}).then(function(){return dt.callAsync("Close")}).lastly(dt.free)}).caught().timeout(50).then(function(){return dr(dc)
}).caught()}).then(de)}).then(function(c8){var c9=aF,da=aF;aJ(c8,function(dc,db){if(!db.parsed){return}if(bF(db.contName)){if(n==db.location){da=cG}else{c9=cG
}}});var c7=["\x00\x01\x02\x03\x04\x05\x06\x07\x08\t\n\x0b\x0c\r\x0e\x0f","\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f"," !\"#$%&'()*+,-./","0123456789:;<=>?","@ABCDEFGHIJKLMNO","PQRSTUVWXYZ[\\]^_","`abcdefghijklmno","pqrstuvwxyz{|}~\x7f","\u0402\u0403\u201a\u0453\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f","\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\ufffd\u2122\u0459\u203a\u045a\u045c\u045b\u045f","\xa0\u040e\u045e\u0408\xa4\u0490\xa6\xa7\u0401\xa9\u0404\xab\xac\xad\xae\u0407","\xb0\xb1\u0406\u0456\u0491\xb5\xb6\xb7\u0451\u2116\u0454\xbb\u0458\u0405\u0455\u0457","\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f","\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042a\u042b\u042c\u042d\u042e\u042f","\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f","\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"].join("");
function c5(db){var df=db.length,dc=[];for(var dd=0;dd<df;++dd){var de=db[dd];dc.push((de<32||de>255)?"?":c7.charAt(de))}return dc.join("")}function c6(de){var dg="SOFTWARE\\Crypto Pro\\Settings\\",dc=dg+"USERS\\"+cI.userSID+"\\Keys",df=dg+"Keys",dd=aF,db={};
return aj.regMassRead(be,de?df:dc,2,"b",aF,{2:cG}).then(function(dh){aJ(dh.subkeys,function(di){if(di.key&&di.key.length){db[di.key]=cG;dd=cG}aJ(di.values,function(dl){if(dl&&("name.key"===dl.name)){var dj=dl.value;
if(dj&&(dj.length>4)&&48==dj[0]&&22==dj[2]){var dk=dj[3];if(dk>0&&dk<=dj.length-4){db[c5(dj.slice(4,4+dk))]=di.key;dd=cG}}return aF}return bN})})}).caught(function(dh){if(!aj.isFileNotFoundError(dh)){bx.debug("Ошибка проверки контейнеров в реестре "+(de?"компьютера":"пользователя"),dh)
}if(!dd){db=bN}}).then(function(){return db})}return ch.all(c8,c9?c6(aF):bN,da?c6(cG):bN)}).spread(function(c7,c6,c8){var c5={};aJ(c7,function(dc,da){if(!da.parsed){return
}var dd=da.info["СНИЛС"]||da.info.SNILS,db=da.id+((cW&&dd)?("-"+dd):""),c9=c5[db];if(c9){if(!c9.old){c9.old=[]}if((da.isValid||!c9.isValid)&&ag(da,c9)>=0){c5[db]=da;
c5[db].old=c9.old;delete c9.old;c5[db].old.push(c9)}else{c9.old.push(da)}}else{c5[db]=da}});return[c5,c6,c8]}).spread(function(c6,c7,db){var da=[],c9=[],c5=[],dc=aF,dd=aF,de=[];
var c8=function(dk,dr){var dq=dk.info,dx=dk.hash,du={isOld:dr?0:1,Status:0,PublicKeyLen:dk.publicKeyLen,SerialNumber:dk.serial,Name:dk.name||"err",ValidFrom:dk.validFrom,ValidTo:dk.validTo,Location:dk.location,Thumbprint:dx},dl=[],dy=[];
if(c0){du.IssuerOrg=aX(dk.issuer);du.OrgName=aX(dq);du.HasPrivateKey=dk.hasPrivateKey;if(du.HasPrivateKey){if(dr){dd=cG}var dj=du.ContName=dk.contName,di=dj&&dj.substr(dj.lastIndexOf("\\")+1),dh=(n==dk.location)?db:c7;
if(di){if(di.indexOf("?")>=0){a7=cG;dl.push("INVALID_CONT_NAME")}else{if(dh&&bF(dj)){if(dh[di]){du.ContExist=1}else{dy.push("MISSING_CONT")}}}}du.ProvType=dk.provType;
var dt=dk.provName;if(ao(dt)){dt=cF(dt.replace("Cryptographic Service Provider",""))}du.ProvName=dt;if(dt&&(dt.indexOf("GOST")>=0||dt.indexOf("ГОСТ")>=0)){if((dt.indexOf("2001")<0)&&(dt.indexOf("94")>0)){cI.foundCspCont20=cG
}}}var ds=aW(dk.issuer);if(cV===ds){if("O"===du.OrgName){du.OrgName=""}du.IssuerName=ds}else{du.KEP=dk.KEP;du.CertId=dk.id;var dg=dk.license,dw=dq.SN||dq.Surname,dn=dq.G||dq.GivenName,dv=dq["СНИЛС"]||dq.SNILS;
if(dg){du.License=dg}if(dw){du.SN=dw}if(dn){du.G=dn}if(dv){du.SNILS=dv}if(c1||cZ){if(ds&&ds.length){du.IssuerName=ds}var dm={E:"EMail",CN:bN,T:bN,OU:bN};
aJ(dm,function(dz){var dA=dq[dz];if(dA){var dB=dm[dz]||dz;du[dB]=dA}})}}}function dp(){return ch.fork(!bm&&dk.content,function(){return ch.collector(ak(["CAPICOM","Certificate"],cG).caught(function(dz){bx.debug("Ошибка создания сертификата ",dz);
throw dz}),ak(["CAPICOM","Chain"],cG).caught(function(dz){bx.debug("Ошибка создания цепочки ",dz);throw dz}),function(dz){return dz.callAsync("Import",[dk.content])
},function(dz){return dz.callAsync("IsValid")},function(dA,dz,dB,dC){return dC.setAsync("CheckFlag",[487])},function(dA,dz){return dz.callAsync("Build",[dA]).caught(function(dB){bx.debug("Ошибка построения цепочки ",dB);
throw dB})},function(dA,dz){return dz.getAsync("Status")}).lastly(function(dA,dz,dB,dC){if(dC&&dC.free){dC.free()}if(dz&&dz.free){dz.free()}if(dA&&dA.free){dA.free()
}}).then(function(dC,dA,dD,dE,dB,dz,dF){return dF})},ch.thrown()).caught(function(dC){if(ai(bw,dC.number)){++g;Y()}if(dC&&dC.timeout){bx.error("timeout comment: Name: "+du.Name+" Thumb: "+du.Thumbprint)
}if(!bm){try{var dz=bq.Binary.fromBase64(dk.content),dA=bq.Crypto.createCertificateFromContent(dz);return dA.verify(67109185)}catch(dB){}}return bN})}function df(){return dp().then(function(dz){if(!dz){return
}if((F&dz)&&!ai(dy,"NOT_TIME_VALID")){dy.push("NOT_TIME_VALID")}else{if(E&dz){dy.push("NOT_TIME_NESTED")}}if(H&dz){dy.push("OFFLINE_REVOCATION")}if(J&dz){dl.push("REVOKED")
}if(D&dz){dl.push("NOT_SIGNATURE_VALID")}if(G&dz){dl.push("NOT_VALID_FOR_USAGE")}if(K&dz){dl.push("UNTRUSTED_ROOT")}if(C&dz){dl.push("CYCLIC")}if(z&dz){dl.push("INVALID_EXTENSION")
}if(B&dz){dl.push("CAPICOM_TRUST_INVALID_POLICY_CONSTRAINTS")}if(y&dz){dl.push("CAPICOM_TRUST_INVALID_BASIC_CONSTRAINTS")}if(A&dz){dl.push("INVALID_NAME")
}if(x&dz){dl.push("NOT_SUPPORTED_NAME")}if(u&dz){dl.push("CAPICOM_TRUST_HAS_NOT_DEFINED_NAME_CONSTRAINT")}if(v&dz){dl.push("CAPICOM_TRUST_HAS_NOT_PERMITTED_NAME_CONSTRAINT")
}if(t&dz){dl.push("CAPICOM_TRUST_HAS_EXCLUDED_NAME_CONSTRAINT")}if(L&dz){dl.push("CAPICOM_TRUST_NO_ISSUANCE_CHAIN_POLICY")}if(I&dz){dl.push("PARTIAL_CHAIN")
}if(r&dz){dl.push("CTL_IS_NOT_TIME_VALID")}if(q&dz){dl.push("CTL_IS_NOT_SIGNATURE_VALID")}if(s&dz){dl.push("CTL_IS_NOT_VALID_FOR_USAGE")}if((dy.length+dl.length<1)&&(M&dz)){dl.push("REVOCATION_STATUS_UNKNOWN")
}}).caught()}return ch.when(function(){if(g<bz&&!aD&&dk.IsValid){du.Status=0;if(dr){dc=cG}}else{if(dr){dc=aF}if(du.ValidTo&&(du.ValidTo<cz)){dy.push("NOT_TIME_VALID")
}else{if(c0&&!du.License&&(cI.expireCSPLicenseDays<=0)&&du.HasPrivateKey&&ao(du.ProvName||"")&&bU(du.IssuerOrg||"")){dy.push("NO_CSPLICENSE")}}if(du.PublicKeyLen===0){dl.push("CERT_KEY_NIL")
}if(g<bz){var dz=(!aD||(c0&&!ao(du.ProvName||""))||((cX||c2)&&du.PublicKeyLen));if(dz){return df()}}}return bN}).then(function(){if(dl.length){du.Status=2;
du.Errors=dl}else{if(dy.length){du.Status=1;du.Warnings=dy}else{du.Status=0;if(dr){dc=cG}}}}).then(function(){if(dc&&dd){du.Quality=0;a9=1;if(!du.isOld&&!du.License){ba=1
}da.push(du)}else{if(dc){du.Quality=1;c9.push(du)}else{du.Quality=2;c5.push(du)}}if(bg[dx]||bf[dx]){return -1}return dl.length?2:(dy.length?1:0)})};aJ(c6,function(df){de.push(df)
});de=de.sort(av());return ch.each(de,function(dh){var df=c6[dh],dg=df.old;R[c4]=cG;return c8(df,cG).then(function(di){if(dg&&dg.length){dg=dg.sort(function(dj,dk){return ag(dk,dj)
});return ch.each(dg,function(dj){return c8(dj,aF).then(function(dk){if(dk<di){di=dk}})}).then(function(){return di})}return di}).then(function(di){if(di>bk[c4]){bk[c4]=di
}if(di<bi[c4]){bi[c4]=di}})}).then(function(){var df="none";if(R[c4]){df=[];if(da.length){df=da}if(c9.length){df=df.concat(c9)}if(c5.length){df=df.concat(c5)
}}return df})}).caught(function(c5){if(cD>0){return"plugin"}else{if(!a8()){return"csp"}else{bx.debug("Ошибка перечисления сертификатов (тип: "+c4+")",c5);
return"err"}}})}var bh=0,Q={};function ac(){function w(cV,cW){return ch.resolve(cy[cV+cW]).lie(function(cX){cy[cV+cW]=cX={};return aT(cV,cW,cG,function(cY){var cZ=cY.getHash().toHexString().toUpperCase();
cX[cZ]={Name:cY.getName(),ValidTo:cY.getValidTo(),Thumbprint:cZ}}).caught(function(cY){ae(cY,cW);return aT(cV,cW,aF,function(cZ){return ch.all(cZ.getAsync("Thumbprint"),cZ.getAsync("SubjectName"),cZ.getAsync("ValidToDate")).spread(function(c1,c0,c2){c1=c1.toUpperCase();
cX[c1]={Name:aW(aV(c0,cG)),ValidTo:Date.parse(c2),Thumbprint:c1}})})}).then(cX)})}function cU(cW,cX,cV){return w(cW,cX).then(function(cZ){var cY=[];aJ(cZ,function(c0){if(cV[c0]){cY.push(cZ[c0])
}});return cY})}return ch.each(S,function(cW){var cX=cW.replace(new RegExp("Remove","gi"),"");var cV=aF;Q[cW]=0;return ch.fork(cW===cX,function(){return ch.serial(k(w,m,cX),k(w,n,cX)).spread(function(cZ,cY){aJ(S[cX],function(c0){if(cZ[c0]||cY[c0]){++Q[cX]
}else{if(!cV){cV=cG;bx.debug("В хранилище "+cX+" отсутствует сертификат "+c0)}}})})},function(){var cY=T[cW];return cU(n,cX,cY).then(function(cZ){if(cZ.length){co=1
}return(cZ&&cZ.length)?cZ:bN},function(cZ){ae(cZ,cX);bx.debug("Ошибка проверки сертов для удаления в хранилище компа "+cX,cZ)}).lie(function(){return cU(m,cX,cY)
}).then(function(cZ){if(cZ&&cZ.length){var c0=av("Name");cZ=cZ.sort(function(c1,c2){var c3=c0(c1,c2);return c3||((c1&&c1.ValidTo||0)-(c2&&c2.ValidTo||0))
});Q[cW]=cZ}})}).caught(function(cY){ae(cY,cW);if(cD!=2){bx.error("Ошибка проверки наличия всех сертификатов (тип: "+cW+")",cY)}})}).caught(function(){bh=1
})}return ch.when(function(){return ch.fork(bY||cb,function(){return aY(["CAPICOM","Store"].join(".")).then(function(w){return aH(w).get("ev")}).truth(function(w,cU){O=cU;
N=ah(cg.Capicom,O)?0:1;return ak(["CAPICOM","Store"],cG).then(function(cV){return cV.callAsync("Open",[n,p[cQ]]).then(function(){return cV.callAsync("Close").caught()
}).lastly(cV.free)}).caught(function(cV){bx.error("Ошибка создания объекта Store",cV);N=3})},function(){N=2}).then(function(){var cV=aj.isMSHTA()?cg.KonturToolboxHta2:cg.KonturToolboxMin2;
cB=cC?(ah(cV,cC)?0:1):2;if(0===cB){try{var w=bq.Crypto.getCertificates({storeLocation:cA[m],storeName:p[cQ]});if(!w||(typeof w.length!="number")){throw new Error()
}}catch(cU){cB=3;cI.getCertificatesKTError=cG;ay.getFixer().prepareFix("KonturExtern.KonturToolbox2")}}cD=Math.min(N,cB)}).caught()}).then(function(){aD=ab()
}).then(function(){return ch.fork(bN===bM,function(){var w=cm+"EncodingType 0\\CryptDllFindOIDInfo\\";return cn(be,w+cj+"\\","Name",aF).caught("").then(function(cU){aj.newCertOID=bM=cU
})})}).then(function(){var w=0,cU=0;return ch.fork(bZ,function(){if(aQ||cv){aJ(aR,function(cV){bP[cV]=aR[cV]})}if(cr||cv){aJ(cs,function(cV){bP[cV]=cs[cV]
})}return ch.each(bP,function(cV){++cU;var cW=bP[cV];return ad(cV,cW).then(function(){++w},function(){if("string"!=typeof(cW)){bQ=1}})})}).then(function(){return aa(aF).then(function(cV){a5=!ci&&(cV>0);
bS=a5?2:((w>=cU)?0:1);bR=a5?"bad":((w>=cU)?"yes":"no")})})}).fork(b4,function(){return a2(cf.Lanit).then(function(w){bt=w;bs=bt?0:1})}).fork(b3,function(){return a2(cf.GosUslugi).then(function(w){a4=w;
a3=a4?0:1})}).fork(b1,function(){return a2(cf.CSPCOM).then(function(w){at=w;ar=at?0:1;return a1(be,"{97F2985C-B74A-4672-960E-E3769AE5657A}}_is1","DisplayName",cG).truth(function(){ap="yes";
aq=0},ch.thrown()).caught(function(){return cn(be,"SOFTWARE\\Mozilla\\Mozilla Firefox\\","",aF).truth(function(){ap="not";aq=1},ch.thrown())}).caught(function(){ap="ff";
aq=-1})})}).fork(bV,function(){return a1(be,"AgzrtCryptProvider_is1","DisplayName",cG).caught(bN).then(function(w){f=w;if(f&&String(f).indexOf(" ")>0){var cU=String(f).split(new RegExp("\\s","g"));
f=cU[cU.length-1]}e=(f&&bp)?0:1})}).fork(b0,function(){var w="{8979C938-2AEE-468e-84E2-7D939561C491}_is1";return ch.all(a1(bd,w,"DisplayVersion",aF).caught(bN),a1(be,w,"DisplayVersion",aF).caught(bN)).spread(function(cU,cV){am=(cV&&cU)?bA(cU,cV):(cV||cU);
al=am?0:1})}).fork(b5,function(){return a1(be,"EGAISCrypto","DisplayVersion",aF).tap(function(w){if(!w||!w.length){throw new Error()}}).caught(function(){return a1(be,"EGAISCrypto","DisplayName",aF).then(function(cU){if(cU&&cU.length){cU=cF(cU);
var w=cU.lastIndexOf(" ");if(w>=0&&w<cU.length-1){cU=cU.substr(w+1)}}return cU}).caught(bN)}).then(function(w){bv=w;bu=bv?0:1})}).fork(cc,function(){return a2(cf.VCRedist2008).then(function(w){cJ=w;
cK=cJ?0:1},function(w){bx.debug("Ошибка определения версии VCRedist 2008",w)})}).fork(cd,function(){return a2(cf.VCRedist2010).then(function(w){cL=w;cM=cL?0:1
},function(w){bx.debug("Ошибка определения версии VCRedist 2010",w)})})}).then(function(){function c3(c7,c6){return c7?(c7+([""," (устарел)",""," (ошибка)"][c6]||"")):[1,2,0,"err"][c6]
}var c0="${INNOARGS}";if(bY){aw.setValue("Certificates/Capicom",c3(O,N));var cU=(2===N)?a:((1===N)?d:c),cV=cE("Certificates/Capicom",cU);ay.addFix(new aI("Certificates.Capicom",{message:cV.message,caption:cV.caption,filename:"capicom.exe",args:"/S",order:250,needadmin:1,priority:1,test:function(c8){var c6=N-(N>1?1:0),c7="";
if(N){c7=(3==N)?"cmtreinst":((2==N)?"cmtinst":"cmtupd")}c8.setMessage("Certificates/Capicom",c6,c7);return c6}}))}if(cb){aw.setValue("Certificates/Toolbox",c3(cC,cB))
}if(b6){aw.setValue("Certificates/CertOIDName",bM||"")}if(bZ){aw.setValue("Certificates/CertOIDUC",bR);ay.addFix(new aI("Certificates.CertOIDUC",{message:cE("Certificates/CertOIDUC/"+(aQ?"fts":(cr?"rosreestr":"uc"))),filename:"RegOids.exe",args:"/S",needadmin:1,priority:cH?0:1,order:1610,needreboot:bQ,fix:function(c6){return this.apply(function(c8){var c7=cG;
return ad(bN,bN,cG).anyway(bP).each(function(c9,da){return ad(c9,da).caught(function(){return aj.writeOidToRegistry(c9,da).caught(function(db){bx.debug("Ошибка исправления OID "+c9,db)
}).then(function(){return ad(c9,da)}).caught(function(db){c7=aF;bx.error("Ошибка регистрации OID "+c9,db)})})}).fork(a5,function(){return aa(cG).then(function(c9){c7=(0===c9)&&c7
})}).then(function(){if(!c7&&c8&&c8.code){c7=c8}return c6(c7)})})},test:function(c7){var c6="";if(1==bS||a5){c6="cmtfix"}c7.setMessage("Certificates/CertOIDUC",bS,c6);
return bS}}))}if(cc){aw.setValue("Certificates/VCRedist2008",cJ||"not",cK);var c4=cE("Certificates/VCRedist2008/"+(ct?"rpn":"uc"));ay.addFix(new aI("Certificates.VCRedist2008",{message:a+" "+c4,caption:c4,filename:(1251==af)?"vcredist_2008_SP1_x86_ru.exe":"vcredist_2008_SP1_x86_en.exe",args:'/q /l "${LOGFILE}"',priority:0,order:1630,needadmin:1,tags:[aI.Tags.MSI],test:function(){return cK
}}))}if(cd){aw.setValue("Certificates/VCRedist2010",cL||"not",cM);var c5=cE("Certificates/VCRedist2010/"+(ct?"rpn":"uc"));ay.addFix(new aI("Certificates.VCRedist2010",{message:a+" "+c5,caption:c5,filename:"vcredist_2010_x86.exe",args:'/q /norestart /log "${LOGFILE}"',priority:0,order:1635,needadmin:1,tags:[aI.Tags.MSI],test:function(){return cM
}}))}if(b4){aw.setValue("Certificates/Lanit",bt||"not");var c1=cE("Certificates/Lanit",bt?d:a);ay.addFix(new aI("Certificates.Lanit",{message:c1.message,caption:c1.caption,filename:"Lanit.exe",args:'/passive /norestart /log "${LOGFILE}" ALLUSERS=1',priority:bK?1:0,order:2100,needadmin:1,tags:[aI.Tags.MSI],dependency:["CryptoPro.CSP3X","KonturExtern.NetFramework"],fix:function(c7){var c6=this;
return c6.apply(function(c8){return ch.fork(c8&&!c8.code,function(){return aj.uninstallAllByMask(cf.Lanit+"\\s*$",c6.needadmin)}).then(function(){return c7(c8)
})})},test:function(c7){var c6="";if(bt&&!ah(cg.Lanit,bt)){bs=1;c6="upd"}c7.setMessage("Certificates/Lanit",bs,c6);return(1==bs)}}))}if(b3){aw.setValue("Certificates/GosUslugi",a4||"not");
var cZ=cE("Certificates/GosUslugi",a4?d:a);ay.addFix(new aI("Certificates.GosUslugi",{message:cZ.message,caption:cZ.caption,filename:(64==h)?"IFCPlugin-x64.msi":"IFCPlugin.msi",tags:[aI.Tags.MSI],args:"/quiet",priority:bJ?1:0,order:2130,needadmin:0,test:function(c7){var c6="";
if(a4&&!ah(cg.GosUslugi,a4)){a3=1;c6="upd"}c7.setMessage("Certificates/GosUslugi",a3,c6);return(1==a3)}}))}if(b1){aw.setValue("Certificates/CSPCOM",at||"not");
aw.setValue("Certificates/CSPCOMFF",ap||"not",aq);var cY=cE("Certificates/CSPCOM/"+(aG?"fed":"uc"),at?d:a);ay.addFix(new aI("Certificates.CSPCOM",{message:cY.message,caption:cY.caption,filename:"cspcom_v2.msi",args:"/quiet",priority:bI?1:0,order:2150,needadmin:1,fix:function(c7){var c6=this;
return ch.fork(at,function(){return a0(cf.CSPCOM).truth(function(c8){return aj.uninstall(c8,c6.needadmin)})}).then(function(){return c6.apply(c7)})},test:function(c7){var c6="";
if(at&&!ah(cg.CSPCOM,at)){ar=1;c6="upd"}c7.setMessage("Certificates/CSPCOM",ar,c6);return(1==ar)}}));var cX=cE("Certificates/CSPCOMFF/"+(aG?"fed":"uc"),a);
ay.addFix(new aI("Certificates.CSPCOMFF",{message:cX.message,caption:cX.caption,filename:"ffactivex-setup-r36.exe",args:c0+' /LOG="${LOGFILE}"',priority:bI?1:0,order:2160,needadmin:1,test:function(){return(1==aq)
}}))}if(bV){aw.setValue("Certificates/AgzrtCrypt",f||(bp?"not":"vista"));var w=cE("Certificates/AgzrtCrypt",f?d:a);ay.addFix(new aI("Certificates.AgzrtCrypt",{message:w.message,caption:w.caption,filename:"AgzrtCryptProvider.Setup.exe",args:c0,priority:bG?1:0,order:2170,needadmin:1,test:function(c7){var c6=(f&&!bp)?"vista":bN;
c7.setMessage("Certificates/AgzrtCrypt",e,c6);return(bp&&(1==e))}}))}if(b0){aw.setValue("Certificates/CryptoMoscow",am||"not",al);var cW=cE("Certificates/CryptoMoscow",a);
ay.addFix(new aI("Certificates.CryptoMoscow",{message:cW.message,caption:cW.caption,filename:"CryptoMoscow.exe",args:c0+' /LOG="${LOGFILE}"',needadmin:0,priority:bH?1:0,order:2180,test:function(){return(1==al)
}}))}if(b5){aw.setValue("Certificates/LesEgais",bv||(cI.noSse2?"sse2":"not"));var c2=cE("Certificates/LesEgais",bv?d:a);ay.addFix(new aI("Certificates.LesEgais",{message:c2.message,caption:c2.caption,filename:"EGAISCryptoSetup.exe",foreign:"http://lesegais.ru/upload/EGAISCryptoSetup.exe",args:"/S",needadmin:1,priority:(bv||bL)?1:0,order:2190,fix:function(c7){var c6=this;
return ch.fork(bv,function(){return a1(be,"EGAISCrypto","UninstallString",aF).truth(function(c8){if(c8&&(c8.length>1)&&('"'===c8.charAt(0))&&('"'===c8.charAt(c8.length-1))){c8=c8.substr(1,c8.length-2)
}return aH(c8).exists().truth(function(){return cu(c8,{args:"/S",admin:cG,wsWait:cG}).waitExit().then(function(c9){bx.debug("Старая версия EGAISCrypto удалена с кодом возврата "+c9.exitCode());
return ch.timeout(2000)}).caught(function(c9){bx.error("Ошибка удаления старой версии EGAISCrypto",c9)})},function(){bx.debug("Файл удаления старой версии EGAISCrypto не найден: "+c8)
})}).caught(function(c8){bx.error("Ошибка поиска команды удаления старой версии EGAISCrypto",c8)})}).then(function(){return c6.apply(c7)})},test:function(c7){if(!bv&&cI.noSse2){c7.setMessage("Certificates/LesEgais",2);
return false}var c6="";if(bv&&!ah(cg.LesEgais,bv)){bu=1;c6="upd"}c7.setMessage("Certificates/LesEgais",bu,c6);return(1==bu)}}))}}).then(function(){return ch.fork(b6,function(){return aC(cQ).then(function(w){bE=w;
if(bc.Scripts.CryptoPro){try{cI.hasPrivateCertsWithLicense=(a9&&!ba)?1:-1;ay.getFixer().prepareFix("CryptoPro.CSPLicense");if(bc.View){bc.View.progressCallback(ay,"CryptoPro",true,function(){})
}}catch(cU){bx.error('Ошибка поиска фикса "CryptoPro.CSPLicense" для его перепроверки',cU)}}})}).fork(b9,function(){return aC(cR).then(function(w){cq=w
})}).fork(bX,function(){return aC(cN).then(function(w){j=w})}).fork(b7,function(){return aC(cP).then(function(w){bT=w})}).fork(b2,function(){return aC(cO).then(function(w){az=w
})}).fork(b8||bW||(S&&S[p[cQ]]&&S[p[cQ]].length),function(){return ac().then(function(){if(cI.foundCspCont20){try{var cV=ay.getFixer(),w=cV.getFix("CryptoPro.CSP3XUpdate")||cV.getFix("CryptoPro.CSP3X");
if(w){cV.prepareFix(w)}}catch(cU){bx.error("Не удалось найти фикс КриптоПро для его перепроверки",cU)}}})}).timeout(50)}).then(function(){if(b8){cp=Q[p[cR]]||(cD?"plugin":"none");
aw.setValue("Certificates/RootCerts",cp)}if(bW){i=Q[p[cN]]||(cD?"plugin":"none");aw.setValue("Certificates/CACerts",i)}if(b8){var dd=Q.ROOTRemove;if(dd&&dd.length){aw.setValue("Certificates/RootRemoveCerts",dd)
}}if(bW){var cW=Q.CARemove;if(cW&&cW.length){aw.setValue("Certificates/CARemoveCerts",cW)}}if(b6){aw.setValue("Certificates/MyCertsTree",bE)}if(b9){aw.setValue("Certificates/RootCertsTree",cq)
}if(bX){aw.setValue("Certificates/CACertsTree",j)}if(b7){aw.setValue("Certificates/OtherCertsTree",bT)}if(b2){aw.setValue("Certificates/DisallowedCertsTree",az)
}var cZ=cH?"Certificates_CenterInform_User.exe":"Certificates_CenterInform_Admin.exe",c0=cH?"Certificates_CSP_User.exe":"Certificates_CSP_Admin.exe",c1=cH?"Certificates_Fed_User.exe":"Certificates_Fed_Admin.exe",c7=cH?"Certificates_Kontur_User.exe":"Certificates_Kontur_Admin.exe",c8=cH?"Certificates_Market_User.exe":"Certificates_Market_Admin.exe",dg=cH?"Certificates_RPN_User.exe":"Certificates_RPN_Admin.exe",dh=cH?"Certificates_Tander_User.exe":"Certificates_Tander_Admin.exe",w=aG?c1:(P?cZ:(an?c0:(ct?dg:(by?c8:(cw?dh:c7)))));
if(cb){aw.setMessage("Certificates/Toolbox",cB-(cB>1?1:0))}var c2="install",db="remove";if(b8){var dc="",c6=(Q[p[cR]]>=S[p[cR]].length);if(!c6){bh=1;if("capicom"!==cp){dc=c2
}}aw.setMessage("Certificates/RootCerts",c6?0:2,dc);var de=Q.ROOTRemove;if(de&&de.length){bh=1;aw.setMessage("Certificates/RootRemoveCerts",2,db)}}if(bW){var c3=(Q[p[cN]]>=S[p[cN]].length),cV="";
if(!c3){bh=1;if("capicom"!==i){cV=c2}}aw.setMessage("Certificates/CACerts",c3?0:2,cV);var cX=Q.CARemove;if(cX&&cX.length){bh=1;aw.setMessage("Certificates/CARemoveCerts",2,db)
}}if(b6){aw.setMessage("Certificates/CertOIDName",bM?1:0);var c9="",c4=!(p[cQ] in Q)||(Q[p[cQ]]>=S[p[cQ]].length);if(!c4){bh=1;if("capicom"!==bE){c9=c2
}}else{if(a7){c9="contnameerr"}}aw.setMessage("Certificates/MyCertsTree",(c4&&!a7&&R[cQ])?(bi[cQ]||-1):2,c9)}if(b7){var da="",c5=(Q[p[cP]]>=S[p[cP]].length);
if(!c5){bh=1;if("capicom"!==bT){da=c2}}aw.setMessage("Certificates/OtherCertsTree",c5?-1:2,da)}if(b2){aw.setMessage("Certificates/DisallowedCertsTree",R[cO]?1:-1)
}if(b9){var df="";if("none"===cq){bh=1;df=c2}aw.setMessage("Certificates/RootCertsTree",R[cR]?bk[cR]:2,df)}if(bX){var cY="";if("none"===j){bh=1;cY=c2}aw.setMessage("Certificates/CACertsTree",R[cN]?bk[cN]:2,cY)
}var cU=cE("Certificates/CACerts",a);ay.addFix(new aI("Certificates.CACerts",{message:cU.message,caption:cU.caption,filename:w,args:"/nowait",priority:1,order:280,needadmin:(co||bl())?1:!cH,dependency:["Certificates.Capicom"],test:function(){return bh
}}));return cG})};window.SkbKontur.Help.Scripts.Antivirus=function(ah,R,bt){var ci=window,aQ=ci.SkbKontur.Help,bE=aQ.Promise,aA=aQ.foreach,aw=aQ.filter,ai=aQ.Diagnosis,bg=aQ.map,ac=aQ.Core,ao=aQ.Err,ax=aQ.Fix,ca=aQ.Test,cd=aQ.trim,aR=ac.HKCU,aS=ac.HKLM,be=ac.log,ag=ac.debugKD,aW=ac.browser.ax,J=ac.badPrograms,cj=ac.warnPrograms,Q=ac.buildPath,Y=ac.compareDate,Z=ac.compareVersion,ad=ac.createAXObject,aF=ac.getKonturDiag,af=ac.dateToDisplayDate,am=ac.doubleSlashes,aq=ac.execute,aB=ac.formatDate,au=ac.File,av=ac.fileExist,ay=ac.Folder,az=ac.folderExist,aG=ac.getProcesses,aH=ac.getService,aI=ac.getShortcut,aJ=ac.getStartup,aP=ac.hasUac,aZ=ac.isCUProgram,a0=ac.isFileNotFoundError,a2=ac.isSystem,a3=ac.isUser,bF=ac.$readUnicode,bI=ac.$regEnumKeys,bJ=ac.regEnumValues,bL=ac.$regReadNumber,bM=ac.$regReadString,bP=ac.$regWriteString,bH=ac.regDeleteValue,bQ=ac.removeBadChars,bR=ac.run,bS=ac.runUniversalFix,ch=ac.versionToDisplayVersion,cg=ac.vars,k=cg.arch,aj=cg.diagnostics,bh=cg.microsoftLinkRoot,co=cg.winVer,cc=ai.translateFix,ae=ac.cyrillicFirstCompare;
var at=false,ce=true,bn=null,bl="none",ap="err",cq="wmi",cs="wsc",bm="noneuser",a7=(64==k),a4=co>=600,bb,cp,bK="Software\\Microsoft\\",a8=co<600,a6=co>=700,I=at,r=ce,s=at,q="[webscanner]";
bt=bt?bt.Antivirus:bn;var bq=!bt||bt.CompatibilityFlags,ab=bK+"Windows NT\\CurrentVersion\\AppCompatFlags\\Layers\\",cf,bf,cu,aa,cb;var bw=!bt||bt.VirusCheck,G=[],F=at;
var bx=!bt||bt.WMIStatus,ct,t;function U(cz){var w="2015.0",cw=a6?"10.0.2200":"10.3.2223",cv="999.9",cx="Файл настроек Avast (или секция "+q+") не найдены и версия антивируса >= ",cy=" - сканирование HTTPS включено";
if(Z(w,cz)){be.debug(cx+w+cy);cg.avAvastHttps=1}else{if(Z(cw,cz)&&!Z(cv,cz)){be.debug(cx+cw+cy);cg.avAvastHttps=1}}}function V(w,cv){return bE.fork(!cg.avAvastFound&&w&&w.toLowerCase().indexOf("avast")>=0,function(){cg.avAvastFound=ce;
var cx=Q(bb.$ComAppData,"AVAST Software\\Avast"),cw="avast5.ini",cy=Q(cx,"WebShield.ini");return av(cy).truth(function(){return bF(cy).then(function(cD){var cE=cD.split(new RegExp("\\r?\\n","g")),cC=at,cB="providerenabled=",cA=ce,cz="httpsscanning=";
aA(cE,function(cH){cH=cd(cH);var cI=cH.length,cJ=cI?cH.toLowerCase():"";if((cI>cB.length)&&(0===cJ.indexOf(cB))){var cK=cJ.split(cB),cL=Number(cK[cK.length-1]);
if(0===cL){be.debug("В настройках веб-экрана Avast нашли параметр "+cH);cA=at;return at}}if((cI>=q.length)&&(0===cJ.indexOf(q))){cC=ce}if((cI>cz.length)&&(cJ.indexOf(cz)>=0)){be.debug("В настройках веб-экрана Avast нашли параметр "+cH);
var cF=cJ.split(cz),cG=Number(cF[cF.length-1]);if(0!==cG){cg.avAvastHttps=1}}return bn});if(cA&&!cC&&!cg.avAvastHttps){be.debug("В файле настроек веб-экрана Avast не найдена секция "+q+", но мы считаем, что HTTPS включен");
if(cv&&cv.length){U(cv)}}})},function(){r=at;be.debug("Файл настроек веб-экрана Avast не найден: "+cy)}).caught(function(cz){be.debug("Не удалось проверить параметр HttpsScanning=1 в файле "+cy,cz)
}).then(function(){cw=Q(cx,cw);return av(cw)}).truth(function(){return bF(cw).then(function(cz){var cA=cz.split(new RegExp("\\r?\\n","g")),cB="hardenedmode=";
aA(cA,function(cE){cE=cd(cE);var cF=cE.length?cE.toLowerCase():"";if((cE.length>cB.length)&&(cF.indexOf(cB)>=0)){be.debug("В настройках Avast нашли параметр "+cE);
var cC=cF.split(cB),cD=Number(cC[cC.length-1]);if(0!==cD){cg.avAvastHardened=cD}return at}return bn})})}).caught(function(cz){be.debug("Не удалось проверить параметр HardenedMode=1,2 в файле "+cw,cz)
})}).then(function(){if(!s&&cg.avAvastFound&&!r&&cv&&cv.length){s=ce;U(cv)}})}var bo=!bt||bt.AllPrograms,b=[],d=bl,a=at,c=0;function aE(cx){var w=".exe",cv=function(){return av(cx+w)
},cw=function(cy,cz){return av(cz.path+w)};return av(cx).lie(cv).lie(function(){if('"'==cx.charAt(0)){cx=cd(cx.substr(1).split('"')[0])}return av(cx)}).lie(cv).lie(function(){return av(cx.split(" ")[0])
}).lie(cw).lie(function(){var cy=cd(String(cx)),cz=cy.lastIndexOf(" ");return bE.each(function(){return(cz>0)||bE.$break()},function(){cy=cy.substr(0,cz);
return av(cy).lie(function(){return av(cy+w)}).lie(function(){cz=cy.lastIndexOf(" ")},function(cA,cB){return bE.$break(cB)})})}).lie(function(){if(cx.indexOf('"')>=0){return av(cx.split('"')[1].split('"')[0])
}return bE.args(at,{})}).lie(cw).lie(function(){return av(Q(bb.$Windows,cx))}).lie(cw).lie(bn)}function aD(w){var cv=String(w);return bE.when(function(){return cv&&cv.length
}).truth(function(){return aE(cv).truth(function(cw,cx){var cy=(cx&&cx.name||"").toLowerCase();if(cy&&("|cmd.exe|regsvr32.exe|rundll32.exe|".indexOf(cy)>=0)){cv=cv.split(cx.name.split(".")[0])[1];
if('"'==cv.charAt(0)){cv=cv.substr(1)}cv=cd(cv);return aE(cv).truth(function(cz,cA){return cA.path})}return cx&&cx.path||cv})}).lie(String(w))}var br=(!bt||bt.Installed),aU=[],aV=bl,aT=at,a9="^\\s*(acs\\.exe|alwil|antivirus|Antiy\\-AVL|ashdisp|ashwebsv|a\\-squared|aupdate|authentium|avast|avg|avira|avp|baidu|bitdefender|ccapp|ccsvchst|cezurity|clamav|cmdagent|comodo|doctor\\s*web|drwagnui|dr\\.?web|dwarkdaemon|dwengine|dwnetfilter|dwservice|ehttpsrv|egui|ekrn|eset|f\\-secure|fortinet|fcssas|frwl_notify|frwl_svc|gdata|iobit\\s*security|ikarus|kaspersky|kavsvc|kwsprotect|kxescore|kxetray|luall|lucomserver|mcafee|mcshield|mfevtps|microsoft\\s+antimalware|microsoft\\s+forefront|microsoft\\s+security|msascui|msmpeng|msseces|nprotect|nod32|norman|norton\\s+antivirus|norton\\s+internet\\s+security|ntrayfw|ntrtscan|ofcpfwsvc|outpost|pagent|panda|pav(fn|pr)?srv|pavprot|pavsched|pccntmon|pnmsrv|psimsvc|quick\\s*heal|rising|rtvscan|security\\s*[^au\\s]|spideragent|spiderml|spidernt|symantec|symcorpui|the\\s*hacker|tmlisten|trend\\s*micro|vba32|virobot|vsmon|zafree|zapro|zonealarm|Антивирус",ba=ca(a9+")","i"),al=new RegExp("\\.","g"),b4=new RegExp("\\s+","g"),H=[],aC=bn,X=ae("Name"),bi;
var bs=!bt||bt.Processes,bB=[],bA=at,bC=bl,bD={},f=[],e=at,g=bl,aO=at,T="common files\\\\microsoft shared\\\\(officesoftwareprotectionplatform\\\\osppsvc|vs7debug\\\\mdm)",bj="microsoft security client\\\\nissrv",cr="windows media player\\\\wmpnetwk",by="program files(\\s\\(x86\\))?\\\\",bz="\\\\"+by+"("+[T,bj,cr].join("|")+")\\.exe",ar="explorer\\.exe",S="ccm\\\\(ccmexec|remctrl\\\\cmrcservice|tsmanager)\\.exe",an="ehome\\\\(ehrecvr|ehsched)\\.exe",bk="microsoft\\.net\\\\framework",b3="servicing\\\\trustedinstaller\\.exe",b7="system32\\\\((alg|cisvc|conhost|csrss|dfsrs|dfssvc|dwm|fxssvc|inetsrv\\\\(inetinfo|wmsvc)|ismserv|locator|lsass|lserver|lsm|msdtc|mstsc|netdde|perfhost|scardsvr|SearchFilterHost|searchindexer|SearchProtocolHost|services|slsvc|smss|snmptrap|spoolsv|sppsvc|taskhost|tcpsvcs|tlntsvr|ui0detect|utscsi|vds|vssvc|wat\\\\watadminsvc|wbem\\\\(wbengine|wmiapsrv|wmiprvse)|wdfmgr|wininit|winlogon|wuauclt|wudfhost)\\.exe|svchost)",b8="syswow64\\\\(perfhost|wbem\\\\wmiprvse)\\.exe",aM="{?[a-z\\d\\-\\_]+}?",cm,b9,a1,C,B=["Conduit(\\\\.+)?\\\\BackgroundContainer|CutterEdit","goopad\\\\goopad","LinkFunc|newnext\\.me\\\\nengine","Pokki\\\\Engine\\\\Launcher","QuickShopper","SupOptCrash|SystemSave|System\\\\SysMenu","UpgraderCreator|WinSpeedSvc|ZPro\\\\ZPro"].join("|"),y,z="BitMaster\\\\bitmaster|(DigitalSites|PennyBee|PriceFountain)\\\\UpdateProc\\\\bkup",E=["Discount Buddy\\\\repair","fltnsl\\\\launchall","HttpFilter\\\\launchall|Temp\\\\launchie","windealist\\\\Internet Explorer\\\\swu","C:\\\\task"].join("|"),A,v=["\\\\(aswast|YubeAlckIE|YubeAlckU\\d*)\\\\","BackgroundContainerV3|chaynacha\\.ru","(dnsatlantic|dnsmohawk|hqghumeaylnlf|spomj|tvDHJS)\\.exe","furyery\\.ru","granena\\.ru","l114la\\.com|limbbo\\.ru|mpnl\\.ru|netman\\.dll|\\\\PBot\\\\launchall\\.py","python\\\\pythonw\\.exe (app\\.py|httpfilter\\.py settings\\.ini|update\\.pyc)","rfusa\\.ru|rigneda\\.ru|rpuniti\\.ru","simsimotkroysia\\.ru|snpstd3|sumsungapple\\.ru|sti_ci\\.dll,","tsnpstd3|WiaCreateWizardMenu|zaxar games browser\\.lnk"].join("|"),aX,a5;
function W(cv){var w=(cv||"").replace(new RegExp("[\\\"\\']","g"),"").toLowerCase();w=w.replace(new RegExp(["(\\s(/i|/p|/yan","dex)([\\s+\\:\\=]\\d+)?)+(\\s|$)"].join(""),"g"),"");
return cd(w).replace(new RegExp("\\s\\s+","g")," ")}var bp=!bt||bt.Autorun,l=at,n={},m=[],p=bl,o=-1,u,x=[],D={},aN=at,i="SYSTEM\\CurrentControlSet\\Control\\Session Manager\\AppCertDlls\\",j="...\\AppCertDlls\\",h=new RegExp("^\\.\\.\\.\\\\AppCertDlls\\\\","i"),aL=["ExecCtrl","ProcNotify","ProcNotify_x86"],aK=new RegExp("\\\\("+aL.join("|")+")$","i"),b5,b6,bG=bK+"Windows\\CurrentVersion\\",bN=bG+"Run\\",bO=bG+"RunOnce\\";
var bv=!bt||bt.Services,bY=at,b2=bl,bZ=[],L=[],M={},ak=0,cn=at,b0=a9+"|msiexec|Windows\\s+Installer|Установщик\\s+Windows|wudfsvc|Windows Driver Foundation)",b1=new RegExp(b0,"i"),cl="BBSvc|BBUpdate|ETOKSRV|eTSrv|ICQ Service",ck=new RegExp(cl.replace(b4,"\\s*"),"i"),bd="BHipsSvc|BavMiniService|BdSandboxSrv|BavSvc",bc=new RegExp(bd.replace(b4,"\\s*"),"i"),K={"7654Bao":bn,AdInjector:"NTService1","All Programs Device":"jyxiveky","ALOT Update Service":"AlotService","Alphabet Key Use":"dipubibu","Amazon 1Button App Service":bn,"Amazon Assistant Service":bn,"Application Manager 1.26.3056825":"AppMgr1.26.3056825","Application Manager 3.16.8591351":"AppMgr3.16.8591351","Article Network Connection":"wikucyle","AS Service component":"serveras","Ask Update Service":"APNMCP",BasementDuster:bn,"Baidu Hips Service":"BHipsSvc","Bav Mini Service":"BavMiniService","Baidu BdSandbox Virtual Service":"BdSandboxSrv","Baidu Antivirus Service":"BavSvc",BBUpdate:bn,"BingBar Service":"BBSvc",BlockAndSurf:bn,BonanzaDeals:bn,BonanzaDealsLive:bn,"Broadcast Data":"xenyduje",BugreportW:bn,"CA Service component":"serverca","Call Centre Mouthpiece":"municevo",cd:"cd","CD Feature":"gyvixodu","Command Line File Size":"fymutoze","Comment Box Subtract":"totekyjo","Compact Stretch":"xetecype",ContentProtector:bn,ContentProtectorUpdate:bn,CouponDownloaderService64:bn,"Cover Copy":"fuzydeqy","CppWindowsService Sample Service":"CppWindowsService",CutterEdit:"942c66f3","Dataup Service":"Dataup",DCL:"DCL",dealplylive:bn,default_display_name:"default_service_name",DefaultTabUpdate:bn,DeltaFix:"24c54e38","Designer Licensed":"pupivyhi","DeskTop DispalyName":"DeskTop_F","DesktopSambaWindows.exe":bn,"Device Greyscale":"poxuwyvy","Disk Low-res":"lehicewu","Double Spaced Firewall":"zigipyro",Ea3Host:bn,"Email Web Directory":"ceriqeso","Encyclopaedia Enter":"vicoqudu",ETOKSRV:"eTSrv","eToken Notification Service":"ETOKSRV","Fan Recipient":"lifotugo","Fast And Safe":"a34a6eb2","FastPlayer Updater Service":"FastPlayerUpdaterService","Firewall Confirm":"bygixyfe","Freemake Improver":bn,GamesRS:bn,"Gaudy Homework":bn,"globalUpdate Update Service (globalUpdate)":"globalUpdate",goopad:"863788fa","Guard.Mail.ru":bn,"HHandler Service":bn,"ICQ Service":bn,"IePlugin Service":"IePluginService","IePlugin Services":"IePluginServices","IG Service component":"serverig","IHProtect Service":bn,IhPul:bn,"Indicator Lights Document":"mulikety",IncludeFoobar:"25efdc5a",IncludeFunc:"c5ce621e","Infonaut 1.10.0.13 Client Service":"insvc_1.10.0.13","JO Service component":"serverjo","Kerning Down":"gopibeko","Left Button Program":"nevinyqu","Line Topology Share":"todufesi",LinkFunc:"d96be41a","Mail.Ru Update Service":"mrupdsrv","MaintainerSvc1.20.7247763":bn,"MaintainerSvc3.22.1827446":bn,"MBRNativeOffice.exe":bn,"Memory Card Left-align":"godokiby","Menu Print Job":"xuhejygu","Mext Guard":bn,"MgAssist Service":"MgAssistService","MHz Table":"tuhurunu",mintcastnetworks:bn,"Mobile Home":"zehygiqo",MobogenieService:bn,"Mouse Outline":"ridonoqy",MSLSService:bn,"MySafeProxy Monitor":"MySafeProxyMonitor","My Web Search Service":"MyWebSearchService","Net Service Event Handler":"Sed",netfsrv:"PFHttpContentFilter.exe","NewPlayer Updater Service":"NewPlayerUpdaterService","Operation GB":"rebebicu","Optimizer Pro Crash Monitor":"70e6ca8c",OptimizerMonitor:bn,"PC Speed Up Service":"PCSUService","PennyBee service":"PennyBee",PicexaService:bn,"PriceMeterLiveUpdate Service (pricemeterliveUpdate)":"pricemeterliveUpdate","Pront Spooler":"ProntSpooler","Pwtyfemuk Cache":"Pwtcchsrv",QipGuard:bn,QQRepair13bc:bn,QQRepair1520:bn,QQRepair16bb:bn,QQRepair1712:bn,QQRepair1bd9:bn,QQRepair1c48:bn,QQRepair1cc5:bn,QQRepair1d85:bn,QQRepair1e0f:bn,QQRepair1f58:bn,QQRepair24a2:bn,QQRepair415:bn,QQRepair6b0:bn,QQRepair824:bn,QQRepair86e:bn,QQRepair9b5:bn,QQRepairc15:bn,QQRepairFixSVC:bn,QQRepairffd:bn,"Quick Ref 1.10.0.9 Client Service":"qrsvc_1.10.0.9",QuickShopper:"d461a231","Quiknowledge Client Service":"qksvc",RDPSSW32:"RDPSSW32","Red Green Blue RGB":"dibudyzy","Reimage Real Time Protector":"ReimageRealTimeProtector",RelieverPro:"381137d8","Reload CD ROM":"qugoqoxi",SeaPort:bn,"Search Protect Service":"CltMngSvc","Service Mgr InternetProgram":bn,"Service Mgr TreasureTrack":bn,sogrMed:bn,"SpeedChecker Service":"SCService","SS 1.10.0.25 Client Service":"swsesrvc_1.10.0.25",SSFK:bn,"StarWind AE Service":"StarWindServiceAE",StatInit:"353f6e4a","Stroke Receipt":"bujixodo","SU Service component":"tyrunufo","Super Optimizer":"22134214","SuperOptimizer Stats":"cae99edb","SvcHost Service Host":bn,"Switch Operating System":"hybixyxu",SystemAssister:"5c8a92f4",SystemSafeguard:"f6082713",SystemSave:"6990f981",SystemUphold:"123fe162","Template Web Server":"bowepeki","Term Tutor Client Service":"ttsvc",TicnoIndexator:bn,TicnoSearch:bn,"Times Domain":"duwisoco","Torch Crash Handler":"TorchCrashHandler",TrustMix:"0b309880","Typewriter High Resolution":"zejytose","Ubar Policy Provider":"UbarPolicyProvider",UdvdPork:bn,"Underscore Poster":"ryrojiry","Update Mgr InternetProgram":bn,"Update Mgr TreasureTrack":bn,"Updater.Mail.Ru":bn,UpdatingServiceMed:bn,UpgraderCreator:"73332371","URL Flash Drive":"qiduvoko",VCL:bn,VideoDownloadConverterService:"VideoDownloadConverter_4zService","VO Service component":"servervo","WdsManPro Service":"WdsManPro","WFini WdMan Service":"WdMan","Windows Management Service":"windowsmanagementservice","WindowsMangerProtect Service":"WindowsMangerProtect","WindowsProtectManger Service":"WindowsProtectManger","winDuBa Driver":"winDuuBa","WinZiper service":"winzipersvc","WordWizard 1.10.0.24 Client Service":"wwsvc_1.10.0.24","Wpm Service":"Wpm","YAC Service":"iSafeService",ZPro:"96203555","Сервис обновления Ask":"APNMCP"},O=["advPlugin","AMZN","BonusBerry","I Like It Extension","Media Saver","StartNow Toolbar","Torrent Search","VKSmile","WebBars"],P=["Adanak","AdvanceElite","App Bud","AppEnable","AppSuper","AtuZi","BatBrowse","Bellaphant","BetterBrowse","Brass Search","BringStar","BrowseBurst","BrowseFox","BrowseMark","BrowseSmart","BrowseStudio","BuzzSearch","Caramava","ClearThink","CytiWeb","Cyti Web","Deal Keeper","diamondata","DiVapton","EnhanceTronic","EnterDigital","fassurun","Faster Light","FindRight","Framed Display","GrabRez","Greener Web","GreyGray","Higher Aurum","Hold Page","HulaToo","HypeNet","InfiniNet","Jotzey","Jump Flip","Lampy Lighty","LemurLeap","LinkSwift","lucky leap","maucampo","Mega Browse","MossNet","NetCrawl","okiitan","outobox","PacFunction","PodoWeb","PortalMore","qualitink","ResultsBay","RightSurf","Rock Turner","SerialTrunc","sizlsearch","SmarterPower","SmarterPowerUnite","Solution Real","SpadeCast","SquirrelWeb","Steel Cut","SunriseBrowse","Surftastic","SwizzleBiz","Techgile","ToggleMark","TowerTilt","trolatunt","Ttessab","WebConnect","Webfuii","webget","WebSpades","WebSparkle","webwebget","Whilokii","WiseEnhance","Wooden Seal","Yawtix","Yulasee"];
aA(O,function(w){K["Update Service for "+w]="Update Service for "+w;K["Updater Service for "+w]="Updater Service for "+w});aA(P,function(w){K["Update "+w]="Update "+w;
K["Util "+w]="Util "+w;K["UpdaterSvc"+w]="UpdaterSvc"+w;var cv=cd(w);K["UpdaterSvc"+cv]="UpdaterSvc"+cv});aA(K,function(w,cv){if(!cv||!cv.length){K[w]=w
}});var aY=function(cw,w,cx){var cv=au(cx);return((w==cw)&&(cw==cv.name)&&(cw==ay(cv.folder).name+".exe"))?cw:bn};var bu=!bt||bt.ScheduledJobs,bT=at,bU=[],bV=bl,N=[],bX,bW=-1;
return bE.when(function(){return ac.getTools(["locator","wmi"]).spread(function(w,cv){bb=w;cp=cv;function cx(cy){return am(Q(cy,bn)+"\\").replace(".","\\.").replace(":","\\:")
}var cw=cx(bb.$AllUsers);cm=cx(bb.$Windows);b9="("+cm+'|^\\"?\\\\SystemRoot\\\\)';a1=ca(bz+"|"+b9+"("+[ar,S,an,bk,b3,b7,b8].join("|")+")","i");C=["1448\\\\Updater|48_dresses_notification_service|Temp\\\\\\d+\\\\\\d+_monster","AbleBook\\\\DiskControl|advPlugin\\\\[\\w\\d]+|AnyProtectEx\\\\AnyProtect|Amazon1ButtonService(64)?|amazonAssistantService|Amazon Browser Settings\\\\(AmznSearchProtect|updater)|Toolbar\\\\apnmcp","(AppData\\\\Roaming|Application Data)\\\\(daemon2|IYZWF|JEPNHIMU|Microsoft\\\\Windows\\\\Xwpwpt|TSv\\\\TSvr|Windows Live\\\\kxdvvmcbme|WindowsUpdate\\\\(Live|Updater))","AppMgr[\\d\\.]+\\\\appmgr|Apps\\\\\\d+\\.\\d+\\\\abril|Ask\\.com\\\\Updater\\\\Updater|Ask\\.com\\\\UpdateTask|ASPackage\\\\ASPackage","baidu\\\\baidu|bar\\\\1\\.bin\\\\65barsvc","Bench\\\\(BService\\\\\\d\\.\\d\\\\bservice(64)?|Updater\\\\updater|Wd\\\\wd)","Microsoft\\\\BingSvc\\\\BingSvc|Blacount\\\\stub|\\w+BlockAndSurf\\w+|BonanzaDealsLive|BonanzaDealsUpdate|BrowserExtensions\\\\BEHelper","CA Research\\\\CAResearch","(AppDownloads|CinemaxMe\\-version\\d+\\.\\d+|(Cinema\\s*Plus|Cinema\\s*Plus\\s*Pro|HDQ|HQ\\s*Cinema\\s*Pro|HQ\\s*Cinema\\s*Video|HQ\\-Video\\-Pro)[\\s\\-]*(\\d+\\.\\d+[a-z]?)?V\\d+\\.\\d+|enterprise 1\\.1|Ge\\-Force|Media\\+PlayerVidEd\\d+\\.\\d+|MedPvid\\d+\\.\\d+|SavePass \\d+\\.\\d+|Sense|Sm23mS)\\\\"+aM,"cobunce\\\\stub|Content\\s+Defender\\\\cd|ContentProtector\\\\(ContentProtector|ContentProtectorUpdate)|CppWindowsService","(Discount_Frenzy|Ge\\-Force|HQ\\-Video\\-Pro\\-\\d+\\.\\d+[a-z]V\\d+\\.\\d+|SavePass \\d+\\.\\d+|Sense)\\-codedownloader","ConvertAd\\\\ConvertAd|Program Files(\\s\\(x86\\))?\\\\cpx\\\\cpx","Crossbrowse\\\\Application\\\\crossbrowse","DealKeeper(\\.(BOAS|BOASHelper|BOASPRT|BrowserAdapter|PurBrowse))?","DealPlyLive|DealPlyUpdate|Dorrible\\\\Ribble\\\\d|DownloadInjectionSQL|dsrlte|dsrsetup","eDealPop|eDealsPop|Eseller\\\\python\\\\pythonw|eTranslator","FilterStart\\\\FilterStart|FunSpace\\.Update\\.Process","GameCenter\\@Mail\\.Ru|GemWare\\\\node\\-webkit|GenieFloater|GetNowUpdater|globalUpdate\\\\Update\\\\GoogleUpdate","gmsd_(ru|us)_\\d+","GuardMailRu","Hostinstaller\\\\\\d+_(installcube|monster)|html5locsvc|HttpFilter\\\\httpfilter","iExpert\\\\iExpert|iLivid|InstallMoney|iobitdownloader_installmonetizer","Jads\\\\(InjectorServiceProject|mintcastnetworks)","jsdrv","kbrowser\\-updater\\-utility","Temp\\\\loader","m3SrchMn|MailRuUpdater|MaxComputerCleaner_Maintenance|MaxDownload\\\\Updater","Max Driver Updater\\\\+(idscservice|maxdu)","MaxTorrent\\\\mtupdate|MediaPlayerApplication\\d*\\\\MediaPlayerApplication","Microsoft\\\\Extensions\\\\extsetup|Microsoft Update\\\\UnLoad|MinerGate\\\\minergate","Mobogenie\\\\DaemonProcess|moYZlDlKziEddkL|Mozilla\\\\siknvfk","mrkeeper|msrtn32\\\\msrtn32","Multibar\\\\(multibar|multibar_main|SearchService)","mwsoemon|mycomputer\\\\mycomputer|MyDesktop\\\\linkme0223","Installer\\\\newsrtr14|ntxobj","IGSC?\\\\OptimizerMonitor|OptProLauncher","P52L4CeHgob9wATJnWNB1UXT7qP","PC Speed Up\\\\(PCSUNotifier|PCSUSD|SpeedCheckerService)","pennybee|PennyBeeW|PFHttpContentFilter|Pokki\\\\Engine\\\\StartMenuIndexer|Pop\\-Up Stopper Free Edition\\\\PSFree|praetorian|pricefountain|pricefountainw|pricemeter|PriceMeter|PriceMeterLiveUpdate|pricemeterw|Microsoft\\.NET\\.Framework\\.Install\\\\punto|Pwtyfemuk\\\\Pwtcchtsk","QipGuard|Temp\\\\qq\\-bundle|QQBrowser\\\\([\\w\\-\\d]+\\\\)?Update\\\\BrowserUpdate|QQPCTray","regdrv","RDENAX|ReiGuard|ReiSystem|roller_coaster_park_notification_service","Extensions\\\\safebrowser","Safer\\-Surf\\-soft\\\\(safeS|Safer\\-Surfw)","SaveSenseLive|Program\\s*status\\\\scheck|Schedule\\\\Schedule","screentk\\\\(screentkup|screentool|screentoolkit)","ScreenUp\\\\future_helper|ScriptWriter\\\\ScriptWriter","SearchGo\\\\searchgo|Search Protection\\\\SearchProtection|SearchSnacks\\\\Service\\\\sssvc",by+"service","Service1104|Settings Manager\\\\SettingsManager|ShopperPro|ShopperPro\\\\updater","Smart Application Controller\\\\smappscontroller|SmartWebApp|SmartWebHelper","SpaceSoundPro\\\\SpaceSoundPro|srtserv\\\\Фото СТО","sfk\\\\ssfk|storegid\\\\(storegid|storegidup)","SupOptLauncher|"+cm+"svhost|SweetPacksUpdateManager|SwiftSearchAutoUpdateClient|SwvUpdater\\\\Updater","SyManager\\\\(launcher|updater\\\\python\\\\pythonw)|SystemAutorun|SystemDir\\\\nethost|SystemMonitor2016\\\\\\d+|systweakasp|sysnet","TablacusApp|TBNotifier|Ticno\\s?Tabs|weather\\\\TicnoWeather|Schedule\\\\timetasks|TimeTasks\\\\timetasks|TimeTasksSetup|TomorrowGames","(ExpressDownloader|TorrentExpress)\\\\TorrentExpress|TorrentSearch_restartonfail_exe\\\\fast\\-torrent\\-search","uohztdh","(APPCLO~1|Dealply|DIGITA\\~\\d|Funmoods|PennyBee|PRICEF\\~\\d|UPDATE\\~\\d)\\\\UPDATE\\~1\\\\UPDATE\\~1","UbarService|updateBrowseMark|updateBuzzSearch|Update Manager\\\\UM|upgmsd_ru_\\d+|utilBrowseMark|utilBuzzSearch","advPlugin\\\\uv1avRc\\.exe","V\\-bates\\\\(notifier|PrefHelper)","(VK Downloader|VKDownloader_restartonfail_exe)\\\\[\\w\\d]+","VKontakteDJ|VKSaver|VNT\\\\vntldr|VOPackage\\\\VOsrv|VTope\\\\vtope","WebProtectorPlus|WebProtectorPlusServer|wincheck\\\\wincheck|Windows\\\\Microsoft\\\\svchost|system32\\\\winsys2|winter_sports_helper_service|winzipersvc|woZI9MLjYIDmI|wupdate\\\\wupdate","7z[^\\\\]*\\.tmp\\\\Xmas|XTab\\\\ProtectService|xwfjiuyapa|temporary_download\\\\xxx_porno","y2SpeedCheckF72","YAC\\\\(iSafeSvc\\d*|iSafeTray)","Yandex\\\\.+\\\\elements(64)?|yandex.*stroka.*","yc\\\\Application\\\\yc|YouTubeAccelerator|YTDownloader","zBBtVhXVL8pUrZ4i8LB|ZetaGames\\\\Upd|ZetaGamesNews\\\\zeta|Zona\\\\Zona"].join("|");
y="Program Files(\\s\\(x86\\))?\\\\launcher|V\\-bates\\\\startsc|SetWallpaper|"+cm+"site1";A=["("+y+")\\.(bat|cmd)","("+z+")\\.(bin|dat)","("+B+")\\.dll","("+E+")\\.(js|vbs)","("+C+")(\\.exe)?",'rundll32\\.exe\\"?\\s*\\"?'+cw+".*",cw+aM+"\\\\"+aM+"\\.(lnk|pif)","Startup\\\\[\\w\\d]+\\.tmp\\.auto\\.hta",aM+"\\\\[a-z]{4}[0-9a-f]{4}\\.(tmp|tmpfs)"].join("|");
aX=ca(v+"|\\\\("+A+')($|\\"|,|\\&|\\s)',"i");a5=ca("baidu.*\\\\bav.*|DllGetClassObject|searchbandapp.*","i")})}).then(function(){return bE.fork(bq,function(){var w=new RegExp("[~\\s]+","g");
function cv(cw,cy){var cx=(aS==cw)?(a7?(cy?"machine64":"machine32"):"machine"):"user";return bJ(cw,ab,cy).map(function(cz){return bM(cw,ab,cz,cy).then(function(cA){return{Type:cx,Path:cz,Flags:cA.split(w)}
})}).caught([])}return bE.all(a2()?[]:cv(aR,at),cv(aS,at),a7?cv(aS,ce):[]).spread(function(cz,cy,cA){if(!cz||!cy||!cA){be.debug("user: "+cz+"; user: "+cy+"; x64: "+cA,bn,bn,"nArr");
cz=cz||[];cy=cy||[];cA=cA||[]}var cw=[{Path:ca('(^|\\"|\\\\)(firefox|iexplore)\\.exe(\\s|\\"|\\/|$)',"i"),Remove:ca("NT4SP5|RUNASADMIN|WIN|VISTA","i")}];
function cx(cB){var cC=[];aA(cB,function(cD){var cF=cD.Path,cE=bn;if(cF){aA(cw,function(cG){if(cG.Path(cF)){cE=aw(cE||cD.Flags,function(cH){return !cG.Remove(cH)
})}});if(cE&&(cE.length!=cD.Flags.length)){cC.push({Type:cD.Type,Path:cF,Flags:cE.join(" ")})}}});return cC}cf=cx(cz);bf=cx(cy);cu=cx(cA);aa=bf.length||cf.length||cu.length;
cb=cz.concat(cy).concat(cu)})}).fork(bw,function(){var cw=function(cG){var cF=[];aA(cG,function(cI){try{aA(document.getElementsByTagName(cI),function(cJ,cK){cF.push(cJ.src||cJ.id||("Неизвестный "+cI+" "+cK))
})}catch(cH){be.debug("Ошибка сбора тегов "+cI,cH)}});return cF};var w=cw(["script",["ifr","ame"].join(""),"img"]),cE=".kontur.ru",cD=".google-analytics.com",cA=["api"+cE,"callback"+cE,"help2"+cE,"help3"+cE,"install2"+cE,"install3"+cE,"4041d29a-c3c9-4296-a56a-d3bfd422e8d2"+cE,"h"+cE,"help"+cE,"i"+cE,"install"+cE,"mc.yandex.ru","ssl"+cD,"www"+cD],cv=cA.join("|").replace(al,"\\.").replace(new RegExp("\\-","g"),"\\-"),cz="https?\\:\\/\\/("+cv+")(\\:\\d{2,5})?",cC="(diagnostics\\.ashx|(alert|chat\\-widget|check|content(\\/components|\\/images)?|diagnostics|ga\\.js|gateways\\/jsapi|jsapi|scripts|watch)\\/)",cx="blob:https?(:|(%|&)[^\\/]+)\\/\\/("+cv+")(:\\d{2,5}|(%|&)[^\\.\\/]+)?\\/\\w{8}-\\w{4}-\\w{4}-\\w{4}-\\w{12}",cB=["diag\\-(ifr","ame|img|script)\\-"].join(""),cy=new RegExp("^(("+cz+")?\\/"+cC+"|"+cx+"|"+cB+")","i");
aA(w,function(cF){if(!cy.test(cF)){G.push(cF)}});if(G.length){F=ce}}).fork(bx&&!ac.isWinServer(),function(){var cy="root\\SecurityCenter"+(a4?"2":"");function cv(cA,cz){return cz==(cA&cz)
}function cx(cz){return cz?[cv(cz,16)?0:1,cv(cz,4096)?1:0]:[ap,bn]}function cw(cA){if(cA){var cB=cA.split(al),cz=Number(cB[cB.length-1]);if(cz>99999){return ch(cz)
}}return cA}function w(cA,cE){if(cA){var cC=cA.displayName,cF="",cz,cB=("Firewall"===cE);if(a4){var cD=cx(+cA.productState);cz=cD[1];t.push({Type:cE,Name:cC,Enabled:cz,UpToDate:cB?"":cD[0]})
}else{cF=cw(cA.versionNumber);cz=(cB?cA.enabled:cA.onAccessScanningEnabled)?1:0;t.push({Type:cE,Name:cC,Version:cF,Enabled:cz,UpToDate:cB?"":(cA.productUptoDate?1:0)})
}if(cz){return V(cC,cF)}}return bE.resolve()}ct=bn;return bE.fork(aW,function(){t=cp?ap:cq;return aH("wscsvc").truth(function(cz){ct=cz.running;if(cz.forDeletion){be.error("Служба wscsvc помечена для удаления")
}}).caught().then(function(){t=[];return ad(["WbemScripting","SWbemLocator"])}).then(function(cz){return cz.ConnectServer("",cy)}).then(function(cA){function cz(cC){var cB="SELECT * FROM "+cC+"Product";
return bE.when(function(){return new ci.Enumerator(cA.ExecQuery(cB,"WQL",48))}).then(function(cD){return bE.each(function(){return(!cD||cD.atEnd())&&bE.$break()
},function(){return w(cD&&cD.item(),cC).then(function(){return cD&&cD.moveNext()})})})}return bE.serial(cz("AntiVirus"),cz("Firewall"),a4?cz("AntiSpyware"):bn)
}).caught(function(cz){if(ct){be.debug("Ошибка определения состояния антивируса через WMI",cz)}else{t=(at===ct)?cs:ap}})},function(){t=[];function cz(cD){var cC="SELECT * FROM "+cD+"Product",cB=("Firewall"===cD),cA=a4?["displayName","productState"]:(cB?["displayName","versionNumber","enabled"]:["displayName","versionNumber","onAccessScanningEnabled","productUptoDate"]);
return ac.kdWMISelect(cy,cC,cA).truth(function(cE){return bE.each(cE,function(cF){return w(cF,cD)})},bE.thrown())}return bE.serial(cz("AntiVirus"),cz("Firewall"),a4?cz("AntiSpyware"):bn).caught(function(cA){be.error("Ошибка определения состояния антивируса через KD",cA);
return ac.runTestEquipment("Antivirus").then(function(cB){if(cB&&(0===cB.code)){ct=("boolean"==typeof(cB.wscRunning))?cB.wscRunning:bl;t=cB.avwmi?cB.avwmi:bl;
cg.antivirusAvastFound=cB.antivirusAvastFound}else{ct=bl;t=bl}})})})})}).then(function(){if(bq){ah.setValue("Antivirus/CompatibilityFlags",cb.length?cb:"not",aa?1:0);
aj.addFix(new ax("Antivirus.CompatibilityFlags",{message:cc("Antivirus/CompatibilityFlags"),priority:1,order:35,needreboot:0,needadmin:(a2()||bf.length||cu.length)?1:0,test:function(){return aa
},fix:function(cz){var cy=ce;function cw(cA,cB,cC){return bE.each(cB,function(cD){var cE=cD.Path;return bE.fork(cD.Flags.length,function(){return bP(cA,ab,cE,cD.Flags,cC)
},function(){return bH(cA,ab,cE,cC)}).caught(function(cF){be.error("Ошибка исправления совместимости программы "+cE,cF);cy=at})})}function cx(){var cF="/@#$/",cD=bf.concat(cu),cC=bg(cD,function(cG){return cG.Flags
}).join(cF),cE=bg(cD,function(cG){return cG.Path}).join(cF),cA=bg(cD,function(cG){return("machine64"==cG.Type)?"1":"0"}).join(cF),cB='"'+cE+'" "'+cC+'" "'+cA+'"';
return bS("WriteCompatFlags "+cB,ce).then(function(cG){cy=cG})}return cw(aR,cf,at).then(function(){if(bf.length||cu.length){if(aP()||a3()){return cx()}return cw(aS,bf,at).then(function(){return cw(aS,cu,ce)
})}return bn}).then(function(){return cz(cy)})}}))}if(bw){ah.setValue("Antivirus/VirusCheck",F?G:bl,F?2:0)}if(bx){ah.setValue("Antivirus/WMIStatus","err");
ah.setValue("Antivirus/WMIStatus",t&&t.length?t:bl);var cv=(cq==t||cs===t)?1:(t&&t.length?-1:0),w=(at===ct&&(cs!==t))?"wmimiss":"";ah.setMessage("Antivirus/WMIStatus",cv,w);
if(t&&(t instanceof Array)&&t.length){aA(t,function(cw,cx){if(0===cw.UpToDate){ah.setMessage("Antivirus/WMIStatus/"+cx,1)}})}}}).then(function(){return bE.fork(bo||br,function(){var w={},cz=ca(cg.productMasks.RutokenDriver,"i"),cB=bK+"Windows\\CurrentVersion\\Uninstall\\",cy=ca("\\{[0-9A-F]{8}\\-([0-9A-F]{4}\\-){3}[0-9A-F]{12}\\}","i"),cA=ca("^(\\{\\[\\w\\-]+}\\.)?(KB[\\d\\-v]+)$","i"),cC=ca("ViPNet CSP","i"),cw=ca(["Avest CSP","LirSSL|ЛирССЛ","LISSI\\-?CSP|ЛИССИ\\-?CSP","eToken (for|для) Signal\\-?COM","Signal\\-?COM (CryptoProvider|CSP)","Валидата CSP","КриптоНУЦ"].join("|"),"i"),cv=ca(["Avast Infinity","COMODO livePCsupport","panda kung","tuneup"].join("|"),"i");
function cx(cI,cJ){var cE=0,cF=50,cG=10,cH=function(){return 0===(cE%cF)};return bI(cI,cB,cJ).each(function cD(cN){++cE;if(!cN||cN.length<3){return cH()?bE.timeout(cG):bn
}var cL=cB+cN+"\\",cM=at,cK;return bE.fork(cH,bE.timeout(cG)).then(function(){return bM(cI,cL,"DisplayName",cJ)}).then(bQ).truth(function(cO){return bE.fork(cz(cO),function(){return bL(cI,cL,"SystemComponent",cJ).then(function(cP){return cP==1?bn:cO
}).caught(cO)},cO)}).truth(function(cO){return bE.fork(cN.length==38&&cy(cN),function(){return bE.all(bL(cI,cL,"WindowsInstaller",cJ),aZ(cN),ac.isProgramOf("S-1-5-18",cN)).spread(function(cR,cP,cQ){cM=(cR===1);
cK=cQ;return(cR==1)&&!cP?bn:cO}).caught(cO)},cO)}).truth(function(cO){return bM(cI,cL,"DisplayVersion",cJ).then(bQ).lie(bE.thrown()).caught(function(){return bL(cI,cL,"Version",cJ).then(ch)
}).caught("").then(function(cU){if(!cU||(cU.length<2)||(cO.indexOf(cU)>=0)){cU=""}var cQ=at,cT=bn,cS=bn,cP="",cR=ac.bind(this,bM,cI,cL,"UninstallString",cJ);
return V(cO,cU).then(function(){var cV=cO+(cU?" "+cU:"");if(J.test(cO)||((cV!==cO)&&J.test(cV))){cQ=ce;if(cj.test(cO)||((cV!==cO)&&cj.test(cV))){c=Math.max(1,c)
}else{c=2}return bM(cI,cL,"UninstallString",cJ).then(function(cW){cT=cW})}return bn}).anyway(function(){return bE.fork(cy(cN),function(){return ac.$getInstallDate(cN,cJ)
}).then(function(cV){if(!cV||(cV.length<8)){return bM(cI,cL,"InstallDate",cJ).then(function(cW){return cW&&(8==cW.length)?af(cW):""})}return cV}).then(function(cV){cP=cV
})}).anyway(function(){return bE.fork(!cT,function(){return bM(cI,cL,"UninstallString",cJ)}).then(aD).then(function(cV){return au(cV).get("ed").then(function(cW,cX){return(!cW||!cX.dateCreated)?bE.thrown():cX
}).then(function(cY){cS=cY.name;var cW=new Date(cY.dateCreated);if(!cP||(10!=cP.length)||(cP==aB(cW,ce,at))){cP=aB(cW,at,at)}else{if(cY.dateOpened){var cX=new Date(cY.dateOpened);
if(cP==aB(cX,ce,at)){cP=aB(cX,at,at)}}}})})}).anyway(function(){var cX=cO+"$"+cU,cZ=w[cX];if(!cZ||!cZ[2]||(cP&&cP.length&&Y(cZ[2],cP)>=0)){var cY=(cI===aS&&(!cM||cK));
w[cX]=[cO,cU,cP,cQ,cT,cN,cJ,cM,cR,cY,cS]}if(!cA(cN)&&ba(cO)){if(!cv(cO)){aU.push({Name:cO,Version:cU,InstallDate:cP})}}if(aQ.Scripts.CryptoPro){if(cw(cO)){if(cU&&(cU.length>1)){var cW=cO.split(b4),cV=cW[cW.length-1];
if(ca("^[\\d\\.]+$")(cV)&&(0===cU.indexOf(cV))){cO=cd(cO.substr(0,cO.length-cV.length))}}H.push(cO+(cU?(" "+cU):""));aC=bn}else{if(!H.length&&cC(cO)){aC=cO
}}}})})}).caught()}).caught(function(cK){if(!ac.isAccessDeniedError(cK)&&!ac.isFileNotFoundError(cK)){be.error("Ошибка сбора антивирусов и программ (root = "+cI+", x64 = "+cJ+")",cK)
}})}return bE.serial(a2()?bn:function(){return cx(aR,at)},function(){return cx(aS,at)},a7?function(){return cx(aS,ce)}:bn).then(function(){function cD(cH,cG){return au(cG).get("evd").truth(function(cI,cM,cJ){var cL=(cM||""),cK=cJ.dateCreated?aB(new Date(cJ.dateCreated),at,at):"";
w[cH+"$"+cL]=[cH,cL,cK,at,"","",at]}).caught()}var cF=Q(bb.$AppData,"retun");cD("Контур.VNC Server",Q(cF,"tvnc.exe"));cD("Контур.VNC Viewer",Q(cF,"kvnviewer.exe"));
aA(w,function(cG){b.push(cG)});a=b.length>0;var cE=bn;if(a){b=b.sort(ae());aA(b,function(cI,cH){var cG=w[cI],cJ={};if(cG[0]&&cG[0].length){cJ.Name=cG[0]
}if(cG[1]&&cG[1].length){cJ.Version=cG[1]}if(cG[2]&&cG[2].length){cJ.InstallDate=cG[2]}b[cH]=cJ;if(cG[3]){if(!cE){cE={}}cE[cH]={isX64:cG[6],regKey:cG[5],uninstallString:cG[4],needMsi:cG[7],regCheck:cG[8],needAdmin:cG[9],fileName:cG[10]}
}})}else{d=bl}cg.badProgramsArray=cE;aT=aU.length>0;return bn}).caught(function(cD){d=aV=ap;be.error("Ошибка сбора антивирусов и программ",cD)}).then(function(){if(aQ.Scripts.CryptoPro&&(H.length||aC)){var cE=aj.getFixer(),cD=cE.getFix("CryptoPro.CSP3X")||cE.getFix("CryptoPro.CSP3XUpdate");
if(cD){if(cD.applicable){if(H.length){cg.foundBadOtherCSP=H.join(",");cE.prepareFix(cD.name);if(aQ.View){aQ.View.progressCallback(aj,"CryptoPro",true,function(){})
}}}else{H=[];aC=bn}}}cg.foundBadOtherCSP=H.length?H.join(","):bn;cg.foundWarnOtherCSP=aC}).caught(function(cD){be.error('Ошибка поиска фикса "CryptoPro.CSP3X" для его перепроверки',cD)
})}).fork(bs,function(){return aG().each(function(cx){var cw=bQ(cx.name),cv=bQ(cx.path),w=bQ(cx.cmdLine);if(!cw||("[System Process]"===cw)||"System"===cw){return bn
}return au(cv).get("v").then(function(cy){cy=cy||"";var cz=w||cv;if(ba(cw)){f.push({Name:cw,Path:cz,Version:cy});return V(cw,cy)}else{if(cz){var cA=aX(cz);
if(cA){aO=ce;var cB=W(cz);bD[cB]=(bD[cB]||[]);bD[cB].push(cx.getPID())}if(cA||!a1(cz)){bB.push({Name:cw,CmdLine:cz,Version:cy})}}}return bn})}).then(function(){e=f.length>0;
if(e){f.sort(X)}else{g=cp?bl:bm}bA=bB.length>0;if(bA){bB.sort(X)}else{bC=cp?bl:bm}}).caught(function(w){bC=g=cp?ap:cq;be.error("Ошибка чтения информации о процессах",w)
})})}).then(function(){if(br){ah.setValue("Antivirus/Installed",aT?aU:aV)}if(bs){var w=(ap===g)?2:(cq===g)?1:-1;ah.setValue("Antivirus/Antiviruses",e?f:g,w);
var cv=(ap===bC)?2:(cq===bC||aO)?1:-1;ah.setValue("Antivirus/Processes",bA?bB:bC,cv);if(aO){aA(bB,function(cx,cw){if(aX(cx.CmdLine)){ah.setMessage("Antivirus/Processes/"+cw,1)
}})}}}).then(function(){return bE.fork(bp,function(){function cv(cx,cy){return ay(cx).files().each(function(cC){var cA=au(cC),cB=cA.name.toLowerCase(),cz=cA.ext,cD;
return bE.fork("lnk"===cz||"url"===cz,function(){return aI(cC).then(function(cE){cD=(cE.lnk?cE.target:cE.url)||"";if(cE.lnk&&cE.url){if(cD.length&&('"'!==cD.charAt(0))){cD='"'+cD+'"'
}cD+=" "+cE.url}})},function(){cD=cC}).then(function(){if(cB!=="desktop.ini"){n[cB+"$"+cy]=[cB,cD,cy]}}).caught()}).caught()}function w(cz,cx,cB,cA,cy){cy=cy||"";
return bJ(cz,cx,cB).each(function(cC){if(!cC){return bn}return bM(cz,cx,cC,cB).then(bQ).truth(function(cD){n[cy+cC+"$"+cA]=[cy+cC,cD,cA]}).caught()}).caught()
}function cw(cx){return bE.all(w(aS,bN,cx,1+2+(cx?8:0)),w(aS,bO,cx,1+2+4+(cx?8:0)))}return bE.all(aJ(ce),aJ()).spread(function(cy,cz){b5=cy;b6=cz;var cx=[b5?cv(b5,a8?2:10):bn,cw(at),w(aS,i,at,1+2+16,j)];
if(a7){cx.push(cw(ce))}if(!a2()){cx=cx.concat(b6?cv(b6,a8?0:8):bn,w(aR,bN,at,1),w(aR,bO,at,1+4))}return bE.all(cx)}).then(function(){aA(n,function(cx){m.push(cx)
});l=m.length>0;if(l){m=m.sort(ae());aA(m,function(cx,cF){var cA=n[cx],cG=cA[0],cz=cA[1],cB=cA[2],cD=aX(cz),cE=!!(cB&2);m[cF]={LM:cE?1:0,Name:cG,CmdLine:cz};
if(cD||(h.test(cG)&&!aK.test(cG))){o=2;aN=aN||cE;var cy=bD[W(cz)],cC=cB+","+cG;if(cD&&cy){cC+=","+cy.join(":")}D[cC]={Flags:cB,Name:cG,CmdLine:cz,PIDs:cy};
x.push(cC)}else{if(J.test(cG)){o=1}}});u=x.length>0}else{p=bl;o=(ap==p)?2:-1}}).caught(function(cx){p=ap;be.error("Ошибка чтения информации о задачах",cx)
})}).fork(bv,function(){return aH(bn,at,ce).each(function(cA){if(!cA){return bn}var cv=bQ(cA.caption),cw=(cA.name||""),cx=bQ(cA.pathName),cy=cA.running,w=cA.automatic,cz={Id:cw,Name:cv,Owner:cy?cA.account:"stop",Mode:w?2:(cA.manual?3:(cA.disabled?4:-1))};
return bE.fork(cx&&cx.length,function(){cz.Path=cx;return aD(cx).truth(function(cB){cz.Path=cx=cB;return au(cx).get("ev")}).truth(function(cB,cC){cz.Version=cC||""
}).caught(function(cB){be.debug("Ошибка чтения версии файла службы",cB)})}).then(function(){var cC=(cx&&cx.length),cB=("LSM"===cv||(cC&&a1(cx))),cE=("msiserver"===cw.toLowerCase()),cD=cE||(!cB&&(cy||w));
if(cE){cn=ce}return bE.fork(cD&&cC,function(){var cF=au(cx),cG=cF.folder;if(K[cv]||K[cw]||aY(cw,cv,cx)){if(ck.test(cv)||ck.test(cw)||bc.test(cv)||bc.test(cw)){M[cv]=1
}else{M[cv]=2;ak=1}}else{return bE.all(av(Q(cG,"Uninstall.exe")),av(Q(cG,"Internet Explorer Settings.exe")),av(Q(cG,"Helper.dll"))).spread(function(cJ,cI,cH){if(cJ){if(cI){if(cH){M[cv]=2;
ak=1}}if(!M[cv]){if(cG.toLowerCase().indexOf("movies toolbar")>0){M[cv]=2;ak=1}}}}).then(ce)}return ce}).truth(function(){if(M[cv]){bZ.push(cz);if(!bc.test(cw)){L.push(cz)
}return at}return ce},ce).truth(function(){if(cD||b1.test(cv)){bZ.push(cz)}})})}).then(function(){if(bZ.length){bY=ce;bZ=bZ.sort(X);if(L.length){L=L.sort(X)
}}}).caught(function(w){b2=ap;be.error("Ошибка чтения информации о службах антивирусов",w)})}).fork(bu,function(){bX=Q(bb.$System32,"schtasks.exe");function w(cv){cv=cv?cv.split(new RegExp("\\r?\\n","g")):[];
var cw=new RegExp("\\d"),cy=new RegExp("\\\\"),cx=new RegExp("включен|enable"),cA={},cz=[];aA(cv,function(cC){var cB=cC?cC.split('","'):bn;if(!cB||cB.length<19){return
}var cF=a8?cB[5]:cB[6];if(!cw.test(cF)){return}var cG=a8?cB[1]:cB[1].slice(1);if(!a8&&cy.test(cG)){return}var cE=a8?cB[4]:cB[5],cJ=cx.test(cB[11].toLowerCase()),cK=cd(a8?cB[12]:cB[18]),cH=cd(a8?cB[18]:cB[14]),cI=cB[8],cD=[cJ,cG,cI,cE,cK,cH].join("@#$");
if(!cA[cD]){cA[cD]=ce;cz.push({State:cJ,Name:cG,Path:cI,LastExec:cE,Type:cK,Owner:cH})}});return cv.length?cz:"err"}return bE.when(aF).truth(function(cv){var cw=new Date().getTimezoneOffset();
return bE.when(function(){return cv.getSchedulerTasks()}).then(ac.getArray).map(function(cx){return{State:!cx.isRunning,Name:cx.name,Path:cx.exePath,LastExec:cx.lastRunTime?1000*(cx.lastRunTime+cw*60):"N/A",Type:cx.type,Owner:cx.creator}
})},bE.thrown(ao("Not supported",-2147024894))).caught(function(cv){ag("getSchedulerTasks()",cv);return av(bX).truth(function(){return aq(bX,"/Query /FO CSV /V",{charset:866,testName:"Antivirus"}).truth(w,bn)
},"noschtasks").caught(function(cw){be.debug("Не удалось получить список задач планировщика",cw);return ap})}).then(function(cv){if(cv instanceof Array){bU=cv;
bT=bU.length>0;if(bT){bU.sort(X)}}else{bV=cv;bW=(a8&&("noschtasks"===cv))?-1:2}}).caught(function(cv){bV=ap;be.error("Ошибка чтения информации о задачах",cv)
})}).fork(br,function(){if(!cg.avAvastHttps&&!cg.avAvastFound&&(I||(!aT&&!e))){return bM(aS,bK+"RemovalTools\\MRT\\","Version",a7).caught("").then(function(w){bi=w.toLowerCase()
})}return bn})}).then(function(){if(bp){ah.setValue("Antivirus/Autorun",l?m:p);aj.addFix(new ax("Antivirus.Autorun",{message:cc("Antivirus/Autorun"),order:40,script:1,priority:1,needadmin:(a2()||aN)?1:0,needrestart:0,fix:function(cC){var cA=0,cz="Ошибка отключения конфликтных программ в автозагрузке";
function cy(cO,cM,cF,cD){var cN="",cL=(cO&1),cJ=(cO&2),cK=(cO&4),cH=!!(cO&8),cI=(cO&16),cG=cJ?aS:aR,cE=cK?bO:bN;if(!cI){cN+=cJ?"комп.\\":"польз.\\";if(cL){cN+=(a7&&!cH)?"Wow6432Node\\":"";
cN+=cK?"RunOnce\\":"Run\\"}else{cN+="Пуск\\Автозагрузка\\"}}be.info("Отключение автозагрузки "+cN+cM+"...");if(cI){return bH(aS,i,cM.slice(-3),at)}return bE.fork(cF&&cF.length,function(){be.debug("Остановка процессов с PID "+cF.join(", ")+"...");
var cP=W(cD);return bE.each(cF,function(cQ){return aG(cQ).then(function(cS){if(!cS){be.debug("Процесс c PID "+cQ+" не найден.");return bn}var cR=W(cS.cmdLine),cU=cP===cR;
if(!cU){be.debug("Процесс "+cS.name+"(PID "+cQ+") имеет командную строку "+cR+", отличную от ожидаемой "+cP);return bn}try{cS.kill(0)}catch(cT){be.debug("Не удалось убить процесс встроенными методами, пробуем через taskkill",cT);
return ac.run(Q(bb.$System32,"taskkill.exe"),{args:" /PID "+cS.pid+" /T /F",wait:ce}).waitExit().then(function(cW){var cV=cW.exitCode();if(cV!==0){throw ao("Pid: "+cQ+", ActualCmdLine: "+cR+", ExpectedCmdLine: "+cP,cV)
}else{be.debug("Процесс успешно остановлен.")}})}return bn})}).caught(function(cQ){++cA;be.debug("Не удалось убить процессы, запущенные автозагрузкой "+cM,cQ)
})}).fork(!cL,function(){return av(Q(cJ?b5:b6),cM).truth(function(cQ,cP){be.debug("Удаляем файл автозапуска.");return cP.remove()},function(cQ,cP){be.debug('Файл уже удален: "'+cP.path+'"')
}).then(ce)}).lie(function(){return bM(cG,cE,cM,cH).then(function(cP){if(!cP||!cP.length){be.debug('Значение в реестре  "'+cM+'" не найдено');return at
}return ce}).truth(function(){be.debug("Удаляем значение в реестре для "+cM);return bH(cG,cE,cM,cH).then(function(){return bM(cG,cE,cM,cH).caught(bn)}).then(function(cP){if(cP&&cP.length){throw ao('Значение в реестре "'+cM+'" было востановлено после удаления',2)
}})})})}function cB(){return bE.each(x,function(cD){var cE=D[cD];return cy(cE.Flags,cE.Name,cE.PIDs,cE.CmdLine).caught(function(cF){if(!a0(cF)){++cA;be.debug("Не удалось отключить автозагрузку "+cE.Name,cF)
}})}).then(function(){return cC(0===cA)})}if(!aN||(!aP()&&!a3())){return cB()}var cx=x.join("/@#$/").replace(new RegExp('\\"',"g"),'^"');return bS('DeleteBadAutorun "'+cx+'"').then(function(cD){if(cD){be.debug("Конфликтные программы автозагрузки успешно отключены")
}else{be.debug(cz);++cA}}).caught(function(cD){be.debug(cz,cD);++cA}).then(cB)},test:function(cy){var cx=u?"cmtoff":"";cy.setMessage("Antivirus/Autorun",o,cx);
if(l&&o>0){aA(m,function(cz,cB){var cA=cz.Name,cC=0;if(h.test(cA)||aX(cz.CmdLine)){cC=2}else{if(J.test(cA)||a5(cz.CmdLine)){cC=1}}if(cC>0){cy.setMessage("Antivirus/Autorun/"+cB,cC)
}})}return u}}))}if(bv){ah.setValue("Antivirus/Services",bY?bZ:b2);aj.addFix(new ax("Antivirus.Services",{message:cc("Antivirus/Services"),order:30,script:1,priority:ak,needadmin:1,needrestart:1,fix:function(cy){function cx(cB,cA,cC){if(K[cA]||(cB&&K[cB])||aY(cB,cA,cC)){return cB||K[cA]||K[cB]
}return bn}function cz(cA){var cE=cA.Id,cB=cA.Name,cC,cD,cG;function cF(){return az(Q(cD,"SRTool~1")).truth(function(cH,cI){return cI.folders().each(function(cJ){var cK=Q(cJ,"uninstall.exe");
return av(cK).truth(function(){return bR(cK,{args:"/S",show:ce,wsWait:ce}).waitExit()})})}).then(at)}return av(cA.Path).then(function(cH,cI){cC=cI;cD=cC.folder;
cG=Q(cD,"uninstall.exe");if(cH&&cD&&cD.length){return ce}var cJ=cx(cE,cB,cC.path);if(!cJ){return at}return aH(cJ).truth(function(cK){return bE.when(cK.setDisable).then(function(cL){if(0!==cL){throw ao("Disable error",cL)
}if(!cK.running){return at}return bE.when(cK.stop).then(function(cM){if(0!==cM){throw ao("Stop error",cL)}return at})})},function(){be.debug('Ошибка отключения службы "'+cB+'" - служба не найдена')
}).caught(function(cK){if(aP()||a3()){return bS('StopService "'+cJ+'"').then(at)}be.error('Не удалось отключить службу "'+cB+'", но такой файл не существует',cK);
return at})}).truth(function(){be.info('Отключение службы "'+cB+'"...');var cH=cx(cE,cB,cC.path);if(cH){return aH(cH).truth(function(cI){return bE.when(cI.setDisable).then(function(cJ){if(0!==cJ){throw ao("Disable error",cJ)
}if(cI.running){return bE.when(cI.stop).then(function(cK){if(0!==cK){throw ao("Stop error",cK)}}).caught(function(cK){if(!cI.pid){throw cK}return aG(cI.pid).then(function(cL){return cL.kill()
})})}return at})},bE.thrown()).caught(function(cI){if(aP()||a3()){return bS('StopService "'+cH+'"')}be.error('Не удалось остановить или отключить службу "'+cB+'"',cI);
return at}).then(cF)}return ce}).truth(function(){return av(cG).truth(function(){return bR(cG,{args:"/S",admin:!ac.needAdmin(),show:ce,wsWait:ce}).waitExit().then(function(cI){var cH=cI.exitCode();
if(cH){throw ao("run() -> "+cH,cH)}}).caught(function(cH){be.error("Ошибка запуска деинсталлятора",cH)})},cF)}).timeout(10)}return bE.each(L,cz).then(function(){return cy(ce)
})},test:function(cy){var cz=(ap===b2),cA=cz?2:(L.length?(ak+1):-1),cx=L.length?"cmtoff":"";if(!cz&&!cn){cA=2;if(cx&&cx.length){cx="cmtoff2"}else{cx="instnotfound"
}}cy.setMessage("Antivirus/Services",cA,cx);aA(bZ,function(cC,cB){var cD=M[cC.Name];if(cD){cy.setMessage("Antivirus/Services/"+cB,cD)}});return L.length?(ak+1):0
}}))}if(bu){ah.setValue("Antivirus/ScheduledJobs",bT?bU:bV);aj.addFix(new ax("Antivirus.ScheduledJobs",{message:cc("Antivirus/ScheduledJobs"),priority:0,script:1,needadmin:1,order:51,fix:function(cB){var cy={},cz=[];
aA(N,function(cD){var cE=bU[cD].Name,cF=cE.toLowerCase();if(!cy[cF]){cy[cF]=ce;cz.push(cE)}});if(aP()||a3()){var cx=cz.join("/@#$/").replace(new RegExp('\\"',"g"),'^"');
return bS('DeleteBadTasks "'+cx+'"',ce).then(cB)}var cC={code:0,message:""},cA=function(cD){return function(){return bR(bX,{args:cD,show:at,wsWait:ce}).waitExit()
}};return bE.each(cz,function(cD){return bE.serial(cA('/End /TN "'+cD+'"'),cA('/Change /TN "'+cD+'" /DISABLE'),cA('/Delete /TN "'+cD+'" /F')).spread(function(cH,cI,cG){var cE=cG.exitCode();
if(0!==cE){var cF='Ошибка удаления задачи "'+cD+'", код ошибки '+cE;be.error(cF);cC={code:cE,message:cF}}})}).then(function(){return cB(cC)})},test:function(cx){if(bT){N=[];
aA(bU,function(cz,cy){var cA=cz.Path;if(cz.State&&aX(cA)){N.push(cy);bW=1}})}cx.setMessage("Antivirus/ScheduledJobs",bW);aA(N,function(cy){cx.setMessage("Antivirus/ScheduledJobs/"+cy,bW)
});return N.length?1:0}}))}if(br){var w=bh+"4/A/A/4AA524C6-239D-47FF-860B-5B397199CBF8/",cv=bh+"2/C/5/2C563B99-54D9-4D85-A82B-45D3CD2F53CE/",cw="Windows-KB890830"+(a7?"-x64":"")+"-V5.55.exe";
aj.addFix(new ax("Antivirus.Installed",{message:cc("Antivirus/Installed"),filename:cw,foreign:(a7?cv:w)+cw,localfile:cw,args:"/q",version:"3D287184-25B3-4DDC-ADD3-A93C626CD7EB",priority:0,needadmin:1,needreboot:0,order:90,fix:function(cz){var cx=this;
function cy(){function cB(cC){return bF(cC).then(function(cJ){var cG=-1,cH=new RegExp("Return\\s*code\\:\\s*(\\d+)","i"),cI="-------------------------------------",cE=cJ.lastIndexOf(cI);
cJ=cJ.slice(cE);if(cJ){be.debug(cJ+"\r\n"+cI)}var cD=cJ.lastIndexOf("Return");if(cD>=0){cJ=cJ.slice(cD);var cF=cH.exec(cJ);if(cF&&cF[1]){cG=Number(cF[1])
}}return cG})}var cA=Q(bb.$Windows,"debug\\mrt.log");return av(cA).truth(function(){return cB(cA).then(function(cC){switch(cC){case 0:case 4:case 6:be.debug("Утилита MRT была успешно выполнена с кодом "+cC);
return ce;case 1:case 2:case 3:case 7:be.debug("Ошибка выполнения утилиты MRT. Код "+cC);return at;case 8:case 10:case 12:case 13:be.debug("Утилита MRT была успешно выполнена с кодом "+cC+", нужна перезагрузка компьютера.");
cx.needreboot=1;return ce;case 9:case 11:be.debug("Ошибка выполнения утилиты MRT. Код "+cC+", нужна перезагрузка компьютера.");cx.needreboot=1;return at;
default:return at}})}).caught(function(cC){be.debug("Ошибка анализа лога MRT",cC);return at})}return cx.apply(function(cA){var cB=(cA&&!cA.code)?cy():cA;
return cz(cB)})},test:function(cA){var cx=this,cz="Antivirus/Installed";if(!cg.avAvastHttps&&!cg.avAvastFound&&(I||(!aT&&!e))){if(bi!==cx.version.toLowerCase()){cA.setMessage(cz,-1);
return 0}}var cB=(cg.avAvastHttps||cg.avAvastHardened||(ap==aV))?2:-1,cy=cg.avAvastHttps?"avastgost":(cg.avAvastHardened?"avasthard":"");cA.setMessage(cz,cB,cy);
return 0}}))}if(bo){if(!a){c=(ap===d)?2:1}ah.setValue("Antivirus/AllPrograms",a?b:d,c)}}).then(ce)};(function(a){a.SkbKontur.Help.profileId="24"})(window);
(function(b){var a=(b.SkbKontur.Help.Core||{}).vars||{};a.keAllLocale=1;a.fullIEUpdate=1;a.needUpdateCSPLicense=1;a.needInstallDateZone=1;a.onlyPriorityCompatMode=1
})(window);(function(a){((a.SkbKontur.Help.Core||{}).vars||{}).defaultParams={Windows:{DateZone:true,Kb2802968:true},CryptoPro:{CSPCarriers:true,CSPLicense:true,CSPRandom:true,CSPReaders:true,CSPVersion:true},Rutoken:{CertPropSvc:true,RtCOMLite:true,RutokenDevices:true,RutokenReadersCount:true,RutokenSupport:true,RutokenSupportFile:true,RutokenVersion:true,SmartCardsService:true,USBHubs:true},KonturExtern:{KonturToolbox2:true,LocalStorage:true,LocalStorageRegister:true,Toolbox2Register:true},IE:{AdditionalSettings:true,Addons:true,CompatMode:true,IEVersion:true,ParentalControl:true,Proxy:true,ReadTrustedSites:true,SyncMode:true,TrustedSettings:true,TrustedSites:true,UserAgent:true,WriteTrustedSites:true},OtherBrowsers:{},Certificates:{CACerts:true,Capicom:true,CertOIDUC:true,MyCertsTree:true,RootCerts:true},Antivirus:{AllPrograms:true,Autorun:true,Installed:true,Processes:true,Services:true,VirusCheck:true}}
})(window);