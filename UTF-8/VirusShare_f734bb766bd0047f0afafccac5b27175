//// JS compiled on Tue Mar 27 2018 13:48:15 GMT+0000 (UTC)
//// Git Repo:   https://git.chi.cleverbridge.com/client-sass-configs/1316-bullguard2017-plan
//// Git Branch: master
(function($){//////////////////////////////////////////////////////////////////
//////////THIS IS THE RESET JS
//The methods in this file will rarely need to change.
//The methods in this file are used universally to fix platform bugs or shortcomings
//these methods are called at the bottom of this file
//if a method is not needed then comment it out
//For full width checkouts you need to UNCOMMENT cbOntop.fullWidthGlobalizer
/////////////////////////////////////////////////////////////////

window.cbOntop = {};
// Change to true when debugging JS to disable try/catch. ALWAYS FALSE ON LIVE CARTS
cbOntop.debugging = false;


//////////////////////////////////////////////////////////////////
//////////INPUTS
/////////////////////////////////////////////////////////////////
/*
cbOntop.interactToPlaceholder = function () {
  var interact = $('div.interact');
  interact.each(function () {
    var label = $(this).find('label');
    var input = $(this).find('input.inputText');
    //in some browsers you can't have a ":before" on placeholders so instead of removing colon, change colon to asterisk
    var ua = navigator.userAgent;
    if ((ua.indexOf('Firefox') != -1) || (ua.indexOf("MSIE") != -1) || (ua.indexOf("Edge") != -1) || ua.match(/Trident.*rv[ :]*11\./) || (ua.toLowerCase().indexOf("safari/") !== -1 && ua.toLowerCase().indexOf("windows") !== -1 && ua.toLowerCase().indexOf("chrom") === -1)) {
      input.prop('placeholder', label.text().replace(':', ''));
    } else if (/Chrome/.test(ua)) {
      if (parseInt(ua.match(/Chrome\/([\d]+\.[\w])/)[1]) >= 49) {
        input.prop('placeholder', label.text().replace(':', ''));
      } else {
        input.prop('placeholder', label.text().replace(':', '').replace('*', ''));
      }
    } else {
      input.prop('placeholder', label.text().replace(':', '').replace('*', ''));
    }
  }); //end interacts
}; //end interact to Placeholder

*/

// Add checked class to active checkboxes
cbOntop.inputCheckedClass = function(){
  var input = $('input.inputCheckbox');

  //when page loads, add checked class to parent div based on value of checkbox
  input.each(function() {
    if ($(this).is(':checked')) {

      $(this).parent().addClass('checked');
      $(this).parent().parent().parent().parent().parent().addClass('checked');

    } else {
      $(this).parent().removeClass('checked');
      $(this).parent().parent().parent().parent().parent().removeClass('checked');
    }
  }); //end input each function

  //when checkbox is clicked, add a class to the parent div
  input.click(function() {
    $(this).parent().toggleClass('checked');
    $(this).parent().parent().parent().parent().parent().toggleClass('checked');
  });
};//end inputCheckedClass

//////////////////////////////////////////////////////////////////
//////////CART
////////////////////////////////////////////////////////////////

// Hide product actions when a quantity stepper is present in recommendations
cbOntop.hideActionsOnStepperProds = function () {
  var prodQuantity = $('li.cbCartItem div.cbProductQuantity');
  prodQuantity.each(function () {
    if ($(this).find('div.CBQuantityStepper').exists()) {
      $(this).closest('li.cbCartItem').find('div.cbProductAdd').css('display', 'none');
    }
  });
}; //end hide actions on stepper products

//Add boxshot class in order to style cart w/o box shots
cbOntop.boxShotClass = function () {
  if (!$('.cbCartItem div.cbProductImage img').exists()) {
    $('body').addClass('noBoxshots');
  }
}; //end box shot class

// Hide upper subsell if it contains no products
//pass in page on which function should execute
cbOntop.hideEmptyUppersubsell = function ($page) {
  if (!$('#cleverCart, #cleverCartReview').exists()) {
    return false;
  }
  if ($page.exists() || !$page) {
    var upperSubsell = $('.cbPositionUpperSubsell');
    upperSubsell.each(function () {
      if (!$(this).find('li').exists()) {
        $(this).closest(".cbPositionUpperSubsell").css("display", "none");
      }
    });
  }
}; //end hide empty upper subsell

// Eliminate the option to remove cart item when only one item is in the cart
cbOntop.hideRemoveOnSingleCartItem = function () {
  if ($('li.cbCartItem').length === 1) {
    $('div.cbProductActions').remove();
  }
}; //end hide remove on single cart item

// hide empty product info
cbOntop.hideEmptyProductInfo = function () {
  if ($('#cleverCart1, #cleverCartReview').exists()) {
    var productInfo = $('.cbProductInformation');
    productInfo.each(function () {
      if ($(this).height() < 11) {
        $(this).remove();
      }
    });
  }
}; //end hide empty product info

// hide empty included selection
cbOntop.hideEmptyIncludedSelection = function () {
  if ($('#cleverCart, #cleverCartReview').exists()) {
    var includedSelection = $('.cbIncludedSelection');
    includedSelection.each(function () {
      if (!$(this).find('div.CBProductSelections').exists()) {
        $(this).remove();
      }
    });
  }
}; //end hide empty included selection

// Move coupon after cart total
cbOntop.cartCouponAfterTotal = function ($couponContainer) {
  if ($couponContainer.exists() && $('div.cbCartTotals').exists()) {
    $couponContainer.insertAfter('div.cbCartTotals');
  }
}; //end move coupon after cart total

// Move actions under total       
cbOntop.cartActionsInTotal = function () {
  $('li.cbCartItem .cbProductActions').each(function () {
    $(this).closest('li.cbCartItem').find('div.cbProductTotalPrice').first().append($(this));
  });
}; //end move cart actions in total

// Allows for custom checkboxes in upper subsells
cbOntop.customCheckboxUppersubsell = function () {
  var upperCheck = $('div.cbPositionUpperSubsell input.inputCheckbox');
  upperCheck.each(function () {
    var checkID = $(this).attr('id');
    $('<label></label>').attr("for", checkID).insertBefore($(this).closest('li.cbCartItem').find('div.cbProductName'));
  });
}; //end upper subsell custom checkbox

// Add class if tax ID is accepted
cbOntop.detectSuccessfulTaxID = function () {
  var taxvalue = $('.taxExemptionDocument input.inputText').attr('value');
  if (taxvalue && !$('.taxExemptionDocument .interactField').hasClass('CBError')) {
    $('.cbVatBusinessNote').remove();
    $('.CBTaxExemption, .cbTaxExemption').html('<p class="cbTaxSuccess">' + taxvalue + '</p>');
  }
}; //end detect successful tax id


//////////////////////////////////////////////////////////////////
//////////PAYMENT
////////////////////////////////////////////////////////////////

cbOntop.paymentActiveClass = function () {
  function handleRadios() {
      if ($('#cleverPayment li.CBListItem input.inputRadio').exists()) {
        $('li.CBListItem', $('#cleverPayment')).each(function () {
          var radioInput = $(this).find('div.radio input.inputRadio');
          if (radioInput.prop('checked')) {
            $(this).addClass('CBpaymentActive');
          } else {
            $(this).removeClass('CBpaymentActive');
          }
        }); //end each list item
      } //end if payment radios
    } //end handle Radios
  handleRadios();
  $('li.CBListItem', $('#cleverPayment')).click(function () {
    handleRadios();
  });
}; //end payment active class


//////////////////////////////////////////////////////////////////
//////////REVIEW PAGE
////////////////////////////////////////////////////////////////

// Don't show products on review page if quantity = 0
cbOntop.hideUnselectedProductsOnReview = function (callback) {
  var productQuantity = $('.CBPagesalestaxreview div.cbProductQuantity span, .CBPagereview div.cbProductQuantity span');
  productQuantity.each(function () {
    if ($(this).text() == 0) {
      $(this).closest('li').remove();
    }
  });
  //hide wrapper AFTER products are removed
  callback();
}; //end hide unselected products on review


//////////////////////////////////////////////////////////////////
//////////GLOBALIZER
////////////////////////////////////////////////////////////////

cbOntop.fullWidthGlobalizer = function () {
  if ($('#cleverGlobalizer').exists()) {
    function placeGlobalizer() {
        var marginOffset = $('footer .sassRow').offset().left;
        var pageSidePadding = $('footer .sassRow').css('padding-left');
        if (marginOffset > 0) {
          $('#cleverGlobalizer').css('right', marginOffset);
        } else {
          $('#cleverGlobalizer').css('right', parseFloat(pageSidePadding));
        }
      } //end placeGlobalizer
    placeGlobalizer();
    $(window).resize(function () {
      cbOntop.utilities.debounce(placeGlobalizer, 100, true)();
    });
  } //end if globalizer
}; //end full width globalizer

cbOntop.hamburgerMenu = function ($container) {
  if ((!$('html.ie8').exists()) && ($('#cleverGlobalizer').exists())) {
    var body = $('body');
    var hamburgerMenu = $('#hamburgerMenu');
    $('#cleverGlobalizer').hide();
    //open switch area
    hamburgerMenu.click(function (e) {
      hamburgerMenu.toggleClass('active');
      $container.toggleClass('navActive');
      $('#cleverGlobalizer').toggle();
    });
  } else {
    //cancel media query because no globalizer
    $('body').addClass('noGlobalizer');
  } //end if/else

  function showGloblizer() {
    if (((!$('.tablet').exists()) && (!$('.mobile').exists()) && (window.innerWidth > 649)) && (!$('.navActive').exists())) {
      $('#cleverGlobalizer').show();
    } else if (((!$('.tablet').exists()) && (!$('.mobile').exists()) && (window.innerWidth > 649)) && ($('.navActive').exists())) {
      $('#cleverGlobalizer').show();
      $('.navActive').removeClass('navActive');
    }
    if ((window.innerWidth < 650 || ($('.tablet').exists()) || ($('.mobile').exists())) && (!$('.navActive').exists())) {
      $('#cleverGlobalizer').hide();
    } else if ((window.innerWidth < 650 || ($('.tablet').exists()) || ($('.mobile').exists())) && ($('.navActive').exists())) {
      $('#cleverGlobalizer').show();
    }
  } //end show globalizer
  showGloblizer();
  $(window).resize(function () {
    cbOntop.utilities.debounce(showGloblizer)();
  });
}; //end hamburgerMenu Globalizer


//////////////////////////////////////////////////////////////////
//////////LAYOUT
////////////////////////////////////////////////////////////////



// Sticky footer - using jquery makes it so that we don't have to change the height on window resize.. responsive baby!
cbOntop.stickyFooter = function () {
  $(window).resize(function () {
    var footerHeight = $('footer').outerHeight();
    var stickFooterPush = $('.push').height(footerHeight);
    $('.wrapper').css({
      'marginBottom': '-' + footerHeight + 'px'
    });
  });
  $(window).resize();
}; //end sticky footer

//Loading Animation
cbOntop.hideLoading = function() {
  $('#loading').remove();
  $('body').removeClass('loading');
};


//////////////////////////////////////////////////////////////////
//////////GENERAL AND MISCELLANEOUS
////////////////////////////////////////////////////////////////

// adds actual page to body
cbOntop.scopeClassToBody = function () {
  if ($('#cleverContent div.CBPage').exists()) {
    $('body').addClass($('#cleverContent div.CBPage').prop('class'));
  }
}; //end scope class to body

//Displays Order Steps on Appropriate Pages    
cbOntop.displayOrderSteps = function () {
  if ($('#cleverContent div.CBScopecheckout, #cleverContent div.CBScopeconfirmation').exists() && !$('.CBPagecrosssellingXad, .CBPageupselling').exists()) {
    $('aside.sassAsideTop').addClass('cbShowOrderSteps');
  }
  if ($('#cleverContent .CBPagesuccessQuote').exists()) {
    $('aside.sassAsideTop').removeClass('cbShowOrderSteps');
  }
  if ($('div.CBPage.CBScopecart.CBPagedefault').exists()) {
    $('.top.row').addClass('cbShowOrderSteps');
    $('#cleverOrderSteps').css('visibility', 'hidden');
  }
}; //end display order steps

//Add error class to recurring billing div
cbOntop.recurringBillingError = function () {
  if ($('#cleverAcceptRecurringBilling .messageError').exists()) {
    $('#cleverAcceptRecurringBilling').addClass('CBError');
  }
}; //end recurring billing error

// Add close button for mobile on price scale popup
cbOntop.priceScaleClose = function () {
  if($('.mobile').exists() || $('.tablet').exists()){
    $('a.CBProductPriceScalePopup').one("mouseenter", function(){
      $('#cleverLayerPopupPriceScale .CBFoot').click(function(){
        $('#cleverLayerPopupPriceScale').addClass('CBJSFold');
      }); 
    });
  }
}; //priceScaleClose

// SVG support in non-SVG browsers 
cbOntop.svgSupport = function () {
  if (document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image", "1.1")) {
    $('img[data-fallback=true]').each(function () {
      var src = $(this).prop('src').slice(0, -3);
      $(this).prop('src', src + 'png');
    });
  } //end if
}; //end svgSupport

// Change cbOntop.debugging (at top of 1cleverReset.js )to true when debugging JS to disable try/catch
// ALWAYS FALSE ON LIVE CARTS
cbOntop.tryCatch = function (fn, args) {
  if(args == null){args = []};
  if (cbOntop.debugging) {
    fn.apply(null, args);
  } else {
    try {
      fn.apply(null, args);
    } catch (e) {}
  }
}; //end try/catch


$(document).ready(function () {

  // move security seals on the same level with next button in cart
  $('.money_back').insertAfter('.CBScopecheckout #cleverSubmitNext, .CBScopecheckout #cleverSubmitPurchase, .CBScopecart #cleverSubmitNext');

  //////////////////////////////////////////////////////////////////
  //////////GENERAL AND MISCELLANEOUS
  ////////////////////////////////////////////////////////////////

  //take scope and page specific classes from cleverContent and add to body
  cbOntop.tryCatch(cbOntop.scopeClassToBody);

  //show or hide order steps on specific pages
  cbOntop.tryCatch(cbOntop.displayOrderSteps);

  //add class if there is no box shot
  cbOntop.tryCatch(cbOntop.boxShotClass);

  //fix recurring billing block error state
  cbOntop.tryCatch(cbOntop.recurringBillingError);

  // Add close button for mobile on price scale popup
  cbOntop.tryCatch(cbOntop.priceScaleClose);

  // Uncomment for SVG support in non-SVG browsers 
  // data-fallback="true" must be added in the HTML for all SVGs that need to be replaced
  // SVG & corresponding PNG must have same file name
  // cbOntop.tryCatch(cbOntop.svgSupport);    


  //////////////////////////////////////////////////////////////////
  //////////INPUTS
  /////////////////////////////////////////////////////////////////

  //change input labels to placeholders
  cbOntop.tryCatch(cbOntop.interactToPlaceholder);

  //add checked class to active input.inputCheckbox
  cbOntop.tryCatch(cbOntop.inputCheckedClass);


  //////////////////////////////////////////////////////////////////
  //////////CART
  ////////////////////////////////////////////////////////////////

  // Hide product actions when a quantity stepper is present in recommendations
  cbOntop.tryCatch(cbOntop.hideActionsOnStepperProds);

  //Add boxshot class in order to style cart w/o box shots
  cbOntop.tryCatch(cbOntop.boxShotClass);

  // Hide upper subsell if it contains no products
  cbOntop.tryCatch(cbOntop.hideEmptyUppersubsell, [$('div.CBPage').not($('.CBPagereview'))]);

  // Eliminate the option to remove cart item when only one item is in the cart
  cbOntop.tryCatch(cbOntop.hideRemoveOnSingleCartItem);

  // hide empty product info
  cbOntop.tryCatch(cbOntop.hideEmptyProductInfo);

  // Hide included selection if it contains no products
  cbOntop.tryCatch(cbOntop.hideEmptyIncludedSelection);

  // Move coupon after cart total
  cbOntop.tryCatch(cbOntop.cartCouponAfterTotal, [$('#cleverCoupon')]);

  // Move actions under total       
  cbOntop.tryCatch(cbOntop.cartActionsInTotal);

  // Allows for custom checkboxes in upper subsells
  cbOntop.tryCatch(cbOntop.customCheckboxUppersubsell);

  // Add class if tax ID is accepted
  cbOntop.tryCatch(cbOntop.detectSuccessfulTaxID);


  //////////////////////////////////////////////////////////////////
  //////////PAYMENT
  ////////////////////////////////////////////////////////////////

  //add active class to list item when radio payment option selected
  cbOntop.tryCatch(cbOntop.paymentActiveClass);


  //////////////////////////////////////////////////////////////////
  //////////REVIEW PAGE
  ////////////////////////////////////////////////////////////////

  //Don't show products on review page if quantity = 0
  cbOntop.tryCatch(cbOntop.hideUnselectedProductsOnReview, [function(){cbOntop.hideEmptyUppersubsell($('.CBPagereview, .CBPagesalestaxreview'))}]);

  //equal height of blocks on review page
  //pass selector for blocks in as argument
  var equalReviewDivs = $('#cleverBillingAddContact, #cleverAffiliateContactReview, #cleverAffiliateAccountReview, #cleverBillingReview, #cleverLicenseeReview, #cleverReviewNewAffiliateLogin');
  cbOntop.tryCatch(cbOntop.utilities.equalBlocks, [equalReviewDivs]);



  //////////////////////////////////////////////////////////////////
  //////////GLOBALIZER
  ////////////////////////////////////////////////////////////////

  //uncomment this if you are making a full width config
  //aligns globalizer
  // cbOntop.tryCatch(cbOntop.fullWidthGlobalizer);

  //pass container for nav as argument
  cbOntop.tryCatch(cbOntop.hamburgerMenu, [$('header')]);


  //////////////////////////////////////////////////////////////////
  //////////LAYOUT
  ////////////////////////////////////////////////////////////////

  // Sticky footer - using jquery makes it so that we don't have to change the height on window resize
  cbOntop.tryCatch(cbOntop.stickyFooter);




}); //end document ready
/* Chosen v1.4.2 | (c) 2011-2015 by Harvest | MIT License, https://github.com/harvesthq/chosen/blob/master/LICENSE.md */
/* Modified to work with jQuery 1.12 according to https://github.com/harvesthq/chosen/issues/2506 */

// Chosen jquery - no ie8/ie7
// if not ie8 and jQuery version === 1.12.0 OR 2.2.0
if($('html.ie8').length === 0 && jQuery.fn.jquery === '1.12.0' || jQuery.fn.jquery === '2.2.0'){
	(function(){var a,b,c,d,e,f={}.hasOwnProperty,g=function(a,b){function d(){this.constructor=a}for(var c in b)f.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};d=function(){function a(){this.options_index=0,this.parsed=[]}return a.prototype.add_node=function(a){return"OPTGROUP"===a.nodeName.toUpperCase()?this.add_group(a):this.add_option(a)},a.prototype.add_group=function(a){var b,c,d,e,f,g;for(b=this.parsed.length,this.parsed.push({array_index:b,group:!0,label:this.escapeExpression(a.label),title:a.title?a.title:void 0,children:0,disabled:a.disabled,classes:a.className}),f=a.childNodes,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(this.add_option(c,b,a.disabled));return g},a.prototype.add_option=function(a,b,c){return"OPTION"===a.nodeName.toUpperCase()?(""!==a.text?(null!=b&&(this.parsed[b].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:a.value,text:a.text,html:a.innerHTML,title:a.title?a.title:void 0,selected:a.selected,disabled:c===!0?c:a.disabled,group_array_index:b,group_label:null!=b?this.parsed[b].label:null,classes:a.className,style:a.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1):void 0},a.prototype.escapeExpression=function(a){var b,c;return null==a||a===!1?"":/[\&\<\>\"\'\`]/.test(a)?(b={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},c=/&(?!\w+;)|[\<\>\"\'\`]/g,a.replace(c,function(a){return b[a]||"&amp;"})):a},a}(),d.select_to_array=function(a){var b,c,e,f,g;for(c=new d,g=a.childNodes,e=0,f=g.length;f>e;e++)b=g[e],c.add_node(b);return c.parsed},b=function(){function a(b,c){this.form_field=b,this.options=null!=c?c:{},a.browser_is_supported()&&(this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers(),this.on_ready())}return a.prototype.set_default_values=function(){var a=this;return this.click_test_action=function(b){return a.test_active_click(b)},this.activate_action=function(b){return a.activate_field(b)},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text?this.options.allow_single_deselect:!1,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=null!=this.options.enable_split_word_search?this.options.enable_split_word_search:!0,this.group_search=null!=this.options.group_search?this.options.group_search:!0,this.search_contains=this.options.search_contains||!1,this.single_backstroke_delete=null!=this.options.single_backstroke_delete?this.options.single_backstroke_delete:!0,this.max_selected_options=this.options.max_selected_options||1/0,this.inherit_select_classes=this.options.inherit_select_classes||!1,this.display_selected_options=null!=this.options.display_selected_options?this.options.display_selected_options:!0,this.display_disabled_options=null!=this.options.display_disabled_options?this.options.display_disabled_options:!0,this.include_group_label_in_selected=this.options.include_group_label_in_selected||!1},a.prototype.set_default_text=function(){return this.form_field.getAttribute("data-placeholder")?this.default_text=this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||a.default_multiple_text:this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||a.default_single_text,this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||a.default_no_result_text},a.prototype.choice_label=function(a){return this.include_group_label_in_selected&&null!=a.group_label?"<b class='group-name'>"+a.group_label+"</b>"+a.html:a.html},a.prototype.mouse_enter=function(){return this.mouse_on_container=!0},a.prototype.mouse_leave=function(){return this.mouse_on_container=!1},a.prototype.input_focus=function(a){var b=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return b.container_mousedown()},50)}else if(!this.active_field)return this.activate_field()},a.prototype.input_blur=function(a){var b=this;return this.mouse_on_container?void 0:(this.active_field=!1,setTimeout(function(){return b.blur_test()},100))},a.prototype.results_option_build=function(a){var b,c,d,e,f;for(b="",f=this.results_data,d=0,e=f.length;e>d;d++)c=f[d],b+=c.group?this.result_add_group(c):this.result_add_option(c),(null!=a?a.first:void 0)&&(c.selected&&this.is_multiple?this.choice_build(c):c.selected&&!this.is_multiple&&this.single_set_selected_text(this.choice_label(c)));return b},a.prototype.result_add_option=function(a){var b,c;return a.search_match&&this.include_option_in_results(a)?(b=[],a.disabled||a.selected&&this.is_multiple||b.push("active-result"),!a.disabled||a.selected&&this.is_multiple||b.push("disabled-result"),a.selected&&b.push("result-selected"),null!=a.group_array_index&&b.push("group-option"),""!==a.classes&&b.push(a.classes),c=document.createElement("li"),c.className=b.join(" "),c.style.cssText=a.style,c.setAttribute("data-option-array-index",a.array_index),c.innerHTML=a.search_text,a.title&&(c.title=a.title),this.outerHTML(c)):""},a.prototype.result_add_group=function(a){var b,c;return(a.search_match||a.group_match)&&a.active_options>0?(b=[],b.push("group-result"),a.classes&&b.push(a.classes),c=document.createElement("li"),c.className=b.join(" "),c.innerHTML=a.search_text,a.title&&(c.title=a.title),this.outerHTML(c)):""},a.prototype.results_update_field=function(){return this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.results_build(),this.results_showing?this.winnow_results():void 0},a.prototype.reset_single_select_options=function(){var a,b,c,d,e;for(d=this.results_data,e=[],b=0,c=d.length;c>b;b++)a=d[b],a.selected?e.push(a.selected=!1):e.push(void 0);return e},a.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},a.prototype.results_search=function(a){return this.results_showing?this.winnow_results():this.results_show()},a.prototype.winnow_results=function(){var a,b,c,d,e,f,g,h,i,j,k,l;for(this.no_results_clear(),d=0,f=this.get_search_text(),a=f.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),i=new RegExp(a,"i"),c=this.get_search_regex(a),l=this.results_data,j=0,k=l.length;k>j;j++)b=l[j],b.search_match=!1,e=null,this.include_option_in_results(b)&&(b.group&&(b.group_match=!1,b.active_options=0),null!=b.group_array_index&&this.results_data[b.group_array_index]&&(e=this.results_data[b.group_array_index],0===e.active_options&&e.search_match&&(d+=1),e.active_options+=1),b.search_text=b.group?b.label:b.html,(!b.group||this.group_search)&&(b.search_match=this.search_string_match(b.search_text,c),b.search_match&&!b.group&&(d+=1),b.search_match?(f.length&&(g=b.search_text.search(i),h=b.search_text.substr(0,g+f.length)+"</em>"+b.search_text.substr(g+f.length),b.search_text=h.substr(0,g)+"<em>"+h.substr(g)),null!=e&&(e.group_match=!0)):null!=b.group_array_index&&this.results_data[b.group_array_index].search_match&&(b.search_match=!0)));return this.result_clear_highlight(),1>d&&f.length?(this.update_results_content(""),this.no_results(f)):(this.update_results_content(this.results_option_build()),this.winnow_results_set_highlight())},a.prototype.get_search_regex=function(a){var b;return b=this.search_contains?"":"^",new RegExp(b+a,"i")},a.prototype.search_string_match=function(a,b){var c,d,e,f;if(b.test(a))return!0;if(this.enable_split_word_search&&(a.indexOf(" ")>=0||0===a.indexOf("["))&&(d=a.replace(/\[|\]/g,"").split(" "),d.length))for(e=0,f=d.length;f>e;e++)if(c=d[e],b.test(c))return!0},a.prototype.choices_count=function(){var a,b,c,d;if(null!=this.selected_option_count)return this.selected_option_count;for(this.selected_option_count=0,d=this.form_field.options,b=0,c=d.length;c>b;b++)a=d[b],a.selected&&(this.selected_option_count+=1);return this.selected_option_count},a.prototype.choices_click=function(a){return a.preventDefault(),this.results_showing||this.is_disabled?void 0:this.results_show()},a.prototype.keyup_checker=function(a){var b,c;switch(b=null!=(c=a.which)?c:a.keyCode,this.search_field_scale(),b){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:if(a.preventDefault(),this.results_showing)return this.result_select(a);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},a.prototype.clipboard_event_checker=function(a){var b=this;return setTimeout(function(){return b.results_search()},50)},a.prototype.container_width=function(){return null!=this.options.width?this.options.width:""+this.form_field.offsetWidth+"px"},a.prototype.include_option_in_results=function(a){return this.is_multiple&&!this.display_selected_options&&a.selected?!1:!this.display_disabled_options&&a.disabled?!1:a.empty?!1:!0},a.prototype.search_results_touchstart=function(a){return this.touch_started=!0,this.search_results_mouseover(a)},a.prototype.search_results_touchmove=function(a){return this.touch_started=!1,this.search_results_mouseout(a)},a.prototype.search_results_touchend=function(a){return this.touch_started?this.search_results_mouseup(a):void 0},a.prototype.outerHTML=function(a){var b;return a.outerHTML?a.outerHTML:(b=document.createElement("div"),b.appendChild(a),b.innerHTML)},a.browser_is_supported=function(){return"Microsoft Internet Explorer"===window.navigator.appName?document.documentMode>=8:/iP(od|hone)/i.test(window.navigator.userAgent)?!1:/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)?!1:!0},a.default_multiple_text="Select Some Options",a.default_single_text="Select an Option",a.default_no_result_text="No results match",a}(),a=jQuery,a.fn.extend({chosen:function(d){return b.browser_is_supported()?this.each(function(b){var e,f;e=a(this),f=e.data("chosen"),"destroy"===d&&f instanceof c?f.destroy():f instanceof c||e.data("chosen",new c(this,d))}):this}}),c=function(b){function c(){return e=c.__super__.constructor.apply(this,arguments)}return g(c,b),c.prototype.setup=function(){return this.form_field_jq=a(this.form_field),this.current_selectedIndex=this.form_field.selectedIndex,this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")},c.prototype.set_up_html=function(){var b,c;return b=["chosen-container"],b.push("chosen-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&b.push(this.form_field.className),this.is_rtl&&b.push("chosen-rtl"),c={"class":b.join(" "),style:"width: "+this.container_width()+";",title:this.form_field.title},this.form_field.id.length&&(c.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"),this.container=a("<div />",c),this.is_multiple?this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>'):this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>'),this.form_field_jq.hide().after(this.container),this.dropdown=this.container.find("div.chosen-drop").first(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chosen-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first()),this.results_build(),this.set_tab_index(),this.set_label_behavior()},c.prototype.on_ready=function(){return this.form_field_jq.trigger("chosen:ready",{chosen:this})},c.prototype.register_observers=function(){var a=this;return this.container.bind("touchstart.chosen",function(b){return a.container_mousedown(b),b.preventDefault()}),this.container.bind("touchend.chosen",function(b){return a.container_mouseup(b),b.preventDefault()}),this.container.bind("mousedown.chosen",function(b){a.container_mousedown(b)}),this.container.bind("mouseup.chosen",function(b){a.container_mouseup(b)}),this.container.bind("mouseenter.chosen",function(b){a.mouse_enter(b)}),this.container.bind("mouseleave.chosen",function(b){a.mouse_leave(b)}),this.search_results.bind("mouseup.chosen",function(b){a.search_results_mouseup(b)}),this.search_results.bind("mouseover.chosen",function(b){a.search_results_mouseover(b)}),this.search_results.bind("mouseout.chosen",function(b){a.search_results_mouseout(b)}),this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(b){a.search_results_mousewheel(b)}),this.search_results.bind("touchstart.chosen",function(b){a.search_results_touchstart(b)}),this.search_results.bind("touchmove.chosen",function(b){a.search_results_touchmove(b)}),this.search_results.bind("touchend.chosen",function(b){a.search_results_touchend(b)}),this.form_field_jq.bind("chosen:updated.chosen",function(b){a.results_update_field(b)}),this.form_field_jq.bind("chosen:activate.chosen",function(b){a.activate_field(b)}),this.form_field_jq.bind("chosen:open.chosen",function(b){a.container_mousedown(b)}),this.form_field_jq.bind("chosen:close.chosen",function(b){a.input_blur(b)}),this.search_field.bind("blur.chosen",function(b){a.input_blur(b)}),this.search_field.bind("keyup.chosen",function(b){a.keyup_checker(b)}),this.search_field.bind("keydown.chosen",function(b){a.keydown_checker(b)}),this.search_field.bind("focus.chosen",function(b){a.input_focus(b)}),this.search_field.bind("cut.chosen",function(b){a.clipboard_event_checker(b)}),this.search_field.bind("paste.chosen",function(b){a.clipboard_event_checker(b)}),this.is_multiple?this.search_choices.bind("click.chosen",function(b){a.choices_click(b)}):this.container.bind("click.chosen",function(a){a.preventDefault()})},c.prototype.destroy=function(){return a(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.search_field[0].tabIndex&&(this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex),this.container.remove(),this.form_field_jq.removeData("chosen"),this.form_field_jq.show()},c.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field_jq[0].disabled,this.is_disabled?(this.container.addClass("chosen-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus.chosen",this.activate_action),this.close_field()):(this.container.removeClass("chosen-disabled"),this.search_field[0].disabled=!1,this.is_multiple?void 0:this.selected_item.bind("focus.chosen",this.activate_action))},c.prototype.container_mousedown=function(b){return this.is_disabled||(b&&"mousedown"===b.type&&!this.results_showing&&b.preventDefault(),null!=b&&a(b.target).hasClass("search-choice-close"))?void 0:(this.active_field?this.is_multiple||!b||a(b.target)[0]!==this.selected_item[0]&&!a(b.target).parents("a.chosen-single").length||(b.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),a(this.container[0].ownerDocument).bind("click.chosen",this.click_test_action),this.results_show()),this.activate_field())},c.prototype.container_mouseup=function(a){return"ABBR"!==a.target.nodeName||this.is_disabled?void 0:this.results_reset(a)},c.prototype.search_results_mousewheel=function(a){var b;return a.originalEvent&&(b=a.originalEvent.deltaY||-a.originalEvent.wheelDelta||a.originalEvent.detail),null!=b?(a.preventDefault(),"DOMMouseScroll"===a.type&&(b=40*b),this.search_results.scrollTop(b+this.search_results.scrollTop())):void 0},c.prototype.blur_test=function(a){return!this.active_field&&this.container.hasClass("chosen-container-active")?this.close_field():void 0},c.prototype.close_field=function(){return a(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chosen-container-active"),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},c.prototype.activate_field=function(){return this.container.addClass("chosen-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},c.prototype.test_active_click=function(b){var c;return c=a(b.target).closest(".chosen-container"),c.length&&this.container[0]===c[0]?this.active_field=!0:this.close_field()},c.prototype.results_build=function(){return this.parsing=!0,this.selected_option_count=null,this.results_data=d.select_to_array(this.form_field),this.is_multiple?this.search_choices.find("li.search-choice").remove():this.is_multiple||(this.single_set_selected_text(),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?(this.search_field[0].readOnly=!0,this.container.addClass("chosen-container-single-nosearch")):(this.search_field[0].readOnly=!1,this.container.removeClass("chosen-container-single-nosearch"))),this.update_results_content(this.results_option_build({first:!0})),this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.parsing=!1},c.prototype.result_do_highlight=function(a){var b,c,d,e,f;if(a.length){if(this.result_clear_highlight(),this.result_highlight=a,this.result_highlight.addClass("highlighted"),d=parseInt(this.search_results.css("maxHeight"),10),f=this.search_results.scrollTop(),e=d+f,c=this.result_highlight.position().top,b=c+this.result_highlight.outerHeight(),b>=e)return this.search_results.scrollTop(b-d>0?b-d:0);if(f>c)return this.search_results.scrollTop(c)}},c.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},c.prototype.results_show=function(){return this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.container.addClass("chosen-with-drop"),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results(),this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this}))},c.prototype.update_results_content=function(a){return this.search_results.html(a)},c.prototype.results_hide=function(){return this.results_showing&&(this.result_clear_highlight(),this.container.removeClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})),this.results_showing=!1},c.prototype.set_tab_index=function(a){var b;return this.form_field.tabIndex?(b=this.form_field.tabIndex,this.form_field.tabIndex=-1,this.search_field[0].tabIndex=b):void 0},c.prototype.set_label_behavior=function(){var b=this;return this.form_field_label=this.form_field_jq.parents("label"),!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=a("label[for='"+this.form_field.id+"']")),this.form_field_label.length>0?this.form_field_label.bind("click.chosen",function(a){return b.is_multiple?b.container_mousedown(a):b.activate_field()}):void 0},c.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices_count()<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},c.prototype.search_results_mouseup=function(b){var c;return c=a(b.target).hasClass("active-result")?a(b.target):a(b.target).parents(".active-result").first(),c.length?(this.result_highlight=c,this.result_select(b),this.search_field.focus()):void 0},c.prototype.search_results_mouseover=function(b){var c;return c=a(b.target).hasClass("active-result")?a(b.target):a(b.target).parents(".active-result").first(),c?this.result_do_highlight(c):void 0},c.prototype.search_results_mouseout=function(b){return a(b.target).hasClass("active-result")?this.result_clear_highlight():void 0},c.prototype.choice_build=function(b){var c,d,e=this;return c=a("<li />",{"class":"search-choice"}).html("<span>"+this.choice_label(b)+"</span>"),b.disabled?c.addClass("search-choice-disabled"):(d=a("<a />",{"class":"search-choice-close","data-option-array-index":b.array_index}),d.bind("click.chosen",function(a){return e.choice_destroy_link_click(a)}),c.append(d)),this.search_container.before(c)},c.prototype.choice_destroy_link_click=function(b){return b.preventDefault(),b.stopPropagation(),this.is_disabled?void 0:this.choice_destroy(a(b.target))},c.prototype.choice_destroy=function(a){return this.result_deselect(a[0].getAttribute("data-option-array-index"))?(this.show_search_field_default(),this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1&&this.results_hide(),a.parents("li").first().remove(),this.search_field_scale()):void 0},c.prototype.results_reset=function(){return this.reset_single_select_options(),this.form_field.options[0].selected=!0,this.single_set_selected_text(),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change"),this.active_field?this.results_hide():void 0},c.prototype.results_reset_cleanup=function(){return this.current_selectedIndex=this.form_field.selectedIndex,this.selected_item.find("abbr").remove()},c.prototype.result_select=function(a){var b,c;return this.result_highlight?(b=this.result_highlight,this.result_clear_highlight(),this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.is_multiple?b.removeClass("active-result"):this.reset_single_select_options(),b.addClass("result-selected"),c=this.results_data[b[0].getAttribute("data-option-array-index")],c.selected=!0,this.form_field.options[c.options_index].selected=!0,this.selected_option_count=null,this.is_multiple?this.choice_build(c):this.single_set_selected_text(this.choice_label(c)),(a.metaKey||a.ctrlKey)&&this.is_multiple||this.results_hide(),this.search_field.val(""),(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[c.options_index].value}),this.current_selectedIndex=this.form_field.selectedIndex,a.preventDefault(),this.search_field_scale())):void 0},c.prototype.single_set_selected_text=function(a){return null==a&&(a=this.default_text),a===this.default_text?this.selected_item.addClass("chosen-default"):(this.single_deselect_control_build(),this.selected_item.removeClass("chosen-default")),this.selected_item.find("span").html(a)},c.prototype.result_deselect=function(a){var b;return b=this.results_data[a],this.form_field.options[b.options_index].disabled?!1:(b.selected=!1,this.form_field.options[b.options_index].selected=!1,this.selected_option_count=null,this.result_clear_highlight(),this.results_showing&&this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[b.options_index].value}),this.search_field_scale(),!0)},c.prototype.single_deselect_control_build=function(){return this.allow_single_deselect?(this.selected_item.find("abbr").length||this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'),this.selected_item.addClass("chosen-single-with-deselect")):void 0},c.prototype.get_search_text=function(){return a("<div/>").text(a.trim(this.search_field.val())).html()},c.prototype.winnow_results_set_highlight=function(){var a,b;return b=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),a=b.length?b.first():this.search_results.find(".active-result").first(),null!=a?this.result_do_highlight(a):void 0},c.prototype.no_results=function(b){var c;return c=a('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),c.find("span").first().html(b),this.search_results.append(c),this.form_field_jq.trigger("chosen:no_results",{chosen:this})},c.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},c.prototype.keydown_arrow=function(){var a;return this.results_showing&&this.result_highlight?(a=this.result_highlight.nextAll("li.active-result").first())?this.result_do_highlight(a):void 0:this.results_show()},c.prototype.keyup_arrow=function(){var a;return this.results_showing||this.is_multiple?this.result_highlight?(a=this.result_highlight.prevAll("li.active-result"),a.length?this.result_do_highlight(a.first()):(this.choices_count()>0&&this.results_hide(),this.result_clear_highlight())):void 0:this.results_show()},c.prototype.keydown_backstroke=function(){var a;return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(a=this.search_container.siblings("li.search-choice").last(),a.length&&!a.hasClass("search-choice-disabled")?(this.pending_backstroke=a,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")):void 0)},c.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},c.prototype.keydown_checker=function(a){var b,c;switch(b=null!=(c=a.which)?c:a.keyCode,this.search_field_scale(),8!==b&&this.pending_backstroke&&this.clear_backstroke(),b){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(a),this.mouse_on_container=!1;break;case 13:this.results_showing&&a.preventDefault();break;case 32:this.disable_search&&a.preventDefault();break;case 38:a.preventDefault(),this.keyup_arrow();break;case 40:a.preventDefault(),this.keydown_arrow()}},c.prototype.search_field_scale=function(){var b,c,d,e,f,g,h,i,j;if(this.is_multiple){for(d=0,h=0,f="position:absolute; left: -1000px; top: -1000px; display:none;",g=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],i=0,j=g.length;j>i;i++)e=g[i],f+=e+":"+this.search_field.css(e)+";";return b=a("<div />",{style:f}),b.text(this.search_field.val()),a("body").append(b),h=b.width()+25,b.remove(),c=this.container.outerWidth(),h>c-10&&(h=c-10),this.search_field.css({width:h+"px"})}},c}(b)}).call(this);
} 
// if not ie8 and jQuery version is not 1.12.0 or 2.2.0
else if ($('html.ie8').length === 0){
  !function(){var a,AbstractChosen,Chosen,SelectParser,b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};SelectParser=function(){function SelectParser(){this.options_index=0,this.parsed=[]}return SelectParser.prototype.add_node=function(a){return"OPTGROUP"===a.nodeName.toUpperCase()?this.add_group(a):this.add_option(a)},SelectParser.prototype.add_group=function(a){var b,c,d,e,f,g;for(b=this.parsed.length,this.parsed.push({array_index:b,group:!0,label:this.escapeExpression(a.label),children:0,disabled:a.disabled}),f=a.childNodes,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(this.add_option(c,b,a.disabled));return g},SelectParser.prototype.add_option=function(a,b,c){return"OPTION"===a.nodeName.toUpperCase()?(""!==a.text?(null!=b&&(this.parsed[b].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:a.value,text:a.text,html:a.innerHTML,selected:a.selected,disabled:c===!0?c:a.disabled,group_array_index:b,classes:a.className,style:a.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1):void 0},SelectParser.prototype.escapeExpression=function(a){var b,c;return null==a||a===!1?"":/[\&\<\>\"\'\`]/.test(a)?(b={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},c=/&(?!\w+;)|[\<\>\"\'\`]/g,a.replace(c,function(a){return b[a]||"&amp;"})):a},SelectParser}(),SelectParser.select_to_array=function(a){var b,c,d,e,f;for(c=new SelectParser,f=a.childNodes,d=0,e=f.length;e>d;d++)b=f[d],c.add_node(b);return c.parsed},AbstractChosen=function(){function AbstractChosen(a,b){this.form_field=a,this.options=null!=b?b:{},AbstractChosen.browser_is_supported()&&(this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers())}return AbstractChosen.prototype.set_default_values=function(){var a=this;return this.click_test_action=function(b){return a.test_active_click(b)},this.activate_action=function(b){return a.activate_field(b)},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text?this.options.allow_single_deselect:!1,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=null!=this.options.enable_split_word_search?this.options.enable_split_word_search:!0,this.group_search=null!=this.options.group_search?this.options.group_search:!0,this.search_contains=this.options.search_contains||!1,this.single_backstroke_delete=null!=this.options.single_backstroke_delete?this.options.single_backstroke_delete:!0,this.max_selected_options=this.options.max_selected_options||1/0,this.inherit_select_classes=this.options.inherit_select_classes||!1,this.display_selected_options=null!=this.options.display_selected_options?this.options.display_selected_options:!0,this.display_disabled_options=null!=this.options.display_disabled_options?this.options.display_disabled_options:!0},AbstractChosen.prototype.set_default_text=function(){return this.default_text=this.form_field.getAttribute("data-placeholder")?this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.options.placeholder_text_multiple||this.options.placeholder_text||AbstractChosen.default_multiple_text:this.options.placeholder_text_single||this.options.placeholder_text||AbstractChosen.default_single_text,this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||AbstractChosen.default_no_result_text},AbstractChosen.prototype.mouse_enter=function(){return this.mouse_on_container=!0},AbstractChosen.prototype.mouse_leave=function(){return this.mouse_on_container=!1},AbstractChosen.prototype.input_focus=function(){var a=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return a.container_mousedown()},50)}else if(!this.active_field)return this.activate_field()},AbstractChosen.prototype.input_blur=function(){var a=this;return this.mouse_on_container?void 0:(this.active_field=!1,setTimeout(function(){return a.blur_test()},100))},AbstractChosen.prototype.results_option_build=function(a){var b,c,d,e,f;for(b="",f=this.results_data,d=0,e=f.length;e>d;d++)c=f[d],b+=c.group?this.result_add_group(c):this.result_add_option(c),(null!=a?a.first:void 0)&&(c.selected&&this.is_multiple?this.choice_build(c):c.selected&&!this.is_multiple&&this.single_set_selected_text(c.text));return b},AbstractChosen.prototype.result_add_option=function(a){var b,c;return a.search_match?this.include_option_in_results(a)?(b=[],a.disabled||a.selected&&this.is_multiple||b.push("active-result"),!a.disabled||a.selected&&this.is_multiple||b.push("disabled-result"),a.selected&&b.push("result-selected"),null!=a.group_array_index&&b.push("group-option"),""!==a.classes&&b.push(a.classes),c=document.createElement("li"),c.className=b.join(" "),c.style.cssText=a.style,c.setAttribute("data-option-array-index",a.array_index),c.innerHTML=a.search_text,this.outerHTML(c)):"":""},AbstractChosen.prototype.result_add_group=function(a){var b;return a.search_match||a.group_match?a.active_options>0?(b=document.createElement("li"),b.className="group-result",b.innerHTML=a.search_text,this.outerHTML(b)):"":""},AbstractChosen.prototype.results_update_field=function(){return this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.results_build(),this.results_showing?this.winnow_results():void 0},AbstractChosen.prototype.reset_single_select_options=function(){var a,b,c,d,e;for(d=this.results_data,e=[],b=0,c=d.length;c>b;b++)a=d[b],a.selected?e.push(a.selected=!1):e.push(void 0);return e},AbstractChosen.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},AbstractChosen.prototype.results_search=function(){return this.results_showing?this.winnow_results():this.results_show()},AbstractChosen.prototype.winnow_results=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;for(this.no_results_clear(),e=0,g=this.get_search_text(),a=g.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),d=this.search_contains?"":"^",c=new RegExp(d+a,"i"),j=new RegExp(a,"i"),m=this.results_data,k=0,l=m.length;l>k;k++)b=m[k],b.search_match=!1,f=null,this.include_option_in_results(b)&&(b.group&&(b.group_match=!1,b.active_options=0),null!=b.group_array_index&&this.results_data[b.group_array_index]&&(f=this.results_data[b.group_array_index],0===f.active_options&&f.search_match&&(e+=1),f.active_options+=1),(!b.group||this.group_search)&&(b.search_text=b.group?b.label:b.html,b.search_match=this.search_string_match(b.search_text,c),b.search_match&&!b.group&&(e+=1),b.search_match?(g.length&&(h=b.search_text.search(j),i=b.search_text.substr(0,h+g.length)+"</em>"+b.search_text.substr(h+g.length),b.search_text=i.substr(0,h)+"<em>"+i.substr(h)),null!=f&&(f.group_match=!0)):null!=b.group_array_index&&this.results_data[b.group_array_index].search_match&&(b.search_match=!0)));return this.result_clear_highlight(),1>e&&g.length?(this.update_results_content(""),this.no_results(g)):(this.update_results_content(this.results_option_build()),this.winnow_results_set_highlight())},AbstractChosen.prototype.search_string_match=function(a,b){var c,d,e,f;if(b.test(a))return!0;if(this.enable_split_word_search&&(a.indexOf(" ")>=0||0===a.indexOf("["))&&(d=a.replace(/\[|\]/g,"").split(" "),d.length))for(e=0,f=d.length;f>e;e++)if(c=d[e],b.test(c))return!0},AbstractChosen.prototype.choices_count=function(){var a,b,c,d;if(null!=this.selected_option_count)return this.selected_option_count;for(this.selected_option_count=0,d=this.form_field.options,b=0,c=d.length;c>b;b++)a=d[b],a.selected&&(this.selected_option_count+=1);return this.selected_option_count},AbstractChosen.prototype.choices_click=function(a){return a.preventDefault(),this.results_showing||this.is_disabled?void 0:this.results_show()},AbstractChosen.prototype.keyup_checker=function(a){var b,c;switch(b=null!=(c=a.which)?c:a.keyCode,this.search_field_scale(),b){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:if(a.preventDefault(),this.results_showing)return this.result_select(a);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},AbstractChosen.prototype.clipboard_event_checker=function(){var a=this;return setTimeout(function(){return a.results_search()},50)},AbstractChosen.prototype.container_width=function(){return null!=this.options.width?this.options.width:""+this.form_field.offsetWidth+"px"},AbstractChosen.prototype.include_option_in_results=function(a){return this.is_multiple&&!this.display_selected_options&&a.selected?!1:!this.display_disabled_options&&a.disabled?!1:a.empty?!1:!0},AbstractChosen.prototype.search_results_touchstart=function(a){return this.touch_started=!0,this.search_results_mouseover(a)},AbstractChosen.prototype.search_results_touchmove=function(a){return this.touch_started=!1,this.search_results_mouseout(a)},AbstractChosen.prototype.search_results_touchend=function(a){return this.touch_started?this.search_results_mouseup(a):void 0},AbstractChosen.prototype.outerHTML=function(a){var b;return a.outerHTML?a.outerHTML:(b=document.createElement("div"),b.appendChild(a),b.innerHTML)},AbstractChosen.browser_is_supported=function(){return"Microsoft Internet Explorer"===window.navigator.appName?document.documentMode>=8:/iP(od|hone)/i.test(window.navigator.userAgent)?!1:/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)?!1:!0},AbstractChosen.default_multiple_text="Select Some Options",AbstractChosen.default_single_text="Select an Option",AbstractChosen.default_no_result_text="No results match",AbstractChosen}(),a=jQuery,a.fn.extend({chosen:function(b){return AbstractChosen.browser_is_supported()?this.each(function(){var c,d;c=a(this),d=c.data("chosen"),"destroy"===b&&d?d.destroy():d||c.data("chosen",new Chosen(this,b))}):this}}),Chosen=function(c){function Chosen(){return b=Chosen.__super__.constructor.apply(this,arguments)}return d(Chosen,c),Chosen.prototype.setup=function(){return this.form_field_jq=a(this.form_field),this.current_selectedIndex=this.form_field.selectedIndex,this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")},Chosen.prototype.set_up_html=function(){var b,c;return b=["chosen-container"],b.push("chosen-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&b.push(this.form_field.className),this.is_rtl&&b.push("chosen-rtl"),c={"class":b.join(" "),style:"width: "+this.container_width()+";",title:this.form_field.title},this.form_field.id.length&&(c.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"),this.container=a("<div />",c),this.is_multiple?this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>'):this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>'),this.form_field_jq.hide().after(this.container),this.dropdown=this.container.find("div.chosen-drop").first(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chosen-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first()),this.results_build(),this.set_tab_index(),this.set_label_behavior(),this.form_field_jq.trigger("chosen:ready",{chosen:this})},Chosen.prototype.register_observers=function(){var a=this;return this.container.bind("mousedown.chosen",function(b){a.container_mousedown(b)}),this.container.bind("mouseup.chosen",function(b){a.container_mouseup(b)}),this.container.bind("mouseenter.chosen",function(b){a.mouse_enter(b)}),this.container.bind("mouseleave.chosen",function(b){a.mouse_leave(b)}),this.search_results.bind("mouseup.chosen",function(b){a.search_results_mouseup(b)}),this.search_results.bind("mouseover.chosen",function(b){a.search_results_mouseover(b)}),this.search_results.bind("mouseout.chosen",function(b){a.search_results_mouseout(b)}),this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(b){a.search_results_mousewheel(b)}),this.search_results.bind("touchstart.chosen",function(b){a.search_results_touchstart(b)}),this.search_results.bind("touchmove.chosen",function(b){a.search_results_touchmove(b)}),this.search_results.bind("touchend.chosen",function(b){a.search_results_touchend(b)}),this.form_field_jq.bind("chosen:updated.chosen",function(b){a.results_update_field(b)}),this.form_field_jq.bind("chosen:activate.chosen",function(b){a.activate_field(b)}),this.form_field_jq.bind("chosen:open.chosen",function(b){a.container_mousedown(b)}),this.form_field_jq.bind("chosen:close.chosen",function(b){a.input_blur(b)}),this.search_field.bind("blur.chosen",function(b){a.input_blur(b)}),this.search_field.bind("keyup.chosen",function(b){a.keyup_checker(b)}),this.search_field.bind("keydown.chosen",function(b){a.keydown_checker(b)}),this.search_field.bind("focus.chosen",function(b){a.input_focus(b)}),this.search_field.bind("cut.chosen",function(b){a.clipboard_event_checker(b)}),this.search_field.bind("paste.chosen",function(b){a.clipboard_event_checker(b)}),this.is_multiple?this.search_choices.bind("click.chosen",function(b){a.choices_click(b)}):this.container.bind("click.chosen",function(a){a.preventDefault()})},Chosen.prototype.destroy=function(){return a(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.search_field[0].tabIndex&&(this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex),this.container.remove(),this.form_field_jq.removeData("chosen"),this.form_field_jq.show()},Chosen.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field_jq[0].disabled,this.is_disabled?(this.container.addClass("chosen-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus.chosen",this.activate_action),this.close_field()):(this.container.removeClass("chosen-disabled"),this.search_field[0].disabled=!1,this.is_multiple?void 0:this.selected_item.bind("focus.chosen",this.activate_action))},Chosen.prototype.container_mousedown=function(b){return this.is_disabled||(b&&"mousedown"===b.type&&!this.results_showing&&b.preventDefault(),null!=b&&a(b.target).hasClass("search-choice-close"))?void 0:(this.active_field?this.is_multiple||!b||a(b.target)[0]!==this.selected_item[0]&&!a(b.target).parents("a.chosen-single").length||(b.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),a(this.container[0].ownerDocument).bind("click.chosen",this.click_test_action),this.results_show()),this.activate_field())},Chosen.prototype.container_mouseup=function(a){return"ABBR"!==a.target.nodeName||this.is_disabled?void 0:this.results_reset(a)},Chosen.prototype.search_results_mousewheel=function(a){var b;return a.originalEvent&&(b=-a.originalEvent.wheelDelta||a.originalEvent.detail),null!=b?(a.preventDefault(),"DOMMouseScroll"===a.type&&(b=40*b),this.search_results.scrollTop(b+this.search_results.scrollTop())):void 0},Chosen.prototype.blur_test=function(){return!this.active_field&&this.container.hasClass("chosen-container-active")?this.close_field():void 0},Chosen.prototype.close_field=function(){return a(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chosen-container-active"),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},Chosen.prototype.activate_field=function(){return this.container.addClass("chosen-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},Chosen.prototype.test_active_click=function(b){var c;return c=a(b.target).closest(".chosen-container"),c.length&&this.container[0]===c[0]?this.active_field=!0:this.close_field()},Chosen.prototype.results_build=function(){return this.parsing=!0,this.selected_option_count=null,this.results_data=SelectParser.select_to_array(this.form_field),this.is_multiple?this.search_choices.find("li.search-choice").remove():this.is_multiple||(this.single_set_selected_text(),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?(this.search_field[0].readOnly=!0,this.container.addClass("chosen-container-single-nosearch")):(this.search_field[0].readOnly=!1,this.container.removeClass("chosen-container-single-nosearch"))),this.update_results_content(this.results_option_build({first:!0})),this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.parsing=!1},Chosen.prototype.result_do_highlight=function(a){var b,c,d,e,f;if(a.length){if(this.result_clear_highlight(),this.result_highlight=a,this.result_highlight.addClass("highlighted"),d=parseInt(this.search_results.css("maxHeight"),10),f=this.search_results.scrollTop(),e=d+f,c=this.result_highlight.position().top+this.search_results.scrollTop(),b=c+this.result_highlight.outerHeight(),b>=e)return this.search_results.scrollTop(b-d>0?b-d:0);if(f>c)return this.search_results.scrollTop(c)}},Chosen.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},Chosen.prototype.results_show=function(){return this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.container.addClass("chosen-with-drop"),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results(),this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this}))},Chosen.prototype.update_results_content=function(a){return this.search_results.html(a)},Chosen.prototype.results_hide=function(){return this.results_showing&&(this.result_clear_highlight(),this.container.removeClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})),this.results_showing=!1},Chosen.prototype.set_tab_index=function(){var a;return this.form_field.tabIndex?(a=this.form_field.tabIndex,this.form_field.tabIndex=-1,this.search_field[0].tabIndex=a):void 0},Chosen.prototype.set_label_behavior=function(){var b=this;return this.form_field_label=this.form_field_jq.parents("label"),!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=a("label[for='"+this.form_field.id+"']")),this.form_field_label.length>0?this.form_field_label.bind("click.chosen",function(a){return b.is_multiple?b.container_mousedown(a):b.activate_field()}):void 0},Chosen.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices_count()<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},Chosen.prototype.search_results_mouseup=function(b){var c;return c=a(b.target).hasClass("active-result")?a(b.target):a(b.target).parents(".active-result").first(),c.length?(this.result_highlight=c,this.result_select(b),this.search_field.focus()):void 0},Chosen.prototype.search_results_mouseover=function(b){var c;return c=a(b.target).hasClass("active-result")?a(b.target):a(b.target).parents(".active-result").first(),c?this.result_do_highlight(c):void 0},Chosen.prototype.search_results_mouseout=function(b){return a(b.target).hasClass("active-result")?this.result_clear_highlight():void 0},Chosen.prototype.choice_build=function(b){var c,d,e=this;return c=a("<li />",{"class":"search-choice"}).html("<span>"+b.html+"</span>"),b.disabled?c.addClass("search-choice-disabled"):(d=a("<a />",{"class":"search-choice-close","data-option-array-index":b.array_index}),d.bind("click.chosen",function(a){return e.choice_destroy_link_click(a)}),c.append(d)),this.search_container.before(c)},Chosen.prototype.choice_destroy_link_click=function(b){return b.preventDefault(),b.stopPropagation(),this.is_disabled?void 0:this.choice_destroy(a(b.target))},Chosen.prototype.choice_destroy=function(a){return this.result_deselect(a[0].getAttribute("data-option-array-index"))?(this.show_search_field_default(),this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1&&this.results_hide(),a.parents("li").first().remove(),this.search_field_scale()):void 0},Chosen.prototype.results_reset=function(){return this.reset_single_select_options(),this.form_field.options[0].selected=!0,this.single_set_selected_text(),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change"),this.active_field?this.results_hide():void 0},Chosen.prototype.results_reset_cleanup=function(){return this.current_selectedIndex=this.form_field.selectedIndex,this.selected_item.find("abbr").remove()},Chosen.prototype.result_select=function(a){var b,c;return this.result_highlight?(b=this.result_highlight,this.result_clear_highlight(),this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.is_multiple?b.removeClass("active-result"):this.reset_single_select_options(),c=this.results_data[b[0].getAttribute("data-option-array-index")],c.selected=!0,this.form_field.options[c.options_index].selected=!0,this.selected_option_count=null,this.is_multiple?this.choice_build(c):this.single_set_selected_text(c.text),(a.metaKey||a.ctrlKey)&&this.is_multiple||this.results_hide(),this.search_field.val(""),(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[c.options_index].value}),this.current_selectedIndex=this.form_field.selectedIndex,this.search_field_scale())):void 0},Chosen.prototype.single_set_selected_text=function(a){return null==a&&(a=this.default_text),a===this.default_text?this.selected_item.addClass("chosen-default"):(this.single_deselect_control_build(),this.selected_item.removeClass("chosen-default")),this.selected_item.find("span").text(a)},Chosen.prototype.result_deselect=function(a){var b;return b=this.results_data[a],this.form_field.options[b.options_index].disabled?!1:(b.selected=!1,this.form_field.options[b.options_index].selected=!1,this.selected_option_count=null,this.result_clear_highlight(),this.results_showing&&this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[b.options_index].value}),this.search_field_scale(),!0)},Chosen.prototype.single_deselect_control_build=function(){return this.allow_single_deselect?(this.selected_item.find("abbr").length||this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'),this.selected_item.addClass("chosen-single-with-deselect")):void 0},Chosen.prototype.get_search_text=function(){return this.search_field.val()===this.default_text?"":a("<div/>").text(a.trim(this.search_field.val())).html()},Chosen.prototype.winnow_results_set_highlight=function(){var a,b;return b=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),a=b.length?b.first():this.search_results.find(".active-result").first(),null!=a?this.result_do_highlight(a):void 0},Chosen.prototype.no_results=function(b){var c;return c=a('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),c.find("span").first().html(b),this.search_results.append(c),this.form_field_jq.trigger("chosen:no_results",{chosen:this})},Chosen.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},Chosen.prototype.keydown_arrow=function(){var a;return this.results_showing&&this.result_highlight?(a=this.result_highlight.nextAll("li.active-result").first())?this.result_do_highlight(a):void 0:this.results_show()},Chosen.prototype.keyup_arrow=function(){var a;return this.results_showing||this.is_multiple?this.result_highlight?(a=this.result_highlight.prevAll("li.active-result"),a.length?this.result_do_highlight(a.first()):(this.choices_count()>0&&this.results_hide(),this.result_clear_highlight())):void 0:this.results_show()},Chosen.prototype.keydown_backstroke=function(){var a;return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(a=this.search_container.siblings("li.search-choice").last(),a.length&&!a.hasClass("search-choice-disabled")?(this.pending_backstroke=a,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")):void 0)},Chosen.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},Chosen.prototype.keydown_checker=function(a){var b,c;switch(b=null!=(c=a.which)?c:a.keyCode,this.search_field_scale(),8!==b&&this.pending_backstroke&&this.clear_backstroke(),b){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(a),this.mouse_on_container=!1;break;case 13:a.preventDefault();break;case 38:a.preventDefault(),this.keyup_arrow();break;case 40:a.preventDefault(),this.keydown_arrow()}},Chosen.prototype.search_field_scale=function(){var b,c,d,e,f,g,h,i,j;if(this.is_multiple){for(d=0,h=0,f="position:absolute; left: -1000px; top: -1000px; display:none;",g=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],i=0,j=g.length;j>i;i++)e=g[i],f+=e+":"+this.search_field.css(e)+";";return b=a("<div />",{style:f}),b.text(this.search_field.val()),a("body").append(b),h=b.width()+25,b.remove(),c=this.container.outerWidth(),h>c-10&&(h=c-10),this.search_field.css({width:h+"px"})}},Chosen}(AbstractChosen)}.call(this);
}
cbOntop.chosenSelects = {};

// Adds class to option, chosen then applies that class to the li
cbOntop.chosenSelects.globalizerClasses = function () {
  $("#cleverGlobalizerCurrency select option").each(function (i) {
    if ($(this).val() === '') {
      $(this).remove();
    }
    var optionValueCurr = $(this).val();
    $(this).addClass("cbCurr-" + optionValueCurr);
  });
  $("#cleverGlobalizerLanguage select option").each(function (i) {
    var optionValueLang = $(this).val();
    $(this).addClass("cbLang-" + optionValueLang);
  });
}; //end globalizerClasses

// Apply chosen to all selects
cbOntop.chosenSelects.initiateChosen = function () {
  $(".inputSelect").chosen({
    width: "100%",
    inherit_select_classes: true
  });
}; //end initiate chosen

// Chosen globalizer, drop down on hover
cbOntop.chosenSelects.globalizerChosenDropdown = function () {
  if ($('#cleverGlobalizer').exists()) {
    var chosenLang = $('#cleverGlobalizerLanguage select.inputSelect');
    var chosenCurr = $('#cleverGlobalizerCurrency select.inputSelect');
    chosenLang.chosen().next(".chosen-container").hover(function () {
      chosenLang.trigger("chosen:open");
      chosenLang.trigger("chosen:close");
    });
    chosenCurr.chosen().next(".chosen-container").hover(function () {
      chosenCurr.trigger("chosen:open");
      chosenCurr.trigger("chosen:close");
    });
  } //end if cleverGlobalizer
}; //end chosen globalizer drop on hover

$(document).ready(function () {
  if (!$('html.ie8').exists()&& !$('body.selectdropdown').exists() ) {
    if (!$('html.tablet').exists()) {
      // Adds class to option, chosen then applies that class to the li
      cbOntop.tryCatch(cbOntop.chosenSelects.globalizerClasses);

      // Apply chosen to all selects
      cbOntop.tryCatch(cbOntop.chosenSelects.initiateChosen);

      // Chosen globalizer, drop down on hover
      cbOntop.tryCatch(cbOntop.chosenSelects.globalizerChosenDropdown);

    } //end if tablet
  } //end if ie8
}); //end doc ready
 //////////////////////////////////////////////////////////////////
 //////////THIS SCRIPT CONVERTS ANYTHING TO A MODAL A.K.A. LIGHTBOX A.K.A. POPUP
 //Method calls at bottom of file
 //To make a new element into a modal: 
 //define options
 //pass optons to cbOntop.convertToModal.initialize
 /////////////////////////////////////////////////////////////////

 cbOntop.convertToModal = {};

 
 cbOntop.convertToModal.makeOverlay = function ($pageWrapper) {
   //if no argument passed as page wrapper then use body
   var $pageWrapper = $pageWrapper || $('body');
   var self = this;
   this.closer = jQuery('<div/>', {
     'class': 'CBClose',
     'text': "x"
   }).click(function (e) {
     self.close.call(self, e)
   });
   this.modalWrapper = jQuery('<div/>', {
     'class': 'CBOntopModal'
   });
   this.modal = jQuery('<div/>', {
     'class': 'CBOnTopOverlay',
   }).html(this.modalWrapper.append(this.closer)).click(function (e) {
     self.close.call(self, e)
   }).appendTo($pageWrapper);
 };

 cbOntop.convertToModal.close = function (e) {
   //event will be jQuery event object so it is normalized
   var target = e.target;
   e.stopPropagation();
   //don't close if element or modal was clicked
   if ((this.modalWrapper.find(target).length === 0 && !this.modalWrapper.is(target)) || $(target).hasClass('CBClose')) {
     //if there is an input with an error then reset content of input on close and remove error class
     if (this.modalWrapper.find('input.CBError').exists()) {
       this.modalWrapper.find('input.CBError').prop('value', '').removeClass('CBError inputTextError');
       //remove error header if this was only error on page
       if ($('.CBError').length > 0) {
         $('#cleverError').remove();
       }
     }
     this.modal.fadeOut();
   } //end if target not element
 };

 cbOntop.convertToModal.initialize = function (opts) {
   var self = this;

   function showModal() {
       //remove current content from modalWrapper
       $('.modalContent', this.modalWrapper).remove();
       //add new content and fade in. Remove CBJSFOLD in case content was hidden on platform
       self.modalWrapper.prepend(opts.textContent.addClass('modalContent ' + opts.modalClass).removeClass('CBJSFold').fadeIn());
       //show modal
       self.modal.fadeIn();
     } //end show modal
     //hide the content as it appears on the page because it should be in the modal
   opts.textContent.hide();
   //check if textContent has an error. If so, show the modal right away without click event
   if (opts.textContent.exists()) {
     if (opts.textContent.find('input.CBError').exists()) {
       showModal();
     }
   }
   if (opts.textContent.exists() && opts.clickToOpen.exists()) {
     opts.clickToOpen.click(function () {
       showModal();
     }).css('cursor', 'pointer');
   } //end if exists
 }; //end intitialize

 $(document).ready(function () {
   try {
     //pass in wrapper within which overlay will be located
     //for cleverbridge the overlay must be within the form so that form submission can work.
     cbOntop.convertToModal.makeOverlay($('#cleverContent form[name=cleverForm]'));
     if ($('#cleverCoupon').exists()) {
       //need to make a coupon code text link clickable element via js since coupon label will be in the modal
       var couponButtonText = $('#cleverCoupon div.blockHeadline h1').text();
       $('#cleverCoupon').append($('<span id=\"couponButton\" class=\"cbButtonMinor\">' + couponButtonText + '</span>').css({
         cursor: 'pointer'
       }));
       var couponOpts = {
         textContent: $('#cleverCoupon div.block'),
         clickToOpen: $('#couponButton'),
         modalClass: 'couponModal'
       };
       cbOntop.convertToModal.initialize(couponOpts);
     } //endif clever coupon
     if ($('#cleverTaxExemptionDocument').exists()) {
       var taxOpts = {
         textContent: $('#cleverTaxExemptionDocument > div.CBWrapper'),
         clickToOpen: $('#cleverTaxExemptionDocument > span.CBText'),
         modalClass: 'taxModal'
       };
       cbOntop.convertToModal.initialize(taxOpts);
     } //end if tax document
   } catch (e) {}
 });
/**
 * Created by pknauer on 27.03.2018.
 */
cbTax = {}
window.cbCartState = {}
cbTax.ajaxUrl = []

cbTax.currencyNumberToString = function(currencyNumber){
    return currencyNumber.formatPrice(cbCart.priceFormatString)
}

cbTax.currencyStringToNumber = function(currencyString){
    return Number(currencyString.split(/[^0-9]/g).join().replace(/,/g , '')) / cbCart.precisionFactor
}

cbTax.dynamicProductCheck = function(){
    for(var i = 0; i < Object.keys(cbCart.items).length; i++){
        var rNo = 'rNo' + cbCart.items[Object.keys(cbCart.items)[i]].runningNo
        if(cbCart.items[rNo].isDynamicPrice){
            return true
            break
        }
    }
}

cbTax.priceRuleCheck = function(){
    var urlString = ''
    cbTax.priceRule = ''
    if(cbCart.predefinedDestEntryUrl != undefined){
        urlString = cbCart.predefinedDestEntryUrl
    } else if(cbCart.uniqueInternalUrl != undefined){
        urlString = cbCart.uniqueInternalUrl
    } else if(cbCart.httpEntryUrl != undefined){
        urlString = cbCart.httpEntryUrl
    }
    if(urlString.match('&amp;pricerule=') != null || urlString.match('&pricerule=') != null){
        urlString = urlString.split('&pricerule=')[1]
        if(urlString.split('&').length > 1){
            cbTax.priceRule = '&pricerule=' + urlString.split('&')[0]
        } else {
            cbTax.priceRule = '&pricerule=' + urlString
        }
    } else {
        cbTax.priceRule = ''
    }
}

cbTax.findAjaxUrl = function(){
    cbTax.priceRuleCheck()
    var completeUrl = ''
    if(cbTax.dynamicProductCheck()){
        if(cbCart.predefinedDestEntryUrl != undefined){
            if(window.location.href.split('?').length > 1){
                completeUrl = cbCart.predefinedDestEntryUrl.replace('scope=checkout','scope=cartjs&nosession=true&allowmultiple=true') + '&' + window.location.href.split('?')[1] + '&state=' + cbTax.stateId + '&postalcode=' + cbTax.postalCode + cbTax.priceRule
            } else {
                completeUrl = cbCart.predefinedDestEntryUrl.replace('scope=checkout','scope=cartjs&nosession=true&allowmultiple=true') + '&state=' + cbTax.stateId + '&postalcode=' + cbTax.postalCode + cbTax.priceRule
            }
        }	else if(cbCart.uniqueInternalUrl != undefined){
            if(window.location.href.split('?').length > 1){
                completeUrl = cbCart.uniqueInternalUrl.replace('scope=checkout','scope=cartjs&nosession=true&allowmultiple=true') + '&' + window.location.href.split('?')[1] + '&state=' + cbTax.stateId + '&postalcode=' + cbTax.postalCode + cbTax.priceRule
            } else {
                completeUrl = cbCart.uniqueInternalUrl.replace('scope=checkout','scope=cartjs&nosession=true&allowmultiple=true') + '&state=' + cbTax.stateId + '&postalcode=' + cbTax.postalCode + cbTax.priceRule
            }
        } else {
            completeUrl = window.location.href.replace('scope=checkout','scope=cartjs&nosession=true&allowmultiple=true') + '&state=' + cbTax.stateId + '&postalcode=' + cbTax.postalCode + cbTax.priceRule
        }
    } else {
        if(cbTax.baseUrl == undefined){
            cbTax.pathNameCheck = window.location.pathname.match(/\bpurl|surl|uurl?\b/);
            if(cbTax.pathNameCheck != null){
                cbTax.baseUrl = window.location.href.split(cbTax.pathNameCheck)[0] + '?scope=cartjs&nosession=true&allowmultiple=true'
            } else {
                cbTax.baseUrl = window.location.href.split('?')[0] + '?scope=cartjs&nosession=true&allowmultiple=true'
            }
            cbTax.languageId = $('html').attr('class').match(/cbLanguage+[^\s]+/)[0].replace('cbLanguage', '')
        }
        if($('.billingPostalcode').length > 0){
            cbTax.stateId = $(".billingStateId.CBStateId option:selected").val().toLowerCase()
        } else {
            cbTax.stateId = $(".CBStateId option:selected").val().toLowerCase()
        }
        var remoteAddr = ''
        if(!cbCart.remoteAddrIsInternal){
            remoteAddr = '&remoteaddr=' + cbCart.remoteAddr
        }
        cbTax.regional = '&country=' + cbCart.taxationCountryId + '&state=' + cbTax.stateId + '&postalcode=' + cbTax.postalCode + '&language=' + cbTax.languageId + '&currency=' + cbCart.currencyId + remoteAddr
        var cartID = [],
            recID = [],
            cartQuantity = '',
            coupons = []
        for(var i = 0; i < Object.keys(cbCart.items).length; i++){
            var rNo = 'rNo' + cbCart.items[Object.keys(cbCart.items)[i]].runningNo
            if(cbCart.items[rNo].quantity > 0){
                cartQuantity += '&quantity_' + cbCart.items[rNo].productId + '=' + cbCart.items[rNo].quantity
                if(cbCart.items[rNo].recommendationId != undefined){
                    recID.push(cbCart.items[rNo].recommendationId)
                } else {
                    cartID.push(cbCart.items[rNo].productId)
                }
                if(cbCart.items[rNo].coupon != undefined){
                    coupons.push(cbCart.items[rNo].coupon)
                }
            }
        }
        if(coupons.length > 0){
            coupons = '&coupon=' + coupons.join(',')
        }
        cartID = '&cart=' + cartID.join(',')
        if(recID.length > 0){
            recID = '&addrecommendation=' + recID.join(',')
            cartID += recID
        }
        completeUrl = cbTax.baseUrl + cbTax.regional + coupons + cartID + cartQuantity + cbTax.priceRule
    }

    completeUrl += '&cfg=' + cbCart.configurationName

    if(cbTax.ajaxUrl[0] == undefined){
        cbTax.ajaxUrl.push(completeUrl)
        cbTax.newAjaxUrl = completeUrl
        cbTax.currentIteration = 0
        return true
    } else {
        var len = cbTax.ajaxUrl.length
        for(var i = 0; i < len; i++){
            if(cbTax.ajaxUrl[i] == completeUrl){
                cbTax.newAjaxUrl = ''
                cbTax.currentIteration = i
                return true
            } else if(i == cbTax.ajaxUrl.length - 1){
                cbTax.ajaxUrl.push(completeUrl)
                cbTax.newAjaxUrl = completeUrl
                cbTax.currentIteration = cbTax.ajaxUrl.length - 1
                return true
            }
        }
    }
}

cbTax.salesTaxUpdaterUS = function(){
    if($('#cbCartTotalUpdatedNote').length > 0){
        if($('.CBPostalcode input').val().match(/^\d{5}(?:[-\s]\d{4})?$/g) != null && $(".CBStateId option:selected").val() != undefined){
            if($('.billingPostalcode').length > 0){
                cbTax.postalCode = $('.billingPostalcode.CBPostalcode input').val()
            } else {
                cbTax.postalCode = $('.CBPostalcode input').val()
            }
            cbTax.languageId = $('html').attr('class').match(/cbLanguage+[^\s]+/)[0].replace('cbLanguage', '')
            cbTax.ajaxCall()
        } else {
            cbTax.revertFields()
            cbTax.revertNotification()
        }
    }
}

// Sets up cart to run sales tax update
cbTax.initialFunctionPlacement = function(){
    if($('.billingPostalcode').length > 0){
        $('.billingPostalcode.CBPostalcode input, .CBStateId select').on("change",cbTax.salesTaxUpdaterUS)
    } else {
        $('.CBPostalcode input, .CBStateId select').on("change",cbTax.salesTaxUpdaterUS)
    }
    $('.CBStateId select').on('state:match',function(){
        cbTax.stateId = $(".CBStateId option:selected").val().toLowerCase()
    })
}

cbTax.ajaxCall = function(){
    if(cbTax.findAjaxUrl()){
        if(window.cbCartState[cbTax.currentIteration] != undefined){
            var currentState = cbTax.currentIteration
            cbTax.salesTaxTotalUpdater(window.cbCartState[currentState])
        } else {
            $.ajax({
                url: cbTax.newAjaxUrl,
                context: document.body,
                dataType: 'json',
                complete: function(data) {
                    var currentState = 'cbCartState[' + cbTax.currentIteration + ']'
                    cbTax.newData = data.responseText.replace(/\bwindow.cbCart?\b/g,'window.' + currentState)
                    eval(cbTax.newData)
                    currentState = cbTax.currentIteration
                    var highestTax = []
                    for(var i = 0; i < Object.keys(window.cbCartState[currentState].items).length; i++){
                        var rNo = 'rNo' + window.cbCartState[currentState].items[Object.keys(window.cbCartState[currentState].items)[i]].runningNo
                        if(window.cbCartState[currentState].items[rNo].quantity > 0){
                            highestTax.push(Number(window.cbCartState[currentState].items[rNo].vatPct))
                        }
                    }
                    window.cbCartState[currentState].taxPct = cbOntop.utilities.findLargest(highestTax).formatPrice(cbCart.floatPercentFormatString)
                    window.cbCartState[currentState].httpEntryUrl = window.cbCartState[currentState].httpEntryUrl.replace(/(amp;)+/g,'')
                    cbTax.salesTaxTotalUpdater(window.cbCartState[currentState])
                }
            })
        }
    }
}

cbTax.salesTaxTotalUpdater = function($data){
    cbTax.updateTotals($data)
    cbTax.updateNotification($data)
}

cbTax.updateTotals = function($data){
    if(cbCart.xWebParameters == undefined){cbCart.xWebParameters = {}}
    if($data.totals.Unknown.prices.totalVat != 0){
        if(cbCart.xWebParameters['x-total_display'] != undefined){
            if(cbCart.xWebParameters['x-total_display'] == 'gross_above'){
                $('div.cbCartTotals ul > span.cbVatBusinessNote').slideUp('slow',function(){
                    $('li.cbCartTotal span.cbTtotal').text(cbTax.currencyNumberToString($data.totals.None.prices.totalGross))
                    $('li.cbVatSetType span.cbTaxTotalVatPrice').text(cbTax.currencyNumberToString($data.totals.None.prices.totalVat))
                    $('li.cbVatSetType span.cbTaxTotalVatPct').text($data.taxPct)
                    $('li.cbVatSetType span.cbTaxTotalVatBasePrice').text(cbTax.currencyNumberToString($data.totals.None.prices.totalNet))
                    $('li.cbVatSetType').slideDown()
                })
            } else if(cbCart.xWebParameters['x-total_display'] == 'gross_below'){
                $('li.cbCartTotal span.cbVatBusinessNote').slideUp('slow',function(){
                    $('li.cbCartSubtotal span.cbTtotal').text(cbTax.currencyNumberToString($data.totals.None.prices.totalNet))
                    $('li.cbCartVat span.cbTtotal').text(cbTax.currencyNumberToString($data.totals.None.prices.totalVat))
                    $('li.cbCartTotal span.cbTtotal').text(cbTax.currencyNumberToString($data.totals.None.prices.totalGross))
                    $('li.cbCartVat, li.cbCartSubtotal').slideDown()
                })
            }
        } else {
            $('li.cbCartTotal span.cbVatBusinessNote').slideUp('slow',function(){
                $('li.cbCartSubtotal span.cbTtotal').text(cbTax.currencyNumberToString($data.totals.None.prices.totalNet))
                $('li.cbCartVat span.cbTtotal').text(cbTax.currencyNumberToString($data.totals.None.prices.totalVat))
                $('li.cbCartTotal span.cbTtotal').text(cbTax.currencyNumberToString($data.totals.None.prices.totalGross))
                $('li.cbCartVat, li.cbCartSubtotal').slideDown()
            })
        }
    } else {
        cbTax.revertFields($data)
    }
}

cbTax.revertFields = function($data){
    if($data == null){
        $data = window.cbCart
    }
    if(window.cbCartState[0] != undefined){
        if(cbCart.xWebParameters['x-total_display'] != undefined){
            if(cbCart.xWebParameters['x-total_display'] == 'gross_above'){
                $('li.cbVatSetType').slideUp('slow',function(){
                    $('li.cbCartTotal span.cbTtotal').text(cbTax.currencyNumberToString($data.totals.None.prices.totalGross))
                    $('div.cbCartTotals ul > span.cbVatBusinessNote').slideDown()
                })
            } else if(cbCart.xWebParameters['x-total_display'] == 'gross_below'){
                $('li.cbCartVat, li.cbCartSubtotal').slideUp('slow',function(){
                    $('li.cbCartTotal span.cbTtotal').text(cbTax.currencyNumberToString($data.totals.None.prices.totalGross))
                    $('li.cbCartTotal span.cbVatBusinessNote').slideDown()
                })
            }
        } else {
            $('li.cbCartVat, li.cbCartSubtotal').slideUp('slow',function(){
                $('li.cbCartTotal span.cbTtotal').text(cbTax.currencyNumberToString($data.totals.None.prices.totalGross))
                $('li.cbCartTotal span.cbVatBusinessNote').slideDown()
            })
        }
        cbTax.revertNotification()
    }
}

cbTax.updateNotification = function($data){
    var cartTotalUpdatedText = $('<div id="cartTotalUpdated" style="display:none;">' + $('li.totalRowTaxApplied').html() + '</div>')
    if(!$('#cartTotalUpdated').exists()){
        cartTotalUpdatedText.insertAfter('#cleverTextCompletePurchase')
    }
    if($data.totals.Unknown.prices.totalVat != 0){
        if($('#cartTotalUpdated:hidden').length > 0){
            $('#cartTotalUpdated').slideDown()
        }
    } else {
        if($('#cartTotalUpdated:visible').length > 0){
            $('#cartTotalUpdated').slideUp()
        }
    }
}

cbTax.revertNotification = function(){
    if($('#cartTotalUpdated').exists()){
        if($('#cartTotalUpdated').attr('style') == 'display: block;' || $('#cartTotalUpdated').attr('style') == 'display:block;' || $('#cartTotalUpdated').attr('style') == ''){
            $('#cartTotalUpdated').slideUp()
        }
    }
}

// Final Call
$(document).ready(function(){
    try {
        // Only US AND scope=checkout AND by x-param (remove x-param if default preferred)
        if(cbCart.taxationCountryId == 'US' && cbCart.scopeId == 'checkout' && $('#cbCartTotalUpdatedNote').length > 0 && !cbCart.hasTaxExemptionDocument){
            if(navigator.appVersion.indexOf("MSIE 8.")!=-1 || navigator.appVersion.indexOf("MSIE 7.")!=-1){
                $.ajaxSetup({cache:false})
            }
            cbTax.initialFunctionPlacement()
            cbTax.salesTaxUpdaterUS()
        }
    } catch(e) {}
})
//////////////////////////////////////////////////////////////////
//////////THESE ARE OUR UTLILITIES
//These methods can be used multiple times in different contexts
//If you use a code snippet repeatedly add it here so it's available as a part of our code base
/////////////////////////////////////////////////////////////////
cbOntop.utilities = {};

//shortcut to check is selector returns results in jQuery
jQuery.fn.extend({
  exists: function() {
    return !!this.length;
  }
});

//comparen numbers in array and return largest
cbOntop.utilities.findLargest = function(arr) {
  arr.sort(function(a, b) {
    return a - b;
  });
  var largest = arr[arr.length - 1];
  return largest;
}; //end

//wait x seconds before executing a function on resize or other recurrent event
//fun = function to execute
//wait = number of miliseconds
//immediate = true/false. If True execute function once before waiting x seconds
cbOntop.utilities.debounce = function(func, wait, immediate) {
  var timeout;
  return function() {
    var context = this,
      args = arguments;
    var later = function() {
      timeout = null;
      if (!immediate) func.apply(context, args);
    };
    var callNow = immediate && !timeout;
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
    if (callNow) func.apply(context, args);
  };
};

// given a series of blocks make all blocks min-height equal to height of tallest block
cbOntop.utilities.equalBlocks = function($blocks) {
  equalHeight = function() {
    $blocks.addClass('equalBlock');
    $blocks.css('min-height', 0);
    var heights = [];
    $blocks.each(function() {
      heights.push($(this).outerHeight());
    });
    var result = cbOntop.utilities.findLargest(heights);
    $blocks.css('min-height', result + 'px');
  }; //end equalHeight

  try {
    equalHeight();
  } catch (e) {}

  $(window).resize(function() {
    try {
      cbOntop.utilities.debounce(equalHeight, 100, true)();
    } catch (e) {}
  });
}; //end equal blocks
/**
 * Created by pknauer on 17.11.2016.
 */
$(document).ready(function () {
    $(".email-prefilled .CBEmail:not(.CBError) input").prop("disabled",true).addClass("CBDisabled").parents("div.interactField").addClass("CBDisabled");

    // check if its the no-review config and add "sassContainerThird" to have the same HTML structure like in review config
    if($("body.CBScopecheckout.CBPagedefault").length > 0 && $("body.CBScopecheckout.CBPagedefault div.sassContainerThird").length < 1) {
        $("<div class='sassContainerThird'></div>").insertAfter("div.sassContainerSecond");
        $("div.sassColumnSubmit").appendTo("div.sassContainerThird");
    }


    $(".subselldesign-old li.cbCartItem.CBCartItemTypesubsellingItem  .cbProductActions").each(function () {
        $(this).insertBefore($(this).parents("li.cbCartItem .cbProductDetails").find("div.cbProductUnitPrice"));
    });
    $(".subselldesign-short li.cbCartItem.CBCartItemTypesubsellingItem  .cbProductActions").each(function () {
        $(this).insertBefore($(this).parents("li.cbCartItem .cbProductDetails").find("div.cbProductName"));
    });
    $(".subselldesign-new li.cbCartItem.CBCartItemTypesubsellingItem  .cbProductActions").each(function () {
        $(this).prependTo($(this).parents(".cbProductDetails").find("div.cbProductUnitPrice"));
    });
    $(".subselldesign-new .cbPositionUpperSubsell .cbCartItem > label").each(function () {
        $(this).prependTo($(this).parents(".cbCartItem").first().find("div.cbProductUnitPrice"));
    });

    // hide/show Billing Note on the review page by changing auto/manual renewal option

    if($('#cleverRenewalLinkManual.CBJSFold').length<1){
        $('#cleverAcceptRecurringBilling').hide();
    }
    $('#cleverRenewalContainerLinkManual').click(function(){
        $('#cleverAcceptRecurringBilling').hide();

    });
    $('#cleverRenewalContainerLinkAutomatic').click(function(){
        $('#cleverAcceptRecurringBilling').show();

    });

    //delete ":" from the labels
    $('label span.interactLabel').each(function(){
        $(this).html($(this).html().replace(':',''));
    });

    // move info icon behind the input label
    $('div.interact div.interactField a.CBHyperLink').each(function(){
        $(this).insertAfter($(this).parents('div.interact').first().find('div.interactLabel span.interactLabel'));
    });

    // manipulate edit cart link to go to the scope cart and back to the review page
    var editCartLink=$('#cleverCartReview .blockHeadlineExtension a');
    if(editCartLink.length>0) {
        editCartLink.attr('href', editCartLink.attr('href').replace('scope=checkout', 'scope=cart').replace('&progress=cart', '') + '&x-progress=review');
    }

    var checkoutActionForm=$('.goto-review .CBScopecart.CBPagedefault form');
    if(checkoutActionForm.length>0) {
        checkoutActionForm.attr('action', checkoutActionForm.attr('action').replace('scope=cart', 'scope=checkout')+ '&progress=review');
    }
    // End


    $('div.cbPositionUpperSubsell').insertAfter('#cleverCart .cbCartItems, #cleverCartReview .cbCartItems');

    // move invoice document behind support contact
    $('#cleverInvoiceDocuments').insertAfter('#cleverSupportContact');

    // move cleverPurchaseId  into support contact
    $('#cleverPurchaseId').insertAfter('#cleverSupportContact .CBClientSupportContactNote');

    // move "click here if you are a business" beneath other input fields
    $('div.x-iscompany').insertAfter('#deliveryContactEmailInput');

    // put state behind country
    $('.cbCountryUs #cleverDelivery div.deliveryStateId, .cbCountryCa #cleverDelivery div.deliveryStateId').insertAfter('#cleverDelivery div.deliveryCountryId');

    // move product icon on conf. page before product name
    $('#cleverCartFinal div.fulfilmentContent div.product_icon').each(function(){
        var new_position= $(this).parents('tr').first().prev('tr').find('td.product');
        $(this).prependTo(new_position);
    });

    // move product price in catalog into the button behind lable
    $('#cleverCatalog li.cbCatalogItem span.cbPriceInitial').each(function(){
        $(this).insertAfter($(this).parents('.cbButtonMajor').find('a.CBHyperLink span.CBHyperLink'));
    });

    // move product discount price in catalog into the button behind lable
    $('#cleverCatalog li.cbCatalogItem span.cbProductUnitPriceInitial').each(function(){
        $(this).insertAfter($(this).parents('.cbButtonMajor').find('a.CBHyperLink span.CBHyperLink'));
    });

    // split cleverPurchaseDeclinedInformation in two sentence with a line brake
    if($("#cleverPurchaseDeclinedInformation").length > 0) {
        var p = $("#cleverPurchaseDeclinedInformation p+p");
        var a = $("#cleverPurchaseDeclinedInformation p+p a");
        a.wrap("<span class='link'></span>")
        var a_html = $("#cleverPurchaseDeclinedInformation p+p span.link").html();
        a.replaceWith("XXXX");
        var new_p_html = p.html().split(".");
        new_p_html[new_p_html.length - 2] = "<p class='cuseco'>" + new_p_html[new_p_html.length - 2] + ".</p>";
        new_p_html = new_p_html.slice(0,new_p_html.length - 1).join(".").replace("XXXX",a_html);
        p.html(new_p_html);
    }

    <!-- remove lower options available for duration/devices by the selections (x-sduration=; x-sdevices=)  -->
    var min_sduration = $("#sduration_number").val();
    var min_sdevices = $("#sdevice_number").val();
    var sduration_size=$(".CBProductSelectionLevel1 li.CBRadioItem").size();
    var sdevices_size=$(".CBProductSelectionLevel2 li.CBRadioItem").size();
    $(".cbIncludedSelection li.CBRadioItem").addClass("CBJSFold");
    for (i=sduration_size; i>(sduration_size-min_sduration); i--){
        $(".cbIncludedSelection .CBProductSelectionLevel1 li.CBRadioItem"+i).removeClass("CBJSFold");
    }
    for (i=sdevices_size; i>(sdevices_size-min_sdevices); i--){
        $(".cbIncludedSelection .CBProductSelectionLevel2 li.CBRadioItem"+i).removeClass("CBJSFold");
    }
    $(".cbIncludedSelection li.CBRadioItem.CBJSFold").remove();

    if( min_sduration==0){
        $(".cbIncludedSelection .CBProductSelectionLevel1").remove();
    }
    if( min_sdevices==0){
        $(".cbIncludedSelection .CBProductSelectionLevel2").remove();
    }
    if( $(".cbIncludedSelection .CBProductSelections *").length == 0){
        $(".cbIncludedSelection").remove();
    }


       // IE8 Bug fixing
    //move selection headlines into the blockheadline
    $(".ie8 body.CBScopecart.sass2col #cleverCart div.cbCartHeadlines div.cbProductTotalPrice span.CBText").appendTo("body.sass2col #cleverCart div.blockHeadline");

    //Move product selections into the product details area
    $(".ie8 body.CBScopecart.sass2col #cbCrossSelling .Upsell_Selection").insertAfter(".ie8 li.cbCartItem.gross .cbProductDetails div.cbProductName").first();



        setTimeout(function () {
            cbOntop.tryCatch(cbOntop.utilities.equalBlocks, [$('.CBScopecheckout.CBPagedefault .sassContainerFirst, .CBScopecheckout.CBPagedefault .sassContainerSecond')]);
            $('.CBScopecheckout.CBPagedefault .sassContainerSecond,.CBScopecheckout.CBPagedefault .sassContainerFirst ').click(function () {
                cbOntop.tryCatch(cbOntop.utilities.equalBlocks, [$('.CBScopecheckout.CBPagedefault .sassContainerFirst, .CBScopecheckout.CBPagedefault .sassContainerSecond')]);
            });

            // Remove loading gif once page has loaded
            cbOntop.tryCatch(cbOntop.hideLoading);
        }, 100);

    $(window).load(function(){
        var equalCatalogItems = $('#cleverCatalog .cbCatalogItem');
        cbOntop.tryCatch(cbOntop.utilities.equalBlocks, [equalCatalogItems]);
    });

    // move product cart beside payment or delivery block, depends on where user is clicking at the moment
    $("#cleverPayment li.CBListItem").click(function(){
        setTimeout(function() {
            if ($(".sassColumnCart").outerHeight() + 250 <= $(".sassContainerSecond").outerHeight())
                $("body").removeClass("moving_product");
            else
                $("body").addClass("moving_product");
        },500);
    });
    $("#cleverPayment li.CBListItem input.inputText").focus(function(){
        setTimeout(function() {
            if ($(".sassColumnCart").outerHeight() + 250 <= $(".sassContainerSecond").outerHeight())
                $("body").removeClass("moving_product");
            else
                $("body").addClass("moving_product");
        },500);
    });
    $("#cleverDelivery").click(function(){
        $("body").addClass("moving_product");
    });

    //give a class if there is no button in final cart
    $("tr.custom_cartItem").each(function() {
        if ($(this).find(".activate_btn").length == 0)
            $(this).addClass("without_btn");
    });

    //add parameters to catalog items

    $("#cleverCatalog li.cbCatalogItem .cbButtonMajor a").each(function(){
        var recommendation_param = $(this).parents("li.cbCatalogItem").first().find(".recommendation_param");
        var catalog_params = "&cartreset=true";
        if(recommendation_param.val().length > 0)
            catalog_params += "&recommendation=" + recommendation_param.val();
        $(this).attr("href",$(this).attr("href")+catalog_params);
    });

    //handle mobiel renewal popups
    $("#cleverRenewalContainer").prev(".CBDictionary").bind("touchstart", function(){
        $(this).next().removeClass("CBJSFold");
    });

    $("#cleverRenewalContainerLinkClose").bind("touchstart", function(){
        $("#cleverRenewalContainer").addClass("CBJSFold");
    });

    // create cbProductDetails div by UpperSubsell
    $('.subselldesign-new #cleverCart div.cbPositionUpperSubsell li.cbCartItem').each(function () {
        $(this).find('.cbProductImage').after('<div class="cbProductDetails"></div>');
        $(this).find('.cbProductName,.cbProductUnitPrice,.cbProductQuantity, .cbProductTotalPrice').appendTo($(this).find('.cbProductDetails'));
    });

    //move incentive Text bevor the Cart
    $('.cbIncentiveText').insertBefore('#cleverCart');


    cbOntop.utilities.equalBlocks($(".CBScopecart .cbPositionLowerXSubsell li, .CBScopecart .cbPositionUpperSubsell li"));

    $(".CBScopecart.subselldesign-new .cbPositionLowerXSubsell .CBProductPopupInformation, .CBScopecart.subselldesign-new .cbPositionUpperSubsell .CBProductPopupInformation").each(function(){
        $(this).appendTo($(this).closest("div").find("strong"));
    });

    $(".cbPositionUpperSubsell .inputCheckbox").each(function(){
        $("<label></label>").insertAfter($(this));
    });
    $(".subselldesign-old .cbPositionUpperSubsell .inputCheckbox").each(function(){
        $("<div class='cbProductAdd'><label for='" + $(this).attr("id") + "'></label></div>").insertBefore($(this).closest("li").find(".cbProductUnitPrice"));
    });

    $(".cbPositionUpperSubsell, .cbPositionLowerXSubsell").each(function(){
        $(this).addClass("productCount" + $(this).find("li").length);
    });

    $("#cleverCartFinal tr.odd .keytemplate, #cleverCartFinal tr.even .keytemplate").each(function(){
        $(this).parents("tr.odd").removeClass("odd").addClass("cartItem").addClass("recItem").prev("tr").removeClass("odd").addClass("cartItem").addClass("recItem");
        $(this).parents("tr.even").removeClass("even").addClass("cartItem").addClass("recItem").prev("tr").removeClass("even").addClass("cartItem").addClass("recItem");
    });
});




/*! device.js 0.1.61 */
(function(){var a,b,c,d,e,f,g,h,i,j;a=window.device,window.device={},c=window.document.documentElement,j=window.navigator.userAgent.toLowerCase(),device.ios=function(){return device.iphone()||device.ipod()||device.ipad()},device.iphone=function(){return d("iphone")},device.ipod=function(){return d("ipod")},device.ipad=function(){return d("ipad")},device.android=function(){return d("android")},device.androidPhone=function(){return device.android()&&d("mobile")},device.androidTablet=function(){return device.android()&&!d("mobile")},device.blackberry=function(){return d("blackberry")||d("bb10")||d("rim")},device.blackberryPhone=function(){return device.blackberry()&&!d("tablet")},device.blackberryTablet=function(){return device.blackberry()&&d("tablet")},device.windows=function(){return d("windows")},device.windowsPhone=function(){return device.windows()&&d("phone")},device.windowsTablet=function(){return device.windows()&&d("touch")&&!device.windowsPhone()},device.fxos=function(){return(d("(mobile;")||d("(tablet;"))&&d("; rv:")},device.fxosPhone=function(){return device.fxos()&&d("mobile")},device.fxosTablet=function(){return device.fxos()&&d("tablet")},device.meego=function(){return d("meego")},device.cordova=function(){return window.cordova&&"file:"===location.protocol},device.nodeWebkit=function(){return"object"==typeof window.process},device.mobile=function(){return device.androidPhone()||device.iphone()||device.ipod()||device.windowsPhone()||device.blackberryPhone()||device.fxosPhone()||device.meego()},device.tablet=function(){return device.ipad()||device.androidTablet()||device.blackberryTablet()||device.windowsTablet()||device.fxosTablet()},device.desktop=function(){return!device.tablet()&&!device.mobile()},device.portrait=function(){return window.innerHeight/window.innerWidth>1},device.landscape=function(){return window.innerHeight/window.innerWidth<1},device.noConflict=function(){return window.device=a,this},d=function(a){return-1!==j.indexOf(a)},f=function(a){var b;return b=new RegExp(a,"i"),c.className.match(b)},b=function(a){return f(a)?void 0:c.className+=" "+a},h=function(a){return f(a)?c.className=c.className.replace(a,""):void 0},device.ios()?device.ipad()?b("ios ipad tablet"):device.iphone()?b("ios iphone mobile"):device.ipod()&&b("ios ipod mobile"):b(device.android()?device.androidTablet()?"android tablet":"android mobile":device.blackberry()?device.blackberryTablet()?"blackberry tablet":"blackberry mobile":device.windows()?device.windowsTablet()?"windows tablet":device.windowsPhone()?"windows mobile":"desktop":device.fxos()?device.fxosTablet()?"fxos tablet":"fxos mobile":device.meego()?"meego mobile":device.nodeWebkit()?"node-webkit":"desktop"),device.cordova()&&b("cordova"),e=function(){return device.landscape()?(h("portrait"),b("landscape")):(h("landscape"),b("portrait"))},i="onorientationchange"in window,g=i?"orientationchange":"resize",window.addEventListener?window.addEventListener(g,e,!1):window.attachEvent?window.attachEvent(g,e):window[g]=e,e()}).call(this);
/**
 * Created by pknauer on 24.11.2016.
 */
//custom JS to create buttons out of the subselling checkboxesand make them text based
/**********************************************************************************************************************/

var cleverLocalizeSubSellButtons = {};

$(document).ready(function(){
    //try{
    var input = $('#cleverCart div.cbPositionUpperSubsell li.CBCartItem input.inputCheckbox');

    if($("body.text").length > 0){
        //$("#cleverContent .cbPositionLowerXSubsell ul li.CBCartItemTypesubsellingItem  div.cbProductDetails div.cbProductActions div.cbProductAdd label").html('<span class="addText">Add</span><span class="removeText">Remove</span>');
        var subSell = $('#cleverContent div.cbPositionUpperSubsell ul li.cbCartItem ');

        subSell.each(function() {

            if ($(this).children('input[type=checkbox]').length > 0) {
                var inputId = $(this).children('input').attr('id');

                if ($(this).length > 0) {
                    $(this).children('label').append('<span class="inputCheckboxLabel addText">Add</span><span class="inputCheckboxLabel removeText">Remove</span>');

                }
            }
        }); //End of subsell

        //BEGIN TEXT LOCALIZATION
        cleverLocalizeSubSellButtons.language = $('body').attr('lang');

        switch (cleverLocalizeSubSellButtons.language) {
            case 'es':
                cleverLocalizeSubSellButtons.spanAdd = 'Añadir';
                cleverLocalizeSubSellButtons.spanRemove = 'Eliminar';
                break;
            case 'de':
                cleverLocalizeSubSellButtons.spanAdd = 'Hinzufügen';
                cleverLocalizeSubSellButtons.spanRemove = 'Entfernen';
                break;
            case 'pt':
                cleverLocalizeSubSellButtons.spanAdd = 'Adicionar';
                cleverLocalizeSubSellButtons.spanRemove = 'Remover';
                break;
            case 'pb':
                cleverLocalizeSubSellButtons.spanAdd = 'Adicionar';
                cleverLocalizeSubSellButtons.spanRemove = 'Remover';
                break;
            case 'fr':
                cleverLocalizeSubSellButtons.spanAdd = 'Ajouter';
                cleverLocalizeSubSellButtons.spanRemove = 'Supprimer';
                break;
            case 'it':
                cleverLocalizeSubSellButtons.spanAdd = 'Aggiungi';
                cleverLocalizeSubSellButtons.spanRemove = 'Rimuovi';
                break;
            case 'nl':
                cleverLocalizeSubSellButtons.spanAdd = 'Toevoegen';
                cleverLocalizeSubSellButtons.spanRemove = 'Verwijderen';
                break;
            case 'da':
                cleverLocalizeSubSellButtons.spanAdd = 'Tilføj';
                cleverLocalizeSubSellButtons.spanRemove = 'Fjern';
                break;
            case 'sv':
                cleverLocalizeSubSellButtons.spanAdd = 'Lägg till';
                cleverLocalizeSubSellButtons.spanRemove = 'Ta bort';
                break;
            case 'no':
                cleverLocalizeSubSellButtons.spanAdd = 'Lägg till';
                cleverLocalizeSubSellButtons.spanRemove = 'Fjern';
                break;
            case 'fi':
                cleverLocalizeSubSellButtons.spanAdd = 'Lisää';
                cleverLocalizeSubSellButtons.spanRemove = 'Poista';
                break;
            case 'tr':
                cleverLocalizeSubSellButtons.spanAdd = 'Ekle';
                cleverLocalizeSubSellButtons.spanRemove = 'Sil';
                break;
            case 'el':
                cleverLocalizeSubSellButtons.spanAdd = 'Προσθήκη';
                cleverLocalizeSubSellButtons.spanRemove = 'Διαγραφή';
                break;
            case 'ru':
                cleverLocalizeSubSellButtons.spanAdd = 'Добавить';
                cleverLocalizeSubSellButtons.spanRemove = 'Удалить';
                break;
            case 'cs':
                cleverLocalizeSubSellButtons.spanAdd = 'Přidat';
                cleverLocalizeSubSellButtons.spanRemove = 'Odstranit';
                break;
            case 'pl':
                cleverLocalizeSubSellButtons.spanAdd = 'Dodaj';
                cleverLocalizeSubSellButtons.spanRemove = 'Usuń';
                break;
            case 'hu':
                cleverLocalizeSubSellButtons.spanAdd = 'Kosárba';
                cleverLocalizeSubSellButtons.spanRemove = 'Eltávolítás';
                break;
            case 'ro':
                cleverLocalizeSubSellButtons.spanAdd = 'Adaugă';
                cleverLocalizeSubSellButtons.spanRemove = 'Elimină';
                break;
            case 'sl':
                cleverLocalizeSubSellButtons.spanAdd = 'Dodaj';
                cleverLocalizeSubSellButtons.spanRemove = 'Odstrani';
                break;
            case 'hr':
                cleverLocalizeSubSellButtons.spanAdd = 'Dodaj';
                cleverLocalizeSubSellButtons.spanRemove = 'Ukloni';
                break;
            case 'he':
                cleverLocalizeSubSellButtons.spanAdd = 'הוסף';
                cleverLocalizeSubSellButtons.spanRemove = 'הסר';
                break;
            case 'ko':
                cleverLocalizeSubSellButtons.spanAdd = '추가';
                cleverLocalizeSubSellButtons.spanRemove = '꺼내기';
                break;
            case 'ja':
                cleverLocalizeSubSellButtons.spanAdd = '追加';
                cleverLocalizeSubSellButtons.spanRemove = '削除';
                break;
            case 'zh':
                cleverLocalizeSubSellButtons.spanAdd = '添加';
                cleverLocalizeSubSellButtons.spanRemove = '删除';
                break;
            case 'zg':
                cleverLocalizeSubSellButtons.spanAdd = '添加';
                cleverLocalizeSubSellButtons.spanRemove = '移除';
                break;
            case 'th':
                cleverLocalizeSubSellButtons.spanAdd = 'เพิ่ม';
                cleverLocalizeSubSellButtons.spanRemove = 'เอาออก';
                break;
            case 'hi':
                cleverLocalizeSubSellButtons.spanAdd = 'जोड़ें';
                cleverLocalizeSubSellButtons.spanRemove = 'हटाएँ';
                break;
            case 'ar':
                cleverLocalizeSubSellButtons.spanAdd = 'إضافة';
                cleverLocalizeSubSellButtons.spanRemove = 'إزالة';
                break;
            default:
                cleverLocalizeSubSellButtons.spanAdd = 'Add';
                cleverLocalizeSubSellButtons.spanRemove = 'Remove';
        } //End SwitchCase

        $("#cleverCart label span.addText").html(cleverLocalizeSubSellButtons.spanAdd);
        $("#cleverCart label span.removeText").html(cleverLocalizeSubSellButtons.spanRemove);
    }//End If body.text parameter exits.
});})(jQuery);