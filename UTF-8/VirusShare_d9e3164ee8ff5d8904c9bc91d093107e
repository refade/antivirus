/**
 * Библиотека использует JQuery!
 * Компонент реализует поддержку голосований (звездочек) c событиями
 * @param className - в какой класс рендерить наш рейтинг.
 *
 * Vote.render({
 *  'className': '.foobar',
 *  'rating': 0.4,
 *  'params': {},
 *  'click': function(vote, $scope, eventParams) {
 *      alert(vote);
 *  },
 *  'mouseMove': function(vote, $scope, eventParams) {
 *      // mousemove
 *  }
 * })
 */
var Vote = {
    render: function(options) {
        // Название класса, в который рендерим.
        var className = options.className || null;
        // рейтинг, текущий, который показываем
        var rating = options.rating || null;
        // событие нажатия мыши по элементу.
        var click = options.click || null;
        // событие наведения на рейтинг.
        var mouseMove = options.mouseMove || null;
        // какие-то произвольные параметры, которые будут переданы в события click и mouseMove
        var eventParams = options.eventParams || {};

        var $scope = $('.' + className);
        var starHtml = '';
        for (var i = 1; i <= 5; i++) {
            starHtml += (rating >= i) ? '<i class="fa fa-star" aria-hidden="true"></i>' : '<i class="fa fa-star-o" aria-hidden="true"></i>';
        }
        $scope.html(starHtml);

        function repaint() {
            $scope.find('i').each(function(index) {
                var $element = $scope.find('i').eq(index);
                if (rating > index) {
                    $element.removeClass('fa-star-o').addClass('fa-star');
                } else {
                    $element.removeClass('fa-star').addClass('fa-star-o');
                }
            })
        }

        $scope.find('i').hover(function() {
            var $_scope = $(this);
            var scopeIndex = $_scope.index();
            $scope.find('i').each(function(index) {
                var $element = $scope.find('i').eq(index);
                if (scopeIndex >= index) {
                    $element.removeClass('fa-star-o').addClass('fa-star');
                } else {
                    $element.removeClass('fa-star').addClass('fa-star-o');
                }
            });
        }, function() {
            // mouse out
           repaint();
        });
        $scope.find('i').on('click', function() {
            var tmpRating = $(this).index() + 1;
            if (click != null) {
                click(tmpRating, $scope, eventParams);
            }
        });
        this.setRating = function(vote) {
            rating = vote;
            repaint();
        };
        return this;
    }
};