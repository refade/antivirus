function positionInfo(object) {
  var p_elm = object;

  this.getElementLeft = getElementLeft;
  function getElementLeft() {
    var x = 0;
    var elm;
    if(typeof(p_elm) == "object"){
      elm = p_elm;
    } else {
      elm = document.getElementById(p_elm);
    }
    while (elm != null) {
      x+= elm.offsetLeft;
      elm = elm.offsetParent;
    }
    return parseInt(x);
  }

  this.getElementWidth = getElementWidth;
  function getElementWidth(){
    var elm;
    if(typeof(p_elm) == "object"){
      elm = p_elm;
    } else {
      elm = document.getElementById(p_elm);
    }
    return parseInt(elm.offsetWidth);
  }

  this.getElementRight = getElementRight;
  function getElementRight(){
    return getElementLeft(p_elm) + getElementWidth(p_elm);
  }

  this.getElementTop = getElementTop;
  function getElementTop() {
    var y = 0;
    var elm;
    if(typeof(p_elm) == "object"){
      elm = p_elm;
    } else {
      elm = document.getElementById(p_elm);
    }
    while (elm != null) {
      y+= elm.offsetTop;
      elm = elm.offsetParent;
    }
    return parseInt(y);
  }

  this.getElementHeight = getElementHeight;
  function getElementHeight(){
    var elm;
    if(typeof(p_elm) == "object"){
      elm = p_elm;
    } else {
      elm = document.getElementById(p_elm);
    }
    return parseInt(elm.offsetHeight);
  }

  this.getElementBottom = getElementBottom;
  function getElementBottom(){
    return getElementTop(p_elm) + getElementHeight(p_elm);
  }
}

function CalendarControl() {

  var calendarId = 'CalendarControl';
  var currentYear = 0;
  var currentMonth = 1;
  var currentDay = 1;

  var selectedYear = 0;
  var selectedMonth = 1;
  var selectedDay = 1;

  var months = ['Ocak','Subat','Mart','Nisan','Mayis','Haziran','Temmuz','Agustos','Eylul','Ekim','Kasim','Aralik'];
  var dateField = null;
 
  function getProperty(p_property){
    var p_elm = calendarId;
    var elm = null;

    if(typeof(p_elm) == "object"){
      elm = p_elm;
    } else {
      elm = document.getElementById(p_elm);
    }
    if (elm != null){
      if(elm.style){
        elm = elm.style;
        if(elm[p_property]){
          return elm[p_property];
        } else {
          return null;
        }
      } else {
        return null;
      }
    }
  }

  function setElementProperty(p_property, p_value, p_elmId){
    var p_elm = p_elmId;
    var elm = null;

    if(typeof(p_elm) == "object"){
      elm = p_elm;
    } else {
      elm = document.getElementById(p_elm);
    }
    if((elm != null) && (elm.style != null)){
      elm = elm.style;
      elm[ p_property ] = p_value;
    }
  }

  function setProperty(p_property, p_value) {
    setElementProperty(p_property, p_value, calendarId);
  }

  function getDaysInMonth(year, month) {
    return [31,((!(year % 4 ) && ( (year % 100 ) || !( year % 400 ) ))?29:28),31,30,31,30,31,31,30,31,30,31][month-1];
  }

  function getDayOfWeek(year, month, day) {
    var date = new Date(year, month-1, day)
    return date.getUTCDay();
  }

  this.setDate = setDate;
  function setDate(year, month, day) {
    if (dateField) {
      if (month < 10) {month = "0" + month;}
      if (day < 10) {day = "0" + day;}

      var dateString = day + "." + month + "." + year;
      dateField.value = dateString;
      hide();
    }
    return;
  }

  this.changeMonth = changeMonth;
  function changeMonth(change) {
    currentMonth += change;
    currentDay = 1;
    if(currentMonth > 12) {
      currentMonth = 1;
      currentYear++;
    } else if(currentMonth < 1) {
      currentMonth = 12;
      currentYear--;
    }

    calendar = document.getElementById(calendarId);
    calendar.innerHTML = calendarDrawTable();
  }

  this.changeYear = changeYear;
  function changeYear(change) {
    currentYear += change;
    currentDay = 1;
    calendar = document.getElementById(calendarId);
    calendar.innerHTML = calendarDrawTable();
  }

  function getCurrentYear() {
    var year = new Date().getFullYear();
    return year;
  }

  function getCurrentMonth() {
    return new Date().getMonth() + 1;
  } 

  function getCurrentDay() {
    return new Date().getDate();
  }

  function calendarDrawTable() {

    var dayOfMonth = 1;
    var validDay = 0;
    var startDayOfWeek = getDayOfWeek(currentYear, currentMonth, dayOfMonth);
    var daysInMonth = getDaysInMonth(currentYear, currentMonth);
    var lastDay = 0;
	
	var styleHeader = "font:11 Arial; text-decoration:none; color:#FFFFFF;";
	var styleText = "font:11 Arial; text-decoration:none; color:#000000;";
	var styleBack = "";
	var styleCurrentDay = "font:11 Arial; text-decoration:none; color:#000000;";
	var styleCurrentDayBack = "border:1px solid red;";
	var styleWeekday = "font:11 Arial; text-decoration:none; color:#000000;";
	var styleWeekdayBack = "border:1px solid #FFFFFF;";
	var styleWeekend = "font:11 Arial; text-decoration:none; color:#000000;";
	var styleWeekendBack = "background-color:#E9E9E9;";
				
    var table = "";
	table = table + "<table width='147px' cellspacing='0' cellpadding='0' border='0' style='" + styleText + "'>";
    table = table + "  <tr height='20' style='" + styleHeader + "'>";
	table = table + "    <td width='14px' background='images/buttonBack.gif' align='center'><a href='javascript:changeCalendarControlMonth(-1);'><img src='images/calendarPrev.gif' border='0' alt='Önceki Ay'></a></td>";
	table = table + "    <td background='images/buttonBack.gif' align='center'>" + months[currentMonth-1] + "</td>";
	table = table + "    <td width='14px' background='images/buttonBack.gif' align='center'><a href='javascript:changeCalendarControlMonth(1);'><img src='images/calendarNext.gif' border='0' alt='Sonraki Ay'></a></td>";
    table = table + "    <td width='14px' background='images/buttonBack.gif' align='center'><a href='javascript:changeCalendarControlYear(-1);'><img src='images/calendarPrev.gif' border='0' alt='Önceki Sene'></a></td>";
    table = table + "    <td width='30px' background='images/buttonBack.gif' align='center'>" + currentYear + "</td>";
	table = table + "    <td width='14px' background='images/buttonBack.gif' align='center'><a href='javascript:changeCalendarControlYear(1);'><img src='images/calendarNext.gif' border='0' alt='Sonraki Sene'></a></td>";
    table = table + "  </tr>";
	table = table + "</table>";
	table = table + "<table width='147px' cellspacing='0' cellpadding='0' border='0'>";
	table = table + "  <tr>";
	table = table + "    <td colspan='5'>";
	table = table + "      <table width='100%' cellspacing='1' cellpadding='0' bgcolor='#CCCCCC' border='0' style='" + styleText + "'>";
	table = table + "        <tr align='center' bgcolor='#DBE2F0' style='padding:1'>";
	table = table + "          <td>Pt</td>";
	table = table + "          <td>Sl</td>";
	table = table + "          <td>Ca</td>";
	table = table + "          <td>Pe</td>";
	table = table + "          <td>Cm</td>";
	table = table + "          <td>Ct</td>";
	table = table + "          <td>Pz</td>";
	table = table + "        </tr>";
	table = table + "        <tr align='center' bgcolor='#FFFFFF'>";
	for (var week = 0; week < 7; week++) {
	  for (var dayOfWeek = 0; dayOfWeek < 7; dayOfWeek++) {
        if (dayOfMonth == selectedDay && currentYear == selectedYear && currentMonth == selectedMonth) {
          styleText = styleCurrentDay;
		  styleBack = styleCurrentDayBack;
        } else if (dayOfWeek == 5 || dayOfWeek == 6) {
          styleText = styleWeekend;
		  styleBack = styleWeekendBack;
        } else {
          styleText = styleWeekday;
		  styleBack = styleWeekdayBack;
        }
        if (week == 0 && dayOfWeek < startDayOfWeek) {
          validDay = 0;
	  	  table = table + "    <td width='21px' style='" + styleBack + "'>&nbsp;</td>";
		} else if (week == 0 && startDayOfWeek == dayOfWeek) {
          validDay = 1;
        } else if (validDay == 1 && dayOfMonth > daysInMonth) {
          validDay = 0;
        }
		if (validDay) {
          table = table + "    <td width='21px' style='" + styleBack + " cursor:hand;' onclick='javascript:setCalendarControlDate(" + currentYear + "," + currentMonth + "," + dayOfMonth + ");'>" + dayOfMonth + "</td>";
          dayOfMonth++;
		} else if (week > 0 && dayOfWeek == 0 && lastDay == 0) {
		  lastDay = -1;
		} else if (week > 0 && lastDay == 0) {
		  lastDay = dayOfWeek;
		  for (var i = lastDay; i < 7; i++) {
		    if (i == 5 || i == 6) {
              styleText = styleWeekend;
		      styleBack = styleWeekendBack;
		    }
	        table = table + "    <td width='21px' style='" + styleBack + "'>&nbsp;</td>";
	      }
		}
	  }
	  if (lastDay == 0) {
	    table = table + "      <tr align='center' bgcolor='#FFFFFF'>";
	  }
	}	
	table = table + "        </tr>";
	table = table + "      </table>";
	table = table + "    </td>";
	table = table + "  </tr>";
	table = table + "  <tr height='18' style='padding:1'><td colspan='5' background='images/buttonBack.gif' align='center'><a style='" + styleHeader + "' href='javascript:hideCalendarControl();'>Kapat</a></td></tr>";
	table = table + "</table>";

    return table;
  }

  this.show = show;
  function show(field) {
    // If the calendar is visible and associated with
    // this field do not do anything.
    if (dateField == field) {
      return;
    } else {
      dateField = field;
    }

    if(dateField) {
      try {
        var dateString = new String(dateField.value);
        var dateParts = dateString.split("-");
        
        selectedMonth = parseInt(dateParts[0],10);
        selectedDay = parseInt(dateParts[1],10);
        selectedYear = parseInt(dateParts[2],10);
      } catch(e) {}
    }

    if (!(selectedYear && selectedMonth && selectedDay)) {
      selectedMonth = getCurrentMonth();
      selectedDay = getCurrentDay();
      selectedYear = getCurrentYear();
    }

    currentMonth = selectedMonth;
    currentDay = selectedDay;
    currentYear = selectedYear;

    if(document.getElementById){

      calendar = document.getElementById(calendarId);
      calendar.innerHTML = calendarDrawTable(currentYear, currentMonth);

      setElementProperty('display', 'block', 'CalendarControlIFrame');
      setProperty('display', 'block');

      var fieldPos = new positionInfo(dateField);
      var calendarPos = new positionInfo(calendarId);

      var x = fieldPos.getElementLeft();
      var y = fieldPos.getElementBottom();

      setProperty('left', x + "px");
      setProperty('top', y + "px");
      setElementProperty('left', x + "px", 'CalendarControlIFrame');
      setElementProperty('top', y + "px", 'CalendarControlIFrame');
      setElementProperty('width', calendarPos.getElementWidth() + "px", 'CalendarControlIFrame');
      setElementProperty('height', calendarPos.getElementHeight() + "px", 'CalendarControlIFrame');
    }
  }

  this.hide = hide;
  function hide() {
    if(dateField) {
      setProperty('display', 'none');
      setElementProperty('display', 'none', 'CalendarControlIFrame');
      dateField = null;
    }
  }
}

var calendarControl = new CalendarControl();

function showCalendarControl(textField) {
  calendarControl.show(textField);
}

function hideCalendarControl() {
  calendarControl.hide();
}

function setCalendarControlDate(year, month, day) {
  calendarControl.setDate(year, month, day);
}

function changeCalendarControlYear(change) {
  calendarControl.changeYear(change);
}

function changeCalendarControlMonth(change) {
  calendarControl.changeMonth(change);
}

document.write("<iframe id='CalendarControlIFrame' style='display: none; left: 0px; position: absolute;  top: 0px; height: 250px; width: 250px; z-index: 99;' src='javascript:false;' frameBorder='0' scrolling='no'></iframe>");
document.write("<div id='CalendarControl' style='position:absolute; background-color:#FFF; margin:0; padding:0; display:none; z-index: 100;'></div>");